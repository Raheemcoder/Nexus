function remove_tr(n){confirm("Are you sure you want to delete?",function(){var o=$(n).find(":selected").text(),i=$(n).closest("tr").children().find(".projectid").val(),t=$("#weekpicker").val().split("-"),r=t[0].trim(),u=t[1].trim(),f=$("#UserName").val(),e={ProjectId:i,StartDate:r,EndDate:u,UserName:f};deletedData.push(e);n.closest("tr").remove();handler()})}function create_tr(){var t=$("#TEffortTracker").find("tbody"),i=$(t).find("tr").length+1,n="Totalhr";n=n+i;let r=` <tr class="valu">
                                    <td style="text-align:center;" class="first-col">
                                        <div class="justify-center_">
                                                <div class="action_container">
                                                    <button class="plus btn-danger" onclick="remove_tr(this)" title="Delete">
                                                        <i class="fa fa-trash"></i>
                                                    </button>
                                                </div>
                                                <div class="btn-icon -history GetInfoIcon" style="display:none" title="Remarks" onclick="Efforts_Remarks_Section(this)">
                                                    <i class="fas fa-info" aria-hidden="true" ></i>
                                                </div>
                                            </div>
                                    </td>
                                    <td style="padding:0px;" >
                                        <select class="form-control data-singleselect projectid">
                                           "`+ProjectList+`"
                                        </select>
                                        <span class="projectiderrmsg text-danger" style="display:none">Please select Project</span>
                                    </td>
                                    <td style="padding:0px;">
                                    <input type="text" class="form-control EfDay number day1"/>
                                    <span class="day1errormsg text-danger" style="display:none">Please enter Efforts</span>
                                  
                                    </td>
                                     <td style="padding:0px;">
                                     <input type="text" class="form-control EfDay number day2"/>
                                     <span class="day2errormsg text-danger" style="display:none">Please enter Efforts</span>

                                     </td>
                                    <td style="padding:0px;">
                                    <input type="text" class="form-control EfDay number day3" />
                                    <span class="day3errormsg text-danger" style="display:none">Please enter Efforts</span>

                                    </td>
                                    <td style="padding:0px;">
                                    <input type="text" class="form-control EfDay number day4" />
                                    <span class="day4errormsg text-danger" style="display:none">Please enter Efforts</span>

                                    </td>
                                    <td style="padding:0px;">
                                    <input type="text" class="form-control EfDay number day5"/>
                                    <span class="day5errormsg text-danger" style="display:none">Please enter Efforts</span>

                                    </td>
                                     <td style="padding:0px;">
                                     <input type="text" class="form-control EfDay number day6"/>
                                     <span class="day6errormsg text-danger" style="display:none">Please enter Efforts</span>

                                     </td>
                                    <td style="padding:0px;">
                                    <input type="text" class="form-control EfDay number day7" />
                                    <span class="day7errormsg text-danger" style="display:none">Please enter Efforts</span>

                                    </td>
                                    <td style="padding: 0;vertical-align: middle;text-align: center;color: blue;background: #e7ecf7;" class="righttotal">0.00</td>
                                </tr>`;$(table_body).append(r);$(".data-singleselect").select2();highlightColumns()}function findDuplicates(n){return n.filter((t,i)=>n.indexOf(t)!==i)}function getDetails(){var n=[],t=$("#weekpicker").val().split("-");return count=0,$("#TEffortTracker tbody tr").each(function(i){var r,e,u,o;for(projecterrorcount=0,r=$(this),e=$(r).find(".projectid").val(),e===null||e===""||typeof e=="undefined"?($(r).find(".projectiderrmsg").show(),isProjectEmpty.push(1),projecterrorcount++):$(r).find(".projectiderrmsg").hide(),u=1;u<=7;u++){var f="day"+u,s=$(r).find("."+f).val(),h=$(r).find("."+f).val()==NaN?"NaN":$(r).find("."+f).val()==""?"":parseFloat($(r).find("."+f).val()),c=$(r).find(".dayApportion"+u).val()==NaN?"NaN":typeof $(r).find(".dayApportion"+u).val()=="undefined"?"":$(r).find(".dayApportion"+u).val();val=h+c+"";projecterrorcount===0&&val!==null&&val!==""&&typeof val!="undefined"&&val!="0"&&(count=i+1,$(r).find("."+f).removeClass("-danger"),$(r).find("."+f+"errormsg").hide(),o=moment(t[0],"DD/MM/YYYY").add(u-1,"days").format("YYYY-MM-DD"),n.push({ProjectId:e,EffortDate:o,EffortInHrs:parseFloat(s)}))}}),n}function handler(){isValidData=!0;var n=0,t=0,i=0,r=0,u=0,f=0,e=0;$(".day1").each(function(t,i){n+=$(i).val()===null||$(i).val()===""||typeof $(i).val()=="undefined"?0:parseFloat($(i).val());n>24?($(".day1total").show(),isValidData=!1):$(".day1total").hide();$("#day1total").text(n.toFixed(2))});$(".day2").each(function(n,i){t+=$(i).val()===null||$(i).val()===""||typeof $(i).val()=="undefined"?0:parseFloat($(i).val());t>24?($(".day2total").show(),isValidData=!1):$(".day2total").hide();$("#day2total").text(t.toFixed(2))});$(".day3").each(function(n,t){i+=$(t).val()===null||$(t).val()===""||typeof $(t).val()=="undefined"?0:parseFloat($(t).val());i>24?($(".day3total").show(),isValidData=!1):$(".day3total").hide();$("#day3total").text(i.toFixed(2))});$(".day4").each(function(n,t){r+=$(t).val()===null||$(t).val()===""||typeof $(t).val()=="undefined"?0:parseFloat($(t).val());r>24?($(".day4total").show(),isValidData=!1):$(".day4total").hide();$("#day4total").text(r.toFixed(2))});$(".day5").each(function(n,t){u+=$(t).val()===null||$(t).val()===""||typeof $(t).val()=="undefined"?0:parseFloat($(t).val());u>24?($(".day5total").show(),isValidData=!1):$(".day5total").hide();$("#day5total").text(u.toFixed(2))});$(".day6").each(function(n,t){f+=$(t).val()===null||$(t).val()===""||typeof $(t).val()=="undefined"?0:parseFloat($(t).val());f>24?($(".day6total").show(),isValidData=!1):$(".day6total").hide();$("#day6total").text(f.toFixed(2))});$(".day7").each(function(n,t){e+=$(t).val()===null||$(t).val()===""||typeof $(t).val()=="undefined"?0:parseFloat($(t).val());e>24?($(".day7total").show(),isValidData=!1):$(".day7total").hide();$("#day7total").text(e.toFixed(2))});$("#table_body tr").each(function(n,t){var s=$(t).find(".day1").val()===null||$(t).find(".day1").val()===""||typeof $(t).find(".day1").val()=="undefined"?0:parseFloat($(t).find(".day1").val()),i,r,u,f,e,o;s+=$(t).find(".dayApportion1").val()===null||$(t).find(".dayApportion1").val()===""||typeof $(t).find(".dayApportion1").val()=="undefined"?0:parseFloat($(t).find(".dayApportion1").val());i=$(t).find(".day2").val()===null||$(t).find(".day2").val()===""||typeof $(t).find(".day2").val()=="undefined"?0:parseFloat($(t).find(".day2").val());i+=$(t).find(".dayApportion2").val()===null||$(t).find(".dayApportion2").val()===""||typeof $(t).find(".dayApportion2").val()=="undefined"?0:parseFloat($(t).find(".dayApportion2").val());r=$(t).find(".day3").val()===null||$(t).find(".day3").val()===""||typeof $(t).find(".day3").val()=="undefined"?0:parseFloat($(t).find(".day3").val());r+=$(t).find(".dayApportion3").val()===null||$(t).find(".dayApportion3").val()===""||typeof $(t).find(".dayApportion3").val()=="undefined"?0:parseFloat($(t).find(".dayApportion3").val());u=$(t).find(".day4").val()===null||$(t).find(".day4").val()===""||typeof $(t).find(".day4").val()=="undefined"?0:parseFloat($(t).find(".day4").val());u+=$(t).find(".dayApportion4").val()===null||$(t).find(".dayApportion4").val()===""||typeof $(t).find(".dayApportion4").val()=="undefined"?0:parseFloat($(t).find(".dayApportion4").val());f=$(t).find(".day5").val()===null||$(t).find(".day5").val()===""||typeof $(t).find(".day5").val()=="undefined"?0:parseFloat($(t).find(".day5").val());f+=$(t).find(".dayApportion5").val()===null||$(t).find(".dayApportion5").val()===""||typeof $(t).find(".dayApportion5").val()=="undefined"?0:parseFloat($(t).find(".dayApportion5").val());e=$(t).find(".day6").val()===null||$(t).find(".day6").val()===""||typeof $(t).find(".day6").val()=="undefined"?0:parseFloat($(t).find(".day6").val());e+=$(t).find(".dayApportion6").val()===null||$(t).find(".dayApportion6").val()===""||typeof $(t).find(".dayApportion6").val()=="undefined"?0:parseFloat($(t).find(".dayApportion6").val());o=$(t).find(".day7").val()===null||$(t).find(".day7").val()===""||typeof $(t).find(".day7").val()=="undefined"?0:parseFloat($(t).find(".day7").val());o+=$(t).find(".dayApportion7").val()===null||$(t).find(".dayApportion7").val()===""||typeof $(t).find(".dayApportion7").val()=="undefined"?0:parseFloat($(t).find(".dayApportion7").val());$(t).find(".righttotal").text((s+i+r+u+f+e+o).toFixed(2))});$("#FinalTotal").text((n+t+i+r+u+f+e).toFixed(2))}function highlightColumns(){$("#TEffortTracker thead tr th").each(function(){var n;holidays.includes($(this).attr("data-attr"))&&(n=$(this).parent().find("th").index(this),$("#TEffortTracker tbody td:nth-child("+(n+1)+") input:nth-child(1)").css("background-color","#bab7ffd1"));leaves.includes($(this).attr("data-attr"))&&(n=$(this).parent().find("th").index(this),$("#TEffortTracker tbody td:nth-child("+(n+1)+") input:nth-child(1)").css("background-color","#90EE90"))})}function Efforts_Remarks_Section(n){var c=$(n).closest("tr"),t=$.trim(c.find(".projectid").val()),f="";$.ajax({url:ROOT+"EffortTracker/ProjectDropDown",type:"get","async":!1,dataType:"json",success:function(n){n!=null&&$.each(n,function(n,i){i.ProjectCode==t&&(f=i.ProjectName);var r=f.replace(t,"").trim();$("#EffortBookingRemarks_ProductName").text(r+" Effort Remarks");$("#EffortBookingRemarks_productid").text(t)})}});$.ajax({type:"Get",url:ROOT+"EffortTracker/GetProjectRemarks",data:{ProjectId:t},dataType:"HTML",success:function(n){var r,u;App_jsons=JSON.parse(n);const f=App_jsons.filter(n=>!deletedRemarksData.some(t=>t.RemarksId===n.RemarksId));const e=savedProjectIdData.filter(n=>!deletedRemarksData.some(t=>t.Remarks===n.Remarks&&t.RemarksDate===n.RemarksDate&&t.ProjectId===n.ProjectId)),o=f.concat(e);r=o.filter(n=>n.ProjectId==t);$.jgrid.gridUnload("#remarks_info");$("#remarks_info").jqGrid({height:"auto",datatype:"local",data:r,mtype:"GET",colModel:colmodels1,loadonce:!0,viewrecords:!0,pager:"#pager_remarks",rowNum:1e5,scroll:!0,gridComplete:function(){var t=$("#remarks_info tbody tr"),r=$("#remarks_info tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$(".ui-jqgrid-bdiv").css({"max-height":"45vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});u=$(".ui-jqgrid-bdiv").find("tbody").height();u>330?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","17px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))},error:function(){alert("Error occured!!")}});$("#remarks_section").modal("show");var l=$("#weekpicker").val(),r=l.split("-"),u=moment();if(r.length>1)var e=r[0].trim(),o=r[1].trim(),s=moment(moment(e,"DD/MM/YYYY").toDate()).format("DD/MM/YYYY"),h=moment(moment(o,"DD/MM/YYYY").toDate()).format("DD/MM/YYYY");else var e=u.clone().startOf("week").day(0),o=u.clone().endOf("week").day(6),s=moment(moment(e,"DD/MM/YYYY").toDate()).format("DD/MM/YYYY"),h=moment(moment(o,"DD/MM/YYYY").toDate()).format("DD/MM/YYYY");$(".weekdatepicker").datepicker({startDate:s,endDate:h,format:"dd-mm-yyyy",todayHighlight:!0,autoclose:!0,beforeShowDay:function(n){var t=n.setHours(0,0,0,0);return[t>=s&&t<=h]}});$(".weekdatepicker").val(u.format("DD-MM-YYYY"))}function remove_row(n){confirm("Are you sure you want to delete?",function(){var i=$("#EffortBookingRemarks_productid").text(),t=jQuery("#remarks_info").jqGrid("getRowData",n),r={ProjectId:i,Remarks:t.Remarks,RemarksDate:t.RemarksDate,RemarksId:t.RemarksId};deletedRemarksData.push(r);$("#remarks_info").jqGrid("delRowData",n);$("#remarks_info").trigger("reloadGrid")})}var ProjectList=[],count=0,projecterrorcount=0,RowNumber="",isValidData=!0,isSubmitted=!1,deletedData,date,today,duplicateProjects,isProjectEmpty,Remarks,ApprovedStatus,$TableHeight;$(".projectid").prop("disabled",!0);$("#weekpicker").datepicker({autoclose:!0,viewMode:"months",endDate:"+0d",forceParse:!1}).on("changeDate",function(n){var t=n.date,i=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()+6);$("#weekpicker").datepicker("update",i);$("#weekpicker").val(("0"+i.getDate()).slice(-2)+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+i.getFullYear()+" - "+("0"+r.getDate()).slice(-2)+"/"+("0"+(r.getMonth()+1)).slice(-2)+"/"+r.getFullYear())});$(function(){var n=new Date(moment($("#WeekPickerHidden").val(),"DD/MM/YYYY")),t=new Date(moment($("#WeekPickerHidden").val(),"DD/MM/YYYY").add(6,"days"));$("#weekpicker").datepicker("update",n);$("#weekpicker").val(("0"+n.getDate()).slice(-2)+"/"+("0"+(n.getMonth()+1)).slice(-2)+"/"+n.getFullYear()+" - "+("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear());$.ajax({url:ROOT+"EffortTracker/ProjectDropDown",type:"POST","async":!1,dataType:"json",success:function(n){n!=null&&(ProjectList+="<option value=>Select<\/option>",$.each(n,function(n,t){ProjectList+="<option value="+t.ProjectCode+">"+t.ProjectName+"<\/option>"}))}})});deletedData=[];$(".dayApportion1, .dayApportion7").css("background-color","#dddddd");date=new Date;today=new Date(date.getFullYear(),date.getMonth(),date.getDate());$(".data-datepicker-month").datepicker({format:"M-yyyy",viewMode:"months",minViewMode:"months",todayHighlight:!0,autoclose:!0});$(".data-datepicker-month").datepicker("setDate",today);$(".data-singleselect").select2();$(document).on("select2:open",n=>{const t=$(n.target).data("select2");t.options.get("multiple")||t.dropdown.$search.get(0).focus()});$("[data-datepicker]").datepicker({todayHighlight:!0,autoclose:!0});$(".js-select2").select2({placeholder:"Select HUB",allowHtml:!0,allowClear:!1,includeSelectAllOption:!0});$("#searchbtn").on("click",function(){var n=$("#weekpicker").val().split("-"),t=$.trim(n[0]),i=$.trim(n[1]);window.location.href=ROOT+"EffortTracker/EffortTracker?q="+Encrypt("StartDate="+t+"&EndDate="+i)});duplicateProjects=[];isProjectEmpty=[];$("#SaveData").on("click",function(){var f,r,n;isProjectEmpty=[];$("#SaveData").prop("disabled",!1);duplicateProjects=[];duplicateProjectsNames=[];$("#table_body tr").each(function(n,t){duplicateProjects.push($(t).find(":selected").text())});var t=findDuplicates(duplicateProjects),i=getDetails(),e=$("#table_body tr").length,u=$("#weekpicker").val().split("-"),h=u[0].trim(),c=u[1].trim();const o=savedProjectIdData.filter(n=>!deletedRemarksData.some(t=>t.Remarks===n.Remarks&&t.RemarksDate===n.RemarksDate&&t.ProjectId===n.ProjectId)),s=App_jsons.filter(n=>deletedRemarksData.some(t=>t.RemarksId===n.RemarksId));if(f=o,isValidData)if($("#table_body tr").length>0){if(t.length==0)if(projecterrorcount===0&&count===e){if(isSubmitted)return!1;isSubmitted=!0;$("#JsonData").val(JSON.stringify(i));console.log(i);$.ajax({url:ROOT+"EffortTracker/SaveData",type:"POST","async":!1,dataType:"json",data:{EffortDetails:JSON.stringify(i),DeletedDetais:JSON.stringify(deletedData),RemarksAddedProjectIds:JSON.stringify(f),DeletedRemarksDetails:JSON.stringify(s)},success:function(){isSubmitted=!1;window.location.reload()},error:function(){isSubmitted=!1}});$("#SaveData").prop("disabled",!0)}else alert("Please enter efforts for atleast one day for each project");else if(isProjectEmpty.length==0){for($("#table_body tr").each(function(n,i){var r=$(i).find(":selected").text();$.inArray(r,t)!=-1&&$("#table_body tr").each(function(n,t){var i=$(t).find(":selected").text();i==r&&$(t).closest("tr").addClass("text-warning bg-warning")})}),r="<br><b>",n=0;n<t.length;n++)r+=n+1+") "+t[n]+"<br>";alert("The project id should be unique.Duplicate projects are not allowed "+r);setTimeout(function(){$("#table_body tr").each(function(n,t){$(t).removeClass("bg-warning")})},2e4)}}else alert("Atleast one record is mandatory")});$(document).on("keyup",".EfDay",function(){if(isValidData=!0,this.value=this.value.replace(/[^0-9.]/g,""),$(this).val()!==null&&$(this).val()!==""&&typeof $(this).val()!="undefined")/^((([0-9])|1[0-9]|2[0-3])(\.[0-9]{0,2})?|24)$/.test($(this).val())||$(this).val($(this).val().slice(0,-1)),$(this).removeClass("-danger"),$(this).siblings("span").hide();handler()});$(document).ready(function(){handler()});Remarks=$("#Remarks").val();Remarks==""?$(".Remarks").hide():$("#Remarks").show();ApprovedStatus=$("#Status").val();ApprovedStatus=="2"&&$(".pendingStatus").show();ApprovedStatus=="1"&&($("#SaveData").hide(),$(".action_container").hide(),$(".projectid").prop("disabled",!0),$(".approvedStatus").show(),$("#TEffortTracker").find("tr").find("th:first").hide(),$(".first-col").hide(),$("tfoot").find("td:first").remove(),$("#effortsApproved").hide());$("#table_body tr").each(function(n,t){for(var i,r,n=1;n<8;n++)i=$(t).find(".day"+n).val(),r="",i=="0.00"&&$(t).find(".day"+n+":first").val("")});var holidaysList=JSON.parse($("#HolidaysList").val()),leavesList=JSON.parse($("#LeavesList").val()),holidays=holidaysList.flatMap(function(n){return Object.values(n)}),leaves=leavesList.flatMap(function(n){return Object.values(n)});highlightColumns();colmodels1=[{name:"",label:"Action",resizable:!0,ignoreCase:!0,width:40,formatter:function(n,t){return`<div class="justify-center_">
            <a onclick="remove_row(`+t.rowId+`)" class="btn-icon -delete"><i class="fa fa-trash" title="Delete" aria-hidden="true"</i></a></div>`}},{name:"RemarksDate",label:"Date",resizable:!0,ignoreCase:!0},{name:"Remarks",label:"Remarks",resizable:!0,ignoreCase:!0},{name:"RemarksId",label:"RemarksId",resizable:!0,ignoreCase:!0,hidden:!0}];$("#remarks_info").jqGrid({dataType:"json",data:[],colModel:colmodels1,loadonce:!0,viewrecords:!0,pager:"#pager_remarks",rowNum:20,scroll:1,gridComplete:function(){var t=$("#remarks_info tbody tr"),r=$("#remarks_info tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$(".ui-jqgrid-bdiv").css({"max-height":"45vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"5vh"});$TableHeight=$(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>330?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","17px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"));var addedData={},savedProjectIdData=[],deletedRemarksData=[],App_jsons=[];$("#Save_projectRemarks").on("click",function(){var o=$("#EffortBookingRemarks_productid").text(),n=$("#RemarksDate").val(),t=$.trim($("#ProjectRemarks").val()),i,r,u,f,e;n==""||t==""?$("#Save_projectRemarks").attr("disabled",!0):($("#Save_projectRemarks").attr("disabled",!1),i=[],r={},r={RemarksDate:n,Remarks:t},i.push(r),u=$("#remarks_info").jqGrid("getGridParam","data"),f=$.merge(u,i),$("#remarks_info").jqGrid("setGridParam",{data:f}),$("#remarks_info").trigger("reloadGrid",[{page:1}]),addedData={ProjectId:o,RemarksDate:n,Remarks:t},$(".closeModal").val(""),e=moment(),$(".weekdatepicker").val(e.format("DD-MM-YYYY")),savedProjectIdData.push(addedData));$("#Save_projectRemarks").attr("disabled",!1)});$(".weekdatepicker").keydown(function(n){if(n.key=="Backspace")return!1});$(".weekdatepicker").keypress(function(n){var t=$(this).val(),i=[45],r;if(n.which>=48&&n.which<=57&&i.push(n.which),i.indexOf(n.which)==-1){n.preventDefault();return}if((t.match(/-/g)||[]).length>=2){n.preventDefault();return}if(r=/^\d{2}-\d{2}-\d{4}$/,!r.test(t)){n.preventDefault();return}});$(".weekpicker").keydown(function(n){if(n.key=="Backspace")return!1});$(".weekpicker").keypress(function(n){var t,i,r;if(t=$(this).val(),i=[45],n.which>=48&&n.which<=57&&i.push(n.which),i.indexOf(n.which)==-1){n.preventDefault();return}if((t.match(/-/g)||[]).length>=2){n.preventDefault();return}if(r=/^\d{2}-\d{2}-\d{4}$/,!r.test(t)){n.preventDefault();return}});$(window).on("hidden.bs.modal",function(){$(".closeModal").val("");$(".Error_closeModal").hide()});$(document).on("change",".projectid",function(){var n=$(this).closest("tr").find(".projectid").val();n==""?$(this).closest("tr").find(".GetInfoIcon").hide():(n!=""||n!=null||n!=undefined)&&$(this).closest("tr").find(".GetInfoIcon").show()});