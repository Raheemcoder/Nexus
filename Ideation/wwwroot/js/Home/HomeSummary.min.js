function FetchHubData(n,t){var i=!0,t=$("#ProjectId option:Selected").text(),n=$("#ProjectId").children(":selected").attr("value"),u=parseInt($("#Hub option:selected").val()),r;n=="0"?($(".projectName_error").show(),i=!1,$(".projectName_error").html("Please Select Project Name")):$(".projectName_error").hide();u==0?($(".hubName_error").text("Please Select HUB"),i=!1):$(".hubName_error").text("");i?$.ajax({dataType:"json",url:ROOT+"Home/GetSummaryVersion",method:"POST",data:{projectId:n,projectName:t,HubId:u},success:function(n){n.length>0?($("#Version").empty(),$.each(n,function(n,t){$("#Version").append("<option value="+t.Value+">"+t.Text+"<\/option>")}),$("#Version").select2(),$("#Version").trigger("change"),$("#dispVersion").show()):($("#Version").empty(),$("#Version").select2(),$("#Version").trigger("change"),$("#dispVersion").hide())},error:function(){}}):(r="",$("#Version").empty(),$("#Version").select2(),$("#Version").trigger("change"),$("#DisplayVersionRemarks").attr("hidden",!0),$("#DisplayVersionRemarks").hide(),CreateJqGrid(r),CreateJqGridModal(r))}function CreateJqGrid(n){$.jgrid.gridUnload("#jqgrid");$("#jqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"Get",colModel:models,loadonce:!0,viewrecords:!0,rowNum:n.length,pager:"#pager",scroll:1,subGrid:!0,subGridOptions:{hasSubgrid:function(n){console.log(n);var t=n.data.subgridData;return t!=null&&t.length>0}},subGridRowExpanded:function(n,t){var r=$("#ProjectId").children(":selected").attr("value"),i=n+"_t",u=jQuery("#jqgrid").jqGrid("getRowData",t),f=u.SequenceNo;$("#"+n).html("<table id='"+i+"'><\/table>");$("#"+i).jqGrid({url:ROOT+"Master/GetProjectSummarySubMilestoneDetails",datatype:"json",mtype:"GET",colModel:Submodels,postData:{projectId:r,SequenceNo:f},loadonce:!0,viewrecords:!0,rowNum:1e4,scroll:!0,pager:"#pager_id",height:"auto"})},userDataOnFooter:!0,gridComplete:function(){var t=$("#jqgrid tbody tr"),r=$("#jqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))},loadComplete:function(){for(var r,f,n,t,u=$("#jqgrid").getDataIDs(),i=0;i<u.length;i++)r=u[i],f=$("#jqgrid").getRowData(r),f.SubmilestoneExit!="True"&&$("#"+r+">td.sgcollapsed").unbind("click").html("");n=$("#jqgrid");t=n.jqGrid("getCol","Amount",!1,"sum");n.jqGrid("footerData","set",{OrderQtyInPallets:"Total Amount $:"});n.jqGrid("footerData","set",{Amount:parseFloat(n.jqGrid("getCol","Amount",!1,"sum")).toFixed(2)});$(".tamounteuro").text(parseFloat(t).toFixed(2));parseInt(t)!==0?$(".tamountdlr").text(parseFloat(1/t).toFixed(2)):0}});$("#jqgrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});var t=$(".ui-jqgrid-bdiv").find("tbody").height();t>278?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","0px")}function CreateJqGridModal(n){Historydata=n}function LoadModal(n){var t=$("#ProjectId").children(":selected").attr("value"),n=n,i=parseInt($("#Hub option:selected").val()),r=$("#Version option:selected").text();$.ajax({url:ROOT+"GanttChart/GetPMUMappingHistory",type:"Get",datatype:"json",data:{projectId:t,SlNo:n,HubId:i,Version:r},success:function(n){console.log("result",n);$("#HistoryGrid").jqGrid("clearGridData",!0);$("#HistoryGrid").jqGrid("setGridParam",{data:n});$("#HistoryGrid").trigger("reloadGrid");$("#HistoryModal").modal("show")}})}function DownloadUploadedImage(n){var i=jQuery("#FileUploadjqgrid").jqGrid("getRowData",n),t=uploadedFiles.findIndex(n=>n.FileName==i.FileName);if(uploadedFiles[t].FileName!="")return FileName=uploadedFiles[t].FileName.replaceAll('"',""),$("#"+n+"DownloadImageOrFile").attr("href",ROOT+"Master/DownloadPackageImageFile?fileName="+FileName.trim()),!0}function ViewUploadedImages(n){var t=$("#ProjectId").children(":selected").attr("value"),i=parseInt($("#Hub option:selected").val()),r=$("#Version option:selected").text();$.ajax({url:ROOT+"Master/DisplayUploadedFiles",type:"POST",dataType:"JSON",data:{ProjectId:t,SeqNo:n,HubId:i,Version:r},success:function(n){var t;if(console.log("uploadedFiles",n),uploadedFiles=[],n.length>0){for(t=0;t<=n.length-1;t++)uploadedFiles.push(n[t]);for(t=0;t<=uploadedFiles.length-1;t++)uploadedFiles[t].rowId=t+1}$("#FileUploadjqgrid").jqGrid("clearGridData",!0);jQuery("#FileUploadjqgrid").jqGrid("setGridParam",{data:uploadedFiles});jQuery("#FileUploadjqgrid").trigger("reloadGrid");CreateJQGridUploadFile(uploadedFiles);$("#dependentMilestones").modal("show")}})}function CreateJQGridUploadFile(n){$("#FileUploadjqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"Get",colModel:filemodels,loadonce:!0,viewrecords:!0,rowNum:1e4,pager:"#FileUploadpager",userDataOnFooter:!0,gridComplete:function(){var t=$("#FileUploadjqgrid tbody tr"),r=$("#FileUploadjqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#FileUploadjqgrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"})}function GetExcelData(){var t=parseInt($("#ProjectId").children(":selected").attr("value")),i=parseInt($("#Hub option:selected").val()),u=$("#ProjectId option:selected").text(),f=$("#Version option:selected").text(),e=$("#Hub option:selected").text(),n=!0,r;t==0&&i==0?(alert("Please select Project and Hub"),n=!1):t==0?(alert("Please select Project"),n=!1):i==0?(alert("Please select Hub"),n=!1):(r=$("#jqgrid").jqGrid("getGridParam","data"),r.length===0&&(alert("No data in Grid"),n=!1));n&&(window.location.href=ROOT+"Home/GetExcelSummaryData?projectId="+t+"&&projectName="+u+"&&HubId="+i+"&&HubName="+e+"&&Version="+f)}function GetHubList(n){n==1&&(n=$("ProjectId").val());$.ajax({dataType:"json",url:ROOT+"Home/GetHubBasedOnProjectId",method:"get",data:{projectId:n},success:function(n){var i="",r=$("#Hub").val(),t;if(n.length>0){for($("#Hub").html(""),i+='<option  value="0">Select Hub<\/option>',t=0;t<n.length;t++)i+=n[t].HubApproved==="1"?'<option  data-bgcolor="#358375 !important;" class="approvedHub" value="'+n[t].HubId+'">'+n[t].HubName+"<\/option>":n[t].HubApproved==="0"&&n[t].HubSaved==="1"?'<option  data-bgcolor="#db8c44 !important;" class="savedHub" value="'+n[t].HubId+'">'+n[t].HubName+"<\/option>":'<option value="'+n[t].HubId+'">'+n[t].HubName+"<\/option>";$("#Hub").html(i);$("#Hub").val(r);$("#Hub").select2({templateResult:function(n){if(!n.id)return n.text;var t=$(n.element),i=t.data("bgcolor")||"block",r=t.text();return $('<span style="color: '+i+';  font-weight: bold;">'+r+"<\/span>")}})}}})}var selectedval="n",GridData=[],isExport=!1,Historydata,data;$(document).ready(function(){var n;if($("#dispVersion").hide(),$(".hubName_error").text("Please Select HUB"),n=2,$("[data-singleselect]").select2({templateselection:function(n){return alert("dsfdb"),formatSelection(n,"uppercase")}}),models=[{name:"SequenceNo",label:"S.No",width:60,resizable:!0,ignoreCase:!0,search:!1},{name:"WBSHeaderDesc",label:"WBS Header",resizable:!0,ignoreCase:!0},{name:"TaskDesc",label:"Task Name",resizable:!0,ignoreCase:!0},{name:"SetRelation",label:"Dependency",resizable:!0,ignoreCase:!0},{name:"Status",label:"Task Status",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return i.Status=="Open"?'<div class="m-table__status -justify-center"><span class="m-table__text Open"> '+i.Status+"<\/span><\/div>":i.Status=="In Progress"?'<div class="m-table__status -justify-center"><span class="m-table__text NotStarted"> '+i.Status+"<\/span><\/div>":i.Status=="Completed"?'<div class="m-table__status -justify-center"><span class="m-table__text Completed"> '+i.Status+"<\/span><\/div>":i.Status=="OverDue"?'<div class="m-table__status -justify-center"><span class="m-table__text Overdue"> '+i.Status+"<\/span><\/div>":""}},{name:"baselineStartDate",label:"Baseline Start Date",resizable:!0,ignoreCase:!0},{name:"baselineEndDate",label:"Baseline End Date",resizable:!0,ignoreCase:!0},{name:"StartDate",label:"Version Start Date",resizable:!0,ignoreCase:!0},{name:"EndDate",label:"Version End Date",resizable:!0,ignoreCase:!0},{name:"CompletedDate",label:"Submitted Date",resizable:!0,ignoreCase:!0},{name:"ActualCompletedDate",label:"Actual Completed Date",resizable:!0,ignoreCase:!0},{name:"UserName",label:"User Name",resizable:!0,ignoreCase:!0},{name:"Extention",label:"Remarks",resizable:!0,ignoreCase:!0},{name:"Completion",label:"Completion Remarks",resizable:!0,ignoreCase:!0},{name:"Remarks",label:"History",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return'<div class="grid-text-icon"><a href=""  onclick="LoadModal('+i.SequenceNo+')" class="grid-icon-only -medidum-size" data-toggle="modal" title="History"><i class="fas fa-comment-alt"><\/i><\/a><\/div>'}},{name:"FileName",label:"File Download",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return parseInt(i.FileName)==1?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.SequenceNo+')" class="icon_color text-success btn_button" title="View" id="'+t.rowId+'viewuploadedfile"><i class="fas fa-eye"><\/i><\/a><\/div>':""}},{name:"SubmilestoneExit",label:"SubmilestoneExit",hidden:!0,resizable:!0,ignoreCase:!0}],$("#selectedProjectName").val()!=undefined||$("#selectedHubName").val()!=undefined){var i=$("#selectedProjectName").val(),n=$("#selectedProjectId").val(),r=$("#selectedHubName").val(),t=$("#selectedHubId").val();$("div.id_100 select").select2().val(n).trigger("change");$("div.id_hub select").select2().val(t).trigger("change");selected="s";$.ajax({dataType:"json",url:ROOT+"Home/MilestoneList",method:"POST",data:{projectId:n,projectName:i,HubId:t,HubName:r},success:function(n){n=JSON.parse(n);GridData=n;n.length>0?($("#DisplayVersionRemarks").removeAttr("hidden"),$("#DisplayVersionRemarks").show()):($("#DisplayVersionRemarks").attr("hidden",!0),$("#DisplayVersionRemarks").hide());$("#jqgrid").jqGrid("clearGridData",!0);jQuery("#jqgrid").jqGrid("setGridParam",{data:n});jQuery("#jqgrid").trigger("reloadGrid");CreateJqGrid(n);CreateJqGridModal(n)},error:function(){}})}else $("div.id_100 select").select2().val("0").change(),selected="s";Submodels=[{name:"SequenceNo",label:"Milestone Id",resizable:!0,hidden:!0,ignoreCase:!0},{name:"SubMilestoneId",resizable:!0,label:"Sub Milestone Id",ignoreCase:!0},{name:"SubMilestoneName",resizable:!0,label:"Sub Milestone Name",ignoreCase:!0},{name:"SetRelation",resizable:!0,label:"Set Relation",ignoreCase:!0},{name:"RelationType",resizable:!0,label:"Relation Type",ignoreCase:!0,hidden:!0},{name:"Duration",resizable:!0,label:"Duration",ignoreCase:!0},{name:"Status",label:"Milestone Status",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return i.Status=="Open"?'<div class="m-table__status -justify-center"><span class="m-table__text Open"> '+i.Status+"<\/span><\/div>":i.Status=="Not Started"?'<div class="m-table__status -justify-center"><span class="m-table__text NotStarted"> '+i.Status+"<\/span><\/div>":i.Status=="Completed"?'<div class="m-table__status -justify-center"><span class="m-table__text Completed"> '+i.Status+"<\/span><\/div>":i.Status=="OverDue"?'<div class="m-table__status -justify-center"><span class="m-table__text Overdue"> '+i.Status+"<\/span><\/div>":""}},{name:"baselineStartDate",label:"Baseline Start Date",resizable:!0,ignoreCase:!0},{name:"baselineEndDate",label:"Baseline End Date",resizable:!0,ignoreCase:!0},{name:"StartDate",label:"Start Date",resizable:!0,ignoreCase:!0},{name:"EndDate",label:"End Date",resizable:!0,ignoreCase:!0},{name:"CompletedDate",label:"Submitted Date",resizable:!0,ignoreCase:!0},{name:"ActualCompletedDate",label:"Actual Completed Date",resizable:!0,ignoreCase:!0},{name:"UserName",label:"User Name",resizable:!0,ignoreCase:!0},{name:"Extention",label:"Remarks",resizable:!0,ignoreCase:!0},{name:"Completion",label:"Completion Remarks",resizable:!0,ignoreCase:!0},{name:"Remarks",label:"History",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return i.Remarks==null&&(i.Remarks=""),'<div class="grid-text-icon"><a href=""  onclick="LoadModal('+i.SubMilestoneId+')" class="grid-icon-only -medidum-size" data-toggle="modal" title="History"><i class="fas fa-comment-alt"><\/i><\/a><\/div>'}},{name:"FileName",label:"File Download",resizable:!0,ignoreCase:!0,hidden:!0,formatter:function(n,t,i){return i.FileName=="1"?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.SequenceNo+')" class="icon_color text-success btn_button" title="View" id="'+t.rowId+'viewuploadedfile"><i class="fas fa-eye"><\/i><\/a><\/div>':""}},]});$("#ProjectId").change(function(){FetchHubData();GetHubList($("#ProjectId").children(":selected").attr("value"));$("#dispVersion").hide()});$("#Hub").on("change",function(){FetchHubData();$("#dispVersion").hide()});data=JSON.parse("{}");models=[{name:"Id",label:"Version",width:100,resizable:!0,ignoreCase:!0,hidden:!0},{name:"ModifiedStartDate",label:"Start Date",width:100,resizable:!0,ignoreCase:!0},{name:"ModifiedEndDate",label:"End Date",width:100,resizable:!0,ignoreCase:!0},{name:"CompltedDate",label:"Submitted Date",width:100,resizable:!0,ignoreCase:!0},{name:"ActualCompletedDate",label:"Actual Completed Date",width:100,resizable:!0,ignoreCase:!0},{name:"ModifiedBy",label:"Action by",width:100,resizable:!0,ignoreCase:!0},{name:"Extention",label:"Remarks",width:100,resizable:!0,ignoreCase:!0},{name:"Completion",label:"Completion Remarks",width:100,resizable:!0,ignoreCase:!0}];$("#HistoryGrid").jqGrid({url:"",datatype:"local",data:data,mtype:"GET",colModel:models,loadonce:!0,viewrecords:!0,rowNum:100,scroll:1,pager:"#HistoryGridPager",gridComplete:function(){var t=$("#HistoryGrid tbody tr"),r=$("#HistoryGrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))},loadComplete:function(){var n=$("#HistoryGrid"),t;$("#HistoryGrid").jqGrid("setGridParam",{beforeSelectRow:function(n,t){return $(t.target).is("input:checkbox")}});t=n.jqGrid("getCol","Amount",!1,"sum");n.jqGrid("footerData","set",{OrderQtyInPallets:"Total Amount $:"});n.jqGrid("footerData","set",{Amount:parseFloat(n.jqGrid("getCol","Amount",!1,"sum")).toFixed(2)});$(".tamounteuro").text(parseFloat(t).toFixed(2));parseInt(t)!==0?$(".tamountdlr").text(parseFloat(1/t).toFixed(2)):0}});$("#HistoryGrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});filemodels=[{name:"MilestoneId",label:"Milestone Id",resizable:!0,ignoreCase:!0,hidden:!0},{name:"RowId",label:"RowId",resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1},{name:"SequenceNo",label:"Milestone No",width:60,resizable:!0,ignoreCase:!0,sortable:!1,hidden:!0},{name:"MilestoneName",resizable:!0,width:100,label:"Milestone Name",ignoreCase:!0,sortable:!1,hidden:!0},{name:"FileName",resizable:!0,width:100,label:"File Name",ignoreCase:!0,sortable:!1},{name:"UploadedBy",resizable:!0,width:100,label:"Uploaded By",ignoreCase:!0,sortable:!1},{name:"UploadedDate",resizable:!0,width:100,label:"Uploaded Date",ignoreCase:!0,sortable:!1},{name:"Action",label:"Action",width:50,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="grid-icons-group -justify-center" id="'+i.rowId+'DisplayIcons"><a class="grid-icon-only Approveicon" href="'+ROOT+"PMUMappingsUploads/"+$("#ProjectId").val()+"/"+i.SequenceNo+"/"+decodeURIComponent(i.FileName)+'" download class="icon_color text-success btn_button" title = "Download" id = "'+i.rowId+'DownloadImageOrFile" ><i class="fas fa-download"><\/i><\/a><\/div>'}}];$("#uploadedbtnok").click(function(){$("#dependentMilestones").modal("hide")});versionmodels=[{name:"VersionId",label:"Version Id",resizable:!0,ignoreCase:!0,hidden:!0},{name:"OldVersion",label:"Previous Version ",resizable:!0,ignoreCase:!0,width:30},{name:"NewVersion",label:"Version ",resizable:!0,ignoreCase:!0,width:30},{name:"RemarksType",label:"Remarks",resizable:!0,ignoreCase:!0,width:30},{name:"CreatedBy",label:"Created By",resizable:!0,ignoreCase:!0,width:30},{name:"CreatedDate",label:"Created Date",resizable:!0,ignoreCase:!0,width:30},];$("#Versionremarksdisplay").jqGrid({url:"",datatype:"local",data:data,mtype:"Get",colModel:versionmodels,loadonce:!0,viewrecords:!0,rowNum:1e4,pager:"#Versionremarksdisplaypager",userDataOnFooter:!0,gridComplete:function(){var t=$("#Versionremarksdisplay tbody tr"),r=$("#Versionremarksdisplay tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#Versionremarksdisplay").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$("#DisplayVersionRemarks").click(function(){var n=$("#ProjectId").children(":selected").attr("value"),t=parseInt($("#Hub option:selected").val()),i=$("#Version option:selected").text();$.ajax({dataType:"json",url:ROOT+"Home/GetVersionRemarksDetails",method:"get",data:{projectId:n,HubId:t,Version:i},success:function(n){n=JSON.parse(n);console.log(n);$("#Versionremarksdisplay").jqGrid("clearGridData",!0);$("#Versionremarksdisplay").jqGrid("setGridParam",{data:n});$("#Versionremarksdisplay").trigger("reloadGrid");$("#VersionRemarkspop").modal("show")},error:function(){}})});$("#Version").on("change",function(){var n=parseInt($("#ProjectId").children(":selected").attr("value")),t=parseInt($("#Hub option:selected").val()),i=$("#Hub option:selected").text(),r=$("#ProjectId option:Selected").text(),u=$("#Version option:selected").text();$.ajax({dataType:"json",url:ROOT+"Home/MilestoneList",method:"POST",data:{projectId:n,projectName:r,HubId:t,HubName:i,Version:u},success:function(n){n=JSON.parse(n);console.log(n);GridData=n;n.length>0?($("#DisplayVersionRemarks").removeAttr("hidden"),$("#DisplayVersionRemarks").show()):($("#DisplayVersionRemarks").attr("hidden",!0),$("#DisplayVersionRemarks").hide());CreateJqGrid(n);CreateJqGridModal(n)},error:function(){}})});