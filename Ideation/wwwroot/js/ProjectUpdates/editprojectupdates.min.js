function validateSaveForm(){var t=!0,n;$("#ProjectLead").val()==""&&$("#ProjectLeadID").val("");n=CKEDITOR.instances.Comments.getData();$("#Save_Ok").prop("disabled",!1);$(".Err_PU").hide();n==""&&(t=!1,n==""?$("#Err_Comments").show():$("#Err_Comments").hide());t&&($("#SaveModal").modal("show"),$("#Save_Ok").click(function(){$("#Save_Ok").prop("disabled",!0);$("#ProjectCode").val(projectMasterData[0].ProjectCode);$("#ProjectUpdates_Details_Submit").submit()}))}function validateFileUpload(){var r=!0,o=["pdf","doc","docx","xls","txt","xlsx","ppt","zip","jpg","jpeg","png","csv"],u=0,f=[],n,s,t,e,i;if(f=$(`#UploadDocument`).get(0).files,$.each(f,function(n,t){var i=t.name.split(".").pop().toLowerCase();if(jQuery.inArray(i,o)===-1)return alert("Please upload a valid file"),$(`#UploadDocument`).val(""),r=!1,!1}),r)for(n=0;n<$(`#UploadDocument`).get(0).files.length;n++){if(s=["Bytes","KB","MB","GB","TB"],u+=$(`#UploadDocument`).get(0).files[n].size/1024,u>5120)return alert("The file size should be less than 5 MB"),$("#UploadDocument").val(""),$("#deleteSelectedFile").hide(),$(`#UploadDocument`).get(0).val(""),!1;t=[];e=$(`#UploadDocument`).get(0).files[n];t.push(e);i=$(`#UploadDocument`).get(0).files[n].name.toString().split("\\").pop();t.name="100"+i;const r=new File(t,i,{type:t[0].type});formData.append("files",r);$("#deleteSelectedFile").show()}}function onClickViewToDownload(n,t,i){$.ajax({type:"POST",url:ROOT+"ProjectUpdates/GetUploadedDocumentDetail",data:{projectCode:n,createdBy:t,createdDate:i},dataType:"json",success:function(n){n.length>0?($("#Document_Download_Grid").jqGrid("clearGridData"),$("#Document_Download_Grid").trigger("reloadGrid"),$("#Document_Download_Grid").jqGrid("setGridParam",{data:n}),$("#Document_Download_Grid").trigger("reloadGrid")):($("#Document_Download_Grid").jqGrid("clearGridData"),$("#Document_Download_Grid").trigger("reloadGrid"));$("#ViewModal").modal("show")},error:function(n){alert(n.responseText)}})}function onlyNumbers(n){var i=event||n,t=i.which||i.keyCode,r=n.value;return t==46&&r.indexOf(".")!==-1?!1:t>31&&(t<48||t>57)&&t!=46?!1:!0}function EditHistory(n,t,i,r,u,f){var o,e;for(u!=""&&u!=null&&u!=undefined&&u!="undefined"&&u!="null"&&($("#OldUploadedFiles").val(u),$("#ProjectDocId").val(f)),o="",e=0;e<headerData.length;e++)if(headerData[e].ProjectUpdatesHeaderId===i){o=headerData[e].Comment;break}$("#ProjectUpdatesHeaderId").val(i);CKEDITOR.instances.Comments.setData(o)}function onlyNumbersNotdecimals(n){var i=event||n,t=i.which||i.keyCode;return t>31&&(t<48||t>57)||t==46?!1:!0}function split(n){return n.split(/,\s*/)}function extractLast(n){return split(n).pop()}function preventInput(n){var t=document.getElementById("ProjectLead");n.key===","&&n.preventDefault();t.value.includes(",")&&n.preventDefault()}var jsonFormProjectUpdatesData=$.parseJSON($("#JsonFormProjectUpdatesData").val()),userName=$("#UserName").val(),roleId=$("#RoleId").val(),projectMasterData=jsonFormProjectUpdatesData.ProjectMasterDataList,headerData=jsonFormProjectUpdatesData.ProjectDetailsHeaderDataList,ProjectLeadListDetails=[],ProjectLeadListDetailIds=[],usersMap={},date,today,formData,$TableHeight;$(document).ready(function(){$("#ProjectLead").val(projectMasterData[0].ProjectLead);$("#ProjectLeadID").val(projectMasterData[0].ProjectLeadID);$("#ProjectLeadList option").each(function(){var n=$(this).val(),i=$(this).text(),t=i;ProjectLeadListDetails.push({label:t,value:n});ProjectLeadListDetailIds.push(n);usersMap[t]=n});CKEDITOR.replace("Comments",{height:105,toolbarGroups:[{name:"basicstyles",groups:["basicstyles"]}],removeButtons:"Underline,Strike,Subscript,Superscript,Anchor,Styles,Specialchar,PasteFromWord,Bold,Italic",toolbar:[{name:"insert",items:["NumberedList"]}],autoParagraph:!0,enterMode:CKEDITOR.ENTER_P,pasteFilter:"plain-text",on:{instanceReady:function(){this.editable().on("keypress",function(){var n=CKEDITOR.instances.Comments,t=n.getCommand("numberedlist");t.state===CKEDITOR.TRISTATE_OFF&&n.execCommand("numberedlist")});this.editable().on("paste",function(){var n=CKEDITOR.instances.Comments,t=n.getCommand("numberedlist");t.state===CKEDITOR.TRISTATE_OFF&&n.execCommand("numberedlist")})}}});projectMasterData.length>0&&($("#ProjectId").text(projectMasterData[0].ProjectCode),$("#ProjectDescription").text(projectMasterData[0].ProjectDescription),$("#ProjectHub").text(projectMasterData[0].ProjectHub),$("#ProjectDivision").text(projectMasterData[0].ProjectDivision),$("#ProjectType").text(projectMasterData[0].ProjectType),$("#ProjectClassification").text(projectMasterData[0].ProjectClassification),$("#HghCode").text(projectMasterData[0].HghCode),$("#RAndDName").text(projectMasterData[0].RAndDName),$("#ProjectStatus").text(projectMasterData[0].ProjectStatus));var n="",t="MM/DD/YYYY HH:mm:ss",i="DD MMM YYYY hh:mm A";headerData.length>0&&($("#Sku").val(headerData[0].Sku),$("#Volume").val(headerData[0].Volume),$("#TargetTtd").datepicker("setDate",headerData[0].TargetTTD),$("#TargetProductionDate").datepicker("setDate",headerData[0].TargetProductionDate),$("#TargetCost").val(headerData[0].AcceptedTargetCost),$("#Currency").val(headerData[0].Currency),$("#M1Quantity").val(headerData[0].M1Quantity),$("#M2Quantity").val(headerData[0].M2Quantity),$("#M3Quantity").val(headerData[0].M3Quantity),$("#Y1Quantity").val(headerData[0].Y1Quantity),$("#Y2Quantity").val(headerData[0].Y2Quantity),$("#Y3Quantity").val(headerData[0].Y3Quantity),$("#ProjectLead").val(headerData[0].ProjectLead),headerData.forEach(function(r,u){var f=$("<div>"+r.Comment+"<\/div>"),e,o,h,s,c;if(f.find("ol").css("font-size","12px"),f.find("ol").css("font-family","Open Sans,sans-serif"),f.find("ol li p").css("margin-top","0px"),e=f.find("ol li"),o=2,e.length>o){e.slice(o).hide();h=$('<a class="read-more-show" data-commlist="'+r.Comment+'" href="#" id="2">Read More<\/a>');s=$('<a class="read-more-hide" data-commlist="'+r.Comment+'" href="#" more-id="2"> Read Less<\/a>');s.hide();$(document).on("click",".read-more-hide",function(n){n.preventDefault();var t=$(this).parent();t.find("ol li:gt(1)").hide();$(this).hide();t.find(".read-more-show").show()});$(document).on("click",".read-more-show",function(n){n.preventDefault();var t=$(this).parent();t.find("ol li:gt()").show();$(this).hide();t.find(".read-more-hide").show()});f.append(h);f.append(s)}var l=r.CreatedDate,a=moment(l,t),v=a.format(i);roleId=="1"&&r.IsLatestComment=="1"&&(r.IsLatestComment=0);c=$("#UserName").val();n+='<div class="history_section mb-0"><div class="user_history col-auto col-form-label lbl_flex"><div class="history_info"><span><i class="fas fa-user"><\/i><\/span> <span class="history_name">'+r.CreatedByName+'<\/span><\/div><div style="display:flex;justify-content:end;align-items:center"><span class="date_font">'+v+'<\/span><span class="_download"><span'+(r.IsContainDocument==0?' style = "display:none"':"")+" ><i onclick=\"onClickViewToDownload('"+r.ProjectCode+"','"+r.CreatedBy+"','"+r.CreatedDate+'\')" class="fa fa-files-o" title="View Documents"><\/i><\/span><span '+(r.IsLatestComment!=0&&r.CreatedBy==c||u==0&&roleId=="1"?" ":'style = "display:none"')+'class="btn-icon -edit"> <i  onclick="EditHistory(\''+r.ProjectCode+"','"+r.CreatedBy+"','"+r.ProjectUpdatesHeaderId+"','"+r.CreatedDate+"','"+r.DocumentName+"','"+r.ProjectDocId+'\')" class="fa fa-edit" title="Edit"><\/i><\/span ><\/span ><\/div > <\/div><p>'+f.html()+"<\/p><\/div>"}),$("#DynamicHistory").append(n),$(".read-more-show,.read-more-hide").css({"font-size":"13px","margin-left":"3vh"}))});$("[data-multiselect]").multiselect({includeSelectAllOption:!0,buttonWidth:"100%",enableCaseInsensitiveFiltering:!0,enableFiltering:!0});date=new Date;today=new Date(date.getFullYear(),date.getMonth(),date.getDate());$("[data-datepicker-monthyear]").datepicker({format:"M/yyyy",viewMode:"months",minViewMode:"months",todayHighlight:!0,autoclose:!0,startDate:"+30"});formData=new FormData;colmodels=[{name:"UploadDocument",label:"Document",resizable:!0,ignoreCase:!0,width:150},{name:"CreatedBy",label:"Uploaded By",width:55,resizable:!0,ignoreCase:!0},{name:"CreatedDate",label:"Uploaded On",resizable:!0,ignoreCase:!0,width:75},{name:"Download",label:"Action",width:35,search:!1,resizable:!0,ignoreCase:!0,classes:"DownloadFile",formatter:function(n,t,i){var r=i.UploadDocument,u=ROOT+"ProjectUpdates/DownloadFile?fileName="+encodeURIComponent(r),f=r.split(".").pop().toLowerCase();return`<div class="justify-center_">
                        <a title="Download" href="${u}" class="btn-icon -view">
                            <i class="fas fa-download"></i>
                        </a>`+(f in{doc:"Microsoft Word Document",docx:"Microsoft Word Document",xls:"Microsoft Excel Spreadsheet",xlsx:"Microsoft Excel Spreadsheet"}?"":`<a class="btn-icon -edit" title="View" id="${t.rowId}" href="${ROOT}ProjectUpdatesImages/${i.UploadDocument}" target="_blank"><i class="fa fa-eye" title="View"></i></a>`)+`
                    </div>`}},];$("#Document_Download_Grid").jqGrid({url:"",datatype:"local",data:[],mtype:"GET",colModel:colmodels,loadonce:!0,viewrecords:!0,pager:"#pager_upload",rowNum:20,scroll:1,gridComplete:function(){var t=$("#Document_Download_Grid tbody tr"),r=$("#Document_Download_Grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#Document_Download_Grid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"45vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});$TableHeight=$(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>330?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","17px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"));$("#UploadDocument").val()==""&&$("#deleteSelectedFile").hide();$("#UploadDocument").change(function(){$("#UploadDocument").val()==""&&$("#deleteSelectedFile").hide()});$("#deleteSelectedFile").click(function(){$("#UploadDocument").val()!=""&&confirm("Are you sure you want to delete the uploaded file?",function(){$("#UploadDocument").val("");$("#deleteSelectedFile").hide()})});$(".tags").autocomplete({source:ProjectLeadListDetails,source:function(n,t){var i=n.term,e=n.term,f=[],r=[],h,o,s,c,u;i.indexOf(",")>0&&(r=i.split(/;/g),r.pop(),$.each(r,function(n,t){t=t.replace(/^\s+/,"").toLowerCase()}),h=i.lastIndexOf(","),i=i.substring(h+1));o=[];$.trim(i).length>0&&(s=i,c=new RegExp("^"+s,"i"),o=$.grep(ProjectLeadListDetails,function(n){return $.trim(n.label).toLowerCase().indexOf(s.toLowerCase())!=-1&&(r.length==0||r.length>0&&!r.includes($.trim(n.label)))}));t($.ui.autocomplete.filter(o.slice(0,50),extractLast(i)));e=e.split(",");e.forEach(n=>{f.push(n.trim())});u=[];f.forEach(n=>{u.push(usersMap[n])});u.push("");f.push("");this.value=f;useridslist=u;$("#ProjectLeadID").val(u.slice(0,-1))},focus:function(){return!1},select:function(n,t){var u=[],i=split(this.value.trim()),f,r;return i.pop(),f=i.indexOf(t.item.label),f!=-1?alert("Duplicate selection is not allowed"):i.push(t.item.label),i.forEach(n=>{u.push(n.trim())}),r=[],u.forEach(n=>{r.push(usersMap[n])}),r.push(""),u.push(""),this.value=i,useridslist=r,$("#ProjectLeadID").val(r.slice(0,-1)),!1}});