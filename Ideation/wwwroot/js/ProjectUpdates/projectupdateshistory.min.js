function onClickViewToDownload(n,t,i){$.ajax({type:"POST",url:ROOT+"ProjectUpdates/GetUploadedDocumentDetail",data:{projectCode:n,createdBy:t,createdDate:i},dataType:"json",success:function(n){n.length>0?($("#Document_Download_Grid").jqGrid("clearGridData"),$("#Document_Download_Grid").trigger("reloadGrid"),$("#Document_Download_Grid").jqGrid("setGridParam",{data:n}),$("#Document_Download_Grid").trigger("reloadGrid")):($("#Document_Download_Grid").jqGrid("clearGridData"),$("#Document_Download_Grid").trigger("reloadGrid"));$("#ViewModal").modal("show")},error:function(n){alert(n.responseText)}})}var jsonFormProjectUpdatesData=$.parseJSON($("#JsonFormProjectUpdatesData").val()),projectMasterData=jsonFormProjectUpdatesData.ProjectMasterDataList,headerData=jsonFormProjectUpdatesData.ProjectDetailsHeaderDataList,flag=!0,date,today,$TableHeight;$(document).ready(function(){var n,t;n=new Date;t=new Date;t.setDate(1);var f=n.getDate(),i=n.getMonth()+1,r=n.getFullYear(),e=t.getDate(),o=("0"+e).slice(-2)+"/"+("0"+i).slice(-2)+"/"+r,s=("0"+f).slice(-2)+"/"+("0"+i).slice(-2)+"/"+r;$("#FromDate").val(o);$("#ToDate").val(s);$("[data-datepicker-sd]").datepicker({format:"dd/mm/yyyy",endDate:new Date,autoclose:!0}).on("changeDate",function(n){var t=n.date;$("[data-datepicker-ed]").datepicker("getDate")<t&&$("[data-datepicker-ed]").datepicker("getDate")!=null&&($("#FromDate_Err").text("From Date cannot be more than To Date"),flag=!1,$("[data-datepicker-ed]").datepicker("setDate",""),$("#FromDate_Err").show(),setTimeout(function(){$("#FromDate_Err").hide()},4500))});$("[data-datepicker-ed]").datepicker({format:"dd/mm/yyyy",endDate:new Date,autoclose:!0}).on("changeDate",function(n){var t=n.date;$("[data-datepicker-sd]").datepicker("getDate")>t&&$("[data-datepicker-sd]").datepicker("getDate")!=null&&($("#ToDate_Err").text("To Date cannot be less From Date"),flag=!1,$("[data-datepicker-sd]").datepicker("setDate",""),$("#ToDate_Err").show(),setTimeout(function(){$("#ToDate_Err").hide()},4500))});projectMasterData.length>0&&($("#ProjectCode").text(projectMasterData[0].ProjectCode),$("#ProjectDescription").text(projectMasterData[0].ProjectDescription),$("#ProjectHub").text(projectMasterData[0].ProjectHub),$("#ProjectDivision").text(projectMasterData[0].ProjectDivision),$("#ProjectType").text(projectMasterData[0].ProjectType),$("#ProjectClassification").text(projectMasterData[0].ProjectClassification),$("#HghCode").text(projectMasterData[0].HghCode),$("#RAndDName").text(projectMasterData[0].RAndDName),$("#ProjectStatus").text(projectMasterData[0].ProjectStatus));var u="",h="MM/DD/YYYY HH:mm:ss",c="DD MMM YYYY hh:mm A";headerData.length>0?(headerData.forEach(function(n){var t,i,r,e,f;if(t=$("<div>"+n.Comment+"<\/div>"),t.find("ol").css("font-size","12px"),t.find("ol").css("font-family","Open Sans,sans-serif"),t.find("ol li p").css("margin-top","0px"),i=t.find("ol li"),r=3,i.length>r){i.slice(r).hide();e=$('<a class="read-more-show" data-commlist="'+n.Comment+'" href="#" id="2">Read More<\/a>');f=$('<a class="read-more-hide" data-commlist="'+n.Comment+'" href="#" more-id="2"> Read Less<\/a>');f.hide();$(document).on("click",".read-more-hide",function(n){n.preventDefault();var t=$(this).parent();t.find("ol li:gt(2)").hide();$(this).hide();t.find(".read-more-show").show()});$(document).on("click",".read-more-show",function(n){n.preventDefault();var t=$(this).parent();t.find("ol li:gt()").show();$(this).hide();t.find(".read-more-hide").show()});t.append(e);t.append(f)}var o=n.CreatedDate,s=moment(o,h),l=s.format(c);u+='<div class="history_section mb-0"><div class="user_history col-auto col-form-label lbl_flex"><div class="history_info"><span><i class="fas fa-user"><\/i><\/span> <span class="history_name">'+n.CreatedByName+'<\/span><\/div><div style="display:flex;justify-content:end;align-items:center"><span class="date_font">'+l+'<\/span><span class="_download"><span'+(n.IsContainDocument==0?' style = "display:none"':"")+" ><i onclick=\"onClickViewToDownload('"+n.ProjectCode+"','"+n.CreatedBy+"','"+n.CreatedDate+'\')" class="fa fa-files-o" title="View Documents"><\/i><\/span><\/span><\/div > <\/div><p>'+t.html()+"<\/p><\/div>"}),$("#DynamicHistory").append(u),$(".read-more-show,.read-more-hide").css({"font-size":"13px","margin-left":"3vh"})):($("#DynamicHistory").empty(),$("#DynamicHistory").append("<p>No Comments Available<\/p>"))});$("[data-multiselect]").multiselect({includeSelectAllOption:!0,buttonWidth:"100%",enableCaseInsensitiveFiltering:!0,enableFiltering:!0});date=new Date;today=new Date(date.getFullYear(),date.getMonth(),date.getDate());$("[data-datepicker-monthyear]").datepicker({format:"M/yyyy",viewMode:"months",minViewMode:"months",todayHighlight:!0,autoclose:!0,startDate:"+30"});$(function(){$(".read-more-content").addClass("hide");$(".read-more-show, .read-more-hide").removeClass("hide");$(".read-more-show").on("click",function(n){var t=$(this).siblings(".read-more-content");$(this).addClass("hide");t.removeClass("hide");n.preventDefault()});$(document).on("click",".read-more-hide",function(n){n.preventDefault();$(this).closest(".history_section").find(".read-more-show").removeClass("hide");$(this).closest(".read-more-content").addClass("hide")})});colmodels=[{name:"UploadDocument",label:"Document",resizable:!0,ignoreCase:!0,width:140},{name:"CreatedBy",label:"Uploaded By",width:55,resizable:!0,ignoreCase:!0},{name:"CreatedDate",label:"Uploaded On",resizable:!0,ignoreCase:!0,width:85},{name:"Download",label:"Action",width:35,search:!1,resizable:!0,ignoreCase:!0,classes:"DownloadFile",formatter:function(n,t,i){var r=i.UploadDocument,u=ROOT+"ProjectUpdates/DownloadFile?fileName="+encodeURIComponent(r),f=r.split(".").pop().toLowerCase();return`<div class="justify-center_">
                        <a title="Download" href="${u}" class="btn-icon -view">
                            <i class="fas fa-download"></i>
                        </a>`+(f in{doc:"Microsoft Word Document",docx:"Microsoft Word Document",xls:"Microsoft Excel Spreadsheet",xlsx:"Microsoft Excel Spreadsheet"}?"":`<a class="btn-icon -edit" title="View" id="${t.rowId}" href="${ROOT}ProjectUpdatesImages/${i.UploadDocument}" target="_blank"><i class="fa fa-eye" title="View"></i></a>`)+`
                    </div>`}},];$("#Document_Download_Grid").jqGrid({url:"",datatype:"local",data:[],mtype:"GET",colModel:colmodels,loadonce:!0,viewrecords:!0,pager:"#pager_upload",rowNum:20,scroll:1,gridComplete:function(){var t=$("#Document_Download_Grid tbody tr"),r=$("#Document_Download_Grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#Document_Download_Grid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"45vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});$TableHeight=$(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>330?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","17px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"));$("#SearchPrototypeData").click(function(){var n=$("#FromDate").val(),t=$("#ToDate").val();n==""||t==""?(n==""?$("#FromDate_Err").text("Please select From Date").show():$("#FromDate_Err").text(""),t==""?$("#ToDate_Err").text("Please select To Date").show():$("#ToDate_Err").text("")):$.ajax({url:ROOT+`ProjectUpdates/GetCommentsHistory`,type:"GET",dataType:"json",data:{ProjectCode:$("#ProjectCode").text(),FromDate:$("#FromDate").val(),ToDate:$("#ToDate").val(),Filter:"FilteredComments"},success:function(n){if(n.message="Success"){$("#DynamicHistory").empty();var t="",r="MM/DD/YYYY HH:mm:ss",u="DD MMM YYYY hh:mm A",i=n.ProjectDetailsHeaderDataList;i.length>0?(i.forEach(function(n){var i=$("<div>"+n.Comment+"<\/div>"),f,e,s,o;if(i.find("ol").css("font-size","12px"),i.find("ol").css("font-family","Open Sans,sans-serif"),i.find("ol li p").css("margin-top","0px"),f=i.find("ol li"),e=2,f.length>e){f.slice(e).hide();s=$('<a class="read-more-show" data-commlist="'+n.Comment+'" href="#" id="2">Read More<\/a>');o=$('<a class="read-more-hide" data-commlist="'+n.Comment+'" href="#" more-id="2"> Read Less<\/a>');o.hide();$(document).on("click",".read-more-hide",function(n){n.preventDefault();var t=$(this).parent();t.find("ol li:gt(1)").hide();$(this).hide();t.find(".read-more-show").show()});$(document).on("click",".read-more-show",function(n){n.preventDefault();var t=$(this).parent();t.find("ol li:gt()").show();$(this).hide();t.find(".read-more-hide").show()});i.append(s);i.append(o)}var h=n.CreatedDate,c=moment(h,r),l=c.format(u);t+='<div class="history_section mb-0"><div class="user_history col-auto col-form-label lbl_flex"><div class="history_info"><span><i class="fas fa-user"><\/i><\/span> <span class="history_name">'+n.CreatedByName+'<\/span><\/div><div style="display:flex;justify-content:end;align-items:center"><span class="date_font">'+l+'<\/span><span class="_download"><span'+(n.IsContainDocument==0?' style = "display:none"':"")+" ><i onclick=\"onClickViewToDownload('"+n.ProjectCode+"','"+n.CreatedBy+"','"+n.CreatedDate+'\')" class="fa fa-files-o" title="View Documents"><\/i><\/span><\/span><\/div > <\/div><p>'+i.html()+"<\/p><\/div>"}),$("#DynamicHistory").append(t),$(".read-more-show,.read-more-hide").css({"font-size":"13px","margin-left":"3vh"})):($("#DynamicHistory").empty(),$("#DynamicHistory").append("<p>No Comments Available<\/p>"))}else alert(n.message)},error:function(n){alert(n.message)}})});$("#FromDate").change(function(){flag&&($(this).val()!=""&&$("#FromDate_Err").text(""),flag=!0)});$("#ToDate").change(function(){flag&&($(this).val()!=""&&$("#ToDate_Err").text(""),flag=!0)});colmodels=[{name:"TargetTTD",label:"Target TTD",width:85,resizable:!0,ignoreCase:!0},{name:"TargetProductionDate",label:"Target Production Date",resizable:!0,ignoreCase:!0,width:85},{name:"TargetCost",label:"Accepted Target Cost",resizable:!0,ignoreCase:!0,width:65},{name:"Currency",label:"Currency",resizable:!0,ignoreCase:!0,width:85},{name:"CreatedBy",label:"Updated By",resizable:!0,ignoreCase:!0,width:85},{name:"CreatedOn",label:"Updated On",resizable:!0,ignoreCase:!0,width:105},];$("#ViewHistoryGrid").jqGrid({url:"",datatype:"local",data:JSON.parse($("#ViewInfoHistoryData").val()),mtype:"GET",colModel:colmodels,loadonce:!0,viewrecords:!0,pager:"#ViewHistoryGrid_Pager",rowNum:JSON.parse($("#ViewInfoHistoryData").val()).length,scroll:1,gridComplete:function(){var t=$("#ViewHistoryGrid tbody tr"),r=$("#ViewHistoryGrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#ViewHistoryGrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"45vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});$TableHeight=$(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>330?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","17px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"));$("#viewHistoryPopup").click(function(){$("#InfoModal").modal("show")});colmodels=[{name:"M1Quantity",label:"M1 Quantity",width:55,resizable:!0,ignoreCase:!0},{name:"M2Quantity",label:"M2 Quantity",resizable:!0,ignoreCase:!0,width:55},{name:"M3Quantity",label:"M3 Quantity",resizable:!0,ignoreCase:!0,width:55},{name:"Y1Quantity",label:"Y1 Quantity",resizable:!0,ignoreCase:!0,width:55},{name:"Y2Quantity",label:"Y2 Quantity",resizable:!0,ignoreCase:!0,width:55},{name:"Y3Quantity",label:"Y3 Quantity",resizable:!0,ignoreCase:!0,width:55},{name:"CreatedBy",label:"Updated By",resizable:!0,ignoreCase:!0,width:75},{name:"CreatedOn",label:"Updated On",resizable:!0,ignoreCase:!0,width:85},];$("#VolumeHistoryGrid").jqGrid({url:"",datatype:"local",data:JSON.parse($("#VolumeInfoHistoryData").val()),mtype:"GET",colModel:colmodels,loadonce:!0,viewrecords:!0,pager:"#VolumeHistoryGrid_Pager",rowNum:JSON.parse($("#VolumeInfoHistoryData").val()).length,scroll:1,gridComplete:function(){var t=$("#VolumeHistoryGrid tbody tr"),r=$("#VolumeHistoryGrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#VolumeHistoryGrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"45vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});$TableHeight=$(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>330?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","17px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"));$("#volumeHistoryPopup").click(function(){$("#InfoVolumeModel").modal("show")});$("#InfoModal,#InfoVolumeModel").on("hidden.bs.modal",function(){var n=$("#ViewHistoryGrid"),t=$("#VolumeHistoryGrid");$(".ui-search-input input").val("");n.jqGrid("setGridParam",{search:!1,postData:{filters:""}});n.trigger("reloadGrid",[{page:1}]);t.jqGrid("setGridParam",{search:!1,postData:{filters:""}});t.trigger("reloadGrid",[{page:1}])});