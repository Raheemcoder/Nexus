function ApproveMilestone(n,t,i,r,u,f,e,o){smallSlNoToApprove==t?($("#ApprovalRemarks").val(""),$(".Error_Approve_Remarks").hide(),$("#ApproveRemarksNoDependency").val(""),$(".Error_Approve_Remarks_No_Dependency").hide(),HubId=HubList.filter(n=>n.HubName.toLowerCase()==o.toLowerCase()).map(n=>n.HubId),approveProjectId=n,approveSlNo=t,approveStartDate=i,approveEndDate=r,approvePMUVersion=u,approveExtendedId=f,approveRemarks=e,approveHub=HubId,$.ajax({url:ROOT+"Milestone/DependentMilestoneList",type:"POST",dataType:"JSON",data:{projectId:n,slNo:t,startDate:moment(i,"DD MMM YYYY").format("DD/MM/YYYY"),pmuVersion:u,endDate:moment(r,"DD MMM YYYY").format("DD/MM/YYYY"),Hub:HubId},success:function(n){n.length>0?($("#dependentMilestonesAlert").modal("show"),CreateJqGriddependent(n)):$("#ApproveConfirmation").modal("show")},error:function(n,t,i){alert(i)}})):alert("Please address the extension requests of the earlier tasks")}function CreateJqGriddependent(n){$.jgrid.gridUnload("#dependentjqgrid");$("#dependentjqgrid").jqGrid({datatype:"local",data:n,mtype:"GET",colModel:models,loadonce:!0,viewrecords:!0,sortable:!1,rowNum:1e4,gridview:!0,scroll:1,pager:"#pager",gridComplete:function(){var t=$("#dependentjqgrid tbody tr"),r=$("#dependentjqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}})}function RejectMilestone(n,t,i,r,u,f,e,o){$("#RejectRemarks").val("");$(".Error_Reject_Remarks").hide();$("#RejectionConfirmation").modal("show");$("#rejectok").click(function(){HubId=HubList.filter(n=>n.HubName.toLowerCase()==o.toLowerCase()).map(n=>n.HubId);var s=$("#RejectRemarks").val().trim(),h=!0;if(s==="")return h=!1,$(".Error_Reject_Remarks").show(),!1;h&&($(".Error_Reject_Remarks").hide(),$.ajax({url:ROOT+"Milestone/ApproveOrRejectMilestone",type:"POST",dataType:"text",data:{projectId:n,slNo:t,startDate:moment(i,"DD MMM YYYY").format("DD/MM/YYYY"),pmuVersion:u,endDate:moment(r,"DD MMM YYYY").format("DD/MM/YYYY"),extendId:f,remarks:e,status:"Rejected",ApprovalRemarks:s,Hub:HubId},success:function(n){n.toLowerCase().includes("successfully")?window.location.reload():alert(n)},error:function(n,t,i){alert(i)}}))})}function RemarksGrid(n){RemarksColmodel=[{name:"ActualStartDate",label:"Planned Start Date",resizable:!0,ignoreCase:!0,width:100},{name:"ActualEndDate",label:"Planned End Date",resizable:!0,ignoreCase:!0,width:100},{name:"RequestedEndDate",label:"Requested End Date",resizable:!0,ignoreCase:!0,width:100},{name:"RevisedStartDate",label:"Revised Start Date",resizable:!0,ignoreCase:!0,width:100},{name:"RevisedEndDate",label:"Revised End Date",resizable:!0,ignoreCase:!0,width:100},{name:"Remarks",label:"Remarks",resizable:!0,ignoreCase:!0,widht:150},{name:"UpdatedBy",label:"Updated By",resizable:!0,ignoreCase:!0,width:100},{name:"UpdatedOn",label:"Updated On",resizable:!0,ignoreCase:!0,width:100},{name:"Status",label:"Status",resizable:!0,ignoreCase:!0,width:100},];$("#remarks").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:RemarksColmodel,loadonce:!0,viewrecords:!0,pager:"#remarks_pager",rowNum:30,scroll:1,gridComplete:function(){var t=$("#remarks tbody tr"),r=$("#remarks tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}})}function MileStoneRemarksHistory(n,t,i){HubId=HubList.filter(n=>n.HubName.toLowerCase()==i.toLowerCase()).map(n=>n.HubId);$.ajax({url:ROOT+"Milestone/GetParticularTaskRemarksHistory",type:"GET",dataType:"JSON",data:{projectId:n,slNo:t,hubId:HubId[0]},success:function(n){n!=undefined||n!=null?($.jgrid.gridUnload("#remarks"),RemarksGrid(n),$("#remarks-popup").modal("show")):alert("Error occured!!!")},error:function(n,t,i){alert(i)}})}var HubId=0,approveProjectId="",approveSlNo="",approveStartDate="",approveEndDate="",approvePMUVersion="",approveExtendedId="",approveRemarks="",approveHub="",smallSlNoToApprove=0,jsonData=$.parseJSON($("#JsonData").val()),HubList=JSON.parse($("#getHubList").val()),projectName=jsonData[0].ProjectName,projectCode=jsonData[0].ProjectCode,hub=jsonData[0].Hub,pendingArray=jsonData.filter(n=>n.Status.toLowerCase()==="pending for approval"),pendingCount=pendingArray.length,approvedArray=jsonData.filter(n=>n.Status.toLowerCase()==="approved"),approvedCount=approvedArray.length,rejectedArray=jsonData.filter(n=>n.Status.toLowerCase()==="rejected"),rejectedCount=rejectedArray.length,pendingCards=$(),approvedCards=$(),rejectedCards=$(),roleId=$("#RoleId").val(),$TableHeight;$.each(pendingArray,function(n,t){var i=t.UserName.lastIndexOf(" "),r="",u,f;i!=-1&&(r=t.UserName[i+1]);u=(t.UserName[0]+r).toUpperCase();f=`<div class="hide_section">
         <div class="open_list" >
            <div>
                <div class="list_card">
                    <div class="hub_project">
                        `+t.Hub+`(`+t.ProjectCode+`)`+t.ProjectName+`
                    </div>
                    <div class="task_list">
                        `+t.TaskName+`
                    </div>
                    <div class="project_date">
                        <span>
                            <i class="fa fa-calendar"></i>`+t.StartDate+`
                        </span>
                        <span>-</span>
                        <span>
                            <i class="fa fa-calendar"></i>`+t.EndDate+`
                        </span>
                        <span class="extend_date"> <i class="fa fa-calendar"></i>`+t.RequestedEndDate+`</span>
                    </div>
                    <div class="status">
                        <span class="text-info">`+t.Status+`</span>
                    </div>
                    <div class="user_name_list">
                        <span class="user_profile">`+u+`</span><span class="">`+t.UserName+`</span>
                    </div>
                    <div class="last_modified">
                        <p class="mb-0">
                            Last modified on `+t.ModifiedDate+`
                        </p>
                    </div>
                    <div class="comments grid-icons-group -justify-center">
                        <span class="comments_icon" onclick="MileStoneRemarksHistory(${t.ProjectId},${t.SlNo},'${t.Hub}')">
                        <i class="fa fa-comment" title="Remarks"></i>
                        </span>
                        ${t.IsAlreadyRequest==0?`
                        <div class="comments">
                            <span title="Project Details" onclick="EditeMyMilestone('${t.ProjectId}', '${t.StartDate}', '${t.EndDate}', '${t.MilestoneStatus}', '${t.DisplaySubMilestone}', ${t.MilestoneId}, ${t.SlNo}, '${t.PMUVersion}', '${t.MilestoneName}',
                            '${t.ProjectCode}', '${t.ProjectName}', '${t.Hub}', '${t.IsWeekendExcluded}')">
                                <i class="fa fa-comment"></i>
                            </span>
                        </div>
                    `:""}  
                         ${roleId!="3"?`
                             <span class="check_icon" onclick="ApproveMilestone(${t.ProjectId},${t.SlNo},'${t.StartDate}','${t.RequestedEndDate}','${t.PMUVersion}',
                            ${t.ExtendedId},'${t.Remarks}','${t.Hub}')">
                                <i class=" fas fa-check" title="Approve"></i>
                            </span>
                            <span class="reject_icon" onclick="RejectMilestone(${t.ProjectId},${t.SlNo},'${t.StartDate}','${t.RequestedEndDate}','${t.PMUVersion}',
                            ${t.ExtendedId},'${t.Remarks}','${t.Hub}')">
                                <i class="fas fa-times" title="Reject"></i>
                            </span>`:""}
                    </div>
                </div>
              </div>
             </div>
           </div>`;pendingCards=pendingCards.add($(f))});$.each(approvedArray,function(n,t){var i=t.UserName.lastIndexOf(" "),r="",u,f;i!=-1&&(r=t.UserName[i+1]);u=(t.UserName[0]+r).toUpperCase();f=`<div class="hide_section">
     <div class="open_list">
      <div>
        <div class="list_card">
            <div class="hub_project">
                `+t.Hub+`(`+t.ProjectCode+`)`+t.ProjectName+`
            </div>
            <div class="task_list">
                  `+t.TaskName+`
                <div class="project_date">
                    <span>
                        <i class="fa fa-calendar"></i>`+t.StartDate+`
                    </span>
                    <span>-</span>
                    <span>
                        <i class="fa fa-calendar"></i>`+t.EndDate+`
                    </span>
                </div>
                <div class="status">
                    <span class="text-success">`+t.Status+`</span>
                </div>
                <div class="user_name_list">
                    <span class="user_profile">`+u+`</span><span class="">`+t.UserName+`</span>
                </div>
                <div class="last_modified">
                    <p class="mb-0">
                        Last modified on `+t.ModifiedDate+`
                    </p>
                </div>
                <div class="comments grid-icons-group -justify-center">
                    <span class="comments_icon" onclick="MileStoneRemarksHistory(${t.ProjectId},${t.SlNo},'${t.Hub}')">
                        <i class="fa fa-comment" title="Remarks"></i>
                    </span>
                    ${t.Remarks.toLowerCase().includes("auto approved")?`
                        <span class="user_profile">AA</span>
                    `:""}  
                </div>
            </div>
        </div>
      </div>
     </div>
    </div>`;approvedCards=approvedCards.add($(f))});$.each(rejectedArray,function(n,t){var i=t.UserName.lastIndexOf(" "),r="",u,f;i!=-1&&(r=t.UserName[i+1]);u=(t.UserName[0]+r).toUpperCase();f=`<div class="hide_section">
         <div class="open_list" >
            <div>
                <div class="list_card">
                    <div class="hub_project">
                        `+t.Hub+`(`+t.ProjectCode+`)`+t.ProjectName+`
                    </div>
                    <div class="task_list">
                        `+t.TaskName+`
                    </div>
                    <div class="project_date">
                        <span>
                            <i class="fa fa-calendar"></i>`+t.StartDate+`
                        </span>
                        <span>-</span>
                        <span>
                            <i class="fa fa-calendar"></i>`+t.EndDate+`
                        </span>
                    </div>
                    <div class="status">
                        <span class="text-warning">`+t.Status+`</span>
                    </div>
                    <div class="user_name_list">
                        <span class="user_profile">`+u+`</span><span class="">`+t.UserName+`</span>
                    </div>
                    <div class="last_modified">
                        <p class="mb-0">
                            Last modified on `+t.ModifiedDate+`
                        </p>
                    </div>
                    <div class="comments grid-icons-group -justify-center">
                        <span class="comments_icon" onclick="MileStoneRemarksHistory(${t.ProjectId},${t.SlNo},'${t.Hub}')">
                            <i class="fa fa-comment" title="Remarks"></i>
                        </span>
                    </div>
                </div>
             </div>
            </div>
         </div>`;rejectedCards=rejectedCards.add($(f))});pendingArray.length>0&&(smallSlNoToApprove=pendingArray[0].SlNo);$(document).ready(function(){$("#ProjectId").hide();$(".projectName_error").hide();$("#projectNameList").hide();var n=hub+"-("+projectCode+")"+projectName;$(".project-hub-name").text(n);$(".pending-count").text(pendingCount);$(".approved-count").text(approvedCount);$(".rejected-count").text(rejectedCount);$(".pending-cards").append(pendingCards);$(".approved-cards").append(approvedCards);$(".rejected-cards").append(rejectedCards)});models=[{name:"SlNo",label:"SlNo",width:60,resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1},{name:"TaskDesc",resizable:!0,width:100,label:"Task",ignoreCase:!0,sortable:!1},{name:"Duration",label:"Duration",width:60,hidden:!0,resizable:!0,ignoreCase:!0,sortable:!1},{name:"StartDate",label:"Start Date",width:100,resizable:!0,ignoreCase:!0,sortable:!1},{name:"EndDate",resizable:!0,label:"End Date",sorttype:"Date",width:100,ignoreCase:!0,sortable:!1},{name:"UpdatedStartDate",label:"Revised Start Date",width:105,resizable:!0,ignoreCase:!0,sortable:!1},{name:"UpdatedEndDate",resizable:!0,label:"Revised End Date",sorttype:"Date",width:105,ignoreCase:!0,sortable:!1}];$("body").on("click","#btnok, #btnokNoDependency",function(){var r=$(this).text().toLowerCase().trim(),n="",t,i;n=r=="yes"?$("#ApprovalRemarks").val().trim():$("#ApproveRemarksNoDependency").val().trim();t=moment(approveStartDate,"DD MMM YYYY").format("DD/MM/YYYY");i=moment(approveEndDate,"DD MMM YYYY").format("DD/MM/YYYY");$.ajax({url:ROOT+"Milestone/ApproveMilestone",type:"POST",dataType:"TEXT",data:{projectId:approveProjectId,approvalRemarks:n,hub:approveHub},success:function(n){n=="1"?window.location.href=ROOT+"Master/NewPmuMappings?q="+Encrypt("SlNo="+approveSlNo+"&StartDate="+t+"&EndDate="+i+"&PMUVersion="+approvePMUVersion):alert(n)},error:function(n,t,i){alert(i)}})});$("#global-search").on("input",function(){var r=$(this).val().toLowerCase().trim(),u=$(".hide_section"),n=0,t=0,i=0;u.each(function(){var u=$(this).find(".open_list"),f=u.text().toLowerCase();if(f.includes(r)){$(this).css("display","block");var h=$(this).find(".text-info").html(),h=$(this).find(".text-info").html(),e=$(this).find(".text-success").html(),o=$(this).find(".text-warning").html(),s=$(this).find(".text-info").html();e=="Approved"?n++:o=="Rejected"?t++:s=="Pending For Approval"&&i++}else $(this).css("display","none");$(".pending-count").text(i);$(".approved-count").text(n);$(".rejected-count").text(t)})});$(".ui-jqgrid-bdiv").css({"max-height":"47vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});$TableHeight=$(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>130?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","4px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));