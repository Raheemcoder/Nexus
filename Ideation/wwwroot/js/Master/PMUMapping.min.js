function CreateJqGrid(n){$("#jqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:models,loadonce:!0,viewrecords:!0,ajaxSubgridOptions:{"async":!1},sortable:!1,rowNum:1e3,beforeProcessing:function(){console.log("loader display ");$("#loader").show();$("#loader").css("visibility","visible")},gridview:!0,subGrid:!0,subGridRowExpanded:function(n,t){var i=$("#jqgrid").getRowData(t);subgrid_table=n+"_t"+i.SequenceNo+"";subgrid_table_id.indexOf(subgrid_table)==-1&&subgrid_table_id.push(n+"_t"+i.SequenceNo+"");$("#"+n).html("<table id='"+subgrid_table+"'><\/table>");$.jgrid.gridUnload("#"+subgrid_table);TemplateSubGridDisplay&&CreateSubGriddata(subgrid_table,t)},multiselect:!0,beforeSelectRow:function(n,t){gettingprevdata(n,status);var i=$(this),r=$.jgrid.getCellIndex($(t.target).closest("td")[0]),u=i.jqGrid("getGridParam","colModel");return u[r].name===""},onCellSelect:function(n,t,i,r){fileuploadedrow=n;var u=$("#jqg_jqgrid_"+n).prop("checked");$(r.target).hasClass("cbox")&&rowselect(n,u)},scroll:1,pager:"#pager",userDataOnFooter:!0,subGridBeforeExpand:function(n,t){var i=$("#jqgrid").getRowData(t);rowSequnce=i.SequenceNo},gridComplete:function(){var i=$("#jqgrid tbody tr"),r=$("#jqgrid tbody tr td"),t,n;if(i.length>1)for(t=$(i[1]).children("td"),n=0;n<t.length;n++)$(t[n]).css("width",$(r[n]).css("width"));for(n=0;n<MaterialArray.length;n++)$("#jqgrid tbody tr").each(function(t,i){$(i).find("td:nth-child(5)").text()==MaterialArray[n].SequenceNo&&($(i).find("td:nth-child(1) input").attr("checked",!0),($(i).find("td:nth-child(7)").text()=="Completed"||$(i).find("td:nth-child(18)").text()=="Pending For Approval")&&$(i).find("td:nth-child(1) input").attr("disabled",!0),$("#"+MaterialArray[n].SequenceNo+"start_date").val(MaterialArray[n].StartDate),$("#"+MaterialArray[n].SequenceNo+"end_date").val(MaterialArray[n].EndDate),$("#"+MaterialArray[n].SequenceNo+"mapperUserid").val(MaterialArray[n].UserId),$("#"+MaterialArray[n].SequenceNo+"mapperUser").val(MaterialArray[n].UserName),$("#"+MaterialArray[n].SequenceNo+"Duration").val(MaterialArray[n].Duration),$("#"+MaterialArray[n].SequenceNo+"SetRelation").val(MaterialArray[n].SetRelation),$("#"+MaterialArray[n].SequenceNo+"Remarks").val(MaterialArray[n].Remarks),$("#"+MaterialArray[n].SequenceNo+"ExtraDays").val(MaterialArray[n].ExtraDays))});if(!looping)for(n=0;n<=milestoneid_looping.length-1;n++)$("#jqgrid tbody tr").each(function(t,i){$(i).find("td:nth-child(5)").text()==milestoneid_looping[n]&&$(i).closest("tr").children("td,th").css("background-color","orange")});$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"),$(this).attr("id"))}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"),$(this).attr("id"))}});LoadUser("mapperUser")},loadComplete:function(){for(var r,u,n,t,f=$("#jqgrid").getDataIDs(),i=0;i<f.length;i++)r=f[i],u=$("#jqgrid").getRowData(r),u.SubmilestoneExit=="True"&&(rowSequnce=u.SequenceNo,$("#jqgrid").expandSubGridRow(r));$(".submilestoneexist").each(function(n,t){if(t.textContent!="True"){var i=$(t).parent().find("td.sgcollapsed");$(i).unbind("click").html("")}});n=$("#jqgrid");t=n.jqGrid("getCol","Amount",!1,"sum");n.jqGrid("footerData","set",{OrderQtyInPallets:"Total Amount $:"});n.jqGrid("footerData","set",{Amount:parseFloat(n.jqGrid("getCol","Amount",!1,"sum")).toFixed(2)});$(".tamounteuro").text(parseFloat(t).toFixed(2));parseInt(t)!==0?$(".tamountdlr").text(parseFloat(1/t).toFixed(2)):0;console.log("loader Hide ");$("#loader").css("visibility","hidden");$("#loader").hide()}});$("#jqgrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".allownumericwithdecimal").keypress(function(n){var t=n.which?n.which:event.keyCode;if(String.fromCharCode(t).match(/[^0-9,\b]/g))return!1});$(".txtOnly").keypress(function(n){var t=n.keyCode;t>=48&&t<=57&&n.preventDefault()})}function CreateSubGriddata(n,t){var u,r,i;u=ClonedProjectDetails?selectedprojectId_Clone:$("#ProjectId").children(":selected").attr("value");r=$("#jqgrid").jqGrid("getRowData",t);i=[];ParentSubgrid_data.length>0&&(i=ParentSubgrid_data.filter(n=>n.SequenceNo==r.SequenceNo),$.jgrid.gridUnload("#"+n),CreateSubGrid(i,n));$.ajax({url:ROOT+"Master/GetSubMilestones",type:"get",dataType:"JSON","async":!1,data:{SequnceNo:r.SequenceNo,ProjectId:u},success:function(t){var s=!0,u=$.merge(t,i),e,o,h,f;if(TotalSubGridData.length>0){for(e=0;e<TotalSubGridData.length;e++)if(f=TotalSubGridData[e],f[0].SequenceNo==r.SequenceNo){u=$.merge(f,i);o=[];$.each(u,function(n,t){var i=!1;$.each(o,function(n,r){if(compareObjects(t,r))return i=!0,!1});i||o.push(t)});arrayOfObjects=o;console.log(arrayOfObjects);u=o;f=u.filter(n=>n.Action=="true");f.length>0&&(h=pmugridData.filter(n=>n.MilestoneStatus=="Completed"&&n.SequenceNo==f[0].SequenceNo),h.length!=0&&(f=u.filter(n=>n.Action==null),$.each(u,function(n,t){t.Action==null&&(t.MilestoneStatus="Done")})));TotalSubGridData[e]=u;s=!1;break}deletedSubMilestone&&(s=!1);s&&u.length>0&&(ClonedProjectDetails&&$.each(u,function(n){u[n].Status="";u[n].MilestoneStatus="";u[n].IsApproved="";u[n].FileName="";u[n].Remarks="";u[n].PMUMappingStatus=""}),TotalSubGridData.push(u),s=!1)}else f=t.filter(n=>n.Action=="true"),h=pmugridData.filter(n=>n.MilestoneStatus=="Completed"&&n.SequenceNo==f[0].SequenceNo),h.length!=0&&(f=t.filter(n=>n.Action==null),$.each(t,function(n,t){t.Action==null&&(t.MilestoneStatus="Done")})),ClonedProjectDetails&&$.each(t,function(n){t[n].Status="";t[n].MilestoneStatus="";t[n].IsApproved="";t[n].FileName="";t[n].Remarks="";t[n].PMUMappingStatus=""}),TotalSubGridData.push(t);$.jgrid.gridUnload("#"+n);CreateSubGrid(u,n);SubGridsortingrecord(n)}});$(".allownumericwithdecimal").keypress(function(n){var t=n.which?n.which:event.keyCode;if(String.fromCharCode(t).match(/[^0-9,\b]/g))return!1})}function compareObjects(n,t){return n.SubMilestoneId===t.SubMilestoneId}function Remarksenter(n){var t=$("#jqgrid").getRowData(n);objindex=pmugridData.findIndex(n=>n.SequenceNo==t.SequenceNo);pmugridData[objindex].Remarks=$("#"+t.SequenceNo+"Remarks").val();objindex=MaterialArray.findIndex(n=>n.SequenceNo==t.SequenceNo);MaterialArray[objindex].Remarks=$("#"+t.SequenceNo+"Remarks").val()}function SubRemarksenter(n,t){var i=n.id,r=$("#"+i).jqGrid("getGridParam","data"),u=$("#"+i).jqGrid("getRowData",t),f=r.findIndex(n=>n.SubMilestoneId==u.SubMilestoneId);r[f].Remarks=$("#"+u.SubMilestoneId+"SubRemarks").val()}function gettingprevdata(n){var t,i;selectedrowid=n;t=$("#jqgrid").getRowData(n);selectedrowsequnce=t.SequenceNo;selectedmilestoneId=t.MilestoneId;prevStartDate=$("#"+t.SequenceNo+"start_date").val();prevEndDate=$("#"+t.SequenceNo+"end_date").val();beforesetrelation=$("#"+t.SequenceNo+"SetRelation").val();beforeDuration=$("#"+t.SequenceNo+"Duration").val();i=t.SequenceNo}function rowselect(n,t){var d=!0,r,e,s,l,nt,c,w,h,st,b,v,it,k,i,y,f,p,u,o,rt,ut;if(selectedrowid=n,r=$("#jqgrid").getRowData(n),selectedmilestoneId=r.MilestoneId,prevStartDate=$("#"+r.SequenceNo+"start_date").val(),prevEndDate=$("#"+r.SequenceNo+"end_date").val(),beforesetrelation=$("#"+r.SequenceNo+"SetRelation").val(),beforeDuration=$("#"+r.SequenceNo+"Duration").val(),e=r.SequenceNo,allData=$("#jqgrid").jqGrid("getGridParam","data"),t==!0){if(setrelationchanged=!1,selectedrowid=="1"&&(objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo),pmugridData[objIndex].Action="true"),beforesetrelation==undefined&&(i=-1,i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),i==-1&&MaterialArray.push(pmugridData[objIndex])),objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo),pmugridData[objIndex].Action="true",i=-1,i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),i==-1&&MaterialArray.push(pmugridData[objIndex]),s=$("#"+e+"SetRelation").val(),s!=undefined)for(s=s.split(","),f=$("#jqgrid").jqGrid("getGridParam","data"),o=0;o<=s.length-1;o++){for(u=0;u<=f.length-1;u++)if(f[u].SequenceNo==s[o]&&(objindex1=pmugridData.findIndex(n=>n.SequenceNo==s[o]),t==!0))if(pmugridData[objindex1].Action==null||pmugridData[objindex1].Action==""){alert("Dependent Milestones are not mapped ");$("#jqg_jqgrid_"+n).prop("checked",!1);pmugridData[objIndex].Action="";i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);i>=0&&MaterialArray.splice(i,1);l=!0;break}else{objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);pmugridData[objIndex].Action="true";i=-1;i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);i==-1&&MaterialArray.push(pmugridData[objIndex]);beforesetrelation=Math.max.apply(Math,s);objIndex=pmugridData.findIndex(n=>n.SequenceNo==beforesetrelation);var ft=$("#"+e+"start_date").val(),et=$("#"+e+"end_date").val(),g=$("#"+beforesetrelation+"ExtraDays").val();if(ft==""&&et==""&&(pmugridData[0].EndDate!=""&&pmugridData[0].EndDate!=null?(nt=getHighestdatefromMulSetrelation($("#"+e+"SetRelation").val()),c=nt):c="",c!=undefined&&c!="")){w=new Date(c.split("/").reverse().join("-"));h="";h=parseInt(g)>0?moment(w).add(parseInt(g)+1,"days").format("DD/MM/YYYY"):moment(w).add(1,"days").format("DD/MM/YYYY");$("#"+e+"start_date").val(h);var ht=$("#"+e+"start_date").val(),tt="",a="",ot=new Date(h.split("/").reverse().join("-"));tt=$("#"+e+"Duration").val();a=moment(ot).add(tt-1,"days").format("DD/MM/YYYY");$("#"+e+"end_date").val(a);i=pmugridData.findIndex(n=>n.SequenceNo==e);pmugridData[i].StartDate=h;pmugridData[i].EndDate=a;i=MaterialArray.findIndex(n=>n.SequenceNo==e);MaterialArray[i].StartDate=h;MaterialArray[i].EndDate=a}break}if(l)break}}else if($("#jqg_jqgrid_"+n).prop("checked")==!1){for(st=!0,u=0;u<=pmugridData.length-1;u++){if(pmugridData[u].SetRelation!=null)for(b=pmugridData[u].SetRelation.split(","),v=0;v<=b.length-1;v++)if(b[v]==e&&pmugridData[u].Action=="true"){alert("Please check whether the below milestone(s) are dependent on the current milestone");$("#jqg_jqgrid_"+n).prop("checked",!0);d=!1;l=!0;i=-1;i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);i==-1&&MaterialArray.push(allData[u-1]);break}if(l)break}if(d){if($("#"+e+"start_date").val(""),$("#"+e+"end_date").val(""),$("#"+e+"mapperUser").val(""),$("#"+e+"Remarks").val(""),r.SubmilestoneExit=="True"){for($.each(subgrid_table_id,function(t){var i=subgrid_table_id[t].split("_");i[1]==n&&(gridid=subgrid_table_id[t])}),u=0;u<TotalSubGridData.length;u++)if(f=TotalSubGridData[u],it=f.findIndex(n=>n.SequenceNo==e),it!=-1){$.each(f,function(n){f[n].StartDate="";f[n].MilestoneStatus="";f[n].EndDate="";f[n].UserId="";f[n].UserName="";f[n].Action="";f[n].Remarks=""});k=f;TotalSubGridData[u]=k;$.jgrid.gridUnload("#"+gridid);CreateSubGrid(TotalSubGridData[u],gridid);break}LoadSubGridData=!0;$("#"+gridid).jqGrid("clearGridData",!0);$("#"+gridid).jqGrid("setGridParam",{data:k});$("#"+gridid).trigger("reloadGrid")}i=-1;i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);i>=0&&MaterialArray.splice(i,1);$("#jqg_jqgrid_"+n).prop("checked",!1);DurationList=DurationList.filter(function(n){return n.milestoneName!==r.MilestoneName});$("#jqgrid").jqGrid("setCell",e,"Action","");i=-1;i=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);i>=0&&(pmugridData[i].StartDate="",pmugridData[i].EndDate="",pmugridData[i].UserId="",pmugridData[i].UserName="",pmugridData[i].Action="",pmugridData[i].Remarks="")}}for(u=0;u<pmugridData.length;u++)$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==pmugridData[u].SequenceNo&&($(t).find("td:nth-child(12)").css("background-color","white"),$(t).find("td:nth-child(13)").css("background-color","white"))});for(y="",f=[],p=0;p<=TotalSubGridData.length;p++)$.merge(f,$.extend(!0,[],TotalSubGridData[p]));for(u=0;u<f.length;u++){for(o=0;o<subgrid_table_id.length;o++)rt=subgrid_table_id[o].split("_"),ut=rt[2].replace("t",""),ut.trim()==f[u].SequenceNo&&(y=subgrid_table_id[o]);console.log(y);$("#"+y+" tbody tr").each(function(n,t){var i=$(t).find("td:nth-child(4)").text();i==f[u].SubMilestoneId&&($(t).find("td:nth-child(11)").css("background-color","white"),$(t).find("td:nth-child(12)").css("background-color","white"))})}}function SubEditUser(n,t){var i=$("#"+n.id).getRowData(t),r,u,f;usernumber=i.SubMilestoneId;r=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo);selectedmilestoneId=i.MilestoneId;ParentMilestoneid=pmugridData[r].MilestoneId;u=$("#"+usernumber+"mapperUser").val();f=$("#"+usernumber+"mapperUserid").val()}function EditUser(n){var t=$("#jqgrid").getRowData(n),i,r;usernumber=t.SequenceNo;selectedmilestoneId=t.MilestoneId;i=$("#"+usernumber+"mapperUser").val();r=$("#"+usernumber+"mapperUserid").val();i==""&&(objindex=MaterialArray.findIndex(n=>n.SequenceNo==usernumber),MaterialArray[objindex].UserId="",MaterialArray[objindex].UserName="",objindex=pmugridData.findIndex(n=>n.SequenceNo==usernumber),pmugridData[objindex].UserId="",pmugridData[objindex].UserName="")}function LoadUser(){var f,r,t,u,n,i,e,o;for($.ajax({url:ROOT+"Master/UserList",type:"POST",dataType:"JSON",data:{Griddata:DefaultArray},success:function(n){availableTags=[];usersMap={};n.forEach(n=>{availableTags.push({label:n.UserName,value:n.UserId}),usersMap[n.UserName]=n.UserId});$(".tags").autocomplete({source:function(n,t){var i=n.term,e=n.term,f=[],r=[],h,o,s,c,u;i.indexOf(",")>0&&(r=i.split(/;/g),r.pop(),$.each(r,function(n,t){t=t.replace(/^\s+/,"").toLowerCase()}),h=i.lastIndexOf(","),i=i.substring(h+1));o=[];$.trim(i).length>0&&(s=i,c=new RegExp("^"+s,"i"),o=$.grep(availableTags,function(n){return $.trim(n.label).toLowerCase().indexOf(s.toLowerCase())!=-1&&(r.length==0||r.length>0&&!r.includes($.trim(n.label)))}));t($.ui.autocomplete.filter(o.slice(0,50),extractLast(i)));e=e.split(",");e.forEach(n=>{f.push(n.trim())});u=[];f.forEach(n=>{u.push(usersMap[n])});u.push("");f.push("");this.value=f.join(",");useridslist=u.join(",");$("#"+usernumber+"mapperUserid").val(u.join(","))},focus:function(){return!1},select:function(n,t){var a="",v="",y=pmugridData.findIndex(n=>n.SequenceNo==usernumber),f,l,s,r,p,i,u,h,e,w,b,c,o;for(y!=-1&&(a=pmugridData[y].Action),f=0;f<=TotalSubGridData.length-1;f++)if(l=TotalSubGridData[f].findIndex(n=>n.SubMilestoneId==usernumber),l!=-1){v=TotalSubGridData[f][l].Action;break}if(a=="true"||v=="true"){if(s=[],r=split(this.value.trim()),r.pop(),p=r.indexOf(t.item.label),p!=-1?alert("Duplicate selection is not allowed"):r.push(t.item.label),r.forEach(n=>{s.push(n.trim())}),i=[],s.forEach(n=>{i.push(usersMap[n])}),i.push(""),s.push(""),this.value=r.join(","),useridslist=i.join(","),$("#"+usernumber+"mapperUserid").val(i.join(",")),objindex=pmugridData.findIndex(n=>n.MilestoneId==ParentMilestoneid),selectedmilestoneId!=undefined)objindex=MaterialArray.findIndex(n=>n.MilestoneId==selectedmilestoneId),MaterialArray[objindex].UserId=i.join(","),MaterialArray[objindex].UserName=this.value,objindex=pmugridData.findIndex(n=>n.MilestoneId==selectedmilestoneId),pmugridData[objindex].UserId=i.join(","),pmugridData[objindex].UserName=this.value;else for(u=0;u<TotalSubGridData.length;u++)h=TotalSubGridData[u].findIndex(n=>n.SubMilestoneId==usernumber),h!=-1&&(TotalSubGridData[u][h].UserId=i.join(","),TotalSubGridData[u][h].UserName=this.value);if(pmugridData[objindex].SubmilestoneExit=="True"){for(e=0;e<subgrid_table_id.length;e++)w=subgrid_table_id[e].split("_"),b=w[2].substring(1),b==pmugridData[objindex].SequenceNo&&(c=subgrid_table_id[e]);for(o=0;o<TotalSubGridData.length;o++)pmugridData[objindex].Action=="true"&&pmugridData[objindex].SequenceNo==TotalSubGridData[o][0].SequenceNo&&($.jgrid.gridUnload("#"+c),CreateSubGrid(TotalSubGridData[o],c),SubGridsortingrecord(c))}return!1}alert("Please select the milestone before selecting the user(s).");$("#"+usernumber+"mapperUserid").val("");$("#"+usernumber+"mapperUser").val("");t.item.value=""}})}}),f=pmugridData.filter(n=>n.Action=="true"),n=0;n<f.length;n++)$("#jqgrid tbody tr").each(function(t,i){$(i).find("td:nth-child(5)").text()==f[n].SequenceNo&&($(i).find("td:nth-child(12)").css("background-color","white"),$(i).find("td:nth-child(13)").css("background-color","white"))});for(r="",t=[],u=0;u<=TotalSubGridData.length;u++)$.merge(t,$.extend(!0,[],TotalSubGridData[u]));for(n=0;n<t.length;n++)if(subgrid_table_id.length>0){for(i=0;i<subgrid_table_id.length;i++)e=subgrid_table_id[i].split("_"),o=e[2].replace("t",""),o.trim()==t[n].SequenceNo&&(r=subgrid_table_id[i]);console.log(r);$("#"+r+" tbody tr").each(function(i,r){var u=$(r).find("td:nth-child(4)").text();u==t[n].SubMilestoneId&&($(r).find("td:nth-child(11)").css("background-color","white"),$(r).find("td:nth-child(12)").css("background-color","white"))})}}function split(n){return n.split(/,\s*/)}function extractLast(n){return split(n).pop()}function displayDate(n,t){display=="s"&&(DurationList=[],searchresult=[],MaterialArray=[],$("#selectedProjectName").val(t),$("#selectedProjectId").val(n),n=="0"?($(".projectName_error").show(),$(".projectName_error").html("Please Select Project Name"),$("#btnRefresh").css("display","none"),$("#BtnClone").css("display","none"),$("#TemplateListdiv").hide(),$.ajax({url:ROOT+"Master/MilestonesList",type:"GET",data:{projectId:n,projectName:t,clonedProjectId:n,clonedProjectName:t},dataType:"JSON",success:function(){$("#jqgrid").jqGrid("clearGridData",!0);$("#ApproveModal").css("display","none")}})):($(".projectName_error").html(""),$("#SaveModel").show(),$("#SaveModel1").show(),$("#btnRefresh").show(),$("#BtnClone").show(),$("#TemplateListdiv").show(),$("#loader").show(),$("#loader").css("visibility","visible"),$.ajax({url:ROOT+"Master/MilestonesList",type:"post",data:{projectId:n,projectName:t,clonedProjectId:n,clonedProjectName:t},dataType:"JSON",success:function(n){var u,i,t,r;for(pmuFirstData=n,$(".projectName_error").hide(),$("#addModal").modal("hide"),searchresult=n,n.forEach(n=>{n.StartDate!=""&&n.EndDate!=""&&DurationList.push({milestoneName:n.MilestoneName,Duration:n.Duration,MilestoneStatus:n.MilestoneStatus,SetRelation:n.SetRelation})}),ProjStatus=n[0].Status,PMUFlag=n[0].Flag,pmugridData=n,pmugridData[0].SetRelation="0",projectIdchanged=!0,LoadSubGridData=!1,ClonedProjectDetails=!1,TotalSubGridData=[],$.jgrid.gridUnload("#jqgrid"),CreateJqGrid(pmugridData),projectIdchanged=!1,allData=$("#jqgrid").jqGrid("getGridParam",n),u=$("#jqgrid").jqGrid("getGridParam","records"),i=1,t=0;t<=pmugridData.length-1;t++)pmugridData[t].Action=="true"&&($("#jqg_jqgrid_"+i).prop("checked",!0),$("#jqg_jqgrid_"+i).prop("checked")==!0&&(MaterialArray.push(pmugridData[t]),$("body").addClass("menuitemshow"),$("#"+pmugridData[t].SequenceNo+"mapperUserid").val(pmugridData[t].UserId)),(pmugridData[t].MilestoneStatus=="Completed"||pmugridData[t].IsApproved=="Pending For Approval")&&$("#jqg_jqgrid_"+i).attr("disabled",!0)),i++;for($(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"),$(this).attr("id"))}}),$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"),$(this).attr("id"))}}),LoadUser("mapperUser"),n[0].Status=="SUBMITTED"&&($(".approve_btn").css("display","inline-block"),$(".checkboxpmu").hide(),$("#BtnClone").css("display","none"),$("#TemplateListdiv").hide()),n[0].Status=="APPROVED"&&($(".save_btn").css("display","none"),$("#BtnClone").css("display","none"),$("#TemplateListdiv").hide(),$(".approve_btn").css("display","none"),$(".checkboxpmu").show()),n[0].Status==""&&($(".approve_btn").css("display","none"),$(".checkboxpmu").hide()),r=pmugridData.findIndex(n=>n.IsApproved=="Pending For Approval"),r>=0&&($("#pendingApprovalmodel").modal("show"),$("#Pendingapprovalmilestones").empty(),$.each(pmugridData,function(n){pmugridData[n].IsApproved=="Pending For Approval"&&$("#Pendingapprovalmilestones").append("<ul><b><li>"+pmugridData[n].MilestoneName+"<\/li><\/b><\/ul>")})),t=0;t<TotalSubGridData.length;t++)r=TotalSubGridData[t].findIndex(n=>n.IsApproved=="Pending For Approval"),r>=0&&($("#pendingApprovalmodel").modal("show"),$.each(TotalSubGridData[t],function(n){console.log(TotalSubGridData[t][n].IsApproved);TotalSubGridData[t][n].IsApproved=="Pending For Approval"&&$("#Pendingapprovalmilestones").append("<ul><b><li>"+TotalSubGridData[t][n].SubMilestoneName+"<\/li><\/b><\/ul>")}));$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(7)").text()=="Completed"&&$(this).attr("class","custom-class")})}})))}function EndChangeDate(n){var s,a,t,c,r,l,y,p,w,o;if(EnddatechangedRowId=n,newSubGridrow=!1,Datachange_SubgRID=!1,t=jQuery("#jqgrid").jqGrid("getRowData",n),ParentSubGridId=t.SequenceNo,$("#jqg_jqgrid_"+n).prop("checked")==!1)return alert("Please select the checkbox"),$("#"+t.SequenceNo+"end_date").val(""),objIndex=pmugridData.findIndex(n=>n.SequenceNo==t.SequenceNo),pmugridData[objIndex].StartDate="",!1;for(objIndex=pmugridData.findIndex(n=>n.SequenceNo==t.SequenceNo),pmugridData[objIndex].EndDate=$("#"+t.SequenceNo+"end_date").val(),UpdatedEndDate_User=pmugridData[objIndex].EndDate,changedmilestoneId=t.SequenceNo,s=0;s<TotalSubGridData.length;s++)if(a=TotalSubGridData[s].find(n=>n.SequenceNo>=changedmilestoneId),a!=undefined){chnagedSubgridDateId=a.SubMilestoneId;break}var d=parseInt($("#"+changedmilestoneId+"SetRelation").val()),g=$("#"+changedmilestoneId+"start_date").val().split("/").join("-"),nt=$("#"+changedmilestoneId+"end_date").val().split("/").join("-"),tt=new Date(g.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),it=new Date(nt.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),rt=tt-it,ut=rt/864e5,h=Math.round(Math.abs(ut));t.SubmilestoneExit!="True"&&$("#"+changedmilestoneId+"Duration").val(h+1);var t=jQuery("#jqgrid").jqGrid("getRowData",n),b=moment($("#"+t.SequenceNo+"start_date").val(),"DD-MM-YYYY"),k=moment($("#"+t.SequenceNo+"end_date").val(),"DD-MM-YYYY");if(b>k)return alert("End date should be greater than Start date"),$("#jqgrid").jqGrid("getLocalRow",t.SequenceNo).EndDate="",$("#"+t.SequenceNo+"end_date").val(prevEndDate),$("#"+t.SequenceNo+"end_date").datepicker("setDate",prevEndDate),$("#"+t.SequenceNo+"Duration").val(beforeDuration),iserror=!0,!1;durationflag?DurationList.forEach(function(t,i){i==n-1&&(DurationList[i].Duration=h)}):DurationList.forEach(function(t,i){i==n-1&&(DurationList[i].Duration=h+1)});objIndex=searchresult.findIndex(n=>n.SequenceNo==t.SequenceNo);searchresult[objIndex].Duration=h+1;console.log("After",searchresult);rowindex=parseInt(n)+1;var v=changedmilestoneId,st=parseInt(changedmilestoneId)+1,u=$("#"+d+"start_date").val(),f=$("#"+changedmilestoneId+"start_date").val();if(u!=undefined&&f!=undefined)if(u=u.split("/").reverse().join("-"),f=f.split("/").reverse().join("-"),u=new Date(u.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),f=new Date(f.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),u<f,t=jQuery("#jqgrid").jqGrid("getRowData",n),c=MaterialArray.findIndex(n=>n.SetRelation.split(",").includes(t.SequenceNo)),c>0)DisplaySubGridValue="",dependentMilestoneDetails(SelectedProjectId,t.MilestoneId),dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(t.MilestoneId,SelectedProjectId,"Dependentjqgridend"),$("#UserConfirmationforenddate").modal("show");else for(selectedrowsequnce=t.SequenceNo,ParentSubGridId=t.SequenceNo,cancelbutton(),r=0;r<pmugridData.length;r++)$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==pmugridData[r].SequenceNo&&($(t).find("td:nth-child(12)").css("background-color","white"),$(t).find("td:nth-child(13)").css("background-color","white"))});else if($("1end_date").val()!="")DisplaySubGridValue="",dependentMilestoneDetails(SelectedProjectId,t.MilestoneId),dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(t.MilestoneId,SelectedProjectId,"Dependentjqgridend"),$("#UserConfirmationforenddate").modal("show");else if(t=jQuery("#jqgrid").jqGrid("getRowData",n),c=MaterialArray.findIndex(n=>n.SetRelation==t.SequenceNo),c>0){for(r=1;r<=pmugridData.length-1;r++){if($("#jqg_jqgrid_"+r).prop("checked")==!0)for(l=0;l<=pmugridData.length-1;l++){var t=jQuery("#jqgrid").jqGrid("getRowData",rowindex),b=moment($("#"+n+"start_date").val(),"DD-MM-YYYY"),k=moment($("#"+n+"end_date").val(),"DD-MM-YYYY");if(issetrelationchanged&&b>k){alert("End date should be greater than Start date of the selected Milestone");$("#jqgrid").jqGrid("getLocalRow",v).EndDate="";$("#"+v+"end_date").val(prevEndDate);$("#"+v+"end_date").datepicker("setDate",prevEndDate);iserror=!0;break}if($("#jqg_jqgrid_"+rowindex).prop("checked")==!0){if(pmugridData[l].MilestoneName==t.MilestoneName){if(y=jQuery("#jqgrid").jqGrid("getRowData",rowindex),y.MilestoneStatus!="Completed"){var i=y.SequenceNo,ft=$("#"+i+"SetRelation").val(),et=$("#"+ft+"end_date").val(),ot=new Date(et.split("/").reverse().join("-")),e=moment(ot).add(1,"days").format("DD/MM/YYYY");$("#jqg_jqgrid_"+rowindex).prop("checked")==!0&&($("#"+i+"start_date").val(e),$("#"+i+"start_date").datepicker("setDate",e),objIndex=pmugridData.findIndex(n=>n.SequenceNo==i),pmugridData[objIndex].StartDate=e,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==i),MaterialArray[objIndex].StartDate=e)}p=new Date(e.split("/").reverse().join("-"));w=$("#"+i+"Duration").val();o=durationflag?moment(p).add(w,"days").format("DD/MM/YYYY"):moment(p).add(w-1,"days").format("DD/MM/YYYY");$("#jqg_jqgrid_"+rowindex).prop("checked")==!0&&($("#"+i+"end_date").val(o),$("#"+i+"end_date").datepicker("setDate",o),objIndex=pmugridData.findIndex(n=>n.SequenceNo==i),pmugridData[objIndex].EndDate=o,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==i),MaterialArray[objIndex].EndDate=o);rowindex++}}else rowindex++}if(iserror)break}$("#jqgrid").jqGrid("getLocalRow",rowindex).StartDate=""}}function DatepapulateforEndDATE(){var w=EnddatechangedRowId,e=ParentSubGridId,n,k,l,i,d,a,u,o,tt,v,y,s,p,et,ot,h,f;if($("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==ParentSubGridId&&(e=$(this).closest("tr").attr("id"))}),rowindex=parseInt(e)+1,n=jQuery("#jqgrid").jqGrid("getRowData",e),n.SubmilestoneExit=="True"){var nt=jQuery("#"+newStr).jqGrid("getGridParam","data"),b=jQuery("#"+newStr).jqGrid("getRowData",w),c=$("#"+b.SubMilestoneId+"SetRelation").val();SubgridStartDatechanged?(st=$("#"+b.SubMilestoneId+"start_date").val(),SubgridStartDatechanged=!1):(c=="0"?st=$("#"+b.SubMilestoneId+"start_date").val():(k=[],c=c.split(","),$.each(c,function(n){var r=nt.findIndex(t=>t.SubMilestoneId==c[n]),t=nt[r].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),k.push(new Date(i)))}),l=new Date(Math.max.apply(null,k)),l=moment(l).format("DD/MM/YYYY"),st=l),a=new Date(st.split("/").reverse().join("-")),st=moment(a).add(1,"days").format("DD/MM/YYYY"));i=SubGridDatesDisplay(w,newStr,"start_date",st);i.newDate!="Invalid date"?($("#"+n.SequenceNo+"end_date").val(i.newDate),w=="1"&&$("#"+n.SequenceNo+"start_date").val(i.StartDate),$("#"+n.SequenceNo+"Duration").val(i.Duration)):(d=pmuFirstData.findIndex(t=>t.SequenceNo==n.SequenceNo),e=="1"&&$("#"+n.SequenceNo+"start_date").val(i.StartDate),$("#"+n.SequenceNo+"Duration").val(pmuFirstData[d].Duration),a=new Date(i.StartDate.split("/").reverse().join("-")),u=moment(a).add(parseInt(pmuFirstData[d].Duration)-1,"days").format("DD/MM/YYYY"),$("#"+n.SequenceNo+"end_date").val(u));o=pmugridData.findIndex(t=>t.SequenceNo==n.SequenceNo);pmugridData[o].EndDate=i.newDate;pmugridData[o].Duration=i.Duration;o=MaterialArray.findIndex(t=>t.SequenceNo==n.SequenceNo);MaterialArray[o].EndDate=i.newDate;MaterialArray[o].Duration=i.Duration}if(tt=MaterialArray.findIndex(t=>t.SetRelation.split(",").includes(n.SequenceNo)),tt>0){for(v=1;v<=pmugridData.length-1;v++){if($("#jqg_jqgrid_"+v).prop("checked")==!0)for(y=0;y<=pmugridData.length-1;y++){var n=jQuery("#jqgrid").jqGrid("getRowData",rowindex),ht=moment($("#"+e+"start_date").val(),"DD-MM-YYYY"),ct=moment($("#"+e+"end_date").val(),"DD-MM-YYYY");if(issetrelationchanged&&ht>ct){alert("End date should be greater than Start date");$("#jqgrid").jqGrid("getLocalRow",SequnceRow).EndDate="";$("#"+SequnceRow+"end_date").val("");$("#"+SequnceRow+"end_date").datepicker("setDate","");iserror=!0;break}if($("#jqg_jqgrid_"+rowindex).prop("checked")==!0){if(pmugridData[y].MilestoneName==n.MilestoneName){if(s=jQuery("#jqgrid").jqGrid("getRowData",rowindex),s.MilestoneStatus!="Completed"){var t=s.SequenceNo,it=$("#"+t+"SetRelation").val(),lt=getHighestdatefromMulSetrelation(it),at=lt,rt=new Date(at.split("/").reverse().join("-")),ut=$("#"+it+"ExtraDays").val(),u="";u=ut!=""?moment(rt).add(parseInt(ut)+1,"days").format("DD/MM/YYYY"):moment(rt).add(1,"days").format("DD/MM/YYYY");$("#jqg_jqgrid_"+rowindex).prop("checked")==!0&&($("#"+t+"start_date").val(u),$("#"+t+"start_date").datepicker("setDate",u),objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].StartDate=u,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==t),MaterialArray[objIndex].StartDate=u)}var r="",g="",ft=0;s.SubmilestoneExit=="True"?(p="",subgrid_table_id.length!=ft&&$.each(subgrid_table_id,function(n){var t=subgrid_table_id[n].split("_");t[1]==rowindex&&(p=subgrid_table_id[n])}),et=$("#"+p).jqGrid("getGridParam","data"),ot=et.filter(n=>n.Action=="true"),EndDatechange_Sub=!0,ot.length>0?(g=SubGridDatesDisplay(0,p,"start_date",$("#"+s.SequenceNo+"start_date").val()),ft++,f=g.newDate,r=g.Duration,$("#"+s.SequenceNo+"Duration").val(r)):(h=new Date(u.split("/").reverse().join("-")),r=$("#"+t+"Duration").val(),f=durationflag?moment(h).add(r,"days").format("DD/MM/YYYY"):moment(h).add(r-1,"days").format("DD/MM/YYYY"))):(h=new Date(u.split("/").reverse().join("-")),r=$("#"+t+"Duration").val(),f=durationflag?moment(h).add(r,"days").format("DD/MM/YYYY"):moment(h).add(r-1,"days").format("DD/MM/YYYY"));$("#jqg_jqgrid_"+rowindex).prop("checked")==!0&&($("#"+t+"end_date").val(f),$("#"+t+"Duration").val(r),$("#"+t+"end_date").datepicker("setDate",f),objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].EndDate=f,pmugridData[objIndex].Duration=r,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==t),MaterialArray[objIndex].EndDate=f,MaterialArray[objIndex].Duration=r);rowindex++}}else rowindex++}if(iserror)break}$("#jqgrid").jqGrid("getLocalRow",rowindex).StartDate=""}HighlightUpdatedDaterows()}function HighlightUpdatedDaterows(){for(var r,t,f,c,i,e,o,l=pmugridData.filter(n=>n.Action=="true"),n=0;n<l.length;n++)$("#jqgrid tbody tr").each(function(t,i){$(i).find("td:nth-child(5)").text()==l[n].SequenceNo&&($(i).find("td:nth-child(12)").css("background-color","white"),$(i).find("td:nth-child(13)").css("background-color","white"))});for(r="",t=[],f=0;f<=TotalSubGridData.length;f++)$.merge(t,$.extend(!0,[],TotalSubGridData[f]));for(n=0;n<t.length;n++){for(i=0;i<subgrid_table_id.length;i++)e=subgrid_table_id[i].split("_"),o=e[2].replace("t",""),o.trim()==t[n].SequenceNo&&(r=subgrid_table_id[i]);console.log(r);$("#"+r+" tbody tr").each(function(i,r){var u=$(r).find("td:nth-child(4)").text();u==t[n].SubMilestoneId&&($(r).find("td:nth-child(11)").css("background-color","white"),$(r).find("td:nth-child(12)").css("background-color","white"))})}for(changedmaingrid_id!=""&&(dependentMilestoneDetailsList=dependentMilestoneDetailsList.filter(n=>n.SequenceNo==changedmaingrid_id),changedmaingrid_id=""),n=0;n<dependentMilestoneDetailsList.length;n++)$("#jqgrid tbody tr").each(function(t,i){$(i).find("td:nth-child(5)").text()==dependentMilestoneDetailsList[n].SequenceNo&&($(i).find("td:nth-child(12)").css("background-color","rgb(149 197 24)"),$(i).find("td:nth-child(13)").css("background-color","rgb(149 197 24)"))});var r="",a=$.map(dependentMilestoneDetailsList,function(n){if(n.SubmilestoneExit=="True")return n.SequenceNo}),t=$.grep(DependentSub_Milestones,function(n,t){var i=parseInt(n.SequenceNo);if($.inArray(i,a)!==-1)return DependentSub_Milestones[t]}),u=[],s=[],h=t.findIndex(n=>n.SubMilestoneId==unionSelectedSubgrid_id);if(h!=-1&&(c=t[h].SequenceNo,u=t.filter(n=>n.SequenceNo==c)),CancelHighlighter)t=t.filter(n=>n.SubMilestoneId==unionSelectedSubgrid_id),CancelHighlighter="",unionSelectedSubgrid_id="";else{if(unionSelectedSubgrid_id!=""){if(s.push(t[h]),u.length>0)for(n=0;n<u.length-1;n++)$.merge(s,$.extend(!0,[],u.filter(t=>t.SetRelation==u[n].SubMilestoneId)));unionSelectedSubgrid_id=""}$.each(t,function(n,i){if(i.SequenceNo===c)return t.splice(n,1),!1});$.merge(t,$.extend(!0,[],s))}for(n=0;n<t.length;n++){for(i=0;i<subgrid_table_id.length;i++)e=subgrid_table_id[i].split("_"),o=e[2].replace("t",""),o.trim()==t[n].SequenceNo&&(r=subgrid_table_id[i]);$("#"+r+" tbody tr").each(function(i,r){var u=$(r).find("td:nth-child(4)").text();u==t[n].SubMilestoneId&&($(r).find("td:nth-child(11)").css("background-color","rgb(149 197 24)"),$(r).find("td:nth-child(12)").css("background-color","rgb(149 197 24)"))})}}function ChangeSetRelation(n,t){var f,u,c,w,b,e,l,a,o,i,p,r;userchangedSetrelation=!1;selectedrow=n;var h=!0,i=jQuery("#jqgrid").jqGrid("getRowData",n);if(ParentSubGridId=i.SequenceNo,selectedrowsequnce=i.SequenceNo,f=$("#"+i.SequenceNo+"SetRelation").val(),f=="0"&&(alert("Please enter valid Set Relation"),$("#"+i.SequenceNo+"SetRelation").val(beforesetrelation)),allData=$("#jqgrid").jqGrid("getGridParam","data"),u=f.split(","),FindRowIDsequnce=Math.max.apply(Math,u),objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].SetRelation=f,c=u.every(function(n){var t=pmugridData.find(function(t){return t.SequenceNo==n});return t&&t.Action=="true"}),console.log("areAllIdsTrue",c),objIndex=pmugridData.findIndex(n=>n.SequenceNo==FindRowIDsequnce),objIndex>=0)if(w=allData.findIndex(n=>n.SequenceNo==FindRowIDsequnce),c){if(objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].Action=="true")if(get_relations(i.SequenceNo,[]),sortingrecord(),looping){for(b=FindRowIDsequnce,e=0;e<=u.length-1;e++)if(t<=u[e]){t==u[e]?(h=!1,sort=!1,alert("Please enter valid Set Relation "),$("#"+t+"SetRelation").val(beforesetrelation)):(alert("Please click on refresh button for sorting the records"),sort=!1,h=!0);break}if(setrelationchanged=!0,h){for(r=0;r<=milestoneid_looping.length-1;r++)$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==milestoneid_looping[r]&&$(t).closest("tr").children("td,th").css("background-color","")});if(isinvalide=0,pmugridData[0].StartDate!=""&&pmugridData[0].StartDate!=null&&pmugridData[0].StartDate!=undefined?(l=getHighestdatefromMulSetrelation(f),objIndex=pmugridData.findIndex(n=>n.SequenceNo==FindRowIDsequnce),a=l,o=a):o="",o!=""&&o!=undefined){var v=moment(o,"DD/MM/YYYY"),y=$("#"+FindRowIDsequnce+"ExtraDays").val(),s="";s=y?moment(v).add(parseInt(y)+1,"days").format("DD/MM/YYYY"):moment(v).add(1,"days").format("DD/MM/YYYY");$("#"+t+"start_date").val(s);$("#"+t+"start_date").datepicker("setDate",s);issetrelationchanged=!1;objIndex=pmugridData.findIndex(n=>n.SequenceNo==t);pmugridData[objIndex].StartDate=s;objIndex=DurationList.findIndex(n=>n.milestoneName==i.MilestoneName);objIndex!=-1&&(DurationList[objIndex].SetRelation=$("#"+t+"SetRelation").val());objIndex=searchresult.findIndex(n=>n.MilestoneName==i.MilestoneName);objIndex!=-1&&(searchresult[objIndex].SetRelation=$("#"+t+"SetRelation").val());objIndex=allData.findIndex(n=>n.MilestoneName==i.MilestoneName);objIndex!=-1&&(allData[objIndex].SetRelation=$("#"+t+"SetRelation").val());setrelationchanged=durationflag==!1?!1:!0;sort=!0;i=jQuery("#jqgrid").jqGrid("getRowData",n);p=MaterialArray.findIndex(n=>n.SetRelation==i.SequenceNo);p>0?(DisplaySubGridValue="false",UpdatedStartDate_User=s,dependentMilestoneDetails(SelectedProjectId,i.MilestoneId),dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(i.MilestoneId,SelectedProjectId,"Dependentjqgrid"),$("#UserConfirmationforStartDate").modal("show")):(selectedrowsequnce=i.SequenceNo,ParentSubGridId=i.SequenceNo,cancelbutton());userchangedSetrelation=!0}else objIndex=DurationList.findIndex(n=>n.milestoneName==i.MilestoneName),objIndex!=-1&&(DurationList[objIndex].SetRelation=$("#"+t+"SetRelation").val()),objIndex=searchresult.findIndex(n=>n.MilestoneName==i.MilestoneName),objIndex!=-1&&(searchresult[objIndex].SetRelation=$("#"+t+"SetRelation").val()),objIndex=allData.findIndex(n=>n.MilestoneName==i.MilestoneName),objIndex!=-1&&(allData[objIndex].SetRelation=$("#"+t+"SetRelation").val())}}else for(r=0;r<=milestoneid_looping.length-1;r++)$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==milestoneid_looping[r]&&$(t).closest("tr").children("td,th").css("background-color","orange")})}else alert("Change set relation milestone is not checked"),$("#"+i.SequenceNo+"SetRelation").val(beforesetrelation),objindex=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),pmugridData[objindex].SetRelation=beforesetrelation,objindex=MaterialArray.findIndex(n=>n.SequenceNo==i.SequenceNo),MaterialArray[objindex].SetRelation=beforesetrelation;else alert("The set relation entered for the milestone is inactive or invalid, Please enter valid set relation."),$("#"+i.SequenceNo+"SetRelation").val(beforesetrelation),objindex=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),pmugridData[objindex].SetRelation=beforesetrelation,objindex=MaterialArray.findIndex(n=>n.SequenceNo==i.SequenceNo),MaterialArray[objindex].SetRelation=beforesetrelation}function getHighestdatefromMulSetrelation(n){var t=[],n=n.split(","),i;return $.each(n,function(i){var f=pmugridData.findIndex(t=>t.SequenceNo==n[i]),r=pmugridData[f].EndDate,u;r!=""&&r!=null&&(u=new Date(r.split("/").reverse().join("-")),t.push(new Date(u)))}),i=new Date(Math.max.apply(null,t)),moment(i).format("DD/MM/YYYY")}function ChangeDuration(n,t){var u=jQuery("#jqgrid").jqGrid("getRowData",n),o=parseInt(n),i=$("#"+t+"Duration").val(),f,e,r;changedDuration=i;objIndex=MaterialArray.findIndex(n=>n.SequenceNo==u.SequenceNo);objIndex>0&&(MaterialArray[objIndex].Duration=$("#"+t+"Duration").val());i=="0"&&(alert("Please enter valid Duration"),$("#"+t+"Duration").val(beforeDuration));i=$("#"+t+"Duration").val();$.each(DurationList,function(t){t==n-1&&(DurationList[t].Duration=i)});objIndex=searchresult.findIndex(n=>n.SequenceNo==u.SequenceNo);searchresult[objIndex].Duration=$("#"+t+"Duration").val();f=$("#"+t+"start_date").val();f!=""&&(e=moment(f,"DD/MM/YYYY"),r=moment(e).add(i-1,"days").format("DD/MM/YYYY"),$("#"+t+"end_date").val(r),$("#"+t+"end_date").datepicker("setDate",r),objIndex=pmugridData.findIndex(n=>n.SequenceNo==u.SequenceNo),pmugridData[objIndex].EndDate=r,pmugridData[objIndex].Duration=$("#"+t+"Duration").val(),t=t.toString(),t=t.concat("start_date"),durationflag=!1,EndChangeDate(n,t))}function matchedrecords(n){return MaterialArray.filter(t=>Math.max.apply(Math,t.SetRelation.split(","))==n)}function matchedsequnceNo(n){for(var i=[],r=MaterialArray.filter(t=>Math.max.apply(Math,t.SetRelation.split(","))==n),t=0;t<=r.length-1;t++)i.push(r[t].SequenceNo);return i}function sortingrecord(){var n,t,i,r,u;if(looping){if(objindex=MaterialArray.findIndex(n=>n.SetRelation==""),objindex>0)return alert("Please Enter the Setrelation "),!1;for(MaterialArray[0].SetRelation="0",n=[],n.push(pmugridData[0]),t=[1];t.length>0;)i=t.shift(),Array.prototype.push.apply(n,matchedrecords(i)),Array.prototype.push.apply(t,matchedsequnceNo(i));r=n;u=pmugridData.filter(n=>n.Action==null||n.Action=="");Array.prototype.push.apply(r,u);pmugridData=[];subgrid_table_id=[];pmugridData=r;TemplateSubGridDisplay=!0;LoadSubGridData=!1;projectIdchanged=!1;sort=!0;$.jgrid.gridUnload("#jqgrid");CreateJqGrid(pmugridData);$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(7)").text()=="Completed"&&$(this).attr("class","custom-class")})}else alert("There is a circle dependency observed for the below marked milestones")}function process(n){var t=n.split("/");return console.log(new Date(t[2],t[1]-1,t[0])),new Date(t[2],t[1]-1,t[0])}function ChangeDate(n,t){var r,l,s,a,u,v,d,h,y,p,w,o,e,b,k,c,i,f;if(looping)if(r="",sort){for(l=t.match(/\d+/),l[0]!=null&&(r=l[0]),i=jQuery("#jqgrid").jqGrid("getRowData",n),changedmilestoneId=r,s=0;s<TotalSubGridData.length;s++)if(a=TotalSubGridData[s].find(n=>n.SequenceNo>=changedmilestoneId),a!=undefined){chnagedSubgridDateId=a.SubMilestoneId;break}if(selectedrowsequnce=r,selectedrow=selectedrowsequnce,ExtraDaysAdd?(ParentSubGridId=n+1,ExtraDaysAdd=!1):ParentSubGridId=i.SequenceNo,u=$("#"+r+"SetRelation").val(),r!="1"?(u=u.split(","),u=Math.max.apply(Math,u)):DatesPapulationflage="",v=pmugridData.findIndex(n=>n.setrelation==u),v==-1&&(DatesPapulationflage=""),d=0,$("#jqg_jqgrid_"+n).prop("checked")==!1)alert("Please select the checkbox"),$("#"+r+"start_date").val(""),objIndex=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),pmugridData[objIndex].StartDate="";else if(n=="1")h=pmugridData.filter(n=>n.Action=="true"),h.length>1?h[0].StartDate!=""&&h[0].StartDate!=undefined?(i=jQuery("#jqgrid").jqGrid("getRowData",n),f=MaterialArray.findIndex(n=>n.SetRelation==i.SequenceNo),f>0&&(DisplaySubGridValue="false",UpdatedStartDate_User=$("#"+r+"start_date").val(),dependentMilestoneDetails(SelectedProjectId,i.MilestoneId),dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(i.MilestoneId,SelectedProjectId,"Dependentjqgrid"),$("#UserConfirmationforStartDate").modal("show"))):(setrelationchanged=!1,startDatepapulation()):(y=pmugridData.findIndex(n=>n.SequenceNo==changedmilestoneId),pmugridData[y].StartDate=$("#"+changedmilestoneId+"start_date").val(),SubGridDatedisplaycount=0,startDatepapulation());else if(n>1?(p=moment($("#"+u+"start_date").val(),"DD-MM-YYYY"),w=moment($("#"+changedmilestoneId+"start_date").val(),"DD-MM-YYYY"),p>=w?(alert("For the selected milestone start date should be between start date and end date of dependent milestone."),$("#"+changedmilestoneId+"start_date").val(prevStartDate),$("#"+changedmilestoneId+"end_date").val(prevEndDate),datepapulation=!1):datepapulation=!0):datepapulation=!0,datepapulation)if(o=$("#"+r+"start_date").val(),e=$("#"+u+"start_date").val(),e!=undefined)if(o!=undefined&&e!=undefined){if(b=o.split("/").reverse().join("-"),k=e.split("/").reverse().join("-"),o=new Date(b.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),e=new Date(k.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),userchangedSetrelation&&(e>=o?(alert("The selected milestone date should be greater than the Start Date of dependent milestone."),$("#"+r+"start_date").val(prevStartDate),startDatealertdisplay=!1):startDatealertdisplay=!0),startDatealertdisplay)if(i=jQuery("#jqgrid").jqGrid("getRowData",n),f=MaterialArray.findIndex(n=>n.SetRelation.split(",").includes(i.SequenceNo)),f>0)DisplaySubGridValue="false",UpdatedStartDate_User=$("#"+r+"start_date").val(),dependentMilestoneDetails(SelectedProjectId,i.MilestoneId),dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(i.MilestoneId,SelectedProjectId,"Dependentjqgrid"),$("#UserConfirmationforStartDate").modal("show");else for(selectedrowsequnce=i.SequenceNo,ParentSubGridId=i.SequenceNo,EnddatechangedRowId=1,SubGridDatedisplaycount=0,startDatepapulation(),c=0;c<pmugridData.length;c++)$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==pmugridData[c].SequenceNo&&($(t).find("td:nth-child(12)").css("background-color","white"),$(t).find("td:nth-child(13)").css("background-color","white"))})}else $("#1end_date").val()==""&&startDatepapulation();else i=jQuery("#jqgrid").jqGrid("getRowData",n),f=MaterialArray.findIndex(n=>n.SetRelation==i.SequenceNo),f>0?$("#UserConfirmationforStartDate").modal("show"):(selectedrowsequnce=i.SequenceNo,ParentSubGridId=i.SequenceNo,cancelbutton())}else sort=!1,alert("Please click on refresh button for sorting the records based on dependancy");else alert("There is a circle dependency observed for the below marked milestones");alldata=pmugridData}function startDatepapulation(){var tt="",it,c,a,rt,ut,s,w,t,r,b,ft,h,k,d,v,y,lt,g,n,e,nt,p,o;if(rowid=selectedrow,$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==selectedrow&&(rowid=$(this).closest("tr").attr("id"))}),n=jQuery("#jqgrid").jqGrid("getRowData",rowid),$("#jqg_jqgrid_"+rowid).prop("checked")==!0){if(newStr!=""&&n.SubmilestoneExit=="True"){for(it=jQuery("#"+newStr).jqGrid("getRowData",EnddatechangedRowId),c=0;c<=TotalSubGridData.length-1;c++)if(a=TotalSubGridData[c].findIndex(t=>t.SequenceNo==n.SequenceNo),a!=-1)break;tt=TotalSubGridData[c].findIndex(n=>n.SetRelation.split(",").includes(it.SubMilestoneId.toString()))}if(rt=MaterialArray.findIndex(t=>t.SetRelation==n.SequenceNo),rt>0||tt>0){ut=0;for(let o of pmugridData)for(r=1;r<=pmugridData.length;r++)if($("#jqg_jqgrid_"+r).prop("checked")==!0){if(n=jQuery("#jqgrid").jqGrid("getRowData",rowid),s=$("#"+n.SequenceNo+"start_date").val(),o.MilestoneName==n.MilestoneName){if(ut++,$("#jqg_jqgrid_"+rowid).prop("checked")==!0){w=moment(s,"DD/MM/YYYY");t="";t=setrelationchanged?moment(w).add(o.Duration,"days").format("DD/MM/YYYY"):moment(w).add(o.Duration-1,"days").format("DD/MM/YYYY");var u="",f="",l="";if($.each(subgrid_table_id,function(n){var t=subgrid_table_id[n].split("_");t[1]==rowid&&(l=subgrid_table_id[n])}),n.SubmilestoneExit=="True"){for(r=0;TotalSubGridData.length>0;r++)if(b=TotalSubGridData[r].filter(t=>t.SequenceNo==n.SequenceNo),b.length>0)break;ft=b.filter(n=>n.Action=="true");ft.length>0&&(h="",comingSubGrid?(k=$("#"+l).jqGrid("getRowData",EnddatechangedRowId),d=$("#"+k.SubMilestoneId+"SetRelation").val(),d!="0"?(v=$("#"+d+"end_date").val(),h=moment(v,"DD/MM/YYYY"),h=moment(h).add(1,"days").format("DD/MM/YYYY")):(v=$("#"+k.SubMilestoneId+"start_date").val(),h=v),f=SubGridDatesDisplay(EnddatechangedRowId,l,n.SequenceNo,h),SubGridDatedisplaycount++,comingSubGrid=!1):(f=SubGridDatesDisplay(0,l,n.SequenceNo,s),SubGridDatedisplaycount++,DurationchangedSubGrid=!1),t=f.newDate,u=f.Duration,$("#"+n.SequenceNo+"Duration").val(u),objIndex=MaterialArray.findIndex(t=>t.SequenceNo==n.SequenceNo),MaterialArray[objIndex].Duration=u,objIndex=pmugridData.findIndex(t=>t.SequenceNo==n.SequenceNo),pmugridData[objIndex].Duration=u)}t!="Invalid date"&&($("#"+n.SequenceNo+"end_date").val(t),$("#"+n.SequenceNo+"end_date").datepicker("setDate",t),objIndex=pmugridData.findIndex(t=>t.SequenceNo==n.SequenceNo),pmugridData[objIndex].EndDate=t,pmugridData[objIndex].StartDate=s,objIndex=MaterialArray.findIndex(t=>t.SequenceNo==n.SequenceNo),MaterialArray[objIndex].EndDate=t,MaterialArray[objIndex].StartDate=s)}if(y=parseInt(rowid)+1,lt=parseInt(changedmilestoneId)+1,$("#jqg_jqgrid_"+y).prop("checked")==!0){if(g="",n=jQuery("#jqgrid").jqGrid("getRowData",y),n.MilestoneStatus!="Completed"){e=$("#"+n.SequenceNo+"SetRelation").val();e!=undefined&&(e=e.split(","));nt=[];$.each(e,function(n){var r=pmugridData.findIndex(t=>t.SequenceNo==e[n]),t=pmugridData[r].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),nt.push(new Date(i)))});p=new Date(Math.max.apply(null,nt));p=moment(p).format("DD/MM/YYYY");FindRowIDsequnce=Math.max.apply(Math,e);g=p;var et=$("#"+FindRowIDsequnce+"ExtraDays").val(),ot=new Date(g.split("/").reverse().join("-")),i="";i=et?moment(ot).add(parseInt(et)+1,"days").format("DD/MM/YYYY"):moment(ot).add(1,"days").format("DD/MM/YYYY");i!="Invalid date"&&($("#"+n.SequenceNo+"start_date").val(i),$("#"+n.SequenceNo+"start_date").datepicker("setDate",i),objIndex=pmugridData.findIndex(t=>t.SequenceNo==n.SequenceNo),pmugridData[objIndex].StartDate=i,objIndex=MaterialArray.findIndex(t=>t.SequenceNo==n.SequenceNo),MaterialArray[objIndex].StartDate=i)}}else{rowid++;break}s=$("#"+y+"start_date").val();rowid++}}else break}else if(n.SubmilestoneExit=="True")if(console.log("gridid",l),f=SubGridDatesDisplay(rowid,subgrid_table_id[SubGridDatedisplaycount],"start_date",$("#"+n.SequenceNo+"start_date").val()),SubGridDatedisplaycount++,t=f.newDate,o=pmuFirstData.findIndex(t=>t.SequenceNo==n.SequenceNo),t=="Invalid date"){var st=$("#"+n.SequenceNo+"start_date").val(),ht=new Date(st.split("/").reverse().join("-")),i=moment(ht).add(parseInt(pmuFirstData[o].Duration)-1,"days").format("DD/MM/YYYY");$("#"+n.SequenceNo+"end_date").val(i);pmugridData[o].StartDate=st;pmugridData[o].EndDate=i}else u=f.Duration,$("#"+n.SequenceNo+"Duration").val(u),$("#"+n.SequenceNo+"end_date").val(t),pmugridData[o].Duration=u,pmugridData[o].EndDate=t,n.SequenceNo=="1"&&(pmugridData[o].StartDate=$("#"+n.SequenceNo+"start_date").val());else{var a=pmugridData.findIndex(t=>t.SequenceNo==n.SequenceNo),ct=$("#"+n.SequenceNo+"start_date").val(),ht=new Date(ct.split("/").reverse().join("-")),at=$("#"+n.SequenceNo+"Duration").val(),i=moment(ht).add(parseInt(at)-1,"days").format("DD/MM/YYYY");$("#"+n.SequenceNo+"end_date").val(i);pmugridData[a].StartDate=ct;pmugridData[a].EndDate=i}}HighlightUpdatedDaterows()}function SubGridDatesDisplay(n,t,i,r){function it(n,t){return n.SubMilestoneId===t.SubMilestoneId}var ot=$("#"+t).getDataIDs(),st=parseInt(n)-1,u=[],h="",tt,k,d,e,y,r,v,a,c,f,o,g,p,w,l,nt,b,s;for(u=$("#"+t).jqGrid("getGridParam","data"),tt=jQuery("#"+t).jqGrid("getRowData",n),k=r,h=r,c=0,n==0?c=0:(d=jQuery("#"+t).jqGrid("getRowData",n),c=u.findIndex(n=>n.SubMilestoneId==d.SubMilestoneId)),e=c;e<u.length;e++)u[e].Action=="true"&&(h!=""?u[e].StartDate=h:(y=u[e].SetRelation.split(","),l=[],$.each(y,function(n){var i=u.findIndex(t=>t.SubMilestoneId==y[n]),t,r;t=i!=-1?u[i].EndDate:u[0].EndDate;t!=""&&t!=null&&(r=new Date(t.split("/").reverse().join("-")),l.push(new Date(r)))}),s=new Date(Math.max.apply(null,l)),s=moment(s).format("DD/MM/YYYY"),h=s,a=new Date(h.split("/").reverse().join("-")),r=moment(a).add(1,"days").format("DD/MM/YYYY"),u[e].StartDate=r,h=u[e].StartDate),v="",a=new Date(h.split("/").reverse().join("-")),u[e].Duration==0?(v=moment(a).add(u[e].Duration,"days").format("DD/MM/YYYY"),EndDatechange_Sub=!1):v=moment(a).add(u[e].Duration-1,"days").format("DD/MM/YYYY"),u[e].EndDate=v,h="");for(o=0;o<TotalSubGridData.length;o++)if(f=TotalSubGridData[o],c=f.findIndex(n=>n.SequenceNo==u[0].SequenceNo),c!=-1){TotalSubGridData[o]=u;break}for(f=[],f.push(u[0]),o=0;o<u.length;o++)f.length>o&&(g=$.grep(u,function(n){return n.SetRelation==f[o].SubMilestoneId})),f=$.merge(f,g);p=$.grep(u,function(n){return $.inArray(!0,$.map(f,function(t){return it(t,n)}))===-1});p.length>0&&(f=$.merge(f,p));$.jgrid.gridUnload("#"+t);CreateSubGrid(f,t);SubGridsortingrecord(t);w=0;l=[];f=f.filter(n=>n.Action=="true");nt=f[f.length-1].SetRelation;b=f.filter(n=>n.SetRelation==nt);$.each(b,function(n){var t=b[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),l.push(new Date(i)))});s=new Date(Math.max.apply(null,l));s=moment(s).format("DD/MM/YYYY");var rt=new Date(u[0].StartDate.split("/").reverse().join("-")),ut=new Date(s.split("/").reverse().join("-")),ft=ut.getTime()-rt.getTime(),et=Math.ceil(ft/864e5);return w=et+1,{newDate:s,Duration:w,StartDate:k}}function CreateSubGrid(n,t){$("#"+t).jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:colmodels,loadonce:!0,viewrecords:!0,sortable:!1,rowNum:1e3,onCellSelect:function(n){fileuploadedrow=n;var t=$(this),i=$("#jqg_jqgrid_"+n).prop("checked");prevSubGridData(n,i,t)},gridComplete:function(){var t=$(this),n;for($("#"+t[0].id+" tr").each(function(n,t){$(t).find("td:nth-child(6)").text()=="Completed"&&$(this).attr("class","custom-class")}),n=0;n<=milestoneid_looping.length-1;n++)$("#"+t[0].id+" tbody tr").each(function(t,i){$(i).find("td:nth-child(4)").text()==milestoneid_looping[n]&&$(i).closest("tr").children("td,th").css("background-color","orange")});$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){var n=$(this).closest("table").attr("id");SubChangeDate($(this).attr("data-id"),$(this).attr("id"),n)}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){var n=$(this).closest("table").attr("id");SubEndChangeDate($(this).attr("data-id"),$(this).attr("id"),n)}});LoadUser("SubmapperUser")}})}function prevSubGridData(n,t,i){var r=jQuery("#"+i[0].id).jqGrid("getRowData",n),u=$("#"+r.SubMilestoneId+"start_date").val(),f=$("#"+r.SubMilestoneId+"end_date").val(),e=$("#"+r.SubMilestoneId+"SetRelation").val(),o=$("#"+r.SubMilestoneId+"SubGridDuration").val()}function SubGridselection(n,t,i){var e,c,f,l,r,g,b,ci,nt,et,ot,d,tt,o,ht,pt,u,wt,bt,kt,dt,ut,y,gt,ft,v,p,h,a,ct,w,lt,at,vt,fi,s,ei;selectedrowid=n;e=i.id;u="";newStr=e;$("#EndNoButton").show();c=$("#"+e).getRowData(n);f=c.SequenceNo;selectedrowsequnce=f;selectedSubMilestone_id.SequenceNo=f;EnddatechangedRowId=n;ParentSubGridId=c.SequenceNo;selectedmilestoneId=c.SubMilestoneId;beforeDuration=$("#"+f+"Duration").val();prevEndDate=$("#"+f+"end_date").val();var p=$("#"+selectedmilestoneId+"SetRelation").val(),oi=$("#"+selectedmilestoneId+"RelationType").val(),si=pmugridData.findIndex(n=>n.SequenceNo==f),hi=pmugridData[si].Action;for(l=0;l<TotalSubGridData.length;l++)if(r=TotalSubGridData[l].filter(n=>n.SequenceNo==f),r.length>0)break;if(hi=="true")if(g=$("#checkbox_"+selectedmilestoneId).prop("checked"),u=r.findIndex(n=>n.SubMilestoneId==c.SubMilestoneId),g==!0){if(SubGridSelected=g,unselectSubMilestone=!1,r[u].Action="true",TotalSubGridData[l]=r,p==="")return $("#checkbox_"+selectedmilestoneId).prop("checked",!1),alert("Please Enter Setrelation"),!1;if(selectedrowid=="1")return b=$("#"+f+"start_date").val(),ci=$("#"+f+"end_date").val(),b!=""&&(nt=$("#"+selectedmilestoneId+"SubGridDuration").val(),$("#"+c.SubMilestoneId+"start_date").val(b),et=new Date(b.split("/").reverse().join("-")),o="",o=moment(et).add(parseInt(nt)-1,"days").format("DD/MM/YYYY"),$("#"+c.SubMilestoneId+"end_date").val(o),$("#"+f+"end_date").val(o),$("#"+f+"Duration").val(nt),r[u].StartDate=b,r[u].EndDate=o,ot=pmugridData.findIndex(n=>n.SequenceNo==f),pmugridData[ot].EndDate=o,pmugridData[ot].Duration=nt),r[u].Action="true",TotalSubGridData[l]=r,SubGridsortingrecord(e),SubChangeDate(n,f,e),!1;var k=p.split(","),s=$("#"+e).jqGrid("getGridParam","data"),yt=k.every(function(n){var t=s.find(function(t){return t.SubMilestoneId==n});return t&&t.Action=="true"});if(k=Math.max.apply(Math,k),console.log("areAllIdsTrue",yt),p!=undefined)for(d=0;d<=s.length-1;d++)if(s[d].SubMilestoneId==k&&g==!0)if(yt){tt=p.split(",");v=[];$.each(tt,function(n){var r=s.findIndex(t=>t.SubMilestoneId==tt[n]),t=s[r].EndDate,i;t!=""&&t!=null&&t!=undefined&&(i=new Date(t.split("/").reverse().join("-")),v.push(new Date(i)))});y=new Date(Math.max.apply(null,v));y=moment(y).format("DD/MM/YYYY");u=r.findIndex(n=>n.SubMilestoneId==k);var it=y,li=r[u].StartDate,ai=$("#"+selectedmilestoneId+"start_date").val(),vi=$("#"+selectedmilestoneId+"end_date").val();if(ai==""&&vi==""){if(it!=undefined&&it!=""&&it!="Invalid date"){if(oi=="SS ( Parallel )")$("#"+selectedmilestoneId+"start_date").val(li);else{var o="",et=new Date(it.split("/").reverse().join("-")),rt=moment(et).add(1,"days").format("DD/MM/YYYY");$("#"+selectedmilestoneId+"start_date").val(rt);st=rt}if(o=new Date(rt.split("/").reverse().join("-")),ht=$("#"+selectedmilestoneId+"SubGridDuration").val(),o=moment(o).add(ht-1,"days").format("DD/MM/YYYY"),$("#"+selectedmilestoneId+"end_date").val(o),pt="",$.each(subgrid_table_id,function(t){var i=subgrid_table_id[t].split("_");i[1]==n&&(pt=subgrid_table_id[t])}),u=r.findIndex(n=>n.SubMilestoneId==selectedmilestoneId),r[u].StartDate=rt,r[u].EndDate=o,r[u].Duration=ht,$.jgrid.gridUnload("#"+e),CreateSubGrid(r,e),newSubGridrow=!0,wt=pmugridData.filter(n=>n.SetRelation==f&&n.Action=="true"),bt=s.filter(n=>n.SetRelation==selectedmilestoneId&&n.Action=="true"),wt.length>0||bt.length>0)kt=pmugridData.findIndex(n=>n.SequenceNo==f&&n.Action=="true"),DisplaySubGridValue="True",updatedStartDateDisplay=!0,dependentMilestoneDetails(SelectedProjectId,pmugridData[kt].MilestoneId),dt=DependentSub_Milestones.findIndex(n=>n.SubMilestoneId==c.SubMilestoneId),ut=$("#"+c.SubMilestoneId+"SetRelation").val(),ut=ut.split(","),$.each(ut,function(n){var r=s.findIndex(t=>t.SubMilestoneId==tt[n]),t=s[r].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),v.push(new Date(i)))}),y=new Date(Math.max.apply(null,v)),y=moment(y).format("DD/MM/YYYY"),gt=y,ft=new Date(gt.split("/").reverse().join("-")),ft=moment(ft).add(1,"days").format("DD/MM/YYYY"),UpdatedStartDate_User=ft,h=new Date(UpdatedStartDate_User.split("/").reverse().join("-")),UpdatedEndDate_User=moment(h).add(DependentSub_Milestones[dt].Duration-1,"days").format("DD/MM/YYYY"),dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(c.SubMilestoneId,SelectedProjectId,"Dependentjqgridend"),$("#UserConfirmationforenddate").modal("show");else{v=[];p=$("#"+selectedmilestoneId+"SetRelation").val();SubGridChanged?(h=$("#"+p+"end_date").val(),h=new Date(h.split("/").reverse().join("-")),h=moment(h).add(1,"days").format("DD/MM/YYYY"),$("#"+selectedmilestoneId+"start_date").val(h),SubGridChanged=!1):h=$("#"+selectedmilestoneId+"start_date").val();var yi=new Date(h.split("/").reverse().join("-")),ni=$("#"+selectedmilestoneId+"SubGridDuration").val(),ti=moment(yi).add(ni-1,"days").format("DD/MM/YYYY");for($("#"+selectedmilestoneId+"end_date").val(ti),a=0;a<=TotalSubGridData.length-1;a++)if(ct=TotalSubGridData[a],w=ct.findIndex(n=>n.SubMilestoneId==selectedmilestoneId),w!=-1){TotalSubGridData[a][w].StartDate=h;TotalSubGridData[a][w].Duration=ni;TotalSubGridData[a][w].EndDate=ti;TotalSubGridData[a][w].SetRelation=p;break}$.jgrid.gridUnload("#"+newStr);CreateSubGrid(ct,newStr);SubGridsortingrecord(newStr);lt=TotalSubGridData[a].filter(n=>n.Action=="true");at=TotalSubGridData[a].filter(n=>n.SetRelation==lt[lt.length-1].SetRelation&&n.Action=="true");$.each(at,function(n){var t=at[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),v.push(new Date(i)))});var ii=new Date(Math.max.apply(null,v)),pi=s[0].StartDate,wi=new Date(pi.split("/").reverse().join("-")),bi=new Date(ii).getTime()-new Date(wi).getTime(),ki=Math.ceil(bi/864e5);totalDuration=ki+1;var ri=moment(ii,"DD/MM/YYYY"),ri=moment(ri,"ddd MMM DD YYYY HH:mm:ss ZZ"),ui=ri.format("DD/MM/YYYY");$("#"+f+"end_date").val(ui);$("#"+f+"Duration").val(totalDuration);vt=pmugridData.findIndex(n=>n.SequenceNo==f);pmugridData[vt].EndDate=ui;pmugridData[vt].Duration=totalDuration}}}else TotalSubGridData[l]=r;break}else{alert("Dependent Sub Milestones are not mapped ");$("#checkbox_"+selectedmilestoneId).prop("checked",!1);r[u].Action="";TotalSubGridData[l]=r;break}}else fi=r.filter(n=>n.Action=="true"),s=fi.filter(n=>n.SetRelation==selectedmilestoneId),s.length>0?(alert("Please check whether the below sub milestone(s) are dependent on the current sub milestone"),$("#checkbox_"+selectedmilestoneId).prop("checked",!0)):(r[u].Action="",TotalSubGridData[l]=r,prevSubGridStartDate=$("#"+selectedmilestoneId+"start_date").val(),prevSubGridEndDate=$("#"+selectedmilestoneId+"end_date").val(),prevSubGridSetrelation=$("#"+selectedmilestoneId+"SetRelation").val(),prevSubGridDuration=$("#"+selectedmilestoneId+"SubGridDuration").val(),prevSubGridmapperUser=$("#"+selectedmilestoneId+"mapperUser").val(),prevSubGridmapperUserid=$("#"+selectedmilestoneId+"mapperUserid").val(),prevSubGridSubRemarks=$("#"+selectedmilestoneId+"SubRemarks").val(),PrevEnddate_SubGRID=prevSubGridEndDate,$("#checkbox_"+selectedmilestoneId).prop("checked",!1),$("#"+selectedmilestoneId+"start_date").val(""),$("#"+selectedmilestoneId+"end_date").val(""),$("#"+selectedmilestoneId+"mapperUser").val(""),$("#"+selectedmilestoneId+"SubRemarks").val(""),$("#"+selectedmilestoneId+"mapperUser").val(""),u=r.findIndex(n=>n.SubMilestoneId==selectedmilestoneId),r[u].Action="",r[u].StartDate="",r[u].EndDate="",r[u].UserId="",r[u].UserName="",r[u].Remarks="",TotalSubGridData[l]=r,SubGridSelected=!1,n>1?(ei=n-1,SubChangeDate(ei,f,e)):SubChangeDate(n,f,e),newSubGridrow=!0,unselectSubMilestone=!0);else alert("Parent Milestone is not mapped"),$("#checkbox_"+selectedmilestoneId).prop("checked",!1),u=r.findIndex(n=>n.SubMilestoneId==selectedmilestoneId),r[u].Action="",TotalSubGridData[d]=r;$.jgrid.gridUnload("#"+e);CreateSubGrid(r,e);SubGridsortingrecord(e);$("#"+e+" tbody tr").each(function(n,t){$(t).find("td:nth-child(4)").text()==selectedmilestoneId&&(EnddatechangedRowId=$(this).closest("tr").attr("id"))})}function cancelbutton(){var k,r,d,g,t,e,p,h,n,f,b,c,i,u,s;if(rowid=ParentSubGridId,$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(5)").text()==ParentSubGridId&&(rowid=$(this).closest("tr").attr("id"))}),n=jQuery("#jqgrid").jqGrid("getRowData",rowid),changedmaingrid_id=n.SequenceNo,n.SubmilestoneExit=="True"&&(k=EnddatechangedRowId,k!=""))if(r=jQuery("#"+newStr).jqGrid("getRowData",k),unionSelectedSubgrid_id=r.SubMilestoneId,i=jQuery("#"+newStr).jqGrid("getGridParam","data"),d=i.findIndex(n=>n.SubMilestoneId==r.SubMilestoneId),i[d].Action!=""){if(g=$("#"+r.SubMilestoneId+"SetRelation").val(),SubGridChanged&&g!="0"){var l=$("#"+g+"end_date").val(),c=new Date(l.split("/").reverse().join("-")),f=moment(c).add(1,"days").format("DD/MM/YYYY");l=f;SubGridChanged=!1}else l=$("#"+r.SubMilestoneId+"start_date").val();var ft=$("#"+r.SubMilestoneId+"SubGridDuration").val(),c=new Date(l.split("/").reverse().join("-")),f=moment(c).add(parseInt(ft)-1,"days").format("DD/MM/YYYY");for($("#"+r.SubMilestoneId+"end_date").val(f),t=0;t<TotalSubGridData.length;t++)if(e=TotalSubGridData[t].findIndex(n=>n.SubMilestoneId==r.SubMilestoneId),e!=-1){TotalSubGridData[t][e].StartDate=l;TotalSubGridData[t][e].Duration=ft;TotalSubGridData[t][e].EndDate=f;break}$.jgrid.gridUnload("#"+newStr);CreateSubGrid(TotalSubGridData[t],newStr);SubGridsortingrecord(newStr);var o=TotalSubGridData[t],nt=TotalSubGridData[t][0].StartDate,a=0,v=[];o=o.filter(n=>n.EndDate!=null&&n.Action=="true");p=o[o.length-1].SetRelation;h=o.filter(n=>n.SetRelation==p&&n.Action=="true");$.each(h,function(n){var t=h[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),v.push(new Date(i)))});u=new Date(Math.max.apply(null,v));u=moment(u).format("DD/MM/YYYY");var tt=new Date(nt.split("/").reverse().join("-")),y=new Date(u.split("/").reverse().join("-")),it=y.getTime()-tt.getTime(),rt=Math.ceil(it/864e5);a=rt+1}else{for($("#"+r.SubMilestoneId+"end_date").val(""),$("#"+r.SubMilestoneId+"start_date").val(""),$("#"+r.SubMilestoneId+"mapperUser").val(""),$("#"+r.SubMilestoneId+"mapperUserid").val(""),$("#"+r.SubMilestoneId+"SubRemarks").val(""),t=0;t<TotalSubGridData.length;t++)if(e=TotalSubGridData[t].findIndex(n=>n.SubMilestoneId==r.SubMilestoneId),e!=-1){TotalSubGridData[t][e].StartDate="";TotalSubGridData[t][e].EndDate="";TotalSubGridData[t][e].Remarks="";TotalSubGridData[t][e].UserId="";TotalSubGridData[t][e].UserName="";break}$.jgrid.gridUnload("#"+newStr);CreateSubGrid(TotalSubGridData[t],newStr);var o=TotalSubGridData[t],nt=TotalSubGridData[t][0].StartDate,a=0,v=[];o=o.filter(n=>n.Action=="true");p=o[o.length-1].SetRelation;h=o.filter(n=>n.SetRelation==p);$.each(h,function(n){var t=h[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),v.push(new Date(i)))});u=new Date(Math.max.apply(null,v));u=moment(u).format("DD/MM/YYYY");var tt=new Date(nt.split("/").reverse().join("-")),y=new Date(u.split("/").reverse().join("-")),it=y.getTime()-tt.getTime(),rt=Math.ceil(it/864e5);a=rt+1}if(n=jQuery("#jqgrid").jqGrid("getRowData",rowid),newStr!=""){i=jQuery("#"+newStr).jqGrid("getGridParam","data");EnddatechangedRowId=="1"&&i[d].Action=="true"&&($("#"+n.SequenceNo+"start_date").val(l),$("#"+n.SequenceNo+"end_date").val(u),$("#"+n.SequenceNo+"Duration").val(a));var s=$("#"+n.SequenceNo+"start_date").val(),et=$("#"+n.SequenceNo+"SetRelation").val(),ut=pmugridData.findIndex(t=>t.SequenceNo==n.SequenceNo),w=pmugridData.findIndex(n=>n.SequenceNo==et);if(w!=-1)if(pmugridData[ut].SubmilestoneExit!="True")pmugridData[w].ExtraDays>0?(s=$("#"+et+"end_date").val(),c=new Date(s.split("/").reverse().join("-")),f=moment(c).add(parseInt(pmugridData[w].ExtraDays)+1,"days").format("DD/MM/YYYY"),$("#"+n.SequenceNo+"start_date").val(f),s=f):s=$("#"+n.SequenceNo+"start_date").val();else{if(i=i.filter(n=>n.Action=="true"),i.length>0)b=i[i.length-1].SubMilestoneId,s=$("#"+b+"end_date").val();else{var ot=pmugridData[w].EndDate,c=new Date(ot.split("/").reverse().join("-")),f=moment(c).add(1,"days").format("DD/MM/YYYY");$("#"+n.SequenceNo+"start_date").val(f);$("#"+n.SequenceNo+"Duration").val(pmugridData[ut].Duration);c=new Date(f.split("/").reverse().join("-"));f=moment(c).add(parseInt(pmugridData[ut].Duration)-1,"days").format("DD/MM/YYYY");s=f}return $("#"+n.SequenceNo+"end_date").val(u),$("#"+n.SequenceNo+"Duration").val(a),!1}else if(n.SequenceNo=="1"&&n.SubmilestoneExit=="True"){i=jQuery("#"+newStr).jqGrid("getGridParam","data");i=i.filter(n=>n.Action=="true");var b=i[i.length-1].SubMilestoneId,g=$("#"+b+"SetRelation").val(),h=i.filter(n=>n.SetRelation==p);$.each(h,function(n){var t=h[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),v.push(new Date(i)))});u=new Date(Math.max.apply(null,v));u=moment(u).format("DD/MM/YYYY");var tt=new Date(nt.split("/").reverse().join("-")),y=new Date(u.split("/").reverse().join("-")),it=y.getTime()-tt.getTime(),rt=Math.ceil(it/864e5);return a=rt+1,y=moment(y).format("DD/MM/YYYY"),s=$("#"+b+"end_date").val(),$("#"+n.SequenceNo+"end_date").val(y),$("#"+n.SequenceNo+"Duration").val(a),!1}}else s=$("#"+n.SequenceNo+"start_date").val();var ct=pmudetails.findIndex(t=>t.SequenceNo==n.SequenceNo),st=$("#"+n.SequenceNo+"Duration").val(),ht=new Date(s.split("/").reverse().join("-")),f=moment(ht).add(st-1,"days").format("DD/MM/YYYY");$("#"+n.SequenceNo+"end_date").val(f);objIndex=pmugridData.findIndex(t=>t.SequenceNo==n.SequenceNo);pmugridData[objIndex].StartDate=s;pmugridData[objIndex].EndDate=f;newStr!=""&&SubGridsortingrecord(newStr)}function get_relations(n,t){if(t.includes(n))return alert("There is circle dependency found between the milestones "+n+" and its relations are: "+t),milestoneid_looping=t,looping=!1,!0;if(looping=!0,objIndex=MaterialArray.findIndex(t=>t.SequenceNo==n),objIndex>0)var i=MaterialArray[objIndex].SetRelation.split(","),r=Math.max.apply(Math,i),u=r;else return!0;return t.push(parseInt(n)),get_relations(u,t),!1}function DisplaySubGridData(){for(var i=$("#TemplateList").val(),t=pmugridData.filter(function(n){return n.SubmilestoneExit=="True"}),n=0;n<t.length;n++)$("#loader").show(),$("#loader").css("visibility","visible"),$.ajax({url:ROOT+"Master/SelectedTemplatesubMilestoneDetails",type:"post","async":!1,data:{TemplateId:i,SequenceNo:t[n].SequenceNo},dataType:"JSON",success:function(i){var u=[],r,f,e;for($.each(i,function(n,t){u.push({SubMilestoneId:t.MilestoneId,SubMilestoneName:t.MilestoneName,Duration:t.Duration,StartDate:"",EndDate:"",MilestoneStatus:"",IsApproved:"",RelationType:t.RelationType,Remarks:"",SequenceNo:t.SequenceNo,SetRelation:t.SetRelation})}),r=0;r<subgrid_table_id.length;r++)if(f=subgrid_table_id[r].split("_"),e=f[2].slice("1"),t[n].SequenceNo==e){$.jgrid.gridUnload("#"+subgrid_table_id[r]);CreateSubGrid(u,subgrid_table_id[r]);break}}})}function FileUpload(n){var t,o,f,i,v,u,c,r,l;fileuploadedrow=n;t=jQuery("#jqgrid").jqGrid("getRowData",n);o=[];supportingdocfilenames3=[];var a=["pdf","doc","docx","xls","txt","xlsx","ppt","zip","jpg","jpeg","png","csv"],s=0,h=[];if(h=$(`input[name=${n}file]`).get(0).files,f=!0,$.each(h,function(n,i){var u=i.name.split(".").pop().toLowerCase();if(jQuery.inArray(u,a)===-1)return alert("Please upload a valid file"),$(`input[name=${r}file]`).val(""),$("#"+t.SequenceNo+"FileUpload").val(""),f=!1,!1}),f){for(FileNamesList=[],i=0;i<$(`input[name=${n}file]`).get(0).files.length;i++){if(o.push($(`input[name=${n}file]`).get(0).files[i].size),v=["Bytes","KB","MB","GB","TB"],s+=$(`input[name=${n}file]`).get(0).files[i].size/1024,s<5120)supportingdocfilenames3.push($(`input[name=${n}file]`).get(0).files[i].name.toString());else return alert("The file size should be less than 5 MB"),$(`input[name=${n}file]`).get(0).val(""),$("#"+t.SequenceNo+"FileUpload").val(""),!1;u=[];c=$(`input[name=${n}file]`).get(0).files[i];u.push(c);MilestoneFilesList.push(t.MilestoneId);var y=$(`input[name=${n}file]`).get(0).files[i].name.toString().split("\\").pop(),p=t.MilestoneId,e=p+""+y;const f=new File(u,e,{type:u.type});formData.delete(t.MilestoneId);formData.append("files",f);r=uploadedFiles.length;r==0&&(r=1);FileNamesList.push(e);FileName.push({FileName:e,MilestoneId:t.MilestoneId});r++}l=pmugridData.findIndex(n=>n.SequenceNo==t.SequenceNo);pmugridData[l].FileName=FileNamesList.join(",")}}function deleteUploadedFile(n){$("#ToDeleteTheSelectedGridRow").modal("show");deletedrow=n}function DownloadUploadedImage(n){var i=jQuery("#FileUploadjqgrid").jqGrid("getRowData",n),r=uploadedFiles.findIndex(n=>n.FileName==i.FileName),t;if(uploadedFiles.FileName!="")return t=uploadedFiles[r].FileName.replaceAll('"',""),$("#"+n+"DownloadImageOrFile").attr("href",ROOT+"Master/DownloadPackageImageFile?fileName="+t.trim()),!0}function ViewUploadedImages(n,t){var i=$("#ProjectId").children(":selected").attr("value");fileuploadedrow=t;$.ajax({url:ROOT+"Master/DisplayUploadedFiles",type:"POST",dataType:"JSON",data:{ProjectId:i,MilestoneId:n},success:function(n){var t,r,i;if(uploadedFiles=[],n.length>0)for(t=0;t<=n.length-1;t++)uploadedFiles.push(n[t]);r=[];i=$.grep(uploadedFiles,function(n){return!$.grep(deletefiledata,function(t){return n.FileName==t.FileName}).length});$("#FileUploadjqgrid").jqGrid("clearGridData",!0);jQuery("#FileUploadjqgrid").jqGrid("setGridParam",{data:i});jQuery("#FileUploadjqgrid").trigger("reloadGrid");CreateJQGridFile(uploadedFiles);$("#dependentMilestones").modal("show")}})}function CreateJQGridFile(n){jQuery("#FileUploadjqgrid").jqGrid({datatype:"local",data:n,colModel:filemodels,width:1,rowNum:1e4,viewrecords:!0,scroll:!0,pager:"#FileUploadpager",gridComplete:function(){var t=$("#FileUploadjqgrid tbody tr"),r=$("#FileUploadjqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#FileUploadjqgrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!0,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});var t=$(".ui-jqgrid-bdiv").find("tbody").height();t>278?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","0px")}function ChangeSetRelationSubGrid(n,t){var u,i,f,s,v,y,a,e,p,w,b,c,l,o,k,r;for(UpdatedSetrelation_display=!0,milestoneid_looping="",u=t.id,i=jQuery("#"+u).jqGrid("getRowData",n),newSubGridrow=!0,SubGridChanged=!0,unselectSubMilestone=!0,chnagedSubgridDateId=i.SubMilestoneId,SubGridSelected=!1,SubgridStartDatechanged=!1,Setrelationchanged_sub=!1,r=0;r<TotalSubGridData.length;r++)o=TotalSubGridData[r].findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),o!=-1&&(prevSubGridSetrelation=TotalSubGridData[r][o].SetRelation);prevSubGridStartDate=$("#"+i.SubMilestoneId+"start_date").val();prevSubGridEndDate=$("#"+i.SubMilestoneId+"end_date").val();f=$("#"+u).jqGrid("getGridParam","data");s=$("#"+i.SubMilestoneId+"SetRelation").val();EnddatechangedRowId=n;newStr=u;var h=s.split(","),d=h.every(n=>f.some(t=>t.SubMilestoneId===n)),o=f.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId);if(d||s==""||s=="0"){if(v=h.every(function(n){var t=f.find(function(t){return t.SubMilestoneId==n});return t&&t.Action=="true"}),s!=""){if(!v)return alert("Dependent Sub Milestones are not mapped "),$("#"+i.SubMilestoneId+"SetRelation").val(f[o].SetRelation),!1}else if(y=f.filter(n=>n.SetRelation==s),y.length>1)return alert("Please enter the valid set relation"),$("#"+i.SubMilestoneId+"SetRelation").val(prevSubGridSetrelation),!1}else return alert("Please enter the valid set relation"),o=f.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),$("#"+i.SubMilestoneId+"SetRelation").val(prevSubGridSetrelation),!1;if(h.length>0)for(r=0;r<h.length;r++)o=f.findIndex(n=>n.SubMilestoneId==h[r]);if(s==i.SubMilestoneId)return alert("Please enter the valid set relation"),o=f.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),$("#"+i.SubMilestoneId+"SetRelation").val(prevSubGridSetrelation),!1;if(SubGridsortingrecord(u),o=f.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),f[o].SetRelation=h.join(","),a=$("#"+i.SequenceNo+"start_date").val(),beforeDuration=$("#"+i.SequenceNo+"Duration").val(),prevEndDate=$("#"+i.SequenceNo+"end_date").val(),selectedrowsequnce=i.SequenceNo,$("#"+u).jqGrid("clearGridData",!0),$("#"+u).jqGrid("setGridParam",{data:f}),$("#"+u).trigger("reloadGrid"),$("#"+u+" tbody tr").each(function(n,t){$(t).find("td:nth-child(4)").text()==i.SubMilestoneId&&(EnddatechangedRowId=$(this).closest("tr").attr("id"))}),findloopingSubgrid(i.SubMilestoneId,[],u),looping)if(e=$.grep(f,function(n){return n.SetRelation==""||n.SetRelation=="0"}),e.length>0){for(p=f.filter(n=>n.Action=="true"),r=0;r<f.length;r++)e.length>r&&(w=$.grep(p,function(n){var t=n.SetRelation.split(",");if($.inArray(e[r].SubMilestoneId,t)!==-1)return n.SetRelation==e[r].SubMilestoneId})),e=$.merge(e,w);for(b=$.grep(f,function(n){return!e.some(function(t){return n.SubMilestoneId===t.SubMilestoneId})}),e=$.merge(e,b),c=$.grep(e,function(n,t){return t===$.inArray(n,e)}),$("#"+c[0].SubMilestoneId+"start_date").val(a),c[0].StartDate=a,$("#"+u).jqGrid("clearGridData",!0),$("#"+u).jqGrid("setGridParam",{data:c}),$("#"+u).trigger("reloadGrid"),l=0;l<TotalSubGridData.length;l++)if(o=TotalSubGridData[l].findIndex(n=>n.SequenceNo==c[0].SequenceNo),o!=-1){TotalSubGridData[l]=c;break}k=$("#checkbox_"+i.SubMilestoneId).prop("checked");f[0].StartDate!=null&&k==!0&&(SubChangeDate(n,i.SequenceNo,u),Setrelationchanged_sub=!0);looping=!0}else alert("At least one SubMilestone SetRelation should be empty");else for(r=0;r<=milestoneid_looping.length-1;r++)$("#"+u+" tbody tr").each(function(n,t){$(t).find("td:nth-child(4)").text()==milestoneid_looping[r]&&$(t).closest("tr").children("td,th").css("background-color","orange")});SubGridsortingrecord(u);$("#"+u+" tbody tr").each(function(n,t){$(t).find("td:nth-child(4)").text()==i.SubMilestoneId&&(EnddatechangedRowId=$(this).closest("tr").attr("id"))})}function findloopingSubgrid(n,t,i){var r;if(t.includes(n))return alert("There is circle dependency found between the milestones "+n+" and its relations are: "+t),milestoneid_looping=t,looping=!1,!0;if(looping=!0,r=$("#"+i).jqGrid("getGridParam","data"),objIndex=r.findIndex(t=>t.SubMilestoneId==n),objIndex!=-1)var u=r[objIndex].SetRelation.split(","),f=Math.max.apply(Math,u),e=f;else return!0;return t.push(n),findloopingSubgrid(e,t,i),!1}function matchedrecordsub(n,t){var i=$("#"+t).jqGrid("getGridParam","data");return i.filter(t=>Math.max.apply(Math,t.SetRelation.split(","))==n)}function SubGridsortingrecord(n){var o=$("#"+n).jqGrid("getGridParam","data"),r=$("#"+n).jqGrid("getGridParam","data"),t=[],i,u,f,s,e,h;if(looping){for(t.push(r[0]),i=[r[0].SubMilestoneId];i.length>0;)u=i.shift(),f=matchedrecordsub(u,n),Array.prototype.push.apply(t,matchedrecordsub(u,n)),$.each(f,function(n){i.push(f[n].SubMilestoneId)});s=$.grep(t,function(n){return $.inArray(n,o)===-1}).concat($.grep(o,function(n){return $.inArray(n,t)===-1}));Array.prototype.push.apply(t,s);e=t.filter(n=>n.Action=="true");h=r.filter(n=>n.Action==""||n.Action==null);Array.prototype.push.apply(e,h);$.jgrid.gridUnload("#"+n);CreateSubGrid(e,n)}else alert("There is a circle dependency observed for the below marked milestones");return t}function SubChangeDate(n,t,i){var wt=i.split("_"),h,v,tt,u,e,p,s,rt,ut,ft,w,b,l,k,d,r,f,a,o,g,nt,c;if(Datachange_SubgRID=!0,Subchange=n=="1"?!1:!0,Setrelationchanged_sub&&(SubgridStartDatechanged=!0,Setrelationchanged_sub=!0),newStr=i,h=jQuery("#"+newStr).jqGrid("getGridParam","data"),selectedSubMilestone_id=jQuery("#"+newStr).jqGrid("getRowData",n),unionSelectedSubgrid_id=selectedSubMilestone_id.SubMilestoneId,changedmilestoneId=selectedSubMilestone_id.SequnceNo,chnagedSubgridDateId=unionSelectedSubgrid_id,$("#checkbox_"+selectedSubMilestone_id.SubMilestoneId).prop("checked")==!1)return alert("Please select the checkbox"),$("#"+selectedSubMilestone_id.SubMilestoneId+"start_date").val(""),!1;if(v=pmugridData.findIndex(n=>n.SequenceNo==selectedSubMilestone_id.SequenceNo),tt=pmugridData[v].Action,tt=="true"){for(u=0;u<TotalSubGridData.length;u++)if(e=TotalSubGridData[u].findIndex(n=>n.SubMilestoneId==selectedSubMilestone_id.SubMilestoneId),e!=-1){unselectSubMilestone?(PrevEnddate_SubGRID=TotalSubGridData[u][e].EndDate,PrevDuration_SubGRID=TotalSubGridData[u][e].Duration,prevSubGridStartDate=TotalSubGridData[u][e].StartDate):(prevSubGridStartDate=TotalSubGridData[u][e].StartDate,PrevEnddate_SubGRID=TotalSubGridData[u][e].EndDate,PrevDuration_SubGRID=TotalSubGridData[u][e].Duration,prevSubGridSetrelation=TotalSubGridData[u][e].SetRelation);break}st=$("#"+selectedSubMilestone_id.SubMilestoneId+"start_date").val();var y=pmugridData.findIndex(n=>n.SequenceNo==selectedSubMilestone_id.SequenceNo),v=pmugridData[y].MilestoneId,it=pmugridData[y].SetRelation,vt=pmugridData.findIndex(n=>n.SequenceNo==it);if(s=it=="0"?pmugridData[y].StartDate:pmugridData[vt].StartDate,s!=null){if(s=s.split("/").join("-"),p=moment(st,"DD-MM-YYYY"),s=moment(s,"DD-MM-YYYY"),p!=""&&s>p)return alert("For the selected milestone start date should be Greater than start date of dependent milestone."),$("#"+selectedSubMilestone_id.SubMilestoneId+"start_date").val(prevSubGridStartDate),!1;if(st!=""){if(EnddatechangedRowId=n,ParentSubGridId=selectedSubMilestone_id.SequenceNo,comingSubGrid=!0,rt=pmugridData.filter(n=>n.SetRelation==selectedSubMilestone_id.SequenceNo&&n.Action=="true"),ut=h.filter(n=>n.SetRelation==selectedSubMilestone_id.SubMilestoneId&&n.Action=="true"),rt.length>0||ut.length>0){if(DisplaySubGridValue="True",updatedStartDateDisplay=!0,dependentMilestoneDetails(SelectedProjectId,v),ft=DependentSub_Milestones.findIndex(n=>n.SubMilestoneId==selectedSubMilestone_id.SubMilestoneId),UpdatedSetrelation_display){if(w=$("#"+selectedSubMilestone_id.SubMilestoneId+"SetRelation").val(),w==""){var b=$("#"+selectedSubMilestone_id.SubMilestoneId+"end_date").val(),et=new Date($("#"+selectedSubMilestone_id.SubMilestoneId+"start_date").val().split("/").reverse().join("-")),c=new Date(b.split("/").reverse().join("-")),ot=c.getTime()-et.getTime(),ht=Math.ceil(ot/864e5);totalDuration=ht+1;$("#"+selectedSubMilestone_id.SubMilestoneId+"SubGridDuration").val(totalDuration);o=h.findIndex(n=>n.SubMilestoneId==selectedSubMilestone_id.SubMilestoneId);h[o].Duration=totalDuration;$.jgrid.gridUnload("#"+newStr);CreateSubGrid(h,newStr)}else b=$("#"+w+"end_date").val();l=new Date(b.split("/").reverse().join("-"));l=moment(l).add(1,"days").format("DD/MM/YYYY");UpdatedStartDate_User=l;UpdatedSetrelation_display=!1}else UpdatedStartDate_User=st;r=new Date(UpdatedStartDate_User.split("/").reverse().join("-"));UpdatedEndDate_User=moment(r).add(DependentSub_Milestones[ft].Duration-1,"days").format("DD/MM/YYYY");dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(selectedSubMilestone_id.SubMilestoneId,SelectedProjectId,"Dependentjqgridend");newSubGridrow=!1;$("#UserConfirmationforenddate").modal("show")}else{k=[];d=$("#"+selectedSubMilestone_id.SubMilestoneId+"SetRelation").val();SubGridChanged?(r=$("#"+d+"end_date").val(),r=new Date(r.split("/").reverse().join("-")),r=moment(r).add(1,"days").format("DD/MM/YYYY"),$("#"+selectedSubMilestone_id.SubMilestoneId+"start_date").val(r),SubGridChanged=!1):r=$("#"+selectedSubMilestone_id.SubMilestoneId+"start_date").val();var yt=new Date(r.split("/").reverse().join("-")),ct=$("#"+selectedSubMilestone_id.SubMilestoneId+"SubGridDuration").val(),lt=moment(yt).add(ct-1,"days").format("DD/MM/YYYY");for($("#"+selectedSubMilestone_id.SubMilestoneId+"end_date").val(lt),f=0;f<=TotalSubGridData.length-1;f++)if(a=TotalSubGridData[f],o=a.findIndex(n=>n.SubMilestoneId==selectedSubMilestone_id.SubMilestoneId),o!=-1){TotalSubGridData[f][o].StartDate=r;TotalSubGridData[f][o].Duration=ct;TotalSubGridData[f][o].EndDate=lt;TotalSubGridData[f][o].SetRelation=d;break}$.jgrid.gridUnload("#"+newStr);CreateSubGrid(a,newStr);g=TotalSubGridData[f].filter(n=>n.Action=="true");nt=TotalSubGridData[f].filter(n=>n.SetRelation==g[g.length-1].SetRelation&&n.Action=="true");$.each(nt,function(n){var t=nt[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),k.push(new Date(i)))});c=new Date(Math.max.apply(null,k));r=a[0].StartDate;var et=new Date(r.split("/").reverse().join("-")),ot=new Date(c).getTime()-new Date(et).getTime(),ht=Math.ceil(ot/864e5);totalDuration=ht+1;var at=moment(c,"DD/MM/YYYY"),at=moment(at,"ddd MMM DD YYYY HH:mm:ss ZZ"),pt=at.format("DD/MM/YYYY");$("#"+selectedSubMilestone_id.SequenceNo+"end_date").val(pt);$("#"+selectedSubMilestone_id.SequenceNo+"Duration").val(totalDuration)}comingSubGrid=!1}}}else alert("Parent Milestone is not mapped"),$("#"+selectedSubMilestone_id.SubMilestoneId+"start_date").val("")}function SubEndChangeDate(n,t,i){var p,o,r,w,b,s,h,d,g,l,a,e,c,u,v,y,f;if(Datachange_SubgRID=!0,SubGridId_end=i,SubGridSelectedrowid=n,Pid=i.split("_"),p="",newStr=i,o=$("#"+newStr).jqGrid("getGridParam","data"),r=jQuery("#"+newStr).jqGrid("getRowData",n),EnddatechangedRowId=n,unionSelectedSubgrid_id=r.SubMilestoneId,chnagedSubgridDateId=unionSelectedSubgrid_id,ParentSubGridId=r.SequenceNo,changedmilestoneId=r.SequenceNo,$("#checkbox_"+r.SubMilestoneId).prop("checked")==!1)return alert("Please select the checkbox"),$("#"+r.SubMilestoneId+"end_date").val(""),!1;w=pmugridData.findIndex(n=>n.SequenceNo==ParentSubGridId);dependentMilestoneDetails(SelectedProjectId,pmugridData[w].MilestoneId);ParentSubGridId&&(SubGridDatedisplaycount=0);b=r.SubMilestoneId;s=$("#"+r.SubMilestoneId+"end_date").val();UpdatedEndDate_User=s;u=o.findIndex(n=>n.SubMilestoneId==b);h=o[u].EndDate;PrevEnddate_SubGRID=h;PrevDuration_SubGRID=o[u].Duration;prevSubGridDuration=PrevDuration_SubGRID;prevSubGridEndDate=PrevEnddate_SubGRID;var ut=o[u].Duration,bt=$("#"+r.SubMilestoneId+"start_date").val(),ft=$("#"+r.SubMilestoneId+"start_date").val().split("/").join("-"),et=s.split("/").join("-"),ot=moment($("#"+r.SubMilestoneId+"start_date").val(),"DD-MM-YYYY"),st=moment(s,"DD-MM-YYYY");if($("#"+unionSelectedSubgrid_id+"SetRelation").val()=="")return alert("Please Enter the Set Relation for SubGrid"),$("#"+unionSelectedSubgrid_id+"end_date").val(h),!1;if(ot>st)return alert("End date should be greater than Start date"),$("#"+r.SubMilestoneId+"end_date").val(h),$("#"+r.SubMilestoneId+"end_date").datepicker("setDate",h),$("#"+r.SubMilestoneId+"SubGridDuration").val(ut),!1;o[u].EndDate=s;var ht=new Date(ft.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),ct=new Date(et.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),lt=ht-ct,at=lt/864e5,k=Math.round(Math.abs(at));if(o[u].Duration=k+1,$("#"+r.SubMilestoneId+"SubGridDuration").val(k+1),comingSubGrid=!0,selectedrow=o[0].SequenceNo,d=pmugridData.filter(n=>n.SetRelation==selectedrow&&n.Action=="true"),g=o.filter(n=>n.SetRelation==r.SubMilestoneId&&n.Action=="true"),d.length>0||g.length>0)DisplaySubGridValue="True",dependentMilestoneDetailsList.length>0&&displayUpdatedatesdetails(r.SubMilestoneId,SelectedProjectId,"Dependentjqgrid"),$("#UserConfirmationforStartDate").modal("show");else{l=[];a=$("#"+r.SubMilestoneId+"SetRelation").val();SubGridChanged?(f=$("#"+a+"end_date").val(),f=new Date(f.split("/").reverse().join("-")),f=moment(f).add(1,"days").format("DD/MM/YYYY"),$("#"+r.SubMilestoneId+"start_date").val(f),SubGridChanged=!1):f=$("#"+r.SubMilestoneId+"start_date").val();var p=new Date(f.split("/").reverse().join("-")),nt=$("#"+r.SubMilestoneId+"SubGridDuration").val(),tt=moment(p).add(nt-1,"days").format("DD/MM/YYYY");for($("#"+r.SubMilestoneId+"end_date").val(tt),e=0;e<=TotalSubGridData.length-1;e++)if(c=TotalSubGridData[e],u=c.findIndex(n=>n.SubMilestoneId==r.SubMilestoneId),u!=-1){TotalSubGridData[e][u].StartDate=f;TotalSubGridData[e][u].Duration=nt;TotalSubGridData[e][u].EndDate=tt;TotalSubGridData[e][u].SetRelation=a;break}$.jgrid.gridUnload("#"+newStr);CreateSubGrid(c,newStr);v=TotalSubGridData[e].filter(n=>n.Action=="true");y=TotalSubGridData[e].filter(n=>n.SetRelation==v[v.length-1].SetRelation&&n.Action=="true");$.each(y,function(n){var t=y[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),l.push(new Date(i)))});c.length>0&&(f=c[0].StartDate);var it=new Date(Math.max.apply(null,l)),vt=new Date(f.split("/").reverse().join("-")),yt=new Date(it).getTime()-new Date(vt).getTime(),pt=Math.ceil(yt/864e5);totalDuration=pt+1;var rt=moment(it,"DD/MM/YYYY"),rt=moment(rt,"ddd MMM DD YYYY HH:mm:ss ZZ"),wt=rt.format("DD/MM/YYYY");$("#"+r.SequenceNo+"end_date").val(wt);$("#"+r.SequenceNo+"Duration").val(totalDuration)}}function enddatepapulation_Sub(){var u=SubGridId_end,i,y,o,c,w,f,s,h,l,e,t;selectedrow=SubGridSelectedrowid;var n=$("#"+u).jqGrid("getGridParam","data"),r=jQuery("#"+u).jqGrid("getRowData",SubGridSelectedrowid),k=r.SubMilestoneId,ut=$("#"+r.SubMilestoneId+"end_date").val(),v=$("#"+r.SubMilestoneId+"start_date").val(),u=SubGridId_end,t=n.findIndex(n=>n.SubMilestoneId==k);for(i=t+1;i<n.length;i++)if(n[i].Action=="true"){n[i].RelationType=="FS ( Sequence)"?(y=n.findIndex(t=>t.SubMilestoneId==n[i].SetRelation),StartDate=n[y].EndDate,o=new Date(StartDate.split("/").reverse().join("-")),c=moment(o).add(1,"days").format("DD/MM/YYYY"),n[i].StartDate=c,StartDate=c):(t=n.findIndex(t=>t.SubMilestoneId==n[i].SetRelation),StartDate=n[t].StartDate,n[i].StartDate=StartDate);var p="",o=new Date(StartDate.split("/").reverse().join("-")),d=$("#"+n[i].SubMilestoneId+"SubGridDuration").val();p=n[i].Duration==0?moment(o).add(n[i].Duration,"days").format("DD/MM/YYYY"):moment(o).add(d-1,"days").format("DD/MM/YYYY");n[i].EndDate=p;StartDate=""}for(w=n[0].SequenceNo,f=0;f<TotalSubGridData.length;f++)t=TotalSubGridData[f].findIndex(n=>n.SequenceNo==w),t!=-1&&(TotalSubGridData[f]=n);$("#"+u).jqGrid("clearGridData",!0);$("#"+u).jqGrid("setGridParam",{data:n});$("#"+u).trigger("reloadGrid");s=0;h=[];n=n.filter(n=>n.Action=="true");l=[];$.each(n,function(t){var i=n[t].StartDate,r=new Date(i.split("/").reverse().join("-"));l.push(new Date(r))});var g=new Date(Math.min.apply(null,l)),a=n.filter(n=>n.EndDate!=null),nt=a[a.length-1].SetRelation,b=a.filter(n=>n.SetRelation==nt);$.each(b,function(n){var t=b[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),h.push(new Date(i)))});e=new Date(Math.max.apply(null,h));e=moment(e).format("DD/MM/YYYY");var tt=new Date(Math.max.apply(null,h)),it=tt.getTime()-g.getTime(),rt=Math.ceil(it/864e5);s=rt+1;$("#"+r.SequenceNo+"end_date").val(e);$("#"+r.SequenceNo+"start_date").val(v);$("#"+r.SequenceNo+"Duration").val(s);ParentId=Pid[1];t=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo);prevStartDate=pmugridData[t].StartDate;prevEndDate=pmugridData[t].EndDate;beforeDuration=pmugridData[t].Duration;beforesetrelation=pmugridData[t].SetRelation;pmugridData[t].StartDate=v;pmugridData[t].EndDate=e;pmugridData[t].Duration=s;comingSubGrid=DurationchangedSubGrid?!1:!0}function displayDuration(n,t){for(var i,r,e,f=$.grep(pmugridData,function(n){return n.SubmilestoneExit==="True"}),u=0;u<f.length;u++)rowSequnce=f[u].SequenceNo,SelectedSubMilestoneData=[],CreateSubGriddata(n,t),i=[],SelectedSubMilestoneData.length>0&&i.push({SubMilestoneId:SelectedSubMilestoneData[0].SubMilestoneId,Duration:SelectedSubMilestoneData[0].Duration}),$.each(SelectedSubMilestoneData,function(n,t){var u=t.SetRelation,r=i.findIndex(n=>n.SubMilestoneId==u),f;u!=""&&(t.RelationType=="FS ( Sequence)"?r!=-1&&(f=parseInt(t.Duration)+parseInt(i[r].Duration),i.push({SubMilestoneId:SelectedSubMilestoneData[n].SubMilestoneId,Duration:f})):t.RelationType=="SS ( Parallel )"&&r!=-1&&(parseInt(t.Duration)>parseInt(i[r].Duration)?i.push({SubMilestoneId:SelectedSubMilestoneData[n].SubMilestoneId,Duration:t.Duration}):i.push({SubMilestoneId:SelectedSubMilestoneData[n].SubMilestoneId,Duration:i[r].Duration})))}),r=-Infinity,$.each(i,function(n,t){t.Duration>r&&(r=t.Duration)}),SelectedSubMilestoneData.length>0&&(e=pmugridData.findIndex(n=>n.SequenceNo==SelectedSubMilestoneData[0].SequenceNo),pmugridData[e].Duration=r)}function SubGridChangeDuration(n,t){var s,i,h,a,v,y,tt,p,it,rt,w,b,f,e,k,d,g,u,st,o,c,nt,l,r;for(SubGridId=t.id,s=$("#"+SubGridId).jqGrid("getGridParam","data"),i=jQuery("#"+SubGridId).jqGrid("getRowData",n),EnddatechangedRowId=n,SubGridSelectedrowid=n+1,ParentSubGridId=i.SequenceNo,Datachange_SubgRID=!0,newStr=SubGridId,chnagedSubgridDateId=i.SubMilestoneId,h=0;h<TotalSubGridData.length;h++)if(a=TotalSubGridData[h].findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),a!=-1){PrevEnddate_SubGRID=TotalSubGridData[h][a].EndDate;PrevDuration_SubGRID=TotalSubGridData[h][a].Duration;break}if(r=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),pmugridData[r].Action!=null&&pmugridData[r].Action!="")if(v=$("#"+i.SubMilestoneId+"SubGridDuration").val(),y=$("#"+i.SubMilestoneId+"start_date").val(),y!="")if(tt=new Date(y.split("/").reverse().join("-")),p=moment(tt).add(v-1,"days").format("DD/MM/YYYY"),$("#"+i.SubMilestoneId+"end_date").val(p),DurationchangedSubGrid=!0,selectedrow=i.SequenceNo,r=s.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),s[r].Duration=v,s[r].EndDate=p,s[r].StratDate=y,SubGridId_end=SubGridId,$.jgrid.gridUnload("#"+SubGridId),CreateSubGrid(s,SubGridId),it=pmugridData.filter(n=>n.SetRelation==i.SequenceNo&&n.Action=="true"),rt=s.filter(n=>n.SetRelation.split(",").includes(i.SubMilestoneId.toString())&&n.Action=="true"),it.length>0||rt.length>0)DisplaySubGridValue="True",r=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),dependentMilestoneDetails(SelectedProjectId,pmugridData[r].MilestoneId),dependentMilestoneDetailsList.length>0&&(UpdatedEndDate_User=p,displayUpdatedatesdetails(i.SubMilestoneId,SelectedProjectId,"Dependentjqgrid")),$("#UserConfirmationforStartDate").modal("show");else{w=[];b=$("#"+i.SubMilestoneId+"SetRelation").val();SubGridChanged?(f=$("#"+b+"end_date").val(),f=new Date(f.split("/").reverse().join("-")),f=moment(f).add(1,"days").format("DD/MM/YYYY"),$("#"+i.SubMilestoneId+"start_date").val(f),SubGridChanged=!1):f=$("#"+i.SubMilestoneId+"start_date").val();var ht=new Date(f.split("/").reverse().join("-")),ut=$("#"+i.SubMilestoneId+"SubGridDuration").val(),ft=moment(ht).add(ut-1,"days").format("DD/MM/YYYY");for($("#"+i.SubMilestoneId+"end_date").val(ft),e=0;e<=TotalSubGridData.length-1;e++)if(k=TotalSubGridData[e],r=k.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),r!=-1){TotalSubGridData[e][r].StartDate=f;TotalSubGridData[e][r].Duration=ut;TotalSubGridData[e][r].EndDate=ft;TotalSubGridData[e][r].SetRelation=b;break}$.jgrid.gridUnload("#"+newStr);CreateSubGrid(k,newStr);d=TotalSubGridData[e].filter(n=>n.Action=="true");g=TotalSubGridData[e].filter(n=>n.SetRelation==d[d.length-1].SetRelation&&n.Action=="true");$.each(g,function(n){var t=g[n].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),w.push(new Date(i)))});var et=new Date(Math.max.apply(null,w)),ct=new Date(f.split("/").reverse().join("-")),lt=new Date(et).getTime()-new Date(ct).getTime(),at=Math.ceil(lt/864e5);totalDuration=at+1;var ot=moment(et,"DD/MM/YYYY"),ot=moment(ot,"ddd MMM DD YYYY HH:mm:ss ZZ"),vt=ot.format("DD/MM/YYYY");$("#"+i.SequenceNo+"end_date").val(vt);$("#"+i.SequenceNo+"Duration").val(totalDuration)}else u=[],u=s,st=u.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),u[st].Duration=v,o=[],o.push({SubMilestoneId:u[0].SubMilestoneId,Duration:u[0].Duration}),$.each(u,function(n,t){var f=t.SetRelation,i=o.findIndex(n=>n.SubMilestoneId==f),r;t.RelationType=="FS ( Sequence)"?(r=parseInt(t.Duration)+parseInt(o[i].Duration),o.push({SubMilestoneId:u[n].SubMilestoneId,Duration:r})):t.RelationType=="SS ( Parallel )"&&(parseInt(t.Duration)>parseInt(o[i].Duration)?o.push({SubMilestoneId:u[n].SubMilestoneId,Duration:t.Duration}):o.push({SubMilestoneId:u[n].SubMilestoneId,Duration:o[i].Duration}))}),c=-Infinity,$.each(o,function(n,t){t.Duration>c&&(c=t.Duration)}),nt=pmugridData.findIndex(n=>n.SequenceNo==u[0].SequenceNo),pmugridData[nt].Duration=c,$("#"+pmugridData[nt].SequenceNo+"Duration").val(c);else for(l=0;l<=TotalSubGridData.length-1;l++)r=TotalSubGridData[l].findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),TotalSubGridData[l][r].Duration=$("#"+i.SubMilestoneId+"SubGridDuration").val()}function ChangeExtraDays(n,t){var i="",r=$("#"+t+"ExtraDays").val(),u;r>0?(i=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[i].ExtraDays=r):(i=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[i].ExtraDays=r);var e=n+1,f=pmugridData[i+1].SequenceNo,o=$("#"+t+"start_date").val(),s=$("#"+t+"end_date").val(),h=$("#"+f+"start_date").val();ExtraDaysAdd=!0;u=pmugridData.findIndex(n=>n.SetRelation==t&&n.Action=="true");u>0&&ChangeDate(n,t+"start_date")}function ChangeRelationType(n,t){var o,u;SubGridId=t.id;var r=$("#"+SubGridId).jqGrid("getGridParam","data"),i=jQuery("#"+SubGridId).jqGrid("getRowData",n),f=$("#"+i.SubMilestoneId+"RelationType").val(),e=r.findIndex(n=>n.SubMilestoneId==i.SubMilestoneId);r[e].RelationType=f;o=$("#"+i.SequenceNo+"start_date").val();beforeDuration=$("#"+i.SequenceNo+"Duration").val();prevEndDate=$("#"+i.SequenceNo+"end_date").val();selectedrowsequnce=i.SequenceNo;$.jgrid.gridUnload("#"+SubGridId);CreateSubGrid(r,SubGridId);u=$("#checkbox_"+i.SubMilestoneId).prop("checked");u==!0&&SubChangeDate("1","",SubGridId)}function AddSubMilestone(n,t){var r,f,h,i,e,o,s,u;if($("#addSubMilestoneModal").modal("show"),$("#SubSetrelation").empty(),r=$("#jqgrid").getRowData(t),$("#MilestoneId").val(r.MilestoneId),ParentSequnceNo=r.SequenceNo,$("#Addelement").html("Add Sub Milestone<b> - "+r.MilestoneName+"<b/>"),f=$("#SubSetrelation"),f.empty(),f.append($("<option>").val("0").text("--Select--")),TotalSubGridData.length==0)$("#SequenceNo").val(SubMilestonestartid),$("#relationtype").prop("disabled",!0),$("#SubSetrelation").prop("disabled",!0),$("#SubSetrelation").addClass("input-disabled"),$("#relationtype").addClass("input-disabled");else{for(h=[],i=-Infinity,e=0;e<TotalSubGridData.length;e++)u=TotalSubGridData[e],$.each(u,function(n,t){var r=t.SubMilestoneId;r>i&&(i=r,h.push(i))});for(i=Math.max.apply(null,h),SubMilestonestartid=parseInt(i)+1,$("#SequenceNo").val(parseInt(i)+1),o=[],s=0;s<TotalSubGridData.length;s++)if(u=TotalSubGridData[s].filter(n=>n.SequenceNo==r.SequenceNo),u.length>0){$.each(u,function(n,t){o.push({value:t.SubMilestoneId,text:t.SubMilestoneName})});break}o.length>0?($.each(o,function(n,t){f.append($("<option>").val(t.value).text(t.text))}),$("#relationtype").prop("disabled",!1),$("#SubSetrelation").prop("disabled",!1),$("#relationtype").removeClass("input-disabled"),$("#SubSetrelation").removeClass("input-disabled")):($("#relationtype").prop("disabled",!0),$("#SubSetrelation").prop("disabled",!0),$("#relationtype").addClass("input-disabled"),$("#SubSetrelation").addClass("input-disabled"))}}function DeleteSubMiestone(n,t){var i,u,e,r,f;for(deleteSubGrid_id=t.id,DeletedSubgrid_row=n,i=0;i<TotalSubGridData.length;i++)if(u=TotalSubGridData[i].findIndex(n=>n.SubMilestoneId==DeletedSubgrid_row),u!=-1){ParentSequnceNo=TotalSubGridData[i][0].SequenceNo;e=TotalSubGridData[i][u].SubMilestoneName;$("#Deletelement").html("Are you sure you want to delete the sub milestone <b>"+e+"<b/> ?");break}for(r=0;r<TotalSubGridData.length;r++)if(f=TotalSubGridData[r].findIndex(n=>n.SetRelation==DeletedSubgrid_row),f!=-1)break;f==-1?($("#ToDeleteTheSelectedSubGridRow").modal("show"),$("#DeleteSubMilestone").text("")):alert("Please check whether the below sub milestone(s) are dependent on the current milestone")}function dependentMilestoneDetails(n,t){var i,r,u;for(dependentMilestoneDetailsList=[],SelecteDprojectId=n,i=pmugridData.filter(n=>n.Action=="true"),dependentMilestoneDetailsList=dependentMilestoneDetailsList.concat(JSON.parse(JSON.stringify(i.filter(n=>n.MilestoneId==t)))),r=0;r<dependentMilestoneDetailsList.length;r++)i[0].SetRelation==""&&(i[0].SetRelation="0"),u=i.filter(n=>n.SetRelation.split(",").includes(dependentMilestoneDetailsList[r].SequenceNo.toString())),$.each(u,function(n,t){var i=!1;$.each(dependentMilestoneDetailsList,function(n,r){if(t.MilestoneId===r.MilestoneId)return i=!0,!1});i||dependentMilestoneDetailsList.push(t)});console.log("dependentdetails",dependentMilestoneDetailsList);SubMilestoneDataList(n)}function SubMilestoneDataList(){var r=dependentMilestoneDetailsList.filter(n=>n.SubmilestoneExit=="True"),i,n,t;if(DependentSub_Milestones=[],r.length>0){for(n=0;n<TotalSubGridData.length;n++)i=TotalSubGridData[n].filter(n=>n.Action=="true"),$.merge(DependentSub_Milestones,$.extend(!0,[],i));for(n=0;n<DependentSub_Milestones.length;n++)t=DependentSub_Milestones[n],t.MilestoneName=t.SubMilestoneName,t.UpdatedStartDate=t.StartDate,t.UpdatedEndDate=t.EndDate;console.log("DependentSub_Milestones",DependentSub_Milestones)}}function displayUpdatedatesdetails(n,t,i){var o,h,l,u,s,a,v,c,r,y,e,f;if(console.log("DependentSub_Milestones",DependentSub_Milestones),console.log("dependentMilestoneDetailsList",dependentMilestoneDetailsList),DependentSub_Milestones=[],SubMilestoneDataList(t),o="",DisplaySubGridValue=="True"&&DependentSub_Milestones.length>0&&(updatedStartDateDisplay?(r=DependentSub_Milestones.findIndex(t=>t.SubMilestoneId==n),DependentSub_Milestones[r].UpdatedStartDate=UpdatedStartDate_User,DependentSub_Milestones[r].UpdatedEndDate=UpdatedEndDate_User,prevSubGridSetrelation!=""&&(DependentSub_Milestones[r].SetRelation=prevSubGridSetrelation),o=SubMilestoneDatesDisplay(r+1,DependentSub_Milestones[r].SequenceNo),updatedStartDateDisplay=!1):(r=DependentSub_Milestones.findIndex(t=>t.SubMilestoneId==n),DependentSub_Milestones[r].UpdatedStartDate=DependentSub_Milestones[r].StartDate,PrevEnddate_SubGRID!=""&&(DependentSub_Milestones[r].EndDate=PrevEnddate_SubGRID,DependentSub_Milestones[r].Duration=PrevDuration_SubGRID),DependentSub_Milestones[r].UpdatedEndDate=UpdatedEndDate_User,o=SubMilestoneDatesDisplay(r+1,DependentSub_Milestones[r].SequenceNo))),dependentMilestoneDetailsList.length>0)for(DisplaySubGridValue==""?(r=dependentMilestoneDetailsList.findIndex(t=>t.MilestoneId==n),dependentMilestoneDetailsList[r].UpdatedStartDate=dependentMilestoneDetailsList[r].StartDate,prevStartDate!=""&&prevEndDate!=""&&beforeDuration!=""&&(dependentMilestoneDetailsList[r].Duration=beforeDuration,dependentMilestoneDetailsList[r].StartDate=prevStartDate,dependentMilestoneDetailsList[r].EndDate=prevEndDate),dependentMilestoneDetailsList[r].UpdatedEndDate=UpdatedEndDate_User,l=dependentMilestoneDetailsList[r].SequenceNo):o===""?(r=dependentMilestoneDetailsList.findIndex(t=>t.MilestoneId==n),dependentMilestoneDetailsList[r].UpdatedStartDate=UpdatedStartDate_User,dependentMilestoneDetailsList[r].StartDate=prevStartDate,h=new Date(UpdatedStartDate_User.split("/").reverse().join("-")),StartDate=moment(h).add(dependentMilestoneDetailsList[r].Duration-1,"days").format("DD/MM/YYYY"),dependentMilestoneDetailsList[r].UpdatedEndDate=StartDate,l=dependentMilestoneDetailsList[r].SequenceNo):r=o,u=r+1;u<dependentMilestoneDetailsList.length;u++)s=dependentMilestoneDetailsList[u].SetRelation,s!=""&&s!=undefined&&s!=null?(a=getHighestdatefromMulSetrelation(s),c=a):(v=dependentMilestoneDetailsList.findIndex(n=>n.SequenceNo==dependentMilestoneDetailsList[r].SequenceNo),c=dependentMilestoneDetailsList[v].UpdatedEndDate),h=new Date(c.split("/").reverse().join("-")),StartDate=moment(h).add(1,"days").format("DD/MM/YYYY"),dependentMilestoneDetailsList[u].UpdatedStartDate=StartDate,dependentMilestoneDetailsList[u].SubmilestoneExit=="True"?(r=DependentSub_Milestones.findIndex(n=>n.SequenceNo==dependentMilestoneDetailsList[u].SequenceNo),r!=-1?(DependentSub_Milestones[r].UpdatedStartDate=StartDate,e=new Date(StartDate.split("/").reverse().join("-")),f=moment(e).add(parseInt(DependentSub_Milestones[r].Duration)-1,"days").format("DD/MM/YYYY"),DependentSub_Milestones[r].UpdatedEndDate=f,y=new Date(f.split("/").reverse().join("-")),StartDate=moment(y).add(1,"days").format("DD/MM/YYYY"),DependentSub_Milestones.length>parseInt(r+1)?(DependentSub_Milestones[r+1].UpdatedStartDate=StartDate,SubMilestoneDatesDisplay(r+1,dependentMilestoneDetailsList[u].SequenceNo)):dependentMilestoneDetailsList[u].UpdatedEndDate=f):(e=new Date(StartDate.split("/").reverse().join("-")),f=moment(e).add(parseInt(dependentMilestoneDetailsList[u].Duration)-1,"days").format("DD/MM/YYYY"),dependentMilestoneDetailsList[u].UpdatedEndDate=f)):(e=new Date(StartDate.split("/").reverse().join("-")),f=moment(e).add(parseInt(dependentMilestoneDetailsList[u].Duration)-1,"days").format("DD/MM/YYYY"),dependentMilestoneDetailsList[u].UpdatedEndDate=f);$("#"+i).jqGrid("clearGridData",!0);jQuery("#"+i).jqGrid("setGridParam",{data:dependentMilestoneDetailsList});jQuery("#"+i).trigger("reloadGrid");CreateSubGridDependent(i)}function SubMilestoneDatesDisplay(n,t){for(var u,f,o,h,s,c,l,r,i=n;i<DependentSub_Milestones.length;i++)DependentSub_Milestones[i].SequenceNo==t&&(u=DependentSub_Milestones[i].SetRelation,u!=""&&u!="0"&&u!=undefined?(f=[],o=u.split(","),$.each(o,function(n){var r=DependentSub_Milestones.findIndex(t=>t.SubMilestoneId==o[n]),t=DependentSub_Milestones[r].EndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),f.push(new Date(i)))}),r=new Date(Math.max.apply(null,f)),r=moment(r).format("DD/MM/YYYY"),s=r):(h=DependentSub_Milestones.findIndex(n=>n.SubMilestoneId==DependentSub_Milestones[i].SubMilestoneId),s=DependentSub_Milestones[h].UpdatedEndDate),EndDate=new Date(s.split("/").reverse().join("-")),StartDate=moment(EndDate).add(1,"days").format("DD/MM/YYYY"),DependentSub_Milestones[i].UpdatedStartDate=StartDate,c=new Date(StartDate.split("/").reverse().join("-")),l=moment(c).add(parseInt(DependentSub_Milestones[i].Duration)-1,"days").format("DD/MM/YYYY"),DependentSub_Milestones[i].UpdatedEndDate=l);var e=DependentSub_Milestones.filter(n=>n.SequenceNo==t),y=e[e.length-1].SetRelation,a=e.filter(n=>n.SetRelation==y),f=[];$.each(a,function(n){var t=a[n].UpdatedEndDate,i;t!=""&&t!=null&&(i=new Date(t.split("/").reverse().join("-")),f.push(new Date(i)))});r=new Date(Math.max.apply(null,f));r=moment(r).format("DD/MM/YYYY");var v=new Date(e[0].UpdatedStartDate.split("/").reverse().join("-")),p=new Date(r.split("/").reverse().join("-")),w=p.getTime()-v.getTime(),b=Math.ceil(w/864e5);return totalDuration=b+1,parent_Index=dependentMilestoneDetailsList.findIndex(n=>n.SequenceNo==t),dependentMilestoneDetailsList[parent_Index].UpdatedStartDate=moment(v).format("DD/MM/YYYY"),dependentMilestoneDetailsList[parent_Index].UpdatedEndDate=r,parent_Index}function CreateSubGridDependent(n){$("#"+n).jqGrid({url:"",datatype:"local",data:dependentMilestoneDetailsList,mtype:"GET",colModel:Parentmodels,loadonce:!0,viewrecords:!0,sortable:!1,rowNum:1e4,gridview:!0,scroll:1,pager:"#pager",userDataOnFooter:!0,subGrid:!0,subGridOptions:{hasSubgrid:function(n){console.log(n);var t=n.data.subgridData;return t!=null&&t.length>0}},beforeExpandRow:function(t,i){var r=i.ColumnName,u=jQuery("#"+n).jqGrid("getRowData",row_id);if(r==="disable")return!1},subGridRowExpanded:function(t,i){var o=$("#ProjectId").children(":selected").attr("value"),r=t+"_t",u=jQuery("#"+n).jqGrid("getRowData",i),f=u.SequenceNo,e=DependentSub_Milestones.filter(n=>n.SequenceNo==f);$("#"+t).html("<table id='"+r+"'><\/table>");$("#"+r).jqGrid({datatype:"local",data:e,colModel:Submodels,loadonce:!0,viewrecords:!0,rowNum:1e4,scroll:!0,pager:"#pager_id",height:"auto"})},gridComplete:function(){},loadComplete:function(){$(".submilestoneexist").each(function(n,t){if(console.log(t.textContent),t.textContent!="True"){var i=$(t).parent().find("td.sgcollapsed");$(i).unbind("click").html("")}});var t=$("#"+n),i=t.jqGrid("getCol","Amount",!1,"sum");t.jqGrid("footerData","set",{OrderQtyInPallets:"Total Amount $:"});t.jqGrid("footerData","set",{Amount:parseFloat(t.jqGrid("getCol","Amount",!1,"sum")).toFixed(2)});$(".tamounteuro").text(parseFloat(i).toFixed(2));parseInt(i)!==0?$(".tamountdlr").text(parseFloat(1/i).toFixed(2)):0}})}var ProjStatus,PMUFlag,changedprojectId=0,changedmilestoneId=0,checkedmilestones=[],golbalsequencenumber=1,usertextid="",searchresult=[],milestoneconut="",DefaultArray=[],DurationList=[],projectId="",ProjectName="",selectedval="n",pmudetails=[],isinvalide=0,display="s",issetrelationchanged=!0,usernumber="",pmugridData=[],durationflag=!1,setrelationchanged=!1,beforesetrelation="",beforeDuration="",MaterialArray=[],changedDuration="",selectedmilestoneId="",ParentMilestoneid="",useridslist="",compltedmilestone=!0,sort=!0,gridselectedrow=[],changedSequnceNo="",looping=!0,userchangedSetrelation=!0,milestoneid_looping=[],selectedrowsequnce=[],EnddatechangedRowId="",cloneproject=!1,clonedProjectName="",clonedprojectId="",prevStartDate="",prevEndDate="",datepapulation=!0,startDatealertdisplay=!0,DatesPapulation="",uploadedFiles=[],deletedrow="",fileuploadedsuccess=!1,Existingsupportingdocfilenames=[],FileNamesList=[],UploadedFilesnameList=[],fileuploadedrow="",selectedFiles=[],FileName=[],MilestoneFilesList=[],formData=new FormData,subgrid_table_id=[],SubGridDatedisplaycount=0,EndDatechange_Sub=!1,TotalSubGridData=[],rowSequnce=comingSubGrid,Subchange=!1,LoadSubGridData=!0,SubGridSelectedrowid="",comingSubGrid=!1,DurationchangedSubGrid=!0,ParentSubGridId="",ClonedProjectDetails=!1,selectedprojectId_Clone="",projectIdchanged=!1,TemplateSubGridDisplay=!0,SelectedSubMilestoneData=[],emptySetRelation="",ExtraDaysAdd="",pmuFirstData=[],ParentId="",ParentSubgrid_data=[],ParentSequnceNo="",SubMilestonestartid="8001",data_Added=!0,deletedSubMilestone=!1,AddSubMilestoneFlag=!0,Datachange_SubgRID="",newSubGridrow="",SubGridSelected="",prevSubGridStartDate="",prevSubGridEndDate="",prevSubGridSetrelation="",prevSubGridDuration="",prevSubGridmapperUser="",prevSubGridmapperUserid="",prevSubGridSubRemarks="",SubGridChanged=!1,unselectSubMilestone=!1,SubgridStartDatechanged="",SelectedProjectId="",Setrelationchanged_sub=!0,DisplaySubGridValue="",DependentSub_Milestones=[],dependentMilestoneDetailsList=[],UpdatedStartDate_User="",updatedStartDateDisplay="",UpdatedSetrelation_display="",unionSelectedSubgrid_id="",changedmaingrid_id="",VersionReamrks="",chnagedSubgridDateId="",CancelHighlighter="",rowindex,iserror,PrevMilestoneId,newdata;$(document).ready(function(){var t,n;jQuery.support.cors=!0;$("#loader").css("visibility","hidden");$(".checkboxpmu").hide();$("#Versionchange").hide();$("#Setrelation").multiselect({includeSelectAllOption:!0,maxHeight:300});$("[data-singleselect]").select2();$("#FromProjectId").select2();$("#ToProjectId").select2();DurationList=[];searchresult=[];n=$("#selectedProjectId").val();models=[{name:"MilestoneId",label:"Milestone Id",width:40,resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1},{name:"RowId",label:"RowId",resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1,formatter:function(){}},{name:"SequenceNo",label:"M.No",width:70,resizable:!0,ignoreCase:!0,sortable:!1},{name:"MilestoneName",resizable:!0,width:280,label:"Milestone Name",ignoreCase:!0,sortable:!1},{name:"MilestoneStatus",resizable:!0,width:900,hidden:!0,label:"Milestone Name",ignoreCase:!0,sortable:!1},{name:"rowidNo",resizable:!0,width:150,hidden:!0,label:"Milestone Name",ignoreCase:!0,formatter:function(n,t,i){return i.rowidNo=t.rowId}},{name:"SetRelation",label:"Set Relation",width:100,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return i.SequenceNo==1?($("#1SetRelation").hide(),""):n==undefined?'<input type="text"   data-id="'+t.rowId+'" id="'+i.SequenceNo+'SetRelation" class="form-control allownumericwithdecimal"  onchange="ChangeSetRelation('+t.rowId+","+i.SequenceNo+')" />':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'SetRelation" value="'+i.SetRelation+'" class="form-control allownumericwithdecimal  input-disabled"  onchange="ChangeSetRelation('+t.rowId+","+i.SequenceNo+')" readonly />':'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'SetRelation" value="'+i.SetRelation+'" class="form-control allownumericwithdecimal"  onchange="ChangeSetRelation('+t.rowId+","+i.SequenceNo+')"  />'}},{name:"RelationType",label:"RelationType",width:100,resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1},{name:"Duration",label:"Duration",width:90,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return i.SubmilestoneExit=="True"?i.Duration!=""?'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'Duration" class="form-control duration allownumericwithdecimal  input-disabled" value="'+i.Duration+'" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')" readonly />':'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'Duration" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')" readonly />':n==undefined?'<input type="text" data-id="'+t.rowId+'"    id="'+i.SequenceNo+'Duration" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')" />':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'Duration" value="'+i.Duration+'" class="form-control duration allownumericwithdecimal  input-disabled" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')" readonly />':'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'Duration" value="'+i.Duration+'" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')"  />'}},{name:"StartDate",label:"Start Date",width:105,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text" class="form-control datepickerS" data-id="'+t.rowId+'"id="'+i.SequenceNo+'start_date"  placeholder="dd/mm/yyyy"  />':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"||i.SubMilestoneComplete==""?'<input type="text" class="form-control  input-disabled" data-id="'+t.rowId+'"value="'+i.StartDate+'" id="'+i.SequenceNo+'start_date"  placeholder="dd/mm/yyyy" readonly/>':'<input type="text" class="form-control datepickerS" data-id="'+t.rowId+'"value="'+i.StartDate+'" id="'+i.SequenceNo+'start_date"  placeholder="dd/mm/yyyy"/>'}},{name:"EndDate",resizable:!0,label:"End Date",sorttype:"Date",width:105,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return i.SubmilestoneExit=="True"?i.EndDate!=null?'<input type="text" class="form-control  input-disabled" data-id="'+t.rowId+'" id="'+i.SequenceNo+'end_date" value="'+i.EndDate+'"  placeholder="dd/mm/yyyy" readonly/>':'<input type="text" class="form-control input-disabled " data-id="'+t.rowId+'" id="'+i.SequenceNo+'end_date"  placeholder="dd/mm/yyyy" readonly/>':n==undefined?'<input type="text" class="form-control datepickerE" data-id="'+t.rowId+'" id="'+i.SequenceNo+'end_date" placeholder="dd/mm/yyyy" />':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"||i.SubmilestoneExit=="True"?'<input type="text" class="form-control  input-disabled" data-id="'+t.rowId+'" value="'+i.EndDate+'" id="'+i.SequenceNo+'end_date"  placeholder="dd/mm/yyyy" readonly/>':'<input type="text" class="form-control datepickerE" data-id="'+t.rowId+'" value="'+i.EndDate+'" id="'+i.SequenceNo+'end_date"  placeholder="dd/mm/yyyy"/>'}},{name:"ExtraDays",resizable:!0,label:"Extra Days",sorttype:"Date",width:55,hidden:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined||i.ExtraDays=="0"?'<input type="text" class="form-control" data-id="'+t.rowId+'" id="'+i.SequenceNo+'ExtraDays"  onchange="ChangeExtraDays('+t.rowId+","+i.SequenceNo+')"/>':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="text" class="form-control" data-id="'+t.rowId+'" value="'+i.ExtraDays+'" id="'+i.SequenceNo+'ExtraDays"  onchange="ChangeExtraDays('+t.rowId+","+i.SequenceNo+')" readonly/>':'<input type="text" class="form-control" data-id="'+t.rowId+'" value="'+i.ExtraDays+'" id="'+i.SequenceNo+'ExtraDays"  onchange="ChangeExtraDays('+t.rowId+","+i.SequenceNo+')"/>'}},{name:"UserId",resizable:!0,label:"User(s)",ignoreCase:!0,hidden:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text"   id="'+i.SequenceNo+'mapperUserid" class="form-control tags" placeholder="user" />':'<input type="text" id="'+i.SequenceNo+'mapperUserid" value="'+i.UserName+'" class="form-control tags " placeholder="user" />'}},{name:"UserName",resizable:!0,label:"User(s)",ignoreCase:!0,width:250,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text"  id="'+i.SequenceNo+'mapperUser" class="form-control tags "  placeholder="user"  onclick="EditUser('+t.rowId+')"/>':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="text" id="'+i.SequenceNo+'mapperUser" value="'+i.UserName+'" title="'+i.UserName+'" class="form-control tags  input-disabled" placeholder="user"  onclick="EditUser('+t.rowId+')" multiple readonly/>':'<input type="text" id="'+i.SequenceNo+'mapperUser" value="'+i.UserName+'" title="'+i.UserName+'" class="form-control tags "  placeholder="user" onclick="EditUser('+t.rowId+')" />'}},{name:"Remarks",resizable:!0,label:"Remarks",width:200,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<textarea rows="1" id="'+i.SequenceNo+'Remarks" value="'+i.Remarks+'" onchange="Remarksenter('+t.rowId+')"  class="form-control remarks">'+i.Remarks+"<\/textarea>":i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<textarea rows="1" id="'+i.SequenceNo+'Remarks" value="'+i.Remarks+'"  class="form-control remarks  input-disabled" readonly>'+i.Remarks+"<\/textarea>":'<textarea rows="1" id="'+i.SequenceNo+'Remarks" value="'+i.Remarks+'" onchange="Remarksenter('+t.rowId+')" class="form-control remarks">'+i.Remarks+"<\/textarea>"}},{name:"IsApproved",resizable:!0,label:"IsApproved",ignoreCase:!0,hidden:!0,sortable:!1},{name:"FileName",label:"File Upload",width:150,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="file"   data-id="'+t.rowId+'" id="'+i.SequenceNo+'FileUpload" name="pmufiles" class="form-control"  disabled />':'<input type="file"   data-id="'+t.rowId+'" id="'+i.SequenceNo+'FileUpload" name="'+t.rowId+'file"  class="form-control" onchange="FileUpload('+t.rowId+',event)"  id="'+t.rowId+'viewFile" multiple/>'}},{name:"Action",label:"Action",width:80,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return i.FileName==""||i.FileName==undefined&&i.MilestoneStatus!="Completed"?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons"><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="View" id="'+t.rowId+'viewuploadedfile" hidden><i class="fas fa-eye"><\/i><\/a><a href="javascript: void(0);" class="grid-icon-only" onclick="AddSubMilestone('+i.MilestoneId+","+t.rowId+')" class="icon_color text-warning btn_button" title="Add Sub Milestone(s)" id="'+t.rowId+'AddSubMilestoneicon"><i class="fas fa-plus"><\/i><\/a><\/div>':i.MilestoneStatus=="Completed"&&i.FileName!=""?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="View" id="'+t.rowId+'viewuploadedfile"><i class="fas fa-eye"><\/i><\/a><a href="javascript: void(0);" class="grid-icon-only" onclick="AddSubMilestone('+i.MilestoneId+","+t.rowId+')" class="icon_color text-warning btn_button" title="Add Sub Milestone(s)" id="'+t.rowId+'AddSubMilestoneicon" hidden><i class="fas fa-plus"><\/i><\/a><\/div>':i.MilestoneStatus=="Completed"&&i.FileName==""?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="View" id="'+t.rowId+'viewuploadedfile" hidden><i class="fas fa-eye"><\/i><\/a><a href="javascript: void(0);" class="grid-icon-only" onclick="AddSubMilestone('+i.MilestoneId+","+t.rowId+')" class="icon_color text-warning btn_button" title="Add" id="'+t.rowId+'AddSubMilestoneicon" hidden><i class="fas fa-plus"><\/i><\/a><\/div>':i.MilestoneStatus==null&&i.FileName!=""?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons"><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="View" id="'+t.rowId+'viewuploadedfile" hidden><i class="fas fa-eye"><\/i><\/a><a href="javascript: void(0);" class="grid-icon-only" onclick="AddSubMilestone('+i.MilestoneId+","+t.rowId+')" class="icon_color text-warning btn_button" title="Add Sub Milestone(s)" id="'+t.rowId+'AddSubMilestoneicon"><i class="fas fa-plus"><\/i><\/a><\/div>':'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="View" id="'+t.rowId+'viewuploadedfile"><i class="fas fa-eye"><\/i><\/a><a href="javascript: void(0);" class="grid-icon-only" onclick="AddSubMilestone('+i.MilestoneId+","+t.rowId+')" class="icon_color text-warning btn_button" title="Add Sub Milestone(s)" id="'+t.rowId+'AddSubMilestoneicon"><i class="fas fa-plus"><\/i><\/a><\/div>'}},{name:"SubmilestoneExit",resizable:!0,label:"SubmilestoneExit",ignoreCase:!0,hidden:!0,sortable:!1,classes:"submilestoneexist"}];colmodels=[{name:"multiselect",label:"Select",width:100,formatter:function(n,t,i){return i.Action=="true"&&i.PMUMappingStatus!="APPROVED"?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><input type="checkbox" class="my-checkbox"  id="checkbox_'+i.SubMilestoneId+'" onchange=SubGridselection('+t.rowId+","+i.SubMilestoneId+","+t.gid+') checked><a href="javascript: void(0);" class="grid-icon-only Rejecticon" onclick="DeleteSubMiestone('+i.SubMilestoneId+","+t.gid+')"  title="Delete" id="'+i.SubMilestoneId+'DeleteSubMiestone"><i class="fas fa-trash"><\/i><\/a><\/div>':i.MilestoneStatus=="Completed"||i.MilestoneStatus=="Done"||i.IsApproved=="Pending For Approval"?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><input type="checkbox" class="my-checkbox"  id="checkbox_'+i.SubMilestoneId+'" onchange=SubGridselection('+t.rowId+","+i.SubMilestoneId+","+t.gid+') checked disabled><a href="javascript: void(0);" class="grid-icon-only Rejecticon" onclick="DeleteSubMiestone('+i.SubMilestoneId+","+t.gid+')"  title="Delete" id="'+i.SubMilestoneId+'DeleteSubMiestone" hidden><i class="fas fa-trash"><\/i><\/a><\/div>':i.Action=="true"&&i.StartDate!=""&&i.PMUMappingStatus=="APPROVED"?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><input type="checkbox" class="my-checkbox"  id="checkbox_'+i.SubMilestoneId+'" onchange=SubGridselection('+t.rowId+","+i.SubMilestoneId+","+t.gid+") checked><\/div>":'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><input type="checkbox" class="my-checkbox"  id="checkbox_'+i.SubMilestoneId+'" onchange=SubGridselection('+t.rowId+","+i.SubMilestoneId+","+t.gid+')><a href="javascript: void(0);" class="grid-icon-only Rejecticon" onclick="DeleteSubMiestone('+i.SubMilestoneId+","+t.gid+')"  title="Delete" id="'+i.SubMilestoneId+'DeleteSubMiestone"><i class="fas fa-trash"><\/i><\/a><\/div>'}},{name:"SequenceNo",label:"Milestone No",width:20,resizable:!0,ignoreCase:!0,sortable:!1,hidden:!0},{name:"RoleId",resizable:!0,label:"RoleId",hidden:!0,ignoreCase:!0},{name:"SubMilestoneId",resizable:!0,label:"Sub Milestone Id",width:120,ignoreCase:!0},{name:"SubMilestoneName",resizable:!0,label:"Sub Milestone Name",width:150,ignoreCase:!0},{name:"MilestoneStatus",resizable:!0,width:200,hidden:!0,label:"Milestone Name",ignoreCase:!0,sortable:!1},{name:"SetRelation",resizable:!0,label:"Set Relation",width:80,ignoreCase:!0,formatter:function(n,t,i){return n==undefined?'<input type="text"   data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'SetRelation" class="form-control allownumericwithdecimal"  onchange="ChangeSetRelationSubGrid('+t.rowId+","+t.gid+')" />':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="text" data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'SetRelation" value="'+i.SetRelation+'" class="form-control allownumericwithdecimal input-disabled"  onchange="ChangeSetRelationSubGrid('+t.rowId+","+t.gid+')" readonly />':'<input type="text" data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'SetRelation" value="'+i.SetRelation+'" class="form-control allownumericwithdecimal"  onchange="ChangeSetRelationSubGrid('+t.rowId+","+t.gid+')"  />'}},{name:"RelationType",resizable:!0,label:"Relation Type",ignoreCase:!0,width:90,hidden:!0,formatter:function(n,t,i){return i.SetRelation=="0"||i.SetRelation==""?($("#"+i.SubMilestoneId+"RelationType").hide(),""):i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<select  id="'+i.SubMilestoneId+'RelationType" value="'+i.RelationType+'" onchange="ChangeRelationType('+t.rowId+","+t.gid+')" class="input-disabled form-control" disabled><option value = "0">-- Select --<\/option><option value='+i.RelationType+" selected>"+i.RelationType+"<\/option><\/select>":'<select class="form-control" id="'+i.SubMilestoneId+'RelationType" value="'+i.RelationType+'" onchange="ChangeRelationType('+t.rowId+","+t.gid+')" ><option value = "0">-- Select --<\/option><option value="FS ( Sequence)" selected>FS ( Sequence)<\/option><option value="SS ( Parallel )">SS ( Parallel )<\/option><\/select>'}},{name:"Duration",resizable:!0,label:"Duration",width:50,ignoreCase:!0,formatter:function(n,t,i){return n==undefined?'<input type="text" data-id="'+t.rowId+'"    id="'+i.SubMilestoneId+'SubGridDuration" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="SubGridChangeDuration('+t.rowId+","+t.gid+')" />':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="text" data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'SubGridDuration" value="'+i.Duration+'" class="form-control duration allownumericwithdecimal input-disabled" placeholder="Duration" onchange="SubGridChangeDuration('+t.rowId+","+t.gid+')" readonly />':'<input type="text" data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'SubGridDuration" value="'+i.Duration+'" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="SubGridChangeDuration('+t.rowId+","+t.gid+')"  />'}},{name:"Status",resizable:!0,width:50,label:"Status",ignoreCase:!0,hidden:!0},{name:"StartDate",label:"Start Date",resizable:!0,width:60,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text" class="form-control datepickerS" data-id="'+t.rowId+'"id="'+i.SubMilestoneId+'start_date"  placeholder="dd/mm/yyyy"/>':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"||i.SubmilestoneExit=="True"?'<input type="text" class="form-control input-disabled" data-id="'+t.rowId+'"value="'+i.StartDate+'" id="'+i.SubMilestoneId+'start_date"  placeholder="dd/mm/yyyy" readonly/>':'<input type="text" class="form-control datepickerS" data-id="'+t.rowId+'"value="'+i.StartDate+'" id="'+i.SubMilestoneId+'start_date"  placeholder="dd/mm/yyyy" />'}},{name:"EndDate",resizable:!0,label:"End Date",sorttype:"Date",ignoreCase:!0,width:60,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text" class="form-control datepickerE" data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'end_date" placeholder="dd/mm/yyyy"/>':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"||i.SubmilestoneExit=="True"?'<input type="text" class="form-control input-disabled" data-id="'+t.rowId+'" value="'+i.EndDate+'" id="'+i.SubMilestoneId+'end_date"  placeholder="dd/mm/yyyy" readonly/>':'<input type="text" class="form-control datepickerE" data-id="'+t.rowId+'" value="'+i.EndDate+'" id="'+i.SubMilestoneId+'end_date"  placeholder="dd/mm/yyyy" />'}},{name:"UserId",resizable:!0,label:"User(s)",ignoreCase:!0,hidden:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text"   id="'+i.SubMilestoneId+'mapperUserid" class="form-control tagsid" placeholder="user" />':'<input type="text" id="'+i.SubMilestoneId+'mapperUserid" value="'+i.UserId+'" class="form-control tags" placeholder="user" />'}},{name:"UserName",resizable:!0,label:"User(s)",ignoreCase:!0,width:150,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text"  id="'+i.SubMilestoneId+'mapperUser" class="form-control tags SubUser"  placeholder="user" onclick="SubEditUser('+t.gid+","+t.rowId+')" />':i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="text" id="'+i.SubMilestoneId+'mapperUser" value="'+i.UserName+'" title="'+i.UserName+'" class="form-control tags SubUser input-disabled" placeholder="user" onclick="SubEditUser('+t.gid+","+t.rowId+')"  multiple readonly/>':'<input type="text" id="'+i.SubMilestoneId+'mapperUser" value="'+i.UserName+'" title="'+i.UserName+'" class="form-control tags SubUser" onclick="SubEditUser('+t.gid+","+t.rowId+')"  placeholder="user"  />'}},{name:"Remarks",resizable:!0,label:"Remarks",ignoreCase:!0,sortable:!1,width:120,formatter:function(n,t,i){return n==undefined?'<textarea id="'+i.SubMilestoneId+'SubRemarks" value="'+i.Remarks+'" onkeyup="SubRemarksenter('+t.gid+","+t.rowId+')"  class="form-control remarks">'+i.Remarks+"<\/textarea>":i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<textarea id="'+i.SubMilestoneId+'SubRemarks" value="'+i.Remarks+'"  class="form-control remarks input-disabled" readonly>'+i.Remarks+"<\/textarea>":'<textarea id="'+i.SubMilestoneId+'SubRemarks" value="'+i.Remarks+'" onkeyup="SubRemarksenter('+t.gid+","+t.rowId+')" class="form-control remarks">'+i.Remarks+"<\/textarea>"}},{name:"IsApproved",resizable:!0,label:"IsApproved",ignoreCase:!0,hidden:!0,sortable:!1},{name:"FileName",label:"File Upload",width:180,resizable:!0,ignoreCase:!0,sortable:!1,hidden:!0,formatter:function(n,t,i){return i.MilestoneStatus=="Completed"||i.IsApproved=="Pending For Approval"?'<input type="file"   data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'SubFileUpload" name="pmufiles" class="form-control"  disabled />':'<input type="file"   data-id="'+t.rowId+'" id="'+i.SubMilestoneId+'SubFileUpload" name="'+t.rowId+'file3"  class="form-control" onchange="FileUpload('+t.rowId+',event)"  id="'+t.rowId+'viewFile" multiple/>'}},{name:"Action",label:"Action",width:50,resizable:!0,ignoreCase:!0,sortable:!1,hidden:!0,formatter:function(n,t,i){return i.FileName==""?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" hidden><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="Download" id="'+t.rowId+'viewuploadedfile"><i class="fas fa-eye"><\/i><\/a><\/div>':i.MilestoneStatus=="Completed"&&i.FileName!=""?'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="Download" id="'+t.rowId+'viewuploadedfile"><i class="fas fa-eye"><\/i><\/a><\/div>':'<div class="grid-icons-group -justify-center" id="'+i.SequenceNo+'DisplayIcons" ><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="ViewUploadedImages('+i.MilestoneId+","+t.rowId+')" class="icon_color text-success btn_button" title="Download" id="'+t.rowId+'viewuploadedfile"><i class="fas fa-eye"><\/i><\/a><\/div>'}},];$("#selectedProjectId").val()!="0"?(t=$("#selectedProjectName").val(),n=$("#selectedProjectId").val(),SelectedProjectId=n,display="N",$("div.id_100 select").select2().val(n).change(),n==0?($(".projectName_error").show(),$(".projectName_error").html("Please Select Project Name")):$(".projectName_error").hide(),$.ajax({dataType:"json",url:ROOT+"Master/MilestonesList",method:"Post",data:{projectId:n,projectName:t,clonedProjectId:n,clonedProjectName:t},success:function(n){var i,t,r,u;for(display="s",$("#loader").show(),$("#loader").css("visibility","visible"),pmugridData=n,pmuFirstData=n,pmugridData[0].SetRelation="0",$.jgrid.gridUnload("#jqgrid"),CreateJqGrid(pmugridData),searchresult=n,LoadSubGridData=!1,allData=$("#jqgrid").jqGrid("getGridParam",n),n.forEach(n=>{n.StartDate!=""&&n.EndDate!=""&&DurationList.push({milestoneName:n.MilestoneName,Duration:n.Duration,MilestoneStatus:n.MilestoneStatus,SetRelation:n.SetRelation})}),n.forEach(n=>{pmudetails.push({Duration:n.Duration,MilestoneName:n.MilestoneName,RelationType:n.RelationType,SequenceNo:n.SequenceNo,SetRelation:n.SetRelation})}),ProjStatus=searchresult[0].Status,PMUFlag=searchresult[0].Flag,i=1,t=0;t<=pmugridData.length-1;t++)pmugridData[t].Action=="true"&&($("#jqg_jqgrid_"+i).prop("checked",!0),MaterialArray.push(pmugridData[t]),$("#jqg_jqgrid_"+i).prop("checked")==!0&&($("body").addClass("menuitemshow"),$("#"+pmugridData[t].SequenceNo+"mapperUserid").val(pmugridData[t].UserId)),(pmugridData[t].MilestoneStatus=="Completed"||pmugridData[t].IsApproved=="Pending For Approval")&&$("#jqg_jqgrid_"+i).attr("disabled",!0)),i++;for($(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"),$(this).attr("id"))}}),$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"),$(this).attr("id"))}}),LoadUser("mapperUser"),pmugridData[0].Status=="SUBMITTED"&&($(".approve_btn").css("display","inline-block"),$(".checkboxpmu").hide(),$("#BtnClone").css("display","none"),$("#TemplateListdiv").hide()),pmugridData[0].Status=="APPROVED"&&($(".save_btn").css("display","none"),$(".approve_btn").css("display","none"),$("#BtnClone").css("display","none"),$("#TemplateListdiv").hide(),$(".checkboxpmu").show()),pmugridData[0].Status==""&&($(".approve_btn").css("display","none"),$(".checkboxpmu").hide()),r=pmugridData.findIndex(n=>n.IsApproved=="Pending For Approval"),r>=0&&($("#pendingApprovalmodel").modal("show"),$("#Pendingapprovalmilestones").empty(),$.each(pmugridData,function(n){pmugridData[n].IsApproved=="Pending For Approval"&&$("#Pendingapprovalmilestones").append("<ul><b><li>"+pmugridData[n].MilestoneName+"<\/li><\/b><\/ul>")})),t=0;t<TotalSubGridData.length;t++)r=TotalSubGridData[t].findIndex(n=>n.IsApproved=="Pending For Approval"),r>=0&&($("#pendingApprovalmodel").modal("show"),$.each(TotalSubGridData[t],function(n){TotalSubGridData[t][n].IsApproved=="Pending For Approval"&&$("#Pendingapprovalmilestones").append("<ul><b><li>"+TotalSubGridData[t][n].SubMilestoneName+"<\/li><\/b><\/ul>")}));$("#jqgrid tbody tr").each(function(n,t){$(t).find("td:nth-child(7)").text()=="Completed"&&$(this).attr("class","custom-class")});$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});u=$(".ui-jqgrid-bdiv").find("tbody").height();u>280?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","0px");$("#loader").css("visibility","hidden")},error:function(){}})):($("div.id_100 select").select2().val(n).change(),$(".submit_btn").css("display","none"),selected="s");$(".save_btn").on("click",function(){var h=$("#Version").val(),c,r,f,e,u,t,o,i,s;if(looping){if(DefaultArray=$("#jqgrid").jqGrid("getGridParam","data"),c=$("#jqgrid").jqGrid("getGridParam","records"),r=[],VersionReamrks=="")return!1;if($.each(pmugridData,function(n,t){t.Action=="true"&&(t.StartDate!==null&&t.StartDate!==""&&typeof t.StartDate!="undefined"&&(t.FormattedStartDate=moment(t.StartDate,"DD/MM/YYYY").format("YYYY-MM-DD")),t.EndDate!==null&&t.EndDate!==""&&typeof t.EndDate!="undefined"&&(t.FormattedEndDate=moment(t.EndDate,"DD/MM/YYYY").format("YYYY-MM-DD")),r.push(t))}),r.length==0)return alert("Please select the check box "),!1;if($.each(r,function(n,t){t.LineItemNo=n+1;t.ProjectId=$("#ProjectId option:Selected").val();t.CreatedBy=$("#LoggedinUser").val();t.Action="";t.Status="0";t.MilestoneStatus="Open";t.projectFlag="p"}),f=0,$.each(r,function(n,t){(t.UserName==0||t.UserName=="")&&(f=1)}),f===1)return alert("Please Enter User"),!1;for(e=[],u=0;u<subgrid_table_id.length;u++)if(t=$("#"+subgrid_table_id[u]).jqGrid("getGridParam","data"),t!=undefined)if(o=$.grep(t,function(n){return $.trim(n.SetRelation)===""}),o.length>1){emptySetRelation=1;alert("Please enter the Set Relation in sub grid");break}else if(t.length>0)for(i=0;i<t.length;i++)t[i].StartDate!==null&&t[i].StartDate!==""&&typeof t[i].StartDate!="undefined"&&(t[i].FormattedStartDate=moment(t[i].StartDate,"DD/MM/YYYY").format("YYYY-MM-DD")),t[i].EndDate!==null&&t[i].EndDate!==""&&typeof t[i].EndDate!="undefined"&&(t[i].FormattedEndDate=moment(t[i].EndDate,"DD/MM/YYYY").format("YYYY-MM-DD")),e.push(t[i]);if(emptySetRelation==1)return!1;Griddata=JSON.stringify(r);FileName=JSON.stringify(FileName);TotalSubGridData=JSON.stringify(e);s="SAVE";formData.append("flag",s);formData.append("projectId",n);formData.append("DatesPapulationflage",DatesPapulationflage);formData.append("Griddata",Griddata);formData.append("Version",h);formData.append("FileName",FileName);formData.append("TotalSubGridData",TotalSubGridData);formData.append("VersionReamrks",VersionReamrks);formData.append("chnagedSubgridDateId",chnagedSubgridDateId);$.ajax({url:ROOT+"Master/PMUMapping",type:"POST",data:formData,contentType:!1,processData:!1,success:function(){location.reload()},error:function(n,t,i){console.log("err",n,t,i)}})}else alert("looping")});$(".approve_btn").on("click",function(){looping?$("#myModal").modal("show"):alert("There is a circle dependency observed for the below marked milestones")});$("#OkApproval").on("click",function(){var e,i,h,u,y,p,r,t;changedmilestoneIdList=[];n=$("#ProjectId option:selected").val();var b=$("#jqgrid").jqGrid("getGridParam","records"),f=[],w=$("#Version").val();if($.each(pmugridData,function(n,t){t.Action=="true"&&(t.StartDate!==null&&t.StartDate!==""&&typeof t.StartDate!="undefined"&&(t.FormattedStartDate=moment(t.StartDate,"DD/MM/YYYY").format("YYYY-MM-DD")),t.EndDate!==null&&t.EndDate!==""&&typeof t.EndDate!="undefined"&&(t.FormattedEndDate=moment(t.EndDate,"DD/MM/YYYY").format("YYYY-MM-DD")),f.push(t))}),f.length==0)return alert("Please select the check box "),!1;$.each(f,function(t,i){i.LineItemNo=t+1;i.ProjectId=n;i.CreatedBy=$("#LoggedinUser").val();i.Status="1";i.MilestoneStatus="Open";i.projectFlag="p"});var o=0,s="";if($.each(f,function(n,t){(t.UserName==0||t.UserName=="")&&(o=1);(t.StartDate==""||t.EndDate==""||t.StartDate==null||t.EndDate==null)&&(s=1)}),!1)return alert("Please Enter the Set Relation"),!1;if(0)return alert("Please Enter the Duration"),!1;if(s===1)return alert("Please select the Date"),!1;if(o===1)return alert("Please Enter User"),!1;for(e=[],u=0;u<subgrid_table_id.length;u++)if(i=$("#"+subgrid_table_id[u]).jqGrid("getGridParam","data"),i!=undefined)if(h=$.grep(i,function(n){return $.trim(n.SetRelation)===""}),h.length>1){emptySetRelation=1;alert("Please enter the Set Relation in sub grid");break}else if(i.length>0)for(t=0;t<i.length;t++)i[t].StartDate!==null&&i[t].StartDate!==""&&typeof i[t].StartDate!="undefined"&&(i[t].FormattedStartDate=moment(i[t].StartDate,"DD/MM/YYYY").format("YYYY-MM-DD")),i[t].EndDate!==null&&i[t].EndDate!==""&&typeof i[t].EndDate!="undefined"&&(i[t].FormattedEndDate=moment(i[t].EndDate,"DD/MM/YYYY").format("YYYY-MM-DD")),e.push(i[t]);if(emptySetRelation==1)return!1;var c="",l="",a="",v="";for(u=0;u<TotalSubGridData.length;u++)if(TotalSubGridData[u].length>0&&(y=TotalSubGridData[u][0].SequenceNo,p=pmugridData.findIndex(n=>n.SequenceNo==y),pmugridData[p].Action=="true"))for(r=TotalSubGridData[u].filter(n=>n.Action=="true"),t=0;t<r.length;t++)r[t].Status="1",(r[t].UserName==""||r[t].UserId==""||r[t].UserId==undefined||r[t].UserId==null)&&(a=1),(r[t].StartDate==""||r[t].EndDate==""||r[t].StartDate==null||r[t].EndDate==null)&&(c=1),r[t].SetRelation==""&&(v=1),r[t].Duration==""&&(l=1);if(l===1)return alert("Please enter the duration for Sub Milestone"),!1;if(c===1)return alert("Please select the date for Sub Milestone(s)"),!1;if(a===1)return alert("Please select user(s) for Sub Milestone(s)"),!1;if(v===1)return alert("Please Enter Set Relation"),!1;Griddata=JSON.stringify(f);FileName=JSON.stringify(FileName);TotalSubGridData=JSON.stringify(e);n!=""&&(formData.append("flag","APPROVED"),formData.append("projectId",n),formData.append("changedmilestoneId",changedmilestoneId),formData.append("Griddata",Griddata),formData.append("Version",w),formData.append("FileName",FileName),formData.append("TotalSubGridData",TotalSubGridData),formData.append("VersionReamrks",VersionReamrks),formData.append("chnagedSubgridDateId",chnagedSubgridDateId),$.ajax({url:ROOT+"Master/PMUMapping",type:"POST",data:formData,contentType:!1,processData:!1,success:function(){location.reload()},error:function(n,t,i){console.log("err",n,t,i)}}))});$(".data-datepicker").datepicker({format:"dd-mm-yyyy",todayHighlight:!0,autoclose:!0});$(".submit_btn").on("click",function(){var e,i,c,u,p,w,r,t,b,k;if(looping){DatesPapulationflage="Yes";DefaultArray=$("#jqgrid").jqGrid("getGridParam","data");n=$("#ProjectId").children(":selected").attr("value");var nt=$("#jqgrid").jqGrid("getGridParam","records"),d=$("#Version").val(),f=[];if($.each(pmugridData,function(n,t){t.Action=="true"&&(t.StartDate!==null&&t.StartDate!==""&&typeof t.StartDate!="undefined"&&(t.FormattedStartDate=moment(t.StartDate,"DD/MM/YYYY").format("YYYY-MM-DD")),t.EndDate!==null&&t.EndDate!==""&&typeof t.EndDate!="undefined"&&(t.FormattedEndDate=moment(t.EndDate,"DD/MM/YYYY").format("YYYY-MM-DD")),f.push(t))}),f.length==0)return alert("Please select the check box "),!1;$.each(f,function(t,i){i.LineItemNo=t+1;i.ProjectId=n;i.CreatedBy=$("#LoggedinUser").val();i.Status="1";i.MilestoneStatus="Open";i.projectFlag="p"});var o=0,s="",g="",h="";if($.each(f,function(n,t){(t.UserName==""||t.UserId==""||t.UserId==undefined)&&(o=1);(t.StartDate==""||t.EndDate==""||t.StartDate==null||t.EndDate==null)&&(s=1);t.SetRelation==""&&(g=1);t.Duration==""&&(h=1)}),h===1)return alert("Please Enter the Duration"),!1;if(s===1)return alert("Please select the Date"),!1;if(o===1)return alert("Please Enter User"),!1;if($("#AccepptVersionCreation").prop("checked")&&$("#Version").val()=="")return $("#VersionError").text("Please enter the version"),!1;for(e=[],u=0;u<subgrid_table_id.length;u++)if(i=$("#"+subgrid_table_id[u]).jqGrid("getGridParam","data"),i!=undefined)if(c=$.grep(i,function(n){return $.trim(n.SetRelation)===""||$.trim(n.SetRelation)==="0"}),c.length>1){emptySetRelation=1;alert("Please enter the Set Relation in sub grid");break}else if(i.length>0)for(t=0;t<i.length;t++)i[t].StartDate!==null&&i[t].StartDate!==""&&typeof i[t].StartDate!="undefined"&&(i[t].FormattedStartDate=moment(i[t].StartDate,"DD/MM/YYYY").format("YYYY-MM-DD")),i[t].EndDate!==null&&i[t].EndDate!==""&&typeof i[t].EndDate!="undefined"&&(i[t].FormattedEndDate=moment(i[t].EndDate,"DD/MM/YYYY").format("YYYY-MM-DD")),e.push(i[t]);if(emptySetRelation==1)return!1;var l="",a="",v="",y="";for(u=0;u<TotalSubGridData.length;u++)if(TotalSubGridData[u].length>0&&(p=TotalSubGridData[u][0].SequenceNo,w=pmugridData.findIndex(n=>n.SequenceNo==p),pmugridData[w].Action=="true"))for(r=TotalSubGridData[u].filter(n=>n.Action=="true"),t=0;t<r.length;t++)r[t].Status="1",(r[t].UserName==""||r[t].UserId==""||r[t].UserId==undefined||r[t].UserId==null||r[t].UserName==null)&&(v=1),(r[t].StartDate==""||r[t].EndDate==""||r[t].StartDate==null||r[t].EndDate==null)&&(l=1),r[t].SetRelation==""&&(y=1),r[t].Duration==""&&(a=1);if(a===1)return alert("Please Enter the duration for Sub Milestone"),!1;if(l===1)return alert("Please select the date for Sub Milestone(s)"),!1;if(v===1)return alert("Please select the User(s) for Sub Milestone(s)"),!1;if(y===1)return alert("Please enter the Set Relation"),!1;Griddata=JSON.stringify(f);FileName=JSON.stringify(FileName);e=JSON.stringify(e);b=ProjStatus=="APPROVED"?" ":"SUBMIT";k=$("#AccepptVersionCreation").prop("checked");formData.append("flag",b);formData.append("projectId",n);formData.append("changedmilestoneId",changedmilestoneId);formData.append("Griddata",Griddata);formData.append("AccepptVersionCreation",k);formData.append("DatesPapulationflage",DatesPapulationflage);formData.append("FileName",FileName);formData.append("Version",d);formData.append("TotalSubGridData",e);formData.append("VersionReamrks",VersionReamrks);formData.append("chnagedSubgridDateId",chnagedSubgridDateId);n!=""?$.ajax({url:ROOT+"Master/PMUMapping",type:"POST",data:formData,contentType:!1,processData:!1,success:function(){location.reload()},error:function(n,t,i){console.log("err",n,t,i)}}):$(".projectName_error").html("Please Select Project Name")}else alert("There is a circle dependency observed for the below marked milestones")})});$("#Addmilestone").on("click",function(){$("#SequenceNo").val("");$("#MilestoneName").val("");$("#Setrelation").val("")});var availableTags=[],usersMap={},availabledata=[];$(".tags").keyup(function(n){n.keyCode==8&&alert("backspace trapped")});$("#btnSubmit").on("click",function(){function t(n,t,i,r){DurationList=[];searchresult=[];MaterialArray=[];subgrid_table_id=[];$("#selectedProjectName").val(i);$("#selectedProjectId").val(r);n=="0"?($(".projectName_error").show(),$(".projectName_error").html("Please Select Project Name"),$("#btnRefresh").css("display","none"),$("#BtnClone").css("display","none"),$("#TemplateListdiv").hide(),$.ajax({url:ROOT+"Master/MilestonesList",type:"GET",data:{projectId:n,projectName:t,clonedProjectId:i,clonedProjectName:r},dataType:"JSON",success:function(){$("#jqgrid").jqGrid("clearGridData",!0);$("#ApproveModal").css("display","none")}})):($(".projectName_error").html(""),$("#SaveModel").show(),$("#SaveModel1").show(),$("#btnRefresh").show(),$("#BtnClone").show(),$("#TemplateListdiv").show(),TotalSubGridData=[],$.ajax({url:ROOT+"Master/MilestonesList",type:"post",data:{projectId:n,projectName:t,clonedProjectId:i,clonedProjectName:r},dataType:"JSON",success:function(i){var e,u,r,f;for($(".projectName_error").hide(),$("#addModal").modal("hide"),searchresult=i,i.forEach(n=>{n.StartDate!=""&&n.EndDate!=""&&DurationList.push({milestoneName:n.MilestoneName,Duration:n.Duration,MilestoneStatus:n.MilestoneStatus,SetRelation:n.SetRelation})}),ProjStatus="",PMUFlag=i[0].Flag,ClonedProjectDetails=!0,TotalSubGridData=[],pmugridData=i,$.each(pmugridData,function(n){pmugridData[n].Status="";pmugridData[n].MilestoneStatus="";pmugridData[n].IsApproved="";pmugridData[n].FileName="";pmugridData[n].Remarks=""}),LoadSubGridData=!0,subgrid_table_id=[],$("#jqgrid").jqGrid("clearGridData",!0),$("#jqgrid").jqGrid("setGridParam",{data:pmugridData}),$("#jqgrid").trigger("reloadGrid"),$("#TemplateList").val(""),allData=$("#jqgrid").jqGrid("getGridParam",i),LoadSubGridData=!1,$("#selectedProjectName").val(t),$("#selectedProjectId").val(n),e=$("#jqgrid").jqGrid("getGridParam","records"),u=1,r=0;r<=pmugridData.length-1;r++)pmugridData[r].Action=="true"&&($("#jqg_jqgrid_"+u).prop("checked",!0),$("#jqg_jqgrid_"+u).prop("checked")==!0&&(MaterialArray.push(pmugridData[r]),$("body").addClass("menuitemshow"),$("#"+pmugridData[r].SequenceNo+"mapperUserid").val(pmugridData[r].UserId))),u++;$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"),$(this).attr("id"))}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"),$(this).attr("id"))}});LoadUser("mapperUser");$(".checkboxpmu").hide();$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});f=$(".ui-jqgrid-bdiv").find("tbody").height();f>280?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","0px")}}))}selectedprojectId_Clone=$("#FromProjectId").val();var n=$("#FromProjectId option:Selected").text();if(clonedprojectId=$("#ToProjectId").val(),clonedProjectName=$("#ToProjectId option:Selected").text(),selectedprojectId_Clone=="0"?$(".FromProjectId_error").text("Please select the From Project"):$(".FromProjectId_error").text(""),clonedprojectId=="0")return $(".ToProjectId_error").text("Please select the To Project"),!1;$(".ToProjectId_error").text("");selectedprojectId_Clone!="0"&&clonedprojectId!="0"&&(cloneproject=!0,$("#ProjectId").val(clonedprojectId).trigger("change"),t(selectedprojectId_Clone,n,clonedprojectId,clonedProjectName))});$("#ProjectId").on("change",function(){$("#loader").show();$("#loader").css("visibility","visible");ParentSubgrid_data=[];DisplaySubGridValue="";DependentSub_Milestones=[];dependentMilestoneDetailsList=[];UpdatedStartDate_User="";updatedStartDateDisplay="";UpdatedSetrelation_display="";SubMilestonestartid="8001";var t=$("#ProjectId option:Selected").text(),n=$("#ProjectId").children(":selected").attr("value");SelectedProjectId=n;subgrid_table_id=[];cloneproject?(t=clonedProjectName,n=clonedprojectId,cloneproject=!1):cloneproject=!1;displayDate(n,t)});rowindex="";iserror=!1;$("#endChangeDate").on("click",function(){DatesPapulationflage="Yes";DatepapulateforEndDATE();$("#EndNoButton").show()});$("#btnRefresh").on("click",function(){var i,t,n,r,u;for($("#loader").show(),$("#loader").css("visibility","visible"),sortingrecord(),i=pmugridData.filter(n=>n.SubmilestoneExit=="True"&&n.Action=="true"),t=0;t<i.length;t++)for(n=0;n<subgrid_table_id.length;n++)r=subgrid_table_id[n].split("_"),u=r[2].slice("1"),i[t].SequenceNo==u&&SubGridsortingrecord(subgrid_table_id[n]);$("#loader").hide();$("#loader").css("visibility","hidden")});$("#ChangeDate").on("click",function(){setrelationchanged=!1;DatesPapulationflage="Yes";startDatepapulation()});$("#EndNoButton").on("click",function(){var o,t,e,f,u,s;if(unselectSubMilestone?(o=parseInt(EnddatechangedRowId),unselectSubMilestone=!1):o=EnddatechangedRowId,rowid=selectedrowsequnce,newStr!="")var r=jQuery("#"+newStr).jqGrid("getRowData",o),n=jQuery("#"+newStr).jqGrid("getGridParam","data"),i=r.SubMilestoneId,h=r.SequenceNo;if(newSubGridrow){for(SubGridSelected?(t=n.findIndex(n=>n.SubMilestoneId==r.SubMilestoneId),n[t].Action="",$("#checkbox_"+i).prop("checked",!1),$("#"+i+"start_date").val(""),$("#"+i+"end_date").val(""),$("#"+i+"mapperUser").val(""),$("#"+i+"SubRemarks").val(""),$("#"+i+"mapperUser").val(""),t=n.findIndex(n=>n.SubMilestoneId==i),n[t].Action="",n[t].StartDate="",n[t].EndDate="",n[t].UserId="",n[t].UserName="",n[t].Remarks="",newSubGridrow=!1,SubGridSelected=!1):(t=n.findIndex(n=>n.SubMilestoneId==r.SubMilestoneId),n[t].Action="true",$("#checkbox_"+i).prop("checked",!0),$("#"+i+"start_date").val(prevSubGridStartDate),$("#"+i+"end_date").val(prevSubGridEndDate),$("#"+i+"mapperUser").val(prevSubGridmapperUser),$("#"+i+"SubRemarks").val(prevSubGridSubRemarks),$("#"+i+"mapperUserid").val(prevSubGridmapperUserid),$("#"+i+"SetRelation").val(prevSubGridSetrelation),t=n.findIndex(n=>n.SubMilestoneId==i),n[t].Action="true",n[t].StartDate=prevSubGridStartDate,n[t].EndDate=prevSubGridEndDate,n[t].UserId=prevSubGridmapperUserid,n[t].UserName=prevSubGridmapperUser,n[t].Remarks=prevSubGridSubRemarks,n[t].SetRelation=prevSubGridSetrelation,newSubGridrow=!1),e=0;e<TotalSubGridData.length;e++)if(u=TotalSubGridData[e].findIndex(n=>n.SubMilestoneId==i),u!=-1){TotalSubGridData[e]=n;break}SubGridsortingrecord(newStr);SubChangeDate("1",h,newStr)}else if(Datachange_SubgRID){for($("#checkbox_"+r.SubMilestoneId).prop("checked",!0),$("#"+r.SubMilestoneId+"end_date").val(PrevEnddate_SubGRID),$("#"+r.SubMilestoneId+"start_date").val(prevSubGridStartDate),$("#"+r.SubMilestoneId+"SetRelation").val(prevSubGridSetrelation),f=0;f<TotalSubGridData.length;f++)u=TotalSubGridData[f].findIndex(n=>n.SubMilestoneId==r.SubMilestoneId),u!=-1&&(TotalSubGridData[f][u].EndDate=PrevEnddate_SubGRID,TotalSubGridData[f][u].SetRelation=prevSubGridSetrelation,TotalSubGridData[f][u].Action="true");Datachange_SubgRID=!1}else $("#"+rowid+"Duration").val(beforeDuration),$("#"+rowid+"end_date").val(prevEndDate),s=pmugridData.findIndex(n=>n.SequenceNo==selectedrowsequnce),pmugridData[s].EndDate=prevEndDate,pmugridData[s].Duration=beforeDuration});$(".CancelDate").on("click",function(){DatesPapulationflage="No";cancelbutton();$("#EndNoButton").show();CancelHighlighter=!0;HighlightUpdatedDaterows()});$("#NoButton").on("click",function(){var u,i,n,r,t;if(Datachange_SubgRID){for(u=EnddatechangedRowId,i=jQuery("#"+newStr).jqGrid("getRowData",u),$("#"+i.SubMilestoneId+"end_date").val(PrevEnddate_SubGRID),$("#"+i.SubMilestoneId+"SubGridDuration").val(PrevDuration_SubGRID),n=0;n<TotalSubGridData.length;n++)if(r=TotalSubGridData[n].findIndex(n=>n.SubMilestoneId==i.SubMilestoneId),r!=-1){TotalSubGridData[n][r].EndDate=PrevEnddate_SubGRID;TotalSubGridData[n][r].Duration=PrevDuration_SubGRID;break}Datachange_SubgRID=!1}else rowid=selectedrowsequnce,$("#"+rowid+"start_date").val(prevStartDate),$("#"+rowid+"end_date").val(prevEndDate),$("#"+rowid+"Duration").val(beforeDuration),$("#"+rowid+"SetRelation").val(beforesetrelation),t=pmugridData.findIndex(n=>n.SequenceNo==selectedrowsequnce),pmugridData[t].StartDate=prevStartDate,pmugridData[t].EndDate=prevEndDate,pmugridData[t].SetRelation=beforesetrelation,pmugridData[t].Duration=beforeDuration});$("#BtnClone").on("click",function(){var n=$("#ProjectId option:Selected").text(),t=$("#ProjectId").children(":selected").attr("value");$("#ToProjectId").val(t).trigger("change");$("#ToProjectId option:Selected").text(n);$("#FromProjectId").val("0").trigger("change");$("#addModal").modal("show")});$("#pendingforApprovalbtn").click(function(){$("#pendingApprovalmodel").modal("hide")});$("#btnTemplateAdd").click(function(){var n=$("#TemplateList").val();$("#loader").show();$("#loader").css("visibility","visible");$.ajax({url:ROOT+"Master/SelectedTemplateDetails",type:"post",data:{TemplateId:n},dataType:"JSON",success:function(n){var u,f,r,i,t,e;for($(".projectName_error").hide(),$("#addModal").modal("hide"),searchresult=n,n.forEach(n=>{n.StartDate!=""&&n.EndDate!=""&&DurationList.push({milestoneName:n.MilestoneName,Duration:n.Duration,MilestoneStatus:n.MilestoneStatus,SetRelation:n.SetRelation})}),ProjStatus="",PMUFlag=n[0].Flag,pmugridData=n,$.each(pmugridData,function(n){pmugridData[n].Status="";pmugridData[n].MilestoneStatus="";pmugridData[n].IsApproved="";pmugridData[n].Remarks="";pmugridData[n].FileName="";pmugridData[n].StartDate="";pmugridData[n].EndDate="";pmugridData[n].UserName="";pmugridData[n].UserId=""}),subgrid_table_id=[],TemplateSubGridDisplay=!1,$("#jqgrid").jqGrid("clearGridData",!0),$("#jqgrid").jqGrid("setGridParam",{data:pmugridData}),$("#jqgrid").trigger("reloadGrid"),r=$("#jqgrid").getDataIDs(),t=0;t<r.length;t++)u=r[t],f=$("#jqgrid").getRowData(u),f.SubmilestoneExit=="True"&&(rowSequnce=f.SequenceNo,$("#jqgrid").expandSubGridRow(u));for(allData=$("#jqgrid").jqGrid("getGridParam",n),$("#selectedProjectName").val(ProjectName),$("#selectedProjectId").val(projectId),MaterialArray=[],r=$("#jqgrid").jqGrid("getGridParam","records"),i=1,t=0;t<=pmugridData.length-1;t++)pmugridData[t].Action=="true"?($("#jqg_jqgrid_"+i).prop("checked",!0),$("#jqg_jqgrid_"+i).prop("checked")==!0&&(MaterialArray.push(pmugridData[t]),$("body").addClass("menuitemshow"),$("#"+pmugridData[t].SequenceNo+"mapperUserid").val(pmugridData[t].UserId))):$("#jqg_jqgrid_"+i).prop("checked",!1),i++;$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"),$(this).attr("id"))}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"),$(this).attr("id"))}});LoadUser("mapperUser");$(".checkboxpmu").hide();sortingrecord();DisplaySubGridData();$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});e=$(".ui-jqgrid-bdiv").find("tbody").height();e>278?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","0px")}})});$("#AccepptVersionCreation").change(function(){var n=$("#ProjectId option:Selected").val();$(this).is(":checked")?$.ajax({type:"post",url:ROOT+"Milestone/GetVersion",data:{ProjectId:n},dataType:"json",success:function(n){$("#Version").val(n);$("#VersionError").text("");$("#Versionchange").show();$("#VersionRemarks").val("");$("#VersionRemarkspop").modal("show")},error:function(n){alert(n.statusText)}}):$("#Versionchange").hide()});$("#VersionAcept").click(function(){var n=$("#Version").val();n.length==0?($("#VersionError").text("Please enter the Version"),$("#userconfirmationforversion").modal("show")):$("#userconfirmationforversion").modal("hide")});$("#CancelVersion").click(function(){$("#userconfirmationforversion").modal("hide");$("#AccepptVersionCreation").prop("checked",!1)});var counter=0,Seq="",deletefiledata=[];$("#ToDeleteTheSelectedGridRow_Ok").on("click",function(){var n;rowid=deletedrow;var t=jQuery("#jqgrid").jqGrid("getRowData",fileuploadedrow),i=jQuery("#FileUploadjqgrid").jqGrid("getRowData",rowid),r=$("#ProjectId").children(":selected").attr("value");deletefiledata.push(i);n=i.FileName;$.ajax({url:ROOT+"Master/DeleteImageFile",type:"POST",dataType:"JSON",data:{fileName:n,ProjectId:r,MilestoneId:t.MilestoneId,rowNo:i.rowNo},success:function(){var i=[],r;uploadedFiles=jQuery.grep(uploadedFiles,function(t){return t.FileName!=n});i=jQuery.grep(uploadedFiles,function(t){return t.FileName!=n});i.length==0&&(r=pmugridData.findIndex(n=>n.SequenceNo==t.SequenceNo),pmugridData[r].FileName="",$("#"+t.SequenceNo+"viewuploadedfile").hide());$("#FileUploadjqgrid").jqGrid("clearGridData",!0);jQuery("#FileUploadjqgrid").jqGrid("setGridParam",{data:i});jQuery("#FileUploadjqgrid").trigger("reloadGrid");CreateJQGridFile(uploadedFiles);$("#ToDeleteTheSelectedGridRow").modal("hide");$("#dependentMilestones").modal("show");objindex=pmugridData.findIndex(n=>n.MilestoneId==t.MilestoneId);FileNamesList=[];FileNamesList=pmugridData[objindex].FileName.split(",");n='"'+n+'"';FileNamesList=jQuery.grep(FileNamesList,function(t){return t.trim()!=n});pmugridData[objindex].FileName=FileNamesList.join(",")}})});filemodels=[{name:"MilestoneId",label:"Milestone Id",resizable:!0,ignoreCase:!0,hidden:!0},{name:"RowId",label:"RowId",resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1},{name:"rowNo",label:"Milestone No",width:90,resizable:!0,ignoreCase:!0,sortable:!1,hidden:!0},{name:"MilestoneName",resizable:!0,width:100,label:"Milestone Name",ignoreCase:!0,sortable:!1,hidden:!0},{name:"FileName",resizable:!0,width:100,label:"File Name",ignoreCase:!0,sortable:!1},{name:"UploadedBy",resizable:!0,width:100,label:"Uploaded By",ignoreCase:!0,sortable:!1},{name:"UploadedDate",resizable:!0,width:100,label:"Uploaded Date",ignoreCase:!0,sortable:!1},{name:"Action",label:"Action",width:50,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t){return'<div class="grid-icons-group -justify-center" id="'+t.rowId+'DisplayIcons"><a href="javascript: void(0);" class="grid-icon-only Approveicon" onclick="DownloadUploadedImage('+t.rowId+')" class="icon_color text-success btn_button" title="Download" id="'+t.rowId+'DownloadImageOrFile"><i class="fas fa-download"><\/i><\/a><a href="javascript: void(0);" class="grid-icon-only Rejecticon"  title="Delete"><i class="fas fa-trash" onclick="deleteUploadedFile(\''+t.rowId+"')\"> <\/i><\/a><\/div>"}}];$("#btnok").click(function(){$("#dependentMilestones").modal("hide")});$("#CancelVersion").click(function(){$("#ToDeleteTheSelectedGridRow").modal("hide")});var newStr="",st="",selectedSubMilestone_id="",Pid="";var SubGridId_end="",PrevEnddate_SubGRID="",PrevDuration_SubGRID="";PrevMilestoneId="";newdata=[];$("#AddSubMilestone").click(function(){var n=[],o,r,s,u,a,t,i;newdata=[];var h=$("#SequenceNo").val(),f=$("#Name").val(),c=$("#relationtype").val(),l=$("#SubSetrelation option:Selected").val(),e=$("#SubSetrelation").val();if(f.length==" ")return alert("Please enter  the Milestone Name"),!1;if(o=$("#SubSetrelation option").length,c==""&&n>1)return alert("Please select the relation type"),!1;if($("#Duration").val()=="")return alert("Please enter the Duration"),!1;if(o>1&&l=="0")return alert("Please select the set relation"),!1;for(r={Action:"",SequenceNo:ParentSequnceNo,SubMilestoneId:h,SubMilestoneName:f,RelationType:"FS ( Sequence)",SetRelation:e==null?"":e,Duration:$("#Duration").val(),CreatedBy:"",CreadtedDate:"",Remarks:""},ParentSubgrid_data.push(r),newdata.push(r),PrevMilestoneId=ParentSequnceNo,s=pmugridData.findIndex(n=>n.SequenceNo==ParentSequnceNo),AddSubMilestoneFlag=!1,pmugridData[s].SubmilestoneExit="True",$.jgrid.gridUnload("#jqgrid"),CreateJqGrid(pmugridData),$("#loader").show(),$("#loader").css("visibility","visible"),SubMilestonestartid=parseInt(SubMilestonestartid)+1,$("#SequenceNo").val(SubMilestonestartid),$("#Name").val(""),$("#Duration").val(""),$("#relationtype").val(""),$("#MilestoneList_ErrorMilestoneList_Error").text(""),u=[],a=ParentSubgrid_data.filter(n=>n.SequenceNo==ParentSequnceNo),t=0;t<TotalSubGridData.length;t++)if(n=TotalSubGridData[t].filter(n=>n.SequenceNo==ParentSequnceNo),n.length>0){$.each(n,function(n,t){u.push({value:t.SubMilestoneId,text:t.SubMilestoneName})});break}i=$("#SubSetrelation");i.empty();i.append($("<option>").val("0").text("--Select--"));$.each(u,function(n,t){i.append($("<option>").val(t.value).text(t.text))});$("#relationtype").prop("disabled",!1);$("#SubSetrelation").prop("disabled",!1);$("#SubSetrelation").removeClass("input-disabled");$("#relationtype").removeClass("input-disabled");alert("Sub Milestone added Successfully")});var deleteSubGrid_id="",DeletedSubgrid_row="",ParentSequnceNo="";$("#ToDeleteTheSelectedSubGridRow_Ok").click(function(){var h=$("#ProjectId option:selected").val(),u=pmugridData.findIndex(n=>n.SequenceNo==ParentSequnceNo),c=pmugridData[u].MilestoneId,f="",n,t,i,s,e,r,o;if(TotalSubGridData.length!=0)for(n=0;n<TotalSubGridData.length;n++)if(t=TotalSubGridData[n].findIndex(n=>n.SubMilestoneId==DeletedSubgrid_row),t!=-1){f=TotalSubGridData[n][t].Action;TotalSubGridData[n].splice(t,1);TotalSubGridData[n].length==0&&(pmugridData[u].SubmilestoneExit=" ");break}if(i=ParentSubgrid_data.findIndex(n=>n.SubMilestoneId==DeletedSubgrid_row),i!=-1&&(f=ParentSubgrid_data[i].Action),ParentSubgrid_data.splice(i,1),(pmugridData[0].Status=="APPROVED"||pmugridData[0].Status=="SUBMITTED")&&$.ajax({url:ROOT+"Master/GetSubMilestonesCount",type:"get","async":!1,data:{MilestoneId:DeletedSubgrid_row,ProjectId:h,ParentMilestoneId:c,SequnceNo:ParentSequnceNo},success:function(){}}),s=ParentSequnceNo,TotalSubGridData[n].length==0){for(e=[],deletedSubMilestone=!0,r=0;r<TotalSubGridData.length;r++)o=TotalSubGridData[r],o.length!=0&&e.push(o);TotalSubGridData=e;pmugridData[u].SubmilestoneExit="";$("#jqgrid").jqGrid("clearGridData",!0);$("#jqgrid").jqGrid("setGridParam",{data:pmugridData});$("#jqgrid").trigger("reloadGrid")}else $.jgrid.gridUnload("#"+deleteSubGrid_id),CreateSubGrid(TotalSubGridData[n],deleteSubGrid_id),f=="true"&&SubChangeDate("1",s,deleteSubGrid_id);alert("Sub milestone deleted successfully");$("#ToDeleteTheSelectedSubGridRow").modal("hide");$("#EndNoButton").hide()});$("#btnCancel").click(function(){$("#Name").val("");$("#Duration").val("")});Submodels=[{name:"SequenceNo",label:"Sequence No",width:90,resizable:!0,hidden:!0,ignoreCase:!0,sortable:!1},{name:"SubMilestoneId",label:"Milestone No",width:120,resizable:!0,ignoreCase:!0,sortable:!1},{name:"MilestoneName",resizable:!0,width:280,label:"Milestone Name",ignoreCase:!0,sortable:!1},{name:"SetRelation",label:"Set Relation",width:120,resizable:!0,ignoreCase:!0,sortable:!1},{name:"Duration",label:"Duration",width:80,resizable:!0,ignoreCase:!0,sortable:!1},{name:"StartDate",label:"Start Date",width:105,resizable:!0,ignoreCase:!0,sortable:!1},{name:"EndDate",resizable:!0,label:"End Date",sorttype:"Date",width:105,ignoreCase:!0,sortable:!1},{name:"UpdatedStartDate",label:"Revised Start Date",width:105,resizable:!0,ignoreCase:!0,sortable:!1},{name:"UpdatedEndDate",resizable:!0,label:"Revised End Date",sorttype:"Date",width:105,ignoreCase:!0,sortable:!1},{name:"SubmilestoneExit",resizable:!0,label:"SubmilestoneExit",ignoreCase:!0,hidden:!0,sortable:!1,classes:"submilestoneexist"}];Parentmodels=[{name:"SequenceNo",label:"Milestone No",width:120,resizable:!0,ignoreCase:!0,sortable:!1},{name:"MilestoneName",resizable:!0,width:280,label:"Milestone Name",ignoreCase:!0,sortable:!1},{name:"SetRelation",label:"Set Relation",width:120,resizable:!0,ignoreCase:!0,sortable:!1},{name:"Duration",label:"Duration",width:80,resizable:!0,ignoreCase:!0,sortable:!1},{name:"StartDate",label:"Start Date",width:105,resizable:!0,ignoreCase:!0,sortable:!1},{name:"EndDate",resizable:!0,label:"End Date",sorttype:"Date",width:105,ignoreCase:!0,sortable:!1},{name:"UpdatedStartDate",label:"Revised Start Date",width:105,resizable:!0,ignoreCase:!0,sortable:!1},{name:"UpdatedEndDate",resizable:!0,label:"Revised End Date",sorttype:"Date",width:105,ignoreCase:!0,sortable:!1},{name:"SubmilestoneExit",resizable:!0,label:"SubmilestoneExit",ignoreCase:!0,hidden:!0,sortable:!1,classes:"submilestoneexist"}];$("#SaveVerionRemarks").click(function(){VersionReamrks=$("#VersionRemarks").val();var n=$("#Version").val();if(n=="")return $("#VersionError").text("Please Enter the Version"),!1;if(VersionReamrks=="")return $("#VersionRemarksError").text("Please Enter the Remarks"),!1;$("#VersionRemarkspop").modal("hide")});$("#CancelVerionRemarks").click(function(){$("#VersionRemarkspop").modal("hide");$("#AccepptVersionCreation").prop("checked",!1);$("#Versionchange").hide()});