function CreateJqGridModal(n){Historydata=n}function CreateJqGrid(n){$.jgrid.gridUnload("#jqgrid");$("#jqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:models,loadonce:!0,viewrecords:!0,sortable:!1,rowNum:1e4,multiselect:!0,beforeSelectRow:function(n,t,i){var u=$("#list").jqGrid("getRowData",n),r=$(t.target),f=r.closest("td"),e=$(this).jqGrid("getGridParam","colModel"),i=$("#jqg_jqgrid_"+n).prop("checked");return(rowselect(n,i),r.is(":checkbox"))?!1:!0},onSelectRow:function(n,t,i){console.log(i);var u=$("#list").jqGrid("getRowData",n),r=jQuery(this).find("#"+n+" input#jqg_list_"+n+"[type=checkbox]");$(r).is(":checked")&&$(r).attr("checked",!1);rowselect(n,t)},scroll:1,pager:"#pager",userDataOnFooter:!0,gridComplete:function(){var i=$("#jqgrid tbody tr"),r=$("#jqgrid tbody tr td"),t,n;if(i.length>1)for(t=$(i[1]).children("td"),n=0;n<t.length;n++)$(t[n]).css("width",$(r[n]).css("width"));for(console.log("MaterialArray",MaterialArray),n=0;n<MaterialArray.length;n++)$("#jqgrid tbody tr").each(function(t,i){$(i).find("td:nth-child(4)").text()==MaterialArray[n].SequenceNo&&(console.log("MilestoneStatus",$(i).MilestoneStatus),$(i).find("td:nth-child(1) input").attr("checked",!0),$(i).find("td:nth-child(6)").text()=="Completed"&&$(i).find("td:nth-child(1) input").attr("disabled",!0),$("#"+MaterialArray[n].SequenceNo+"start_date").val(MaterialArray[n].StartDate),$("#"+MaterialArray[n].SequenceNo+"end_date").val(MaterialArray[n].EndDate),$("#"+MaterialArray[n].SequenceNo+"mapperUserid").val(MaterialArray[n].UserId),$("#"+MaterialArray[n].SequenceNo+"mapperUser").val(MaterialArray[n].UserName))});$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"),$(this).attr("id"))}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"),$(this).attr("id"))}});LoadUser()},loadComplete:function(){var n=$("#jqgrid"),t=n.jqGrid("getCol","Amount",!1,"sum");n.jqGrid("footerData","set",{OrderQtyInPallets:"Total Amount $:"});n.jqGrid("footerData","set",{Amount:parseFloat(n.jqGrid("getCol","Amount",!1,"sum")).toFixed(2)});$(".tamounteuro").text(parseFloat(t).toFixed(2));parseInt(t)!==0?$(".tamountdlr").text(parseFloat(1/t).toFixed(2)):0}});$("#jqgrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".allownumericwithdecimal").keypress(function(n){var t=n.which?n.which:event.keyCode;if(String.fromCharCode(t).match(/[^0-9,\b]/g))return!1});$(".txtOnly").keypress(function(n){var t=n.keyCode;t>=48&&t<=57&&n.preventDefault()})}function EditUser(n){var i=$("#jqgrid").getRowData(n),t,r;usernumber=i.SequenceNo;t=$("#"+usernumber+"mapperUser").val();r=$("#"+usernumber+"mapperUserid").val();t==""&&(objindex=MaterialArray.findIndex(n=>n.SequenceNo==usernumber),MaterialArray[objindex].UserId="",MaterialArray[objindex].UserName="",objindex=pmugridData.findIndex(n=>n.SequenceNo==usernumber),pmugridData[objindex].UserId="",pmugridData[objindex].UserName="")}function LoadUser(){$.ajax({url:ROOT+"Master/UserList",type:"POST","async":!1,cache:!1,dataType:"JSON",success:function(n){availableTags=[];usersMap={};n.forEach(n=>{availableTags.push({label:n.UserName,value:n.UserId}),usersMap[n.UserName]=n.UserId});console.log("result",n);console.log("availableTags",availableTags);console.log("usersMap",usersMap);$(".tags").autocomplete({source:function(n,t){var i=n.term,e=n.term,u=[],r=[],h,o,s,c,f;i.indexOf(",")>0&&(r=i.split(/;/g),r.pop(),$.each(r,function(n,t){t=t.replace(/^\s+/,"").toLowerCase()}),h=i.lastIndexOf(","),i=i.substring(h+1));o=[];$.trim(i).length>0&&(s=i,c=new RegExp("^"+s,"i"),o=$.grep(availableTags,function(n){return $.trim(n.label).toLowerCase().indexOf(s.toLowerCase())!=-1&&(r.length==0||r.length>0&&!r.includes($.trim(n.label)))}));t($.ui.autocomplete.filter(o.slice(0,50),extractLast(i)));console.log(e,"term");e=e.split(",");e.forEach(n=>{u.push(n.trim())});console.log("terms",u);f=[];u.forEach(n=>{f.push(usersMap[n])});f.push("");u.push("");this.value=u.join(",");useridslist=f.join(",");$("#"+usernumber+"mapperUserid").val(f.join(","))},focus:function(){return!1},select:function(n,t){var u=[],r=split(this.value.trim()),f,i;return r.pop(),f=r.indexOf(t.item.label),f!=-1?alert("Duplicate selection is not allowed"):r.push(t.item.label),r.forEach(n=>{u.push(n.trim())}),i=[],u.forEach(n=>{i.push(usersMap[n])}),i.push(""),u.push(""),this.value=r.join(","),useridslist=i.join(","),$("#"+usernumber+"mapperUserid").val(i.join(",")),objindex=MaterialArray.findIndex(n=>n.MilestoneId==selectedmilestoneId),MaterialArray[objindex].UserId=i.join(","),MaterialArray[objindex].UserName=this.value,objindex=pmugridData.findIndex(n=>n.MilestoneId==selectedmilestoneId),pmugridData[objindex].UserId=i.join(","),pmugridData[objindex].UserName=this.value,$("#jqgrid").trigger("reloadGrid"),!1}})},error:function(){}})}function split(n){return n.split(/,\s*/)}function extractLast(n){return split(n).pop()}function ChangeDate(n,t){var y,p,h,f,c,r,e,k,l,i,o,w,s;if(sort){var a=parseInt(t.substring(0,2)),i=jQuery("#jqgrid").jqGrid("getRowData",n),u=t,b=$("#"+a+"SetRelation").val(),v=0;$("#jqg_jqgrid_"+n).prop("checked")==!1&&($("#"+a+"start_date").val(""),objIndex=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),pmugridData[objIndex].StartDate="",alert("Milestone are not selected for this for project"));n>1&&(y=moment($("#"+b+"end_date").val(),"DD-MM-YYYY"),p=moment($("#"+u+"start_date").val(),"DD-MM-YYYY"),y>p&&(alert("Selected date must be after the relation milestone end date"),$("#"+u+"start_date").val(""),$("#"+u+"end_date").datepicker("setDate","")));for(let t of pmugridData)for(h=1;h<=pmugridData.length;h++)if($("#jqg_jqgrid_"+h).prop("checked")==!0){if(i=jQuery("#jqgrid").jqGrid("getRowData",n),f=$("#"+i.SequenceNo+"start_date").val(),t.MilestoneName==i.MilestoneName){if(v++,console.log("changedmilestoneId",u),$("#jqg_jqgrid_"+n).prop("checked")==!0&&(c=moment(f,"DD/MM/YYYY"),r="",r=setrelationchanged?moment(c).add(t.Duration,"days").format("DD/MM/YYYY"):moment(c).add(t.Duration-1,"days").format("DD/MM/YYYY"),console.log("Enddate",r),$("#"+i.SequenceNo+"end_date").val(r),$("#"+i.SequenceNo+"end_date").datepicker("setDate",r),objIndex=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),pmugridData[objIndex].EndDate=r,pmugridData[objIndex].StartDate=f,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==i.SequenceNo),MaterialArray[objIndex].EndDate=r,MaterialArray[objIndex].StartDate=f),e=parseInt(n)+1,k=parseInt(u)+1,console.log("nextRowId",e),$("#jqg_jqgrid_"+e).prop("checked")==!0)l="",i=jQuery("#jqgrid").jqGrid("getRowData",e),i.MilestoneStatus!="Completed"&&v!=DurationList.length&&(o=$("#"+i.SequenceNo+"SetRelation").val(),console.log("seq",i.SequenceNo),console.log("set",o),o=o.split(","),FindRowIDsequnce=Math.max.apply(Math,o),l=$("#"+FindRowIDsequnce+"end_date").val(),w=new Date(l.split("/").reverse().join("-")),s=moment(w).add(1,"days").format("DD/MM/YYYY"),$("#"+i.SequenceNo+"start_date").val(s),$("#"+i.SequenceNo+"start_date").datepicker("setDate",s),objIndex=pmugridData.findIndex(n=>n.SequenceNo==i.SequenceNo),pmugridData[objIndex].StartDate=s,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==i.SequenceNo),MaterialArray[objIndex].StartDate=s);else{n++;break}f=$("#"+e+"start_date").val();n++}}else break}else sort=!1,alert("Please click on refresh button for sorting the records based on dependancy")}function EndChangeDate(n){var v=!1,r=jQuery("#jqgrid").jqGrid("getRowData",n),o,s,c,l,a,f;$("#jqg_jqgrid_"+n).prop("checked")==!1&&($("#"+r.SequenceNo+"end_date").val(""),objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo),pmugridData[objIndex].StartDate="");objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo);pmugridData[objIndex].EndDate=$("#"+r.SequenceNo+"end_date").val();changedmilestoneId=r.SequenceNo;var ut=parseInt($("#"+changedmilestoneId+"SetRelation").val()),y=$("#"+changedmilestoneId+"start_date").val().split("/").join("-"),p=$("#"+changedmilestoneId+"end_date").val().split("/").join("-"),w=new Date(y.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),b=new Date(p.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),k=w-b,d=k/864e5,e=Math.round(Math.abs(d));$("#"+changedmilestoneId+"Duration").val(e+1);durationflag?DurationList.forEach(function(t,i){i==n-1&&(DurationList[i].Duration=e)}):DurationList.forEach(function(t,i){i==n-1&&(DurationList[i].Duration=e+1)});objIndex=searchresult.findIndex(n=>n.SequenceNo==r.SequenceNo);searchresult[objIndex].Duration=e+1;console.log("After",searchresult);var i=parseInt(n)+1,h=changedmilestoneId,ft=parseInt(changedmilestoneId)+1;for(o=1;o<=pmugridData.length-1;o++){if($("#jqg_jqgrid_"+o).prop("checked")==!0)for(s=0;s<=pmugridData.length-1;s++){var r=jQuery("#jqgrid").jqGrid("getRowData",i),g=moment($("#"+n+"start_date").val(),"DD-MM-YYYY"),nt=moment($("#"+n+"end_date").val(),"DD-MM-YYYY");if(issetrelationchanged&&g>nt){alert("End date should be greater than Start date");$("#jqgrid").jqGrid("getLocalRow",h).EndDate="";$("#"+h+"end_date").val("");$("#"+h+"end_date").datepicker("setDate","");v=!0;break}if($("#jqg_jqgrid_"+i).prop("checked")==!0){if(pmugridData[s].MilestoneName==r.MilestoneName){if(c=jQuery("#jqgrid").jqGrid("getRowData",i),c.MilestoneStatus!="Completed"){var t=c.SequenceNo,tt=$("#"+t+"SetRelation").val(),it=$("#"+tt+"end_date").val(),rt=new Date(it.split("/").reverse().join("-")),u=moment(rt).add(1,"days").format("DD/MM/YYYY");$("#jqg_jqgrid_"+i).prop("checked")==!0&&($("#"+t+"start_date").val(u),$("#"+t+"start_date").datepicker("setDate",u),objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].StartDate=u,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==t),MaterialArray[objIndex].StartDate=u)}l=new Date(u.split("/").reverse().join("-"));a=$("#"+t+"Duration").val();f=durationflag?moment(l).add(a,"days").format("DD/MM/YYYY"):moment(l).add(a-1,"days").format("DD/MM/YYYY");$("#jqg_jqgrid_"+i).prop("checked")==!0&&($("#"+t+"end_date").val(f),$("#"+t+"end_date").datepicker("setDate",f),objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].EndDate=f,objIndex=MaterialArray.findIndex(n=>n.SequenceNo==t),MaterialArray[objIndex].EndDate=f);i++}}else i++}if(v)break}$("#jqgrid").jqGrid("getLocalRow",i).StartDate=""}function rowselect(n,t){var p=!0,r,f,e,a,o,h,c,w,s,d,u,y,l,i;if(selectedrowid=n,r=$("#jqgrid").getRowData(n),selectedmilestoneId=r.MilestoneId,console.log("rowData",r),beforesetrelation=$("#"+r.SequenceNo+"SetRelation").val(),beforeDuration=$("#"+r.SequenceNo+"Duration").val(),f=r.SequenceNo,allData=$("#jqgrid").jqGrid("getGridParam","data"),t==!0){if(beforesetrelation=="")alert("Please enter the set relation for this milestone"),$("#jqgrid").jqGrid("setCell",n,"Action",0),$("#jqg_jqgrid_"+n).prop("checked",!1);else if(setrelationchanged=!1,selectedrowid=="1"&&(objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo),pmugridData[objIndex].Action="true"),beforesetrelation==undefined&&(i=-1,i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),i==-1&&MaterialArray.push(pmugridData[objIndex])),objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo),pmugridData[objIndex].Action="true",i=-1,i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),i==-1&&MaterialArray.push(pmugridData[objIndex]),e=$("#"+f+"SetRelation").val(),e!=undefined)for(e=e.split(","),a=$("#jqgrid").jqGrid("getGridParam","data"),o=0;o<=e.length-1;o++){for(u=0;u<=a.length-1;u++)if(a[u].SequenceNo==e[o]&&(objindex1=pmugridData.findIndex(n=>n.SequenceNo==e[o]),t==!0))if(pmugridData[objindex1].Action==null||pmugridData[objindex1].Action==""){alert("Dependent Milestones are not mapped!! ");$("#jqg_jqgrid_"+n).prop("checked",!1);$("#jqgrid").jqGrid("setCell",n,"Action",0);pmugridData[objIndex].Action="";i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);i>0&&MaterialArray.splice(i,1);h=!0;break}else{if(objIndex=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),pmugridData[objIndex].Action="true",i=-1,i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),i==-1&&MaterialArray.push(pmugridData[objIndex]),beforesetrelation=Math.max.apply(Math,e),objIndex=pmugridData.findIndex(n=>n.SequenceNo==beforesetrelation),c=pmugridData[objIndex].EndDate,c!=undefined&&c!=""){w=new Date(c.split("/").reverse().join("-"));s=moment(w).add(1,"days").format("DD/MM/YYYY");$("#"+f+"start_date").val(s);var b=new Date(s.split("/").reverse().join("-")),k=$("#"+f+"Duration").val(),v=moment(b).add(k-1,"days").format("DD/MM/YYYY");$("#"+f+"end_date").val(v);i=pmugridData.findIndex(n=>n.SequenceNo==f);pmugridData[i].StartDate=s;pmugridData[i].EndDate=v;i=MaterialArray.findIndex(n=>n.SequenceNo==f);MaterialArray[i].StartDate=s;MaterialArray[i].EndDate=v}break}if(h)break}}else if($("#jqg_jqgrid_"+n).prop("checked")==!1){for(d=!0,u=0;u<=pmugridData.length-1;u++){if(pmugridData[u].SetRelation!=null)for(y=pmugridData[u].SetRelation.split(","),l=0;l<=y.length-1;l++)if(y[l]==f&&(console.log("obj.rowidNo",pmugridData[u].rowidNo),pmugridData[u].Action=="true")){alert("Please check whether the below milestone(s) are dependent on the current milestone");$("#jqgrid").jqGrid("setCell",allData[u].SequenceNo,"Action",1);$("#jqg_jqgrid_"+n).prop("checked",!0);p=!1;h=!0;i=-1;i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName);i==-1&&MaterialArray.push(allData[u-1]);break}if(h)break}p&&($("#"+f+"start_date").val(""),$("#"+f+"end_date").val(""),$("#"+f+"mapperUser").val(""),i=-1,i=MaterialArray.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),i>=0&&MaterialArray.splice(i,1),$("#jqg_jqgrid_"+n).prop("checked",!1),DurationList=DurationList.filter(function(n){return n.milestoneName!==r.MilestoneName}),$("#jqgrid").jqGrid("setCell",f,"Action",0),i=-1,i=pmugridData.findIndex(n=>n.SequenceNo==r.SequenceNo&&n.MilestoneName==r.MilestoneName),i>=0&&(pmugridData[i].StartDate="",pmugridData[i].EndDate="",pmugridData[i].UserId="",pmugridData[i].UserName="",pmugridData[i].Action=""))}}function SortByName(n,t){var i=parseInt(n.SetRelation),r=parseInt(t.SetRelation);return i<r?-1:i>r?1:0}function ChangeSetRelation(n,t){var o=!0,i=jQuery("#jqgrid").jqGrid("getRowData",n),s=$("#"+i.SequenceNo+"SetRelation").val(),r,l,a,u,h,f,c,e;if(s=="0"&&(alert("Please enter valid Set Relation"),$("#"+i.SequenceNo+"SetRelation").val(beforesetrelation)),allData=$("#jqgrid").jqGrid("getGridParam","data"),r=s.split(","),FindRowIDsequnce=Math.max.apply(Math,r),objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].SetRelation=s,objIndex=pmugridData.findIndex(n=>n.SequenceNo==FindRowIDsequnce),l=allData.findIndex(n=>n.SequenceNo==FindRowIDsequnce),objIndex>=0){if(pmugridData[objIndex].Action=="true"){for(a=FindRowIDsequnce,u=0;u<=r.length-1;u++)if(t<=r[u]){t==r[u]?(o=!1,sort=!1,alert("please enter valide Set Relation "),$("#"+t+"SetRelation").val(beforesetrelation)):(sortingrecord(),o=!0);break}console.log("After",pmugridData);setrelationchanged=!0;o&&(isinvalide=0,h=pmugridData[objIndex].EndDate,f=h,f!=""&&f!=undefined?(c=moment(f,"DD/MM/YYYY"),e=moment(c).add(1,"days").format("DD/MM/YYYY"),$("#"+t+"start_date").val(e),$("#"+t+"start_date").datepicker("setDate",e),issetrelationchanged=!1,objIndex=pmugridData.findIndex(n=>n.SequenceNo==t),pmugridData[objIndex].StartDate=e,console.log("After",pmugridData),objIndex=DurationList.findIndex(n=>n.milestoneName==i.MilestoneName),console.log("Before update: ",DurationList[objIndex]),objIndex!=-1&&(DurationList[objIndex].SetRelation=$("#"+t+"SetRelation").val()),console.log("After update: ",DurationList[objIndex]),objIndex=searchresult.findIndex(n=>n.MilestoneName==i.MilestoneName),objIndex!=-1&&(searchresult[objIndex].SetRelation=$("#"+t+"SetRelation").val()),objIndex=allData.findIndex(n=>n.MilestoneName==i.MilestoneName),console.log("Before update: ",allData[objIndex]),console.log("SetRelation",$("#"+t+"SetRelation").val()),objIndex!=-1&&(allData[objIndex].SetRelation=$("#"+t+"SetRelation").val()),console.log("After update: ",allData[objIndex]),setrelationchanged=durationflag==!1?!1:!0,sort=!0,sortingrecord(),ChangeDate(n,t+"start_date")):(objIndex=DurationList.findIndex(n=>n.milestoneName==i.MilestoneName),console.log("Before update: ",DurationList[objIndex]),objIndex!=-1&&(DurationList[objIndex].SetRelation=$("#"+t+"SetRelation").val()),console.log("After update: ",DurationList[objIndex]),objIndex=searchresult.findIndex(n=>n.MilestoneName==i.MilestoneName),objIndex!=-1&&(searchresult[objIndex].SetRelation=$("#"+t+"SetRelation").val()),console.log("After update: ",searchresult[objIndex]),objIndex=allData.findIndex(n=>n.MilestoneName==i.MilestoneName),console.log("Before update: ",allData[objIndex]),console.log("SetRelation",$("#"+t+"SetRelation").val()),objIndex!=-1&&(allData[objIndex].SetRelation=$("#"+t+"SetRelation").val())))}}else alert("Changed setrelation in not selected"),$("#"+i.SequenceNo+"SetRelation").val("")}function ChangeDuration(n,t){var u=jQuery("#jqgrid").jqGrid("getRowData",n),o=parseInt(n),i=$("#"+t+"Duration").val(),f,e,r;changedDuration=i;console.log(MaterialArray);objIndex=MaterialArray.findIndex(n=>n.SequenceNo==u.SequenceNo);objIndex>0&&(MaterialArray[objIndex].Duration=$("#"+t+"Duration").val(),console.log("After",MaterialArray));i=="0"&&(alert("Please enter valid Duration"),$("#"+t+"Duration").val(beforeDuration));i=$("#"+t+"Duration").val();$.each(DurationList,function(t){t==n-1&&(DurationList[t].Duration=i)});console.log("ChangeDuration",DurationList);objIndex=searchresult.findIndex(n=>n.SequenceNo==u.SequenceNo);searchresult[objIndex].Duration=$("#"+t+"Duration").val();console.log("ChangeDuration",searchresult);f=$("#"+t+"start_date").val();f!=""&&(e=moment(f,"DD/MM/YYYY"),r=moment(e).add(i-1,"days").format("DD/MM/YYYY"),$("#"+t+"end_date").val(r),$("#"+t+"end_date").datepicker("setDate",r),objIndex=pmugridData.findIndex(n=>n.SequenceNo==u.SequenceNo),pmugridData[objIndex].EndDate=r,pmugridData[objIndex].Duration=$("#"+t+"Duration").val(),console.log("After",pmugridData),t=t.toString(),t=t.concat("start_date"),durationflag=!1,EndChangeDate(n,t))}function SortByDate(n,t){if(n.StartDate!=""&&t.EndDate!=""){var i=n.StartDate.split("/"),u=new Date(i[1]+","+i[0]+","+i[2]).getTime(),r=t.EndDate.split("/"),f=new Date(r[1]+","+r[0]+","+r[2]).getTime();return u<f?-1:u>f?1:0}}function sortingrecord(){var t,i,n,u,r,f;for(gridselectedrow=[],gridselectedrow.push(pmugridData[0]),t=0;t<=MaterialArray.length-1;t++)for(i=MaterialArray.filter(n=>n.SetRelation==gridselectedrow[t].SequenceNo),n=0;n<=i.length-1;n++)u=gridselectedrow.findIndex(t=>t.SequenceNo==i[n].SequenceNo),u==-1&&(gridselectedrow.push(i[n]),console.log("gridselectedrow",gridselectedrow));console.log("gridselectedrow",gridselectedrow);console.log("MaterialArray",MaterialArray);r=gridselectedrow;f=pmugridData.filter(n=>n.Action==null||n.Action=="");Array.prototype.push.apply(r,f);pmugridData=[];pmugridData=r;$("#jqgrid").jqGrid("clearGridData",!0);$("#jqgrid").jqGrid("setGridParam",{data:pmugridData});sort=!0;$("#jqgrid").trigger("reloadGrid")}var ProjStatus,PMUFlag,changedprojectId=0,changedmilestoneId=0,checkedmilestones=[],golbalsequencenumber=1,usertextid="",searchresult=[],milestoneconut="",DefaultArray=[],DurationList=[],projectId="",ProjectName="",selectedval="n",pmudetails=[],isinvalide=0,display="s",issetrelationchanged=!0,usernumber="",pmugridData=[],durationflag=!1,setrelationchanged=!1,beforesetrelation="",beforeDuration="",MaterialArray=[],changedDuration="",selectedmilestoneId="",useridslist="",compltedmilestone=!0,sort=!0,gridselectedrow=[],models=[{name:"MilestoneId",label:"Milestone Id",width:60,resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1},{name:"RowId",label:"RowId",resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1,formatter:function(){}},{name:"SequenceNo",label:"Milestone No",width:60,resizable:!0,ignoreCase:!0,sortable:!1},{name:"MilestoneName",resizable:!0,width:150,label:"Milestone Name",ignoreCase:!0,sortable:!1},{name:"MilestoneStatus",resizable:!0,width:150,hidden:!0,label:"Milestone Name",ignoreCase:!0,sortable:!1},{name:"rowidNo",resizable:!0,width:150,hidden:!0,label:"Milestone Name",ignoreCase:!0,formatter:function(n,t,i){return i.rowidNo=t.rowId}},{name:"SetRelation",label:"Set Relation",width:60,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return i.SequenceNo==1?($("#1SetRelation").hide(),""):n==undefined?'<input type="text"   data-id="'+t.rowId+'" id="'+i.SequenceNo+'SetRelation" class="form-control allownumericwithdecimal"  onchange="ChangeSetRelation('+t.rowId+","+i.SequenceNo+')" />':i.MilestoneStatus=="Completed"?'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'SetRelation" value="'+i.SetRelation+'" class="form-control allownumericwithdecimal"  onchange="ChangeSetRelation('+t.rowId+","+i.SequenceNo+')" readonly />':'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'SetRelation" value="'+i.SetRelation+'" class="form-control allownumericwithdecimal"  onchange="ChangeSetRelation('+t.rowId+","+i.SequenceNo+')"  />'}},{name:"RelationType",label:"RelationType",width:100,resizable:!0,ignoreCase:!0,hidden:!0,sortable:!1},{name:"Duration",label:"Duration",width:60,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text" data-id="'+t.rowId+'"    id="'+i.SequenceNo+'Duration" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')" />':i.MilestoneStatus=="Completed"?'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'Duration" value="'+i.Duration+'" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')" readonly />':'<input type="text" data-id="'+t.rowId+'" id="'+i.SequenceNo+'Duration" value="'+i.Duration+'" class="form-control duration allownumericwithdecimal" placeholder="Duration" onchange="ChangeDuration('+t.rowId+","+i.SequenceNo+')"  />'}},{name:"StartDate",label:"Start Date",width:100,resizable:!0,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text" class="form-control datepickerS" data-id="'+t.rowId+'"id="'+i.SequenceNo+'start_date"  placeholder="dd/mm/yyyy"/>':i.MilestoneStatus=="Completed"?'<input type="text" class="form-control" data-id="'+t.rowId+'"value="'+i.StartDate+'" id="'+i.SequenceNo+'start_date"  placeholder="dd/mm/yyyy" readonly/>':'<input type="text" class="form-control datepickerS" data-id="'+t.rowId+'"value="'+i.StartDate+'" id="'+i.SequenceNo+'start_date"  placeholder="dd/mm/yyyy" />'}},{name:"EndDate",resizable:!0,label:"End Date",sorttype:"Date",width:100,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text" class="form-control datepickerE" data-id="'+t.rowId+'" id="'+i.SequenceNo+'end_date" placeholder="dd/mm/yyyy"/>':i.MilestoneStatus=="Completed"?'<input type="text" class="form-control" data-id="'+t.rowId+'" value="'+i.EndDate+'" id="'+i.SequenceNo+'end_date"  placeholder="dd/mm/yyyy" readonly/>':'<input type="text" class="form-control datepickerE" data-id="'+t.rowId+'" value="'+i.EndDate+'" id="'+i.SequenceNo+'end_date"  placeholder="dd/mm/yyyy" />'}},{name:"userid",resizable:!0,label:"User(s)",ignoreCase:!0,hidden:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text"   id="'+i.SequenceNo+'mapperUserid" class="form-control tagsid" placeholder="user" />':'<input type="text" id="'+i.SequenceNo+'mapperUserid" value="'+i.UserName+'" class="form-control tags" placeholder="user" />'}},{name:"UserName",resizable:!0,label:"User(s)",ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return n==undefined?'<input type="text"  id="'+i.SequenceNo+'mapperUser" class="form-control tags txtOnly"  placeholder="user" onchange="EditUser('+t.rowId+')"/>':i.MilestoneStatus=="Completed"?'<input type="text" id="'+i.SequenceNo+'mapperUser" value="'+i.UserName+'" class="form-control tags txtOnly" placeholder="user" onchange="EditUser('+t.rowId+')" readonly/>':'<input type="text" id="'+i.SequenceNo+'mapperUser" value="'+i.UserName+'" class="form-control tags txtOnly" placeholder="user" onchange="EditUser('+t.rowId+')"/>'}},],data,Historydata;$(document).ready(function(){function u(n){e=n;$(".txtOnly").keypress(function(n){var t=n.keyCode;t>=48&&t<=57&&n.preventDefault()})}function s(){var n=[],r,c,h,v,e,s,w,a,i,y;for($("#multipleSelect option:selected").each(function(){var n=$(this),t;n.length&&(t=n.text(),o.push(t))}),r=[],c=$("#multipleSelect").val(),h=0;h<=c.length-1;h++)v=f.filter(function(n){return n.SequenceNo==c[h]}),r.push(v[0]);for(e=0;e<=r.length-1;e++)n.push({SequenceNo:r[e].SequenceNo,MilestoneId:r[e].MilestoneId,MilestoneName:r[e].MilestoneName,SetRelation:r[e].SetRelation,Duration:r[e].Duration});console.log(n,"result");s=$("#jqgrid").jqGrid("getGridParam","data");console.log("dropdown",n);console.log("griddata",s);const p=s.filter({SequenceNo:t}=>n.some({SequenceNo:n}=>n==t));t=p;s=[];console.log(t,"newresult");s=t;const l=n.filter({SequenceNo:n}=>!t.some({SequenceNo:t}=>t==n));for(console.log(l,"diff"),i=0;i<=l.length-1;i++)s.push(l[i]);if(console.log("griddata",s),n.length>0){for(pmugridData=s,$.each(pmugridData,function(n){n!=0&&(objindex=pmugridData.findIndex(t=>t.SequenceNo==pmugridData[n].SetRelation),objindex==-1&&(pmugridData[n].SetRelation=""))}),$(".projectName_error").css("display","none"),$("#jqgrid").jqGrid("clearGridData",!0),$("#jqgrid").jqGrid("setGridParam",{data:pmugridData}),$("#jqgrid").trigger("reloadGrid"),CreateJqGrid(pmugridData),u(pmugridData),w=$("#jqgrid").jqGrid("getGridParam","records"),a=1,i=0;i<=searchresult.length-1;i++)searchresult[i].Action=="true"&&($("#jqg_jqgrid_"+a).prop("checked",!0),$("body").addClass("menuitemshow"),$("#"+searchresult[i].SequenceNo+"mapperUserid").val(searchresult[i].UserId)),a++;$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"))}});n[0].Status=="SUBMITTED"&&($(".approve_btn").css("display","inline-block"),$(".Mistonelistdiv").css("display","block"));n[0].Status=="APPROVED"&&($(".save_btn").css("display","none"),$(".approve_btn").css("display","none"));n[0].Status==""&&$(".approve_btn").css("display","none");$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});y=$(".ui-jqgrid-bdiv").find("tbody").height();y>280?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","0px")}else $(".projectName_error").css("display","block"),$(".projectName_error").text("Please select the milestones"),$("#jqgrid").jqGrid("clearGridData",!0),$("#jqgrid").jqGrid("setGridParam",{data:n}),$("#jqgrid").trigger("reloadGrid")}var i,n,r,e;$("#milestonedropdown").css("display","none");$("#SaveModel1").hide();$("[data-multiselect]").multiselect({includeSelectAllOption:!0,buttonWidth:220,enableCaseInsensitiveFiltering:!0,enableFiltering:!0});DurationList=[];searchresult=[];n=$("#ProjectId").val();$("[data-singleselect]").select2();$("#ProjectId").val()!==null&&$("#ProjectId").val()!==""&&typeof $("#ProjectId").val()!="undefined"?($("#milestonedropdown").css("display","block"),i=$("#selectedProjectName").val(),n=$("#selectedProjectId").val(),$(".projectName_error").hide(),display="N",$("div.id_100 select").select2().val(n).change(),r={ProjectName:i,ProjectId:parseInt(n)},$.ajax({dataType:"json",url:ROOT+"Master/NewProjectmappingList",type:"POST",data:{pMUMapping:r},success:function(n){var i,f,e,o,r,t,s;if(console.log("data",n),display="s",ProjStatus=n[0].Status,PMUFlag=n[0].Flag,n[0].Status=="SUBMITTED"&&($(".approve_btn").css("display","inline-block"),$(".Mistonelistdiv").css("display","block"),$(".checkboxpmu").css("display","none")),n[0].Status=="APPROVED"&&($(".save_btn").css("display","none"),$(".approve_btn").css("display","none"),$(".checkboxpmu").css("display","block")),n[0].Status==""&&($(".approve_btn").css("display","none"),$(".checkboxpmu").css("display","none")),n.forEach(n=>{n.StartDate!=""&&n.EndDate!=""&&DurationList.push({milestoneName:n.MilestoneName,Duration:n.Duration,MilestoneId:n.MilestoneId})}),n[0].StartDate==null&&n[0].EndDate==null&&(n=[]),i=$("#multipleSelect").val(),i.length>0){for(t in i)f=i[t],$("#multipleSelect option[value="+f+"]").prop("selected",!1);$("#multipleSelect").multiselect("refresh")}if(n.length>0){for(t in n)e=n[t].SequenceNo,$("#multipleSelect").find("option[value="+e+"]").prop("selected","selected");$("#multipleSelect").multiselect("refresh");$(".projectName_error").css("display","none")}for(searchresult=n,pmugridData=n,o=searchresult.find(n=>n.projectFlag==="p"),o!=undefined&&(searchresult=[]),MaterialArray=searchresult,pmugridData=searchresult,CreateJqGrid(n),u(n),n.forEach(n=>{pmudetails.push({Duration:n.Duration,MilestoneName:n.MilestoneName,RelationType:n.RelationType,SequenceNo:n.SequenceNo,SetRelation:n.SetRelation})}),r=1,t=0;t<=searchresult.length-1;t++)searchresult[t].Action=="true"&&($("#jqg_jqgrid_"+r).prop("checked",!0),$("body").addClass("menuitemshow"),$("#"+searchresult[t].SequenceNo+"mapperUserid").val(searchresult[t].UserId)),r++;$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"))}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"))}});$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});s=$(".ui-jqgrid-bdiv").find("tbody").height();s>280?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","0px")},error:function(){}})):(selected="s",$("div.id_100 select").select2().val(n).change(),$(".submit_btn").css("display","none"),$(".Mistonelistdiv").css("display","none"),$(".checkboxpmu").css("display","none"),$(".projectName_error").html("Please Select Project Name"));$(".ui-th-div").removeClass("ui-jqgrid-sortable");$(".save_btn").on("click",function(){var r,n,t,i;if(DefaultArray=$("#jqgrid").jqGrid("getGridParam","data"),r=$("#jqgrid").jqGrid("getGridParam","records"),n=[],$.each(pmugridData,function(t,i){i.Action=="true"&&n.push(i)}),n.length==0)return alert("Please select the check box "),!1;if($.each(n,function(n,t){console.log(t.SequenceNo);t.LineItemNo=n+1;t.ProjectId=$("#ProjectId option:Selected").val();t.CreatedBy=$("#LoggedinUser").val();t.Action="";t.Status="0";t.MilestoneStatus="Open";t.projectFlag="p"}),t=0,$.each(n,function(n,i){(i.UserName==0||i.UserName=="")&&(t=1)}),t===1)return alert("Please Enter User"),!1;Griddata=JSON.stringify(n);i="SAVE";$.ajax({url:ROOT+"Master/PMUMapping",type:"POST",data:{Griddata:Griddata,flag:i},success:function(){location.reload()}})});$(".approve_btn").on("click",function(){$("#ApproveModal").show()});$("#OkApproval").on("click",function(){var u,t;if(changedmilestoneIdList=[],u=$("#jqgrid").jqGrid("getGridParam","records"),t=[],$.each(pmugridData,function(n,i){i.Action=="true"&&t.push(i)}),t.length==0)return alert("Please select the check box "),!1;$.each(t,function(t,i){i.LineItemNo=t+1;i.ProjectId=n;i.CreatedBy=$("#LoggedinUser").val();i.Status="1";i.MilestoneStatus="Open";i.projectFlag="p"});var i=0,r="";if($.each(t,function(n,t){(t.UserName==0||t.UserName=="")&&(i=1);(t.StartDate==""||t.EndDate=="")&&(r=1)}),!1)return alert("Please Enter the Set Relation"),!1;if(0)return alert("Please Enter the Duration"),!1;if(r===1)return alert("Please select the Date"),!1;if(i===1)return alert("Please Enter User"),!1;Griddata=JSON.stringify(t);n!=""&&$.ajax({url:ROOT+"Master/PMUMapping",type:"POST",data:{Griddata:Griddata,flag:"APPROVED",projectId:n,changedmilestoneId:changedmilestoneId},success:function(){location.reload()}})});$(".data-datepicker").datepicker({format:"dd-mm-yyyy",todayHighlight:!0,autoclose:!0});$("#SaveModel").on("click",function(){var s,t,e,o;if(DefaultArray=$("#jqgrid").jqGrid("getGridParam","data"),n=$("#ProjectId").children(":selected").attr("value"),s=$("#jqgrid").jqGrid("getGridParam","records"),t=[],pmugridData[0].SetRelation="0",$.each(pmugridData,function(n,i){i.Action=="true"&&t.push(i)}),console.log("myCellData",t),t.length==0)return alert("Please select the check box "),!1;$.each(t,function(t,i){i.LineItemNo=t+1;i.ProjectId=n;i.CreatedBy=$("#LoggedinUser").val();i.Status="1";i.MilestoneStatus="Open";i.projectFlag="p"});console.log("myCellData",t);var i=0,r="",u="",f="";if($.each(t,function(n,t){(t.UserName==""||t.UserId==""||t.UserId==undefined)&&(i=1);(t.StartDate==""||t.EndDate=="")&&(r=1);t.SetRelation==""&&(u=1);t.Duration==""&&(f=1)}),u===1)return alert("Please Enter the Set Relation"),!1;if(f===1)return alert("Please Enter the Duration"),!1;if(r===1)return alert("Please select the Date"),!1;if(i===1)return alert("Please Enter User"),!1;Griddata=JSON.stringify(t);e=ProjStatus=="APPROVED"?" ":"SUBMIT";console.log("AccepptVersionCreation",$("#AccepptVersionCreation").prop("checked"));o=$("#AccepptVersionCreation").prop("checked");n!=""?$.ajax({url:ROOT+"Master/PMUMapping",type:"POST",dataType:"JSON",data:{Griddata:Griddata,flag:e,projectId:n,changedmilestoneId:changedmilestoneId,AccepptVersionCreation:o},success:function(){location.reload()},error:function(n,t,i){console.log("err",n,t,i)}}):$(".projectName_error").html("Please Select Project Name")});var o=[],t=[],f=[];$("#btnAdd").on("click",function(){var n="",t=$("#multipleSelect").val();$.each(t,function(i){n=n.concat(",",t[i])});console.log(n,"selectedmiletonesList");$.ajax({url:ROOT+"Master/MilestoneBasedDuration",type:"POST",dataType:"JSON",data:{MilestoneName:n},success:function(n){console.log("result",n);f=n;s()},error:function(n,t,i){console.log("err",n,t,i)}})})});data=JSON.parse("{}");var availableTags=[],usersMap={},availabledata=[];$(".tags").keyup(function(n){n.keyCode==8&&alert("backspace trapped")});$("#ProjectId").on("change",function(){var t;if(display=="s"){DurationList=[];searchresult=[];MaterialArray=[];$("#milestonedropdown").css("display","block");var i=$("#ProjectId option:Selected").text(),n=$("#ProjectId").val(),t={ProjectName:i,ProjectId:parseInt(n)};n=="0"?($(".projectName_error").show(),$(".Mistonelistdiv").css("display","none"),$(".checkboxpmu").css("display","none"),$(".projectName_error").html("Please Select Project Name"),$.ajax({url:ROOT+"Master/NewProjectmappingList",type:"POST",data:{pMUMapping:t},dataType:"JSON",success:function(n){console.log("result",n);$("#jqgrid").jqGrid("clearGridData",!0);$(".approve_btn").css("display","none")}})):(console.log("project name changed"),$(".projectName_error").html(""),$("#SaveModel").show(),$("#SaveModel1").show(),$(".Mistonelistdiv").css("display","black"),$(".checkboxpmu").css("display","none"),DefaultArray=$("#jqgrid").jqGrid("getGridParam","data"),t={ProjectName:i,ProjectId:parseInt(n)},$.ajax({url:ROOT+"Master/NewProjectmappingList",type:"POST",data:{pMUMapping:t},dataType:"JSON",success:function(n){var f,r,e,o,i,s,c,u,t,h;if(console.log("result",n),f=n.find(n=>n.projectFlag==="p"),f!=undefined)n=[],$("#ApproveModal").hide(),$(".Mistonelistdiv").hide(),$(".projectName_error").hide(),$(".approve_btn").css("display","none"),alert("Details about this project can be found in the PMU mapping page"),$("#loader").css("visibility","hidden"),CreateJqGrid(n);else{if(ProjStatus=n[0].Status,PMUFlag=n[0].Flag,n[0].Status=="SUBMITTED"&&($(".approve_btn").css("display","inline-block"),$(".Mistonelistdiv").css("display","block"),$(".checkboxpmu").css("display","none")),n[0].Status=="APPROVED"&&($(".save_btn").css("display","none"),$(".approve_btn").css("display","none"),$(".checkboxpmu").css("display","block")),n[0].Status==""&&($(".approve_btn").css("display","none"),$(".Mistonelistdiv").css("display","block"),$(".checkboxpmu").css("display","none")),n[0].StartDate==null&&n[0].EndDate==null&&(n=[]),r=$("#multipleSelect").val(),r.length>0){for(t in r)e=r[t],$("#multipleSelect option[value="+e+"]").prop("selected",!1);$("#multipleSelect").multiselect("refresh")}if(n.length>0){for(t in n)o=n[t].SequenceNo,$("#multipleSelect").find("option[value="+o+"]").prop("selected","selected");$("#multipleSelect").multiselect("refresh");$(".projectName_error").css("display","none")}for($.each(n,function(n,t){t.SequenceNo=n+1}),pmugridData=n,i=pmugridData.filter(n=>n.Action!=null&&n.Action!=""),i=i.sort(SortByDate),console.log("selectedmilestonedata",i),s=pmugridData.filter(n=>n.Action==null||n.Action==""),Array.prototype.push.apply(i,s),pmugridData=i,CreateJqGrid(n),searchresult=n,c=$("#jqgrid").jqGrid("getGridParam","records"),u=1,t=0;t<=searchresult.length-1;t++)searchresult[t].Action=="true"&&($("#jqg_jqgrid_"+u).prop("checked",!0),MaterialArray.push(searchresult[t]),$("body").addClass("menuitemshow"),$("#"+searchresult[t].SequenceNo+"mapperUserid").val(searchresult[t].UserId)),u++;$(".datepickerS").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){ChangeDate($(this).attr("data-id"))}});$(".datepickerE").datepicker({dateFormat:"dd/mm/yy",autoclose:!0,onSelect:function(){EndChangeDate($(this).attr("data-id"))}});$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});h=$(".ui-jqgrid-bdiv").find("tbody").height();h>280?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","0px")}}}))}});$(".displaycheck").on("change",function(){var n=$("#AccepptVersionCreation").prop("checked");n==!0&&alert("Are you sure do you want to create new version ?")});$("#Addmilestone").on("click",function(){$("#SequenceNo").val("");$("#MilestoneName").val("");$("#Setrelation").val("")});$("#btnRefresh").on("click",function(){sortingrecord()});