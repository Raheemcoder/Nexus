function bindregulatorystatusDropDown(){$.ajax({url:ROOT+"RID/GetRegulatoryStatus",dataType:"JSON","async":!1,type:"GET",success:function(n){$.each(n,function(n,t){$(".regulatorystatus_c").append("<option value="+t.Value+">"+t.Text+"<\/option>")})}});$(".regulatorystatus_c").select2()}function convertToDate(n){const[t,i,r]=n.split("/");return new Date(`${r}-${i}-${t}`)}var gridData=[],fileName=[],documentData=[],login_region=[],ingredientId=parseInt($("#IngredientId").val());$(document).ready(function(){var n,t,i;$("body").on("change",".textvalid",function(){var n=$(this)[0].id,t=this.value.trim();t===""?$("#"+n+"_valid").removeClass("_hide"):$("#"+n+"_valid").addClass("_hide")});$("body").on("keyup",".textvalid",function(){var n=$(this)[0].id,t=this.value.trim();t===""?$("#"+n+"_valid").removeClass("_hide"):$("#"+n+"_valid").addClass("_hide")});n=JSON.parse($("#DivisionBasedIngredientListJson").val());gridData=n;arrtSetting=function(n,i){var r;return r=(t=undefined||t!=i)?' rowspan="4"':' style="display:none"',t=i,r};$("#list").jqGrid({datatype:"local",data:n,colNames:["RowNo","Region","Category","Regulatory Status","Compliance Remarks","Impact Date","References","Ref Documents"],colModel:[{name:"RowNo",align:"center",hidden:!0},{name:"Region",align:"center",classes:"trs",cellattr:arrtSetting,formatter:function(n,t,i){if(i.IsEditable==!0){var r=login_region.findIndex(function(t){return t===n});r==-1?login_region.push(n):""}return n}},{name:"Category",classes:"trs1",formatter:function(n){return n}},{name:"RegulatoryStatus",search:!1,formatter:function(n,t,i){var r;return i.IsEditable==!0?(r="",r=r+'<div class="demo-content"  >',r=r+'<select id="regulatory_status_selected_'+i.RowNo+'" class="form-control textvalid singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect>',r=r+'<option value="0">Select<\/option>',r=r+"<\/select>",r=r+'<span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span>',r+"<\/div>"):(r="",r=r+'<div class="demo-content"  >',r=r+'<select id="regulatory_status_selected_'+i.RowNo+'" class="form-control textvalid singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect disabled>',r=r+'<option value="0">Select<\/option>',r=r+"<\/select>",r=r+'<span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span>',r+"<\/div>")}},{name:"CRemarks",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text" id="cremarks_selected_'+i.RowNo+'" rows="3" cols="15" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"><\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>':'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text" id="cremarks_selected_'+i.RowNo+'" rows="3" cols="15" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" readonly><\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>'}},{name:"ImpactDates",search:!1,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" readonly class= "form-control form-control-sm data-datepicker ImpactDates_text ImpactDates_text_freezed" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>':'<div class="demo-content" ><input type="text" readonly class= "form-control form-control-sm data-datepicker ImpactDates_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>'}},{name:"References",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>':'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" readonly/> <\/div>'}},{name:"ReferenceDoc",name:"ReferenceDoc",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><input type="file" id="RefDoc_'+i.RowNo+'" class="form-control form-control-sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple/><\/div>':'<div class="demo-content"><input type="file" id="RefDoc_'+i.RowNo+'" class="form-control form-control-sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple disabled/><\/div>'}},],cmTemplate:{sortable:!1},loadonce:!0,viewrecords:!0,pager:"#pager_expected1",rowNum:200,hoverrows:!1,scroll:1,beforeSelectRow:function(){return!1},gridComplete:function(){bindregulatorystatusDropDown();$(".regulatorystatus_c").select2()}});$(".ui-jqgrid-bdiv").css({"max-height":"58vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});i=$(".ui-jqgrid-bdiv").find("tbody").height();i>130?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","10px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));$("#list").closest("#gview_list").css({"z-index":"0"});$("[data-singleselect]").select2();$(".data-singleselect").select2();$(".data-singleselect").select2({dropdownParent:$("#add_project")});$(".data-datepicker").datepicker({todayHighlight:!0,format:"dd/mm/yyyy",autoclose:!0})});$("#savebtn").on("click",function(){var e,h,r,o;var t=!0,u=$("#IngredientName").val(),c=$("#Synonyms").val(),l=$("#CASNumber").val(),i=$("#FunctionId_arr").val().join(",").toString(),v=$("#Division_Id").val(),n=new FormData;n.append("IngredientName",u);n.append("Synonyms",c);n.append("CASNumber",l);n.append("FunctionId",i);n.append("GridData",JSON.stringify(gridData));n.append("JsonFileNames",JSON.stringify(fileName));n.append("DocumentData",JSON.stringify(documentData));n.append("Division_Id",$("#Division_Id").val());ingredientId>0?n.append("Source",$("#Source").val()):"";u==null||u===""||typeof u=="undefined"?($("#IngredientName_valid").removeClass("_hide"),t=!1):$("#IngredientName_valid").addClass("_hide");i==null||i===""||typeof i=="undefined"||i.length===0?($("#FunctionId_arr_valid").removeClass("_hide"),t=!1):$("#FunctionId_arr_valid").addClass("_hide");var f=0,s=[],a=login_region.length==1?login_region[0]:"atleast one";if($.each(gridData,function(n,t){s.indexOf(parseInt(t.RegionId))>-1?"":s.push(parseInt(t.RegionId))}),$.each(s,function(n,i){var u=gridData.filter(function(n){return parseInt(n.RegulatoryStatus)!==0&&parseInt(i)===parseInt(n.RegionId)}).length,e=gridData.filter(function(n){return typeof n.CRemarks=="string"&&n.CRemarks.trim()!==""&&parseInt(i)===parseInt(n.RegionId)}).length,r=gridData.filter(function(n){return parseInt(i)===parseInt(n.RegionId)}).length,o=gridData.filter(function(n){return parseInt(n.RegulatoryStatus)!==0&&parseInt(i)===parseInt(n.RegionId)});u===r&&e===r?f++:f;(u>0||e>0)&&(u<r||e<r)&&f>0&&$.each(o,function(n,i){i.RegulatoryStatus==="0"||i.RegulatoryStatus===null?($("#regulatory_status_selected_"+i.RowNo+"_valid").removeClass("_hide"),t=!1):$("#regulatory_status_selected_"+i.RowNo+"_valid").addClass("_hide");i.CRemarks===""||i.CRemarks===null?($("#cremarks_selected_"+i.RowNo+"_valid").removeClass("_hide"),t=!1):$("#cremarks_selected_"+i.RowNo+"_valid").addClass("_hide")})}),f===0)return alert("Please enter the Regulatory Status and Compliance Remarks for "+a+" Region "),t=!1,!1;for(e=1;e<=gridData.length;e++)if(h=$("#RefDoc_"+e).get(0),r=h.files,r.length!="0"||r.length!=0)for(o=0;o<r.length;o++)n.append("PostedFile",r[o]);if(t){$("#confirmpopup").modal("show");$("#ConfirmOKbutton").on("click",function(){$.ajax({url:ROOT+"RID/SaveDetails",dataType:"JSON",type:"POST",data:n,contentType:!1,processData:!1,success:function(n){jQuery("#list").jqGrid().setGridParam({datatype:"local",data:n});window.location.href=ROOT+"RID/IngredientsRegulation"},error:function(){alert(" An Error occured!!")}});$("#confirmpopup").modal("hide")})}});$(document).on("change",".regulatorystatus_c",function(n){var n=$(this),t=parseInt($(n).data("lineno")),r=$(n).data("name"),i=gridData.findIndex(n=>n.RowNo===t),u=$("#list").getRowData(t);i>=0&&(gridData[i][r]=$(this).val())});$(document).on("change",".RefDocs_text",function(n){for(var c,f,l,y,i,e=!0,p=$(this).data("lineno"),r=$(this).data("regionid"),u=$(this).data("categoryid"),o=n.target.files.length,a=$(this).data("name"),v=parseInt($(this).data("lineno")),s=gridData.findIndex(n=>n.RowNo===v),h=0,o=n.target.files.length,t=0;t<o;t++)h+=n.target.files[t].size;if(c=10485760,h>c)return alert("The file size should be less than 10 MB"),$(this).val(""),e=!1,!1;if(e){for(s>=0&&(gridData[s][a]=i),f=documentData.filter(function(n){return n.RegionId===r&&n.CategoryId===u}).length;f>0;)l=documentData.findIndex(n=>n.RegionId===r&&n.CategoryId===u),documentData.splice(l,1),f--;for(t=0;t<o;t++)y=n.target.files[t],i=n.target.files[t].name,documentData.push({RegionId:r,CategoryId:u,EnclosureName:i.replaceAll(" ","")}),fileName.push(i.replaceAll(" ",""))}});$(document).on("keyup",".Cremarks_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo===i);t>=0&&(gridData[t][r]=$(this).val())});$(document).on("change",".ImpactDates_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=convertToDate($(this).val()))});$(document).on("keyup",".References_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=$(this).val())});$(document).on("keyup",".INCI_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=$(this).val())});$("#cancelbtn").click(function(){var n=$("#Division_Id").val();window.location.href=ROOT+"RID/IngredientsRegulation?DivisionId"});$(".data-multiselect").multiselect({enableFiltering:!0,includeSelectAllOption:!0,enableCaseInsensitiveFiltering:!0,maxHeight:5,buttonWidth:"75%",dropUp:!0});