function bindregulatorystatusDropDown(){$.ajax({url:ROOT+"RID/GetRegulatoryStatus",dataType:"JSON","async":!1,type:"GET",success:function(n){$.each(n,function(n,t){$(".regulatorystatus_c").append("<option value="+t.Value+">"+t.Text+"<\/option>")})}});$(".regulatorystatus_c").select2()}function convertToDate(n){const[t,i,r]=n.split("/");return new Date(`${r}-${i}-${t}`)}function bindFilesGrid(){$.each(oldfiles_uploadedData,function(n,t){$("#old_"+t.RegionId+"_"+t.CategoryId).removeClass("_hide")})}function deletedoc(n){var t=n.getAttribute("data-region"),i=n.getAttribute("data-category"),r=n.getAttribute("data-enclosure");$("#closebtn").trigger("click");$("#confirmpopup1").modal("show");$("#ConfirmDeletebutton").on("click",function(){var n=oldfiles_uploadedData.findIndex(n=>n.RegionId===parseInt(t)&&n.CategoryId===parseInt(i)&&n.EnclosureName===r);oldfiles_uploadedData.splice(n,1);alert("Document Deleted Successfully")});$("#confirmpopup1").modal("hide")}function downloadoc(n){var t=n.getAttribute("data-region"),i=n.getAttribute("data-category"),r=n.getAttribute("data-enclosure");window.location.href=ROOT+"RID/FileDownload?docName="+r+"&&ingredientId="+ingredientId+"&&regionId="+t+"&&categoryId="+i}function ViewDocumentsDataModal(n){var i=parseInt(n.getAttribute("data-categoryId")),r=parseInt(n.getAttribute("data-regionId")),u=n.getAttribute("data-region"),t;$.jgrid.gridUnload("#viewlist");view_file_data=[];t=oldfiles_uploadedData.filter(n=>n.RegionId===r&&n.CategoryId===i);$.each(t,function(n,t){view_file_data.push({EnclosureName:t.EnclosureName,CategoryId:t.CategoryId,RegionId:t.RegionId,Region:t.Region})});createModalGrid();$("#IngredientModal1").modal("show")}function createModalGrid(){$("#viewlist").jqGrid({url:"",datatype:"local",data:view_file_data,mtype:"GET",colModel:IngridentDocViewColModels,loadonce:!0,viewrecords:!0,pager:"#pager_expected2",rowNum:200,scroll:1,gridComplete:function(){var t=$("#viewlist tbody tr"),r=$("#viewlist tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#viewlist").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#viewlist").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var n=$("#viewlist").closest(".ui-jqgrid-bdiv").find("tbody").height();n>280?($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}var gridData=[],EnclosureName=[],filesData=[],oldfiles_uploadedData=[],documentData=[],view_file_data=[],ingredientId=parseInt($("#IngredientId").val()),ingredientreqId=parseInt($("#IngredientId").val()),colModel=[],oldRegion,login_region=[];arrtSetting=function(n,t){var i,r,u;return(oldRegion=undefined||oldRegion!=t)?(r=gridData.filter(function(n){return n.Region===t}),u=r.length,i=' rowspan="'+u+'"'):i=' style="display:none"',oldRegion=t,i};var insertcolmodels=[{name:"RowNo",align:"center",hidden:!0},{name:"Region",align:"center",classes:"trs",cellattr:arrtSetting,formatter:function(n,t,i){if(i.IsEditable==!0){var r=login_region.findIndex(function(t){return t===n});r==-1?login_region.push(n):""}return n}},{name:"Category",classes:"trs1",formatter:function(n){return n}},{name:"RegulatoryStatus",search:!1,formatter:function(n,t,i){var r;return i.IsEditable==!0?(r="",r=r+'<div class="demo-content"  >',r=r+'<select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect>',r=r+'<option value="0">Select<\/option>',r=r+"<\/select>",r=r+'<span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span>',r+"<\/div>"):(r="",r=r+'<div class="demo-content"  >',r=r+'<select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect disabled>',r=r+'<option value="0">Select<\/option>',r=r+"<\/select>",r=r+'<span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span>',r+"<\/div>")}},{name:"CRemarks",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text" id="cremarks_selected_'+i.RowNo+'" rows="3" cols="15" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"><\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>':'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text" id="cremarks_selected_'+i.RowNo+'" rows="3" cols="15" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"readonly><\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>'}},{name:"ImpactDates",search:!1,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" readonly class= "form-control form-control-sm data-datepicker ImpactDates_text ImpactDates_text_freezed" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>':'<div class="demo-content" ><input type="text" readonly disabled class= "form-control form-control-sm data-datepicker ImpactDates_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>'}},{name:"References",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>':'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" readonly/> <\/div>'}},{name:"ReferenceDoc",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><input type="file" id="RefDoc_'+i.RowNo+'" class="form-control form-control-sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple/><\/div>':'<div class="demo-content"><input type="file" id="RefDoc_'+i.RowNo+'" class="form-control form-control-sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple disabled/><\/div>'}},],updatecolmodels=[{name:"RowNo",align:"center",hidden:!0},{name:"Region",align:"center",classes:"trs",cellattr:arrtSetting,formatter:function(n,t,i){if(i.IsEditable==!0){var r=login_region.findIndex(function(t){return t===n});r==-1?login_region.push(n):""}return n}},{name:"Category",classes:"trs1",formatter:function(n){return n}},{name:"RegulatoryStatus",search:!1,formatter:function(n,t,i){var r;return i.IsEditable==!0?(r="",r=r+'<div class="demo-content"  >',r=r+'<select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect>',r=r+'<option value="0">Select<\/option>',r=r+"<\/select>",r=r+'<span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span>',r+"<\/div>"):(r="",r=r+'<div class="demo-content"  >',r=r+'<select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect disabled>',r=r+'<option value="0">Select<\/option>',r=r+"<\/select>",r=r+'<span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span>',r+"<\/div>")}},{name:"CRemarks",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text" id="cremarks_selected_'+i.RowNo+'" rows="3" cols="15" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'">'+i.CRemarks+'<\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>':'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text " id="cremarks_selected_'+i.RowNo+'" rows="3" cols="15" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" readonly>'+i.CRemarks+'<\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>'}},{name:"ImpactDates",search:!1,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" readonly class= "form-control form-control-sm data-datepicker ImpactDates_text ImpactDates_text_freezed" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ImpactDates+'"/> <\/div>':'<div class="demo-content" ><input type="text" readonly disabled class= "form-control form-control-sm data-datepicker ImpactDates_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ImpactDates+'"/> <\/div>'}},{name:"References",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.References+'"/> <\/div>':'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.References+'" readonly/> <\/div>'}},{name:"ReferenceDoc",name:"ReferenceDoc",formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content "><div class="row"><div class="_hide col-md-1 pdt_9" id="old_'+i.RegionId+"_"+i.CategoryId+'"><a href="#" data-target="#IngredientModal1" data-categoryId="'+i.CategoryId+'" data-regionId="'+i.RegionId+'"data-region="'+i.Region+'" onclick="ViewDocumentsDataModal(this)" title="View Documents"><i class="fa fa-info-circle"><\/i><\/a><\/div> <div class="col-md-10"><input type="file" id="RefDoc_'+i.RowNo+'" class="form - control form - control - sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple/><\/div><\/div ><\/div >':'<div class="demo-content "><div class="row"><div class="_hide col-md-1 pdt_9" id="old_'+i.RegionId+"_"+i.CategoryId+'"><a href="#" data-target="#IngredientModal1" data-categoryId="'+i.CategoryId+'" data-regionId="'+i.RegionId+'"data-region="'+i.Region+'" onclick="ViewDocumentsDataModal(this)" title="View Documents"><i class="fa fa-info-circle"><\/i><\/a><\/div> <div class="col-md-10"><input type="file" id="RefDoc_'+i.RowNo+'" class="form - control form - control - sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple disabled/><\/div><\/div ><\/div >'}},],IngridentDocViewColModels=[{name:"EnclosureName",label:"Document Name",align:"center"},{name:"CategoryId",label:"CategoryId",align:"center",hidden:!0},{name:"RegionId",label:"RegionId",align:"center",hidden:!0},{name:"Region",label:"Region",align:"center",hidden:!0},{name:"Action",label:"Action",align:"center",formatter:function(n,t,i){var r=login_region.findIndex(function(n){return n==i.Region});return r>-1?'<div class="demo-content "><a href="#" title="Download" class="btn-icon btn-success" onclick="downloadoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" ><i class="fa fa-download"><\/i><\/a><a href="#" title="Delete" onclick="deletedoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" class="btn-icon -delete"><i class="fa fa-trash"><\/i><\/a><\/div >':'<div class="demo-content "><a href="#" title="Download" class="btn-icon btn-success" onclick="downloadoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" ><i class="fa fa-download"><\/i><\/a><\/div >'}}];$(document).ready(function(){var i=$("#userrole").val(),n,t;$("body").on("change",".textvalid",function(){var n=$(this)[0].id,t=this.value.trim();t===""?$("#"+n+"_valid").removeClass("_hide"):$("#"+n+"_valid").addClass("_hide")});$("body").on("keyup",".textvalid",function(){var n=$(this)[0].id,t=this.value.trim();t===""?$("#"+n+"_valid").removeClass("_hide"):$("#"+n+"_valid").addClass("_hide")});ingredientId>0?(gridData=JSON.parse($("#IngredientListData").val()),colModel=updatecolmodels,oldfiles_uploadedData=JSON.parse($("#IngredientFileData").val()),$("#title").text("/ Edit Ingredient")):(n=JSON.parse($("#DivisionBasedIngredientListJson").val()),gridData=n,colModel=insertcolmodels);$("#list").jqGrid({datatype:"local",data:gridData,colNames:["RowNo","Region","Category","Regulatory Status","Compliance Remarks","Impact Date","References","Ref Documents"],colModel:colModel,cmTemplate:{sortable:!1},loadonce:!0,viewrecords:!0,pager:"#pager_expected1",rowNum:200,hoverrows:!1,scroll:1,beforeSelectRow:function(){return!1},gridComplete:function(){bindregulatorystatusDropDown();$(".regulatorystatus_c").select2();ingredientId>0&&$.each(gridData,function(n,t){if(gridData.length>=1){var i=n+1;$("#regulatory_status_selected_"+i).val(t.RegulatoryStatus).trigger("change")}})}});$(".ui-jqgrid-bdiv").css({"max-height":"58vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});t=$(".ui-jqgrid-bdiv").find("tbody").height();t>130?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","10px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));$("#list").closest("#gview_list").css({"z-index":"0"});$("[data-singleselect]").select2();$(".data-singleselect").select2();$(".data-singleselect").select2({dropdownParent:$("#add_project")});$(".data-datepicker").datepicker({todayHighlight:!0,format:"dd/mm/yyyy",autoclose:!0});ingredientId>0?$(".readonly").attr("disabled",!0):$(".readonly").attr("disabled",!1);$(gridData).each(function(n,t){gridData[n].ImpactDates=t.ImpactDates===""||t.ImpactDates===null||typeof t.ImpactDates=="undefined"?"":convertToDate(t.ImpactDates)});bindFilesGrid()});$("#savebtn").on("click",function(){var e,c,r,o;var t=!0,s=parseInt($("#IngredientId").val()),u=$("#IngredientName").val(),l=$("#Synonyms").val(),a=$("#CASNumber").val(),i=$("#FunctionId_arr").val().join(",").toString(),y=$("#Division_Id").val(),n=new FormData;n.append("IngredientId",s);n.append("IngredientName",u);n.append("Synonyms",l);n.append("CASNumber",a);n.append("FunctionId",i);n.append("GridData",JSON.stringify(gridData));n.append("JsonFileNames",JSON.stringify(EnclosureName));n.append("Division_Id",$("#Division_Id").val());s>0?n.append("Source",$("#Source").val()):"";u==null||u===""||typeof u=="undefined"?($("#IngredientName_valid").removeClass("_hide"),t=!1):$("#IngredientName_valid").addClass("_hide");i==null||i===""||typeof i=="undefined"||i.length===0?($("#FunctionId_arr_valid").removeClass("_hide"),t=!1):$("#FunctionId_arr_valid").addClass("_hide");var f=0,h=[],v=login_region.length==1?login_region[0]:"atleast one";if($.each(gridData,function(n,t){h.indexOf(parseInt(t.RegionId))>-1?"":h.push(parseInt(t.RegionId))}),$.each(h,function(n,i){var u=gridData.filter(function(n){return parseInt(n.RegulatoryStatus)!==0&&parseInt(i)===parseInt(n.RegionId)}).length,e=gridData.filter(function(n){return typeof n.CRemarks=="string"&&n.CRemarks.trim()!==""&&parseInt(i)===parseInt(n.RegionId)}).length,r=gridData.filter(function(n){return parseInt(i)===parseInt(n.RegionId)}).length,o=gridData.filter(function(n){return parseInt(n.RegulatoryStatus)!==0&&parseInt(i)===parseInt(n.RegionId)});u===r&&e===r?f++:f;(u>0||e>0)&&(u<r||e<r)&&f>0&&$.each(o,function(n,i){i.RegulatoryStatus==="0"||i.RegulatoryStatus===null?($("#regulatory_status_selected_"+i.RowNo+"_valid").removeClass("_hide"),t=!1):$("#regulatory_status_selected_"+i.RowNo+"_valid").addClass("_hide");i.CRemarks===""||i.CRemarks===null?($("#cremarks_selected_"+i.RowNo+"_valid").removeClass("_hide"),t=!1):$("#cremarks_selected_"+i.RowNo+"_valid").addClass("_hide")})}),f===0)return alert("Please enter the Regulatory Status and Compliance Remarks for "+v+" Region "),t=!1,!1;for(e=1;e<=gridData.length;e++)if(c=$("#RefDoc_"+e).get(0),r=c.files,r.length!="0"||r.length!=0)for(o=0;o<r.length;o++)n.append("PostedFile",r[o]);if(t&&s>0){$("#confirmpopup").modal("show");$("#ConfirmOKbutton").off("click").on("click",function(){$.each(oldfiles_uploadedData,function(n,t){documentData.push({RegionId:t.RegionId,CategoryId:t.CategoryId,EnclosureName:t.EnclosureName})});n.append("DocumentData",JSON.stringify(documentData));$.ajax({url:ROOT+"RID/UpdateDetails",dataType:"JSON",type:"POST",data:n,contentType:!1,processData:!1,success:function(n){n.includes("Successfully")?window.location.href=ROOT+"RID/IngredientsRegulation":alert(n)},error:function(){alert(" An Error occured!!")}});$("#confirmpopup").modal("hide")})}else if(t){$("#confirmpopup").modal("show");$("#ConfirmOKbutton").off("click").on("click",function(){$.each(oldfiles_uploadedData,function(n,t){documentData.push({RegionId:t.RegionId,CategoryId:t.CategoryId,EnclosureName:t.EnclosureName})});n.append("DocumentData",JSON.stringify(documentData));$.ajax({url:ROOT+"RID/SaveDetails",dataType:"JSON",type:"POST",data:n,contentType:!1,processData:!1,success:function(n){n.includes("Successfully")?window.location.href=ROOT+"RID/IngredientsRegulation":alert(n)},error:function(){alert(" An Error occured!!")}});$("#confirmpopup").modal("hide")})}});$(document).on("change",".regulatorystatus_c",function(n){var u;var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo===i),f=$("#list").getRowData(i);t>=0&&(gridData[t][r]=$(this).val(),u=gridData[t].Region)});$(document).on("change",".RefDocs_text",function(n){for(var c,f,l,y,i,e=!0,p=$(this).data("lineno"),r=$(this).data("regionid"),u=$(this).data("categoryid"),o=n.target.files.length,a=$(this).data("name"),v=parseInt($(this).data("lineno")),s=gridData.findIndex(n=>n.RowNo===v),h=0,o=n.target.files.length,t=0;t<o;t++)h+=n.target.files[t].size;if(c=10485760,h>c)return alert("The file size should be less than 10 MB"),$(this).val(""),e=!1,!1;if(e){for(s>=0&&(gridData[s][a]=i),f=documentData.filter(function(n){return n.RegionId===r&&n.CategoryId===u}).length;f>0;)l=documentData.findIndex(n=>n.RegionId===r&&n.CategoryId===u),documentData.splice(l,1),f--;for(t=0;t<o;t++)y=n.target.files[t],i=n.target.files[t].name,documentData.push({RegionId:r,CategoryId:u,EnclosureName:i.replaceAll(" ","")}),EnclosureName.push(i.replaceAll(" ",""))}});$(document).on("keyup",".Cremarks_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo===i);t>=0&&(gridData[t][r]=$(this).val())});$(document).on("change",".ImpactDates_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=convertToDate($(this).val()))});$(document).on("keyup",".References_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=$(this).val())});$(document).on("keyup",".INCI_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=$(this).val())});$("#cancelbtn").click(function(){var n=$("#Division_Id").val();window.location.href=ROOT+"RID/IngredientsRegulation?DivisionId"});$(".data-multiselect").multiselect({enableFiltering:!0,includeSelectAllOption:!0,enableCaseInsensitiveFiltering:!0,maxHeight:5,buttonWidth:"75%",dropUp:!0});$("#closebtn").click(function(){$("#IngredientModal1").modal("hide")});