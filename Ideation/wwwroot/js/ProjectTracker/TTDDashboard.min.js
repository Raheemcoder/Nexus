function createTTDGrid(n){var t=n.filter(function(n){return n.IsActive===!0}),u;$.jgrid.gridUnload("#TTDDashboard_grid");$grid=$("#TTDDashboard_grid");$("#TTDDashboard_grid").jqGrid({url:"",datatype:"local",frozenColumns:!0,data:t,mtype:"GET",colModel:colmodels,viewrecords:!0,width:1500,scroll:!1,shrinkToFit:!1,loadonce:!0,pager:"#TTDDashboardpager",rowNum:t.length,menuIcon:!0,menuUI:{tabs:["hideCols"]},dataModel:t,rowattr:function(n){return{"class":`trrowno_${n.RowNo}`}},resizeStop:function(){resizeColumnHeader.call(this);fixPositionsOfFrozenDivs.call(this);fixGboxHeight.call(this)},loadComplete:function(){$(".ui-jqgrid .frozen-bdiv").length>0&&(bindDropdowns(),bindActions())},gridComplete:function(){var t=$("#TTDDashboard_grid tbody tr"),r=$("#TTDDashboard_grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"));$("[data-datepicker]").datepicker({format:"dd/mm/yyyy",todayHighlight:!0,autoclose:!0});$("[data-datepicker-monthyear1]").datepicker({format:"M/yyyy",viewMode:"months",minViewMode:"months",todayHighlight:!0,autoclose:!0})}});const r=100;$("#TTDDashboard_grid").bind("jqGridGridComplete",function(){const n=$(".ui-jqgrid-bdiv")[0];$("#leftArrow").click(function(){n.scrollLeft-=r});$("#rightArrow").click(function(){n.scrollLeft+=r})});jQuery("#TTDDashboard_grid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:"Action",numberOfColumns:11,titleText:""},{startColumnName:"HGMLValue",numberOfColumns:7,titleText:"Business Value in M$"},{startColumnName:"BaselineTTDDate",numberOfColumns:4,titleText:""},{startColumnName:"TTDTargetCommentId",numberOfColumns:2,titleText:"Comments on timing"},{startColumnName:"CommentsOnTiming",numberOfColumns:1,titleText:""},]});$(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 240px)"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});u=$(".ui-jqgrid-bdiv").find("tbody").height();u>130?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","4px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));$(".ui-pg-table.ui-common-table.ui-paging-pager").find("tbody").find("tr").html("");$grid.jqGrid("navGrid","#TTDDashboardpager",{add:!1,edit:!1,del:!1},{},{},{},{multipleSearch:!0,overlay:0});$grid.jqGrid("navButtonAdd","#TTDDashboardpager",{caption:"Filter",title:"Toggle Searching Toolbar",buttonicon:"ui-icon-pin-s",onClickButton:function(){this.toggleToolbar();$.isFunction(this.p._complete)&&($(".ui-search-toolbar",this.grid.hDiv).is(":visible")?$(".ui-search-toolbar",this.grid.fhDiv).show():$(".ui-search-toolbar",this.grid.fhDiv).hide(),this.p._complete.call(this),fixPositionsOfFrozenDivs.call(this))}});role.toLowerCase()=="report viewer"&&($(".hidelegends").hide(),$("#TTDDashboard_grid").jqGrid("destroyFrozenColumns"),$("#TTDDashboard_grid").jqGrid("hideCol","Action"),$("#TTDDashboard_grid").jqGrid("setFrozenColumns"));$grid.jqGrid("setFrozenColumns");syncRowHeights();bindDropdowns();bindActions()}function bindDropdowns(){$.ajax({url:ROOT+"TTDDashboard/GetTTDDropdownData","async":!1,type:"GET",success:function(n){dropdowndata=n.TTDDropDownDataList;populateDropdown()}})}function populateDropdown(){var n;[{"class":".rd",type:"r&d"},{"class":".classification",type:"classification"},{"class":".priority",type:"ttdpriority"},{"class":".market",type:"projhub"},{"class":".category",type:"ttdcategory"},{"class":".subcategory",type:"ttdsubcategory"},{"class":".ttdcomments",type:"ttdtargetcomments"},{"class":".prodcomments",type:"prodtargetcomments"},].forEach(function(n){var i=dropdowndata.filter(function(t){return t.Type.trim().toLowerCase()===n.type.toLowerCase()}),t;$(n.class).html("");t='<option value="0">Select<\/option>';i.forEach(function(n){t=t+'<option value="'+n.Value+'">'+n.Text+"<\/option>"});$(n.class).append(t)});n=grid_arr_new.filter(function(n){return n.IsActive==!0});$.each(n,function(n,t){var r=dropdowndata.filter(function(n){return n.Type.trim().toLowerCase()==="ttdsubcategory"&&n.DependOnType.trim().toLowerCase()=="ttdcategory"&&n.DependOnValue==t.CategoryId}),u=$(".trrowno_"+t.RowNo+" .subcategory"),i;$(u).html("");i='<option value="0">Select<\/option>';r!=""&&r.forEach(function(n){i=i+'<option value="'+n.Value+'">'+n.Text+"<\/option>"});$(u).append(i);$(".rd_selected_"+t.RowNo).val(t.RDId);$(".classification_selected_"+t.RowNo).val(t.ClassificationTypeId);$(".priority_selected_"+t.RowNo).val(t.PriorityTypeId);$(".category_selected_"+t.RowNo).val(t.CategoryId);$(".subcategory_selected_"+t.RowNo).val(t.SubCategoryId);$(".market_selected_"+t.RowNo).val(t.MarketTypeId);$(".ttdcomments_selected_"+t.RowNo).val(t.TTDTargetCommentId);$(".prodtargetcomments_selected_"+t.RowNo).val(t.ProductionTargetCommentId)});$("[data-singleselect]").select2()}function bindproductnamesdropdown(){var n=year_old;$.ajax({type:"GET",url:ROOT+"TTDDashboard/GetProductNamesData","async":!1,success:function(t){var u,i,r,f;productnames_arr=[];productnames_arr=t;u=$("#ProdName option:selected").text();$("#ProdName").html("");i='<option value="">Select<\/option>';t!=""&&(r=new Set,f=$.grep(productnames_arr,function(t){var i=t.ProductName,u=r.has(i);return u||r.add(i),parseInt(t.ProductionTargetYear)==parseInt(n)&&!u}),$.each(f,function(n,t){i=u===t.ProductName?i+'<option value="'+t.TTDHeaderId+'" selected>'+t.ProductName+"<\/option>":i+'<option value="'+t.TTDHeaderId+'">'+t.ProductName+"<\/option>"}));$("#ProdName").append(i);$("[data-singleselect]").select2()},error:function(n){alert(n)}})}function getSavedData(n){$.each(n,function(n,t){grid_arr_new.unshift({TTDHeaderId:t.TTDHeaderId,RowNo:t.RowNo,ProductionTargetYear:t.ProductionTargetYear,ProjectBriefId:t.ProjectBriefId,ProductName:t.ProductName,RDId:t.RDId.toString(),PackSizes:t.PackSizes,ClassificationTypeId:t.ClassificationTypeId.toString(),PriorityTypeId:t.PriorityTypeId.toString(),MarketTypeId:t.MarketTypeId.toString(),CategoryId:t.CategoryId.toString(),SubCategoryId:t.SubCategoryId.toString(),BriefAcceptedDate:t.BriefAcceptedDate,BusinessValueYear1:t.BusinessValueYear1,BusinessValueYear2:t.BusinessValueYear2,BaselineTTDDate:t.BaselineTTDDate,BaselineTTDRemarks:t.BaselineTTDRemarks,BaselineProductionDate:t.BaselineProductionDate,BaselineProductionRemarks:t.BaselineProductionRemarks,TTDTargetDate:t.TTDTargetDate,TTDTargetRemarks:t.TTDTargetRemarks,ProductionTargetDate:t.ProductionTargetDate,ProductionTargetRemarks:t.ProductionTargetRemarks,TTDTargetCommentId:t.TTDTargetCommentId.toString(),ProductionTargetCommentId:t.ProductionTargetCommentId.toString(),Remarks:t.Remarks,ActionBy:t.ActionBy,IsEdit:!1,IsNew:!1,IsActive:t.IsActive,IsChanged:!1,IsTTDComment:t.IsTTDComment,IsProductionComment:t.IsProductionComment,IsRemarks:t.IsRemarks,BaselineTTDRemarks_HasRemarks:!1,BaselineProductionRemarks_HasRemarks:!1,TTDTargetRemarks_HasRemarks:!1,ProductionTargetRemarks_HasRemarks:!1,LoginId:t.LoginId})})}function getGridData(){var t=grid_arr_new.length>0?1:10,n,i,r;for(role.toLowerCase()=="report viewer"&&(t=0);t>0;)n=0,grid_arr_new.length===0?n=n+1:(i=grid_arr_new.map(function(n){return n.RowNo}),r=Math.max(...i),n=r+1),grid_arr_new.unshift({TTDHeaderId:"",RowNo:n,ProductionTargetYear:year_old,ProjectBriefId:"",ProductName:"",RDId:"0",PackSizes:"",ClassificationTypeId:"0",PriorityTypeId:"0",MarketTypeId:"0",CategoryId:"0",SubCategoryId:"0",BriefAcceptedDate:"",BusinessValueYear1:"",BusinessValueYear2:"",BaselineTTDDate:"",BaselineTTDRemarks:"",BaselineProductionDate:"",BaselineProductionRemarks:"",TTDTargetDate:"",TTDTargetRemarks:"",ProductionTargetDate:"",ProductionTargetRemarks:"",TTDTargetCommentId:"0",ProductionTargetCommentId:"0",Remarks:"",ActionBy:"",IsEdit:!0,IsNew:!0,IsActive:!0,IsChanged:!1,IsTTDComment:!1,IsProductionComment:!1,IsRemarks:!1,BaselineTTDRemarks_HasRemarks:!1,BaselineProductionRemarks_HasRemarks:!1,TTDTargetRemarks_HasRemarks:!1,ProductionTargetRemarks_HasRemarks:!1,LoginId:""}),t--;role.toLowerCase()=="report viewer"?$(".viewbtn").hide():$(".viewbtn").show()}function bindActions(){var n=grid_arr_new.filter(function(n){return n.IsActive===!0});$.each(n,function(n,t){t.IsEdit==!0?(t.IsNew==!0?($(".deleterow_"+t.RowNo).removeClass("_hide"),$(".editrow_"+t.RowNo).addClass("_hide"),$(".cancelrow_"+t.RowNo).addClass("_hide"),$(".saverow_"+t.RowNo).addClass("_hide")):($(".deleterow_"+t.RowNo).removeClass("_hide"),$(".editrow_"+t.RowNo).addClass("_hide"),$(".cancelrow_"+t.RowNo).removeClass("_hide"),$(".saverow_"+t.RowNo).removeClass("_hide")),$(".trrowno_"+t.RowNo+" .form-control").attr("disabled",!1)):($(".deleterow_"+t.RowNo).removeClass("_hide"),$(".editrow_"+t.RowNo).removeClass("_hide"),$(".cancelrow_"+t.RowNo).addClass("_hide"),$(".saverow_"+t.RowNo).addClass("_hide"),$(".trrowno_"+t.RowNo+" .form-control").attr("disabled",!0));t.IsTTDComment==!0&&$(".ttdcommentshistory_"+t.RowNo).removeClass("_hide");t.IsProductionComment==!0&&$(".productioncommentshistory_"+t.RowNo).removeClass("_hide");t.IsRemarks==!0&&$(".remarkshistory_"+t.RowNo).removeClass("_hide")})}function updateRowData(n){var i=grid_arr_new.filter(function(t){return t.RowNo==n}),t=$(".trrowno_"+n);$(t).find("[data-singleselect]").select2("destroy");$.each(i,function(t,i){var u=dropdowndata.filter(function(n){return n.Type.trim().toLowerCase()==="ttdsubcategory"&&n.DependOnType.trim().toLowerCase()=="ttdcategory"&&n.DependOnValue==i.CategoryId}),f=$(".trrowno_"+i.RowNo+" .subcategory"),r;$(f).html("");r='<option value="0">Select<\/option>';u!=""&&u.forEach(function(n){r=r+'<option value="'+n.Value+'">'+n.Text+"<\/option>"});$(f).append(r);$(".projectbriefid_selected_"+n).val(i.ProjectBriefId);$(".product_selected_"+n).val(i.ProductName);$(".rd_selected_"+n).val(i.RDId);$(".packsize_selected_"+n).val(i.PackSizes);$(".classification_selected_"+n).val(i.ClassificationTypeId);$(".priority_selected_"+n).val(i.PriorityTypeId);$(".market_selected_"+n).val(i.MarketTypeId);$(".category_selected_"+n).val(i.CategoryId);$(".subcategory_selected_"+n).val(i.SubCategoryId);$(".briefaccepteddate_selected_"+n).val(i.BriefAcceptedDate);$(".businessvalueyear1_selected_"+n).val(i.BusinessValueYear1);$(".businessvalueyear1_selected_"+n).val(i.BusinessValueYear2);$(".baselinettd_selected_"+n).val(i.BaselineTTDDate);$(".baselineproduction_selected_"+n).val(i.BaselineProductionDate);$(".ttdtarget_selected_"+n).val(i.TTDTargetDate);$(".prodtarget_selected_"+n).val(i.ProductionTargetDate);$(".ttdcomments_selected_"+n).val(i.TTDTargetCommentId);$(".prodtargetcomments_selected_"+n).val(i.ProductionTargetCommentId);$(".remarks_selected_"+n).val(i.Remarks);$.each(dateremarks_arr,function(n,t){var r=t.findIndex(function(n){return n.IsNew==!0&&n.RowNo==i.RowNo});r>-1&&(dateremarks_arr[n][r].Remarks="")})});$(t).find("[data-singleselect]").select2()}function validatechangeddata(n){var t=!1;return $.each(n,function(n,i){i.IsChanged==!0?t=!0:$(".trrowno_"+i.RowNo+" .errortext").addClass("_hide")}),t}function validatedata(n){var i=!0,t=!1,r=n.filter(function(n){return n.IsChanged==!0});return $.each(r,function(r,u){var l=u.ProjectBriefId,d=new RegExp("^(PB\\d{6}|NA)$"),v,y,c;d.test(l)||l==""?$(".projectbrief_selected_"+u.RowNo+"_valid").addClass("_hide"):(i=!1,$(".projectbrief_selected_"+u.RowNo+"_valid").removeClass("_hide"));var e=u.ProductName,a=u.MarketTypeId,o=-1,o=grid_arr.findIndex(function(n){return n.RowNo==u.RowNo&&u.IsChanged==!0}),g=n.filter(function(n){return n.RowNo==u.RowNo}),f=g.findIndex(function(n){return n.IsChanged==!0});if((e===""||e===null)&&f>-1)i=!1,$(".product_selected_"+u.RowNo+"_valid").removeClass("_hide");else{var nt=year_old,tt=productnames_arr.filter(function(n){return parseInt(n.ProductionTargetYear)!=parseInt(nt)}),s=[],h=grid_arr_new.filter(function(n){return n.IsActive==!0});h=structuredClone(h).reverse();$.each(h,function(n,t){if(t.ProductName!=""&&t.ProductName!=null){var i=s.findIndex(function(n){return t.ProductName.toLowerCase()===n.ProductName.toLowerCase()&&t.RowNo==n.RowNo});i==-1&&s.push({RowNo:t.RowNo,ProductName:t.ProductName})}});v=tt.findIndex(function(n){return n.ProductName.trim().toLowerCase()==e.trim().toLowerCase()});y=s.findIndex(function(n){return n.ProductName.trim().toLowerCase()==e.trim().toLowerCase()&&parseInt(n.RowNo)!=parseInt(u.RowNo)});v>-1||y>-1?a==""||a=="0"?(i=!1,$(".market_selected_"+u.RowNo+"_valid").removeClass("_hide"),t||(scrollToColumn("MarketTypeId"),scrollToRow(u.RowNo),t=!0)):$(".market_selected_"+u.RowNo+"_valid").addClass("_hide"):($(".product_selected_"+u.RowNo+"_valid").addClass("_hide"),$(".market_selected_"+u.RowNo+"_valid").addClass("_hide"))}if(u.IsNew==!1&&f>-1){var it=grid_arr[o].BaselineTTDDate,rt=u.BaselineTTDDate,p=u.BaselineTTDRemarks;it!=rt?(p==""||p==null)&&f>-1?(i=!1,$(".baselinettdremarks_selected_"+u.RowNo+"_valid").removeClass("_hide"),t||(scrollToColumn("BaselineTTDDate"),scrollToRow(u.RowNo),t=!0)):$(".baselinettdremarks_selected_"+u.RowNo+"_valid").addClass("_hide"):$(".baselinettdremarks_selected_"+u.RowNo+"_valid").addClass("_hide");var ut=grid_arr[o].BaselineProductionDate,ft=u.BaselineProductionDate,w=u.BaselineProductionRemarks;ut!=ft?(w==""||w==null)&&f>-1?(i=!1,$(".baselineproductionremarks_selected_"+u.RowNo+"_valid").removeClass("_hide"),t||(scrollToColumn("BaselineProductionDate"),scrollToRow(u.RowNo),t=!0)):$(".baselineproductionremarks_selected_"+u.RowNo+"_valid").addClass("_hide"):$(".baselineproductionremarks_selected_"+u.RowNo+"_valid").addClass("_hide");var et=grid_arr[o].TTDTargetDate,ot=u.TTDTargetDate,b=u.TTDTargetRemarks;et!=ot?(b==""||b==null)&&f>-1?(i=!1,$(".ttdtargetremarks_selected_"+u.RowNo+"_valid").removeClass("_hide"),t||(scrollToColumn("TTDTargetDate"),scrollToRow(u.RowNo),t=!0)):$(".ttdtargetremarks_selected_"+u.RowNo+"_valid").addClass("_hide"):$(".ttdtargetremarks_selected_"+u.RowNo+"_valid").addClass("_hide");var st=grid_arr[o].ProductionTargetDate,ht=u.ProductionTargetDate,k=u.ProductionTargetRemarks;st!=ht?(k==""||k==null)&&f>-1?(i=!1,$(".prodtargetremarks_selected_"+u.RowNo+"_valid").removeClass("_hide"),t||(scrollToColumn("ProductionTargetDate"),scrollToRow(u.RowNo),t=!0)):$(".prodtargetremarks_selected_"+u.RowNo+"_valid").addClass("_hide"):$(".prodtargetremarks_selected_"+u.RowNo+"_valid").addClass("_hide");c=u.Remarks;(c==""||c==null)&&f>-1?($(".remarks_selected_"+u.RowNo+"_valid").removeClass("_hide"),t||(scrollToColumn("Remarks"),scrollToRow(u.RowNo),t=!0)):$(".remarks_selected_"+u.RowNo+"_valid").addClass("_hide")}}),syncRowHeights(),i}function convertStringDateFormat(n){if(n===""||n==null)return"";var t=n.split("/");return t[2]+"-"+t[1]+"-"+t[0]}function updateGridArray(n){var t=$(n),i=parseInt($(t).data("lineno")),f=$(t).data("name"),u="",r,e;u=$(t).val().replace(/^\s+/g,"").trim();r=grid_arr_new.findIndex(n=>n.RowNo===i);r>=0&&(grid_arr_new[r][f]=u);e=grid_arr_new.filter(function(n){return n.RowNo==i});updateIsChanged(i)}function updateIsChanged(n){var n=parseInt(n),i=grid_arr_new.findIndex(t=>t.RowNo===n),r=grid_arr_new.filter(function(t){return t.RowNo==n}),t=!1;$.each(r,function(n,r){t=!1;var u=grid_arr.findIndex(function(n){return r.RowNo==n.RowNo});const f=grid_arr[u];for(const n in r)f[n]!==r[n]&&(t=!0);grid_arr_new[i].IsChanged=t;grid_arr[i].IsChanged=t});t||$(".trrowno_"+n+" .errortext").addClass("_hide")}function syncRowHeights(){var t=$grid.attr("id"),n=t+"_frozen",i=$grid.find(".jqgrow");i.each(function(){var i=this.id,t=$("#"+n).find("#"+i),r,u;t.length?(r=$(this).outerHeight(),u=t.outerHeight(),t[0].style.setProperty("height",r+"px","important")):console.warn(`Row with ID ${i} not found in frozen grid (${n})`)})}function getResponsiveWidth(){var n=$(window).width();return n>1800?200:n>1300?165:n>1200?125:n>768?50:30}function scrollToColumn(n){const i=$(".ui-jqgrid-bdiv")[0],r=$('td[aria-describedby="TTDDashboard_grid_'+n+'"]:first');if(r.length!==0){const e=r.position().left,u=$(i).width(),o=e-u*.66,s=i.scrollLeft,f=$(i).prop("scrollWidth")-u;let t=o;t<0&&(t=0);t>f&&(t=f);$(i).animate({scrollLeft:t},500)}}function scrollToRow(n){const t=$(".ui-jqgrid-bdiv")[0],i=$(".trrowno_"+n);if(i.length===0){console.error("Row not found:",n);return}const r=i.position().top+t.scrollTop,u=$(t).height();$(t).animate({scrollTop:r-u/2},500)}function showAlertMessage(n,t){$("#alertText").text(n);$("#alertMessage").removeClass().addClass("alert "+t);$("#alertMessage").show();setTimeout(function(){$("#alertMessage").hide()},3e3)}function binddateremarksdata(){dateremarks_arr={BaselineTTDRemarks:[],BaselineProductionRemarks:[],TTDTargetRemarks:[],ProductionTargetRemarks:[]};$.each(grid_arr_new,function(n,t){$.each(dateremarks_arr,function(i){t[i]==grid_arr[n][i]?dateremarks_arr[i].push({RowNo:t.RowNo,Date:"",Remarks:"",CreatedBy:"",CreatedOn:"",IsNew:!0,TTDLineNo:0}):dateremarks_arr[i].push({RowNo:t.RowNo,Date:"",Remarks:t[i],CreatedBy:"",CreatedOn:"",IsNew:!0,TTDLineNo:0})})});var n=year_old;$.ajax({type:"GET",url:ROOT+"TTDDashboard/GetDateRemarksData",data:{prodyear:n},"async":!1,success:function(n){n!=""&&n.length>0&&bindsaveddateremarksdate(n)},error:function(n){alert(n)}})}function bindsaveddateremarksdate(n){var t={BaselineTTDRemarks:[],BaselineProductionRemarks:[],TTDTargetRemarks:[],ProductionTargetRemarks:[]};$.each(n,function(n,i){var r=grid_arr_new.findIndex(function(n){return i.TTDHeaderId==n.TTDHeaderId});r>-1&&$.each(t,function(n){dateremarks_arr[n].push({RowNo:grid_arr_new[r].RowNo,Date:i[n+"Date"],Remarks:i[n],CreatedBy:i.CreatedBy,CreatedOn:i.CreatedOn,IsNew:!1,TTDLineNo:i.TTDLineNo})})})}function createRemarksGrid(n,t){var r,u,f;n=n.filter(function(n){return(n.IsNew===!1||n.Remarks!=="")&&n.Date!==""});$.jgrid.gridUnload("#dateremarks_grid");$("#dateremarks_grid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:t,loadonce:!0,width:500,viewrecords:!0,pager:"#dateremarks_pager",rowNum:n.length,scroll:1,gridComplete:function(){var t=$("#dateremarks_grid tbody tr"),r=$("#dateremarks_grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#dateremarks_grid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 400px)"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});r=$(".ui-jqgrid-bdiv").find("tbody").height();r>50?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","4px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));u=parseInt($(".dateremarksrowno").val());f=grid_arr_new.filter(function(n){return n.IsEdit==!0&&n.RowNo==u});f.length==0&&$("#dateremarks_grid").jqGrid("hideCol","Action");role.toLowerCase()=="report viewer"&&$("#dateremarks_grid").jqGrid("hideCol","Action")}function createcolmodels(n,t,i,r){var o;var f="",h=dateremarks_arr[n],u=grid_arr_new.findIndex(function(n){return n.RowNo==t}),e=[];if(h.length>0){o=dateremarks_arr[n].findIndex(function(n){return n.IsNew==!0&&n.RowNo==t});o>-1&&(dateremarks_arr[n][o].Date=structuredClone(grid_arr_new[u][i]));e=dateremarks_arr[n].filter(function(n){return n.RowNo==t});var s=grid_arr_new[u][n],c=grid_arr_new[u].IsNew,l=grid_arr_new[u].IsChanged,a=grid_arr_new[u][i],v=grid_arr[u][i];c==!1&&(v!=a?l&&(s===""||s===null)||$("."+r+t+"_valid").addClass("_hide"):$("."+r+t+"_valid").addClass("_hide"))}$(".dataremarksproduct").text(grid_arr_new[u].ProductName);$(".dateremarkscolumn").val(n);$(".dateremarksdatecolumn").val(i);$(".dateremarksvalidclass").val(r);$(".dateremarksrowno").val(t);$(".dataremarkstitle").text(f+" Remarks");$(".dateremarkstext").val("");n=="BaselineTTDRemarks"?(f="Baseline TTD",createRemarksGrid(e,basettdcolmodels)):n=="BaselineProductionRemarks"?(f="Baseline Production",createRemarksGrid(e,baseprodcolmodels)):n=="TTDTargetRemarks"?(f="TTD Target",createRemarksGrid(e,ttdtargetcolmodels)):n=="ProductionTargetRemarks"&&(f="Production Target",createRemarksGrid(e,prodtargetcolmodels));$("#dateremarksmodal").modal("show")}function saveeditedRemarks(){var t=$(".dateremarkstext").val().trim(),r=parseInt($(".dateremarksrowno").val()),n=$(".dateremarkscolumn").val(),u=$(".dateremarksdatecolumn").val(),f=$(".dateremarksvalidclass").val(),i=parseInt($(".ttdlineno").val());$.ajax({type:"POST",url:ROOT+"TTDDashboard/UpdateSavedRemarks","async":!1,data:{DateAndRemarksId:i,Type:n,Remarks:t},success:function(r){if(r.includes("Successfully")){alert("Remarks Updated Successfully");var u=dateremarks_arr[n].findIndex(function(n){return n.TTDLineNo==i});dateremarks_arr[n][u].Remarks=t}},error:function(n){alert(n)}})}function createHistortGrid(n,t){$.jgrid.gridUnload("#history_grid");$("#history_grid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:t,loadonce:!0,width:500,viewrecords:!0,pager:"#history_pager",rowNum:n.length,scroll:1,gridComplete:function(){var t=$("#history_grid tbody tr"),r=$("#history_grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#history_grid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 400px)"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});var r=$(".ui-jqgrid-bdiv").find("tbody").height();r>50?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","4px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"))}var dropdowndata=[],colmodels;$grid=$("#TTDDashboard_grid");var grid_arr=[],grid_arr_new=[],productnames_arr=[],role=$("#Role").val(),year_old="",prod_old="",dateremarks_arr={BaselineTTDRemarks:[],BaselineProductionRemarks:[],TTDTargetRemarks:[],ProductionTargetRemarks:[]},isExport=!0;$(document).ready(function(){$(".second_header").addClass("d-none");var n=new Date,t=new Date(n.getFullYear(),n.getMonth(),n.getDate());$("#ProdYear").datepicker("destroy");$("#ProdYear").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years",todayHighlight:!0,autoclose:!0,endDate:((new Date).getFullYear()+1).toString()});$("#ProdYear").datepicker("setDate",t);$("#ProdName").val("").trigger("change");year_old=$("#ProdYear").val();prod_old=$("#ProdName").val();$(".hidelegends").show();$("#btnsearch").trigger("click")});colmodels=[{name:"TTDHeaderId",label:"Header Id",width:70,resizable:!0,ignoreCase:!0,hidden:!0,frozen:!0,sortable:!1},{name:"RowNo",label:"Row",width:70,resizable:!0,ignoreCase:!0,hidden:!0,frozen:!0,sortable:!1},{name:"Action",label:"Action",width:80,resizable:!0,ignoreCase:!0,frozen:!0,search:!1,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form action_icons icons_'+i.RowNo+'"><span class="mr-2 deleterow _hide deleterow_'+i.RowNo+'" data-lineno="'+i.RowNo+'" title="Delete"><i class="fas fa-trash color-delete"><\/i><\/span><span class="mr-2 editrow _hide editrow_'+i.RowNo+'" data-lineno="'+i.RowNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><span class="mr-2 cancelrow _hide cancelrow_'+i.RowNo+'"  data-lineno="'+i.RowNo+'"  title="Close" ><i class="fas fa-times-circle color-history"><\/i><\/span><span class="mr-2 saverow _hide saverow_'+i.RowNo+'" data-lineno="'+i.RowNo+'" title="Save" ><i class="fas fa-save color-file"><\/i><\/span><\/div>'}},{name:"ProductionTargetYear",label:"Year",width:50,resizable:!0,ignoreCase:!0,frozen:!0,sortable:!1,hidden:!0,exportcol:!1},{name:"ProjectBriefId",label:"Project Brief Id",width:90,resizable:!0,ignoreCase:!0,frozen:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form projectbriefid_div"><input type="text" class="form-control projectbriefid removespecials updatevalue projectbriefid_selected_'+i.RowNo+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ProjectBriefId+'"><span class="text-danger _hide errortext valid  projectbrief_selected_'+i.RowNo+'_valid" >Please enter valid Project Brief Number or NA<\/span><\/div>'}},{name:"ProductName",label:"Product",width:200,resizable:!0,ignoreCase:!0,frozen:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form product_div"><input type="text" title="'+i.ProductName+'" class="form-control product prodmarket removespaces updatevalue product_selected_'+i.RowNo+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ProductName+'"><span class="text-danger _hide errortext valid text-wrap product_selected_'+i.RowNo+'_valid">Please enter Product<\/span><\/div>'}},{name:"RDId",label:"R&D",width:90,resizable:!0,ignoreCase:!0,frozen:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><select class="form-control rd updatevalue rd_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" ><option value="0">Select<\/option><\/select > <\/div>'}},{name:"PackSizes",label:"Pack Sizes",resizable:!0,width:90,ignoreCase:!0,frozen:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><input type="text" class="form-control packsize removespaces updatevalue packsize_selected_'+i.RowNo+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"  value="'+i.PackSizes+'"><\/div>'}},{name:"ClassificationTypeId",label:"Classification",resizable:!0,ignoreCase:!0,width:90,frozen:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><select class="form-control classification updatevalue classification_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" ><option value="0">Select<\/option><\/select > <\/div>'}},{name:"PriorityTypeId",label:"Priority",resizable:!0,width:110,ignoreCase:!0,frozen:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><select class="form-control priority updatevalue priority_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" ><option value="0">Select<\/option><\/select > <\/div>'}},{name:"MarketTypeId",label:"Market",resizable:!0,width:120,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><select class="form-control market prodmarket updatevalue market_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" ><option value="0">Select<\/option><\/select > <span class="text-danger _hide errortext valid text-wrap market_selected_'+i.RowNo+'_valid">Please select Market<\/span><\/div>'}},{name:"CategoryId",label:"Category",resizable:!0,width:100,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><select class="form-control category updatevalue category_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" ><option value="0">Select<\/option><\/select > <\/div>'}},{name:"SubCategoryId",label:"Sub Category",resizable:!0,width:90,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><select class="form-control subcategory updatevalue subcategory_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" ><option value="0">Select<\/option><\/select > <\/div>'}},{name:"BriefAcceptedDate",label:"Brief Accepted Date",resizable:!0,width:120,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form remarks_icon"><div class="remarks_calender"><input type="text" title="'+i.BriefAcceptedDate+'" class="form-control briefaccepteddate updatevalue briefaccepteddate_selected_'+i.RowNo+'" data-datepicker  data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" data-datepicker="true"  value="'+i.BriefAcceptedDate+'"><span data-toggle="modal" data-target="#remarks_pop_"><i class="fas fa-calendar text-info"><\/i><\/span><\/div><\/div>'}},{name:"BusinessValueYear1",label:"Business value in <br> M$ (Year 1)",resizable:!0,width:118,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><input type="text" title="'+i.BusinessValueYear1+'" class="form-control onlydecimal updatevalue businessvalueyear1_selected_'+i.RowNo+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.BusinessValueYear1+'"><\/div>'}},{name:"BusinessValueYear2",label:"Business value in <br> M$ (Year 2)",resizable:!0,width:118,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><input type="text" title="'+i.BusinessValueYear2+'" class="form-control  onlydecimal updatevalue businessvalueyear2_selected_'+i.RowNo+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.BusinessValueYear2+'"><\/div>'}},{name:"BaselineTTDDate",label:"Baseline TTD Date",resizable:!0,width:120,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form remarks_icon"><div class="remarks_calender"><input type="text" title="'+i.BaselineTTDDate+'" class="form-control baselinettd updatevalue baselinettd_selected_'+i.RowNo+'" data-datepicker-monthyear1 data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.BaselineTTDDate+'"><span data-toggle="modal" data-target="#r"><i class="fas fa-calendar text-info"><\/i><\/span><\/div><span data-toggle="modal" data-valid="baselinettdremarks_selected_" data-rowno="'+i.RowNo+'" data-columnname="BaselineTTDRemarks" data-datecolumn="BaselineTTDDate" class="openremarksmodel"><i class="fas fa-info-circle text-primary"><\/i><\/span><\/div><span class="text-danger _hide errortext valid text-wrap baselinettdremarks_selected_'+i.RowNo+'_valid">Please enter Remarks<\/span>'}},{name:"BaselineProductionDate",label:"Baseline Production <br> Date",resizable:!0,width:125,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form remarks_icon"><div class="remarks_calender"><input type="text" title="'+i.BaselineProductionDate+'" class="form-control baselineprod updatevalue baselineproduction_selected_'+i.RowNo+'" data-datepicker-monthyear1 data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.BaselineProductionDate+'"><span data-toggle="modal" data-target="#remarks_pop_"><i class="fas fa-calendar text-info"><\/i><\/span><\/div><span data-toggle="modal" data-valid="baselineproductionremarks_selected_" data-rowno="'+i.RowNo+'" data-columnname="BaselineProductionRemarks" data-datecolumn="BaselineProductionDate" class="openremarksmodel"><i class="fas fa-info-circle text-primary"><\/i><\/span><\/div><span class="text-danger _hide errortext valid text-wrap baselineproductionremarks_selected_'+i.RowNo+'_valid">Please enter Remarks<\/span>'}},{name:"TTDTargetDate",label:"TTD Target Date",resizable:!0,width:120,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form remarks_icon"><div class="remarks_calender"><input type="text" title="'+i.TTDTargetDate+'" class="form-control ttdtarget updatevalue ttdtarget_selected_'+i.RowNo+'" data-datepicker-monthyear1 data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.TTDTargetDate+'"><span data-toggle="modal" data-target="#remarks_pop_"><i class="fas fa-calendar text-info"><\/i><\/span><\/div><span data-toggle="modal" data-valid="ttdtargetremarks_selected_" data-rowno="'+i.RowNo+'" data-columnname="TTDTargetRemarks" data-datecolumn="TTDTargetDate" class="openremarksmodel"><i class="fas fa-info-circle text-primary"><\/i><\/span><\/div><span class="text-danger _hide errortext valid text-wrap ttdtargetremarks_selected_'+i.RowNo+'_valid">Please enter Remarks<\/span>'}},{name:"ProductionTargetDate",label:"Production Target <br> Date",resizable:!0,width:125,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form remarks_icon"><div class="remarks_calender"><input type="text"  title="'+i.ProductionTargetDate+'"  class="form-control prodtarget updatevalue prodtarget_selected_'+i.RowNo+'" data-datepicker-monthyear1 data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ProductionTargetDate+'"><span data-toggle="modal" data-target="#remarks_pop_"><i class="fas fa-calendar text-info"><\/i><\/span><\/div><span data-toggle="modal" data-valid="prodtargetremarks_selected_" data-rowno="'+i.RowNo+'" data-columnname="ProductionTargetRemarks" data-datecolumn="ProductionTargetDate" class="openremarksmodel"><i class="fas fa-info-circle text-primary"><\/i><\/span><\/div><span class="text-danger _hide errortext valid text-wrap prodtargetremarks_selected_'+i.RowNo+'_valid">Please enter Remarks<\/span>'}},{name:"TTDTargetCommentId",label:"TTD Target Comments",resizable:!0,width:150,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><div style="display:flex;"><select class="form-control ttdcomments updatevalue ttdcomments_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.TTDTargetCommentId+'"><option value="0">Select<\/option><\/select > <span class="historydetails _hide ttdcommentshistory_'+i.RowNo+'" data-toggle="modal" data-rowno="'+i.RowNo+'" data-columnname="TTD Target Comments"><i class="fas fa-history ml-2 mr-1 mt-2 text-danger"><\/i><\/span><\/div><\/div>'}},{name:"ProductionTargetCommentId",label:"Production Target Comments",resizable:!0,width:160,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form"><div style="display:flex;"><select class="form-control prodcomments updatevalue prodtargetcomments_selected_'+i.RowNo+'" data-singleselect data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ProductionTargetCommentId+'"><option value="0">Select<\/option><\/select> <span class="historydetails _hide productioncommentshistory_'+i.RowNo+'" data-toggle="modal" data-rowno="'+i.RowNo+'" data-columnname="Production Target Comments"><i class="fas fa-history ml-2 mt-2 mr-1 text-danger "><\/i><\/span><\/div><\/div>'}},{name:"Remarks",label:"Remarks",resizable:!0,width:160,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return'<div class="text-center input_form "><div style="display:flex;"><input type="text" title="'+i.Remarks+'" class="form-control remarks removespaces updatevalue remarks_selected_'+i.RowNo+'"  data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.Remarks+'"><span class="historydetails _hide remarkshistory_'+i.RowNo+'" data-toggle="modal" data-rowno="'+i.RowNo+'" data-columnname="Remarks"><i class="fas fa-history ml-2 mr-1 mt-2 text-danger "><\/i><\/span><\/div><\/div><div class="text-center"><span class="text-danger _hide errortext valid text-wrap remarks_selected_'+i.RowNo+'_valid">Please enter Remarks<\/span><\/div>'}},{name:"ActionBy",label:"Last Updated By",resizable:!0,width:120,ignoreCase:!0,sortable:!1,formatter:function(n,t,i){return i.ActionBy==""?"":'<div class="text-center input_form "><div style="display:flex;"><span style="font-size:11px !important;" class="mr-1 mt-2 actionbyselected_'+i.RowNo+'">'+i.ActionBy+'<\/span><div><span class="historydetails updatedhistorydata_'+i.RowNo+'" data-toggle="modal" data-rowno="'+i.RowNo+'" data-columnname="ActionHistory"><i class="fas fa-history ml-2 mr-1 mt-2 text-danger "><\/i><\/span><\/div><\/div><\/div>'}}];$(document).off("click","#btnsearch").on("click","#btnsearch",function(){var i=validatechangeddata(grid_arr_new),t,n;i?confirmSearch("There are unsaved changes, Are you sure you want to continue ?",function(){var t=$("#ProdYear").val(),n=$("#ProdName option:selected").text();year_old=$("#ProdYear").val();prod_old=$("#ProdName").val();n=n==="Select"?"":n;$.ajax({type:"GET",url:ROOT+"TTDDashboard/GetTTDData",data:{prodyear:t,product:n},"async":!1,success:function(n){grid_arr_new=[];n!=""&&n.length>0&&getSavedData(n);getGridData();grid_arr=structuredClone(grid_arr_new);createTTDGrid(grid_arr_new);bindproductnamesdropdown();binddateremarksdata()},error:function(n){alert(n)}})},function(){$("#ProdYear").val(year_old);$("#ProdName").val(prod_old).trigger("change")}):(t=$("#ProdYear").val(),n=$("#ProdName option:selected").text(),n=n==="Select"?"":n,year_old=$("#ProdYear").val(),prod_old=$("#ProdName").val(),$.ajax({type:"GET",url:ROOT+"TTDDashboard/GetTTDData",data:{prodyear:t,product:n},"async":!1,success:function(n){grid_arr_new=[];n!=""&&n.length>0&&getSavedData(n);getGridData();grid_arr=structuredClone(grid_arr_new);createTTDGrid(grid_arr_new);bindproductnamesdropdown();binddateremarksdata()},error:function(n){alert(n)}}))});$(document).off("click","#btnrefresh").on("click","#btnrefresh",function(){var i=validatechangeddata(grid_arr_new),n,t;i?confirm("There are unsaved changes, Are you sure you want to refresh ?",function(){var n=new Date,t=new Date(n.getFullYear(),n.getMonth(),n.getDate());$("#ProdYear").datepicker("destroy");$("#ProdYear").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years",todayHighlight:!0,autoclose:!0,endDate:((new Date).getFullYear()+1).toString()});$("#ProdYear").datepicker("setDate",t);$("#ProdName").val("").trigger("change");grid_arr_new=[];$("#btnsearch").trigger("click")}):(n=new Date,t=new Date(n.getFullYear(),n.getMonth(),n.getDate()),$("#ProdYear").datepicker("destroy"),$("#ProdYear").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years",todayHighlight:!0,autoclose:!0,endDate:((new Date).getFullYear()+1).toString()}),$("#ProdYear").datepicker("setDate",t),$("#ProdName").val("").trigger("change"),grid_arr_new=[],$("#btnsearch").trigger("click"))});$(document).off("click","#addbtn").on("click","#addbtn",function(){var n=0,t,i,r;grid_arr_new.length===0?n=n+1:(t=grid_arr_new.map(function(n){return n.RowNo}),i=Math.max(...t),n=i+1);grid_arr_new.unshift({TTDHeaderId:"",RowNo:n,ProductionTargetYear:year_old,ProjectBriefId:"",ProductName:"",RDId:"0",PackSizes:"",ClassificationTypeId:"0",PriorityTypeId:"0",MarketTypeId:"0",CategoryId:"0",SubCategoryId:"0",BriefAcceptedDate:"",BusinessValueYear1:"",BusinessValueYear2:"",BaselineTTDDate:"",BaselineTTDRemarks:"",BaselineProductionDate:"",BaselineProductionRemarks:"",TTDTargetDate:"",TTDTargetRemarks:"",ProductionTargetDate:"",ProductionTargetRemarks:"",TTDTargetCommentId:"0",ProductionTargetCommentId:"0",Remarks:"",ActionBy:"",IsEdit:!0,IsNew:!0,IsActive:!0,IsChanged:!1,IsTTDComment:!1,IsProductionComment:!1,IsRemarks:!1,BaselineTTDRemarks_HasRemarks:!1,BaselineProductionRemarks_HasRemarks:!1,TTDTargetRemarks_HasRemarks:!1,ProductionTargetRemarks_HasRemarks:!1,LoginId:""});r=grid_arr_new.findIndex(function(t){return t.RowNo==n});grid_arr.unshift(structuredClone(grid_arr_new[r]));createTTDGrid(grid_arr_new)});$(document).off("click",".editrow").on("click",".editrow",function(){var r=$(this),n=parseInt($(r).data("lineno")),t=grid_arr_new.findIndex(t=>t.RowNo===n),i;t>=0&&(grid_arr_new[t].IsEdit=!0,grid_arr[t].IsEdit=!0,i=grid_arr_new[t].IsNew,i==!0?($(".deleterow_"+n).removeClass("_hide"),$(".editrow_"+n).addClass("_hide"),$(".cancelrow_"+n).addClass("_hide"),$(".saverow_"+n).addClass("_hide")):($(".deleterow_"+n).removeClass("_hide"),$(".editrow_"+n).addClass("_hide"),$(".cancelrow_"+n).removeClass("_hide"),$(".saverow_"+n).removeClass("_hide")),$(".trrowno_"+n+" .form-control").attr("disabled",!1))});$(document).off("click",".cancelrow").on("click",".cancelrow",function(){var r=$(this),n=parseInt($(r).data("lineno")),t=grid_arr_new.findIndex(t=>t.RowNo===n),i;t>=0&&(grid_arr_new[t].IsEdit=!1,grid_arr[t].IsEdit=!1,grid_arr[t].IsChanged=!1,grid_arr_new[t].IsChanged=!1,i=grid_arr_new[t].IsNew,i==!0?($(".deleterow_"+n).removeClass("_hide"),$(".editrow_"+n).addClass("_hide"),$(".cancelrow_"+n).addClass("_hide"),$(".saverow_"+n).addClass("_hide")):($(".deleterow_"+n).removeClass("_hide"),$(".editrow_"+n).removeClass("_hide"),$(".cancelrow_"+n).addClass("_hide"),$(".saverow_"+n).addClass("_hide")),$(".trrowno_"+n+" .form-control").attr("disabled",!0),$(".trrowno_"+n+" .errortext").addClass("_hide"),grid_arr_new[t]=structuredClone(grid_arr[t]),updateRowData(n))});$(document).off("click",".deleterow").on("click",".deleterow",function(){var t=$(this),n=parseInt($(t).data("lineno")),i=grid_arr_new.findIndex(function(t){return t.RowNo==n});confirm("Are you sure you want to Delete?",function(){$.ajax({url:ROOT+"TTDDashboard/DeleteTTDData",type:"POST",data:{ttdHeaderId:grid_arr_new[i].TTDHeaderId},success:function(t){var i=grid_arr_new.findIndex(t=>t.RowNo===n);i>=0&&(grid_arr_new[i].IsActive=!1,grid_arr[i]=structuredClone(grid_arr_new[i]));createTTDGrid(grid_arr_new);showAlertMessage(t,"alert-danger")}})})});$(document).off("click",".saverow").on("click",".saverow",function(){var o=$(this),t=parseInt($(o).data("lineno")),n=grid_arr_new.filter(function(n){return n.RowNo==t}),s=n.filter(function(n){return n.ProductionTargetYear!=year_old||n.ProjectBriefId!=""||n.ProductName!=""||n.RDId!="0"||n.PackSizes!=""||n.PackSizes!=""||n.ClassificationTypeId!="0"||n.PriorityTypeId!="0"||n.MarketTypeId!="0"||n.CategoryId!="0"||n.SubCategoryId!="0"||n.BriefAcceptedDate!=""||n.BusinessValueYear1!=""||n.BusinessValueYear2!=""||n.BaselineTTDDate!=""||n.BaselineTTDRemarks!=""||n.BaselineProductionDate!=""||n.BaselineProductionRemarks!=""||n.TTDTargetDate!=""||n.TTDTargetRemarks!=""||n.ProductionTargetDate!=""||n.ProductionTargetRemarks!=""||n.TTDTargetCommentId!="0"||n.ProductionTargetCommentId!="0"||n.Remarks!=""}),u,f,e,i,r;s.length>0?(u=validatechangeddata(n),u?(f=validatedata(n),f&&(e=n.filter(function(n){return n.IsChanged==!0&&n.IsNew==!1&&n.Remarks==""}),i=[],$.each(e,function(n,t){i.push(t.ProductName)}),r=i.join(","),r==""?confirm("Are you sure you want to Save?",function(){var i=structuredClone(n.filter(function(n){return n.IsChanged==!0})),r;$.each(i,function(n,t){t.BriefAcceptedDate=convertStringDateFormat(t.BriefAcceptedDate);var i=grid_arr.findIndex(function(n){return n.RowNo===t.RowNo});t.BaselineTTDDate==grid_arr[i].BaselineTTDDate&&t.BaselineTTDRemarks==grid_arr[i].BaselineTTDRemarks&&(t.BaselineTTDDate="",t.BaselineTTDRemarks="");t.BaselineProductionDate==grid_arr[i].BaselineProductionDate&&t.BaselineProductionRemarks==grid_arr[i].BaselineProductionRemarks&&(t.BaselineProductionDate="",t.BaselineProductionRemarks="");t.TTDTargetDate==grid_arr[i].TTDTargetDate&&t.TTDTargetRemarks==grid_arr[i].TTDTargetRemarks&&(t.TTDTargetDate="",t.TTDTargetRemarks="");t.ProductionTargetDate==grid_arr[i].ProductionTargetDate&&t.ProductionTargetRemarks==grid_arr[i].ProductionTargetRemarks&&(t.ProductionTargetDate="",t.ProductionTargetRemarks="");t.TTDTargetCommentId==grid_arr[i].TTDTargetCommentId&&(t.TTDTargetCommentId=0);t.ProductionTargetCommentId==grid_arr[i].ProductionTargetCommentId&&(t.ProductionTargetCommentId=0);t.Remarks==grid_arr[i].Remarks&&(t.Remarks="")});r={TTDData:i};$.ajax({url:ROOT+"TTDDashboard/SaveTTDData",type:"POST",data:{ttdDashboard:r},success:function(n){var i,r;n.toLowerCase().includes("success")?(i=grid_arr_new.findIndex(n=>n.RowNo===t),i>=0&&(grid_arr_new[i].IsNew=!1,grid_arr_new[i].IsEdit=!1,grid_arr_new[i].IsChanged=!1,r=grid_arr_new[i].LoginId,grid_arr_new[i].ActionBy=r,$(".actionbyselected_"+t).text(r),grid_arr_new[i].BaselineTTDRemarks_HasRemarks=!1,grid_arr_new[i].BaselineProductionRemarks_HasRemarks=!1,grid_arr_new[i].TTDTargetRemarks_HasRemarks=!1,grid_arr_new[i].ProductionTargetRemarks_HasRemarks=!1,grid_arr_new[i].BaselineTTDRemarks="",grid_arr_new[i].BaselineProductionRemarks="",grid_arr_new[i].TTDTargetRemarks="",grid_arr_new[i].ProductionTargetRemarks="",(grid_arr_new[i].Remarks!=""||grid_arr[i].IsRemarks==!0)&&(grid_arr_new[i].IsRemarks=!0),(grid_arr_new[i].TTDTargetCommentId!=0||grid_arr[i].IsTTDComment==!0)&&(grid_arr_new[i].IsTTDComment=!0),(grid_arr_new[i].ProductionTargetCommentId!=0||grid_arr[i].IsProductionComment==!0)&&(grid_arr_new[i].IsProductionComment=!0),grid_arr[i]=structuredClone(grid_arr_new[i])),bindActions(),bindproductnamesdropdown(),binddateremarksdata(),showAlertMessage(n,"alert-success")):showAlertMessage(n,"alert-danger")}})}):alert("Please enter Remarks for the following Product : <strong>"+r+"<\/strong>"))):alert("There are no changes to Save")):alert("There is no data to Save")});$(document).off("click","#savebtn").on("click","#savebtn",function(){var n=grid_arr_new.filter(function(n){return n.IsActive==!0}),e=n.filter(function(n){return n.ProductionTargetYear!=year_old||n.ProjectBriefId!=""||n.ProductName!=""||n.RDId!="0"||n.PackSizes!=""||n.PackSizes!=""||n.ClassificationTypeId!="0"||n.PriorityTypeId!="0"||n.MarketTypeId!="0"||n.CategoryId!="0"||n.SubCategoryId!="0"||n.BriefAcceptedDate!=""||n.BusinessValueYear1!=""||n.BusinessValueYear2!=""||n.BaselineTTDDate!=""||n.BaselineTTDRemarks!=""||n.BaselineProductionDate!=""||n.BaselineProductionRemarks!=""||n.TTDTargetDate!=""||n.TTDTargetRemarks!=""||n.ProductionTargetDate!=""||n.ProductionTargetRemarks!=""||n.TTDTargetCommentId!="0"||n.ProductionTargetCommentId!="0"||n.Remarks!=""}),r,u,f,t,i;e.length>0?(r=validatechangeddata(n),r?(u=validatedata(n),u&&(f=n.filter(function(n){return n.IsChanged==!0&&n.IsNew==!1&&n.Remarks==""}),t=[],$.each(f,function(n,i){t.push(i.ProductName)}),i=t.join(","),i==""?confirm("Are you sure you want to Save?",function(){var t=structuredClone(n.filter(function(n){return n.IsChanged==!0})),i;$.each(t,function(n,t){t.BriefAcceptedDate=convertStringDateFormat(t.BriefAcceptedDate);var i=grid_arr.findIndex(function(n){return n.RowNo===t.RowNo});t.BaselineTTDDate==grid_arr[i].BaselineTTDDate&&t.BaselineTTDRemarks==grid_arr[i].BaselineTTDRemarks&&(t.BaselineTTDDate="",t.BaselineTTDRemarks="");t.BaselineProductionDate==grid_arr[i].BaselineProductionDate&&t.BaselineProductionRemarks==grid_arr[i].BaselineProductionRemarks&&(t.BaselineProductionDate="",t.BaselineProductionRemarks="");t.TTDTargetDate==grid_arr[i].TTDTargetDate&&t.TTDTargetRemarks==grid_arr[i].TTDTargetRemarks&&(t.TTDTargetDate="",t.TTDTargetRemarks="");t.ProductionTargetDate==grid_arr[i].ProductionTargetDate&&t.ProductionTargetRemarks==grid_arr[i].ProductionTargetRemarks&&(t.ProductionTargetDate="",t.ProductionTargetRemarks="");t.TTDTargetCommentId==grid_arr[i].TTDTargetCommentId&&(t.TTDTargetCommentId=0);t.ProductionTargetCommentId==grid_arr[i].ProductionTargetCommentId&&(t.ProductionTargetCommentId=0);t.Remarks==grid_arr[i].Remarks&&(t.Remarks="")});i={TTDData:t};$.ajax({url:ROOT+"TTDDashboard/SaveTTDData",type:"POST",data:{ttdDashboard:i},success:function(n){n.toLowerCase().includes("success")?(grid_arr_new=[],$("#btnsearch").trigger("click"),showAlertMessage(n,"alert-success")):showAlertMessage(n,"alert-danger")}})}):alert("Please enter Remarks for the following Products : <strong>"+i+"<\/strong>"))):alert("There are no changes to Save")):alert("There is no data to Save")});$(document).on("change",".updatevalue",function(){updateGridArray(this)});$(document).on("change",".product",function(){var i=$(this),t=$(this).val(),n=parseInt($(i).data("lineno")),r=grid_arr_new.filter(function(t){return t.RowNo==n}),u=r.findIndex(function(n){return n.IsChanged==!0});(t===""||t===null)&&u>-1?$(".product_selected_"+n+"_valid").removeClass("_hide"):$(".product_selected_"+n+"_valid").addClass("_hide")});$(document).on("change",".prodmarket",function(){var f=$(this),n=parseInt($(f).data("lineno")),s=$(f).data("name"),t=grid_arr_new.findIndex(function(t){return t.RowNo==n}),h=grid_arr_new.filter(function(t){return t.RowNo==n}),i=grid_arr_new[t].ProductName,r=grid_arr_new[t].MarketTypeId,c=h.findIndex(function(t){return t.IsChanged==!0&&t.RowNo==n}),e,o;if(!((i===""||i===null)&&c>-1)){var l=year_old,a=productnames_arr.filter(function(n){return parseInt(n.ProductionTargetYear)!=parseInt(l)}),u=[],v=grid_arr_new.filter(function(n){return n.IsActive==!0});$.each(v,function(n,t){if(t.ProductName!=""&&t.ProductName!=null){var i=u.findIndex(function(n){return t.ProductName.toLowerCase()===n.ProductName.toLowerCase()&&t.RowNo==n.RowNo});i==-1&&u.push({RowNo:t.RowNo,ProductName:t.ProductName,MarketTypeId:t.MarketTypeId})}});e=a.findIndex(function(n){return n.ProductName.trim().toLowerCase()==i.trim().toLowerCase()&&n.MarketTypeId==r});o=u.findIndex(function(t){return t.ProductName.trim().toLowerCase()==i.trim().toLowerCase()&&t.MarketTypeId==r&&parseInt(t.RowNo)!=n});r!=""&&r!="0"&&(e>-1||o>-1)&&(alert("Product and Market Combination already exists"),s=="ProductName"?(grid_arr_new[t].ProductName=grid_arr[t].ProductName,$(".product_selected_"+n).val(grid_arr[t].ProductName)):($(".trrowno_"+n).find(".market").select2("destroy"),grid_arr_new[t].MarketTypeId="0",$(".market_selected_"+n).val("0"),$(".trrowno_"+n).find(".market").select2()),updateIsChanged(n))}$(".market_selected_"+n+"_valid").addClass("_hide")});$(document).on("change",".projectbriefid",function(){var i=$(this),n=$(this).val(),t=parseInt($(i).data("lineno")),r=new RegExp("^(PB\\d{6}|NA)$");r.test(n)||n===""?$(".projectbrief_selected_"+t+"_valid").addClass("_hide"):$(".projectbrief_selected_"+t+"_valid").removeClass("_hide")});$(document).on("change",".category",function(){var f=$(this),e=$(this).val(),t=parseInt($(f).data("lineno")),r=dropdowndata.filter(function(n){return n.Type.trim().toLowerCase()==="ttdsubcategory"&&n.DependOnType.trim().toLowerCase()=="ttdcategory"&&n.DependOnValue==e}),i=$(".trrowno_"+t+" .subcategory"),n,u;$(i).html("");n='<option value="0">Select<\/option>';r!=""&&r.forEach(function(t){n=n+'<option value="'+t.Value+'">'+t.Text+"<\/option>"});$(i).append(n);$(i).select2();u=grid_arr_new.findIndex(function(n){return n.RowNo==t});grid_arr_new[u].SubCategoryId="0";updateIsChanged(t)});$(document).on("change",".remarks",function(){var i=$(this),t=$(this).val(),n=parseInt($(i).data("lineno")),r=grid_arr_new.filter(function(t){return t.RowNo==n}),u=r.findIndex(function(n){return n.IsChanged==!0&&n.IsNew==!1});(t===""||t===null)&&u>-1?$(".remarks_selected_"+n+"_valid").removeClass("_hide"):$(".remarks_selected_"+n+"_valid").addClass("_hide")});$(document).on("change",".form-control",function(){syncRowHeights()});$("body").on("input",".removespaces",function(){this.value=this.value.replace(/\s+/g," ").replace(/^\s+/,"")});$("body").on("input",".removespecials",function(){this.value=this.value.replace(/[^a-zA-Z0-9]/g,"")});$("body").on("input",".onlydecimal",function(){this.value=this.value.replace(/[^0-9.]/g,"");this.value=this.value.replace(/^0+(\d)/,"$1")});$("body").on("change",".onlydecimal",function(){this.value=this.value!=""?parseFloat(this.value).toFixed(2):""});resizeColumnHeader=function(){var n,t=$(this).closest("div.ui-jqgrid-view").find("table.ui-jqgrid-htable>thead>tr.ui-jqgrid-labels");n=t.height();t.find("div.ui-jqgrid-sortable").each(function(){var t=$(this);t.css("top",(n-t.outerHeight())/2+"px")})};fixPositionsOfFrozenDivs=function(){var n;typeof this.grid.fbDiv!="undefined"&&(n=$(">div>table.ui-jqgrid-btable>tbody>tr",this.grid.bDiv),$(">table.ui-jqgrid-btable>tbody>tr",this.grid.fbDiv).each(function(t){var i=$(n[t]).height(),r=$(this).height();$(this).hasClass("jqgrow")&&($(this).height(i),r=$(this).height(),i!==r&&$(this).height(i+(i-r)))}),$(this.grid.fbDiv).height(this.grid.bDiv.clientHeight),$(this.grid.fbDiv).css($(this.grid.bDiv).position()));typeof this.grid.fhDiv!="undefined"&&(n=$(">div>table.ui-jqgrid-htable>thead>tr",this.grid.hDiv),$(">table.ui-jqgrid-htable>thead>tr",this.grid.fhDiv).each(function(t){var i=$(n[t]).height(),r=$(this).height();$(this).height(i);r=$(this).height();i!==r&&$(this).height(i+(i-r))}),$(this.grid.fhDiv).height(this.grid.hDiv.clientHeight),$(this.grid.fhDiv).css($(this.grid.hDiv).position()))};fixGboxHeight=function(){var n=$("#gview_"+$.jgrid.jqID(this.id)).outerHeight(),t=$(this.p.pager).outerHeight();$("#gbox_"+$.jgrid.jqID(this.id)).height(n+t);n=$("#gview_"+$.jgrid.jqID(this.id)).outerHeight();t=$(this.p.pager).outerHeight();$("#gbox_"+$.jgrid.jqID(this.id)).height(n+t)};var basettdcolmodels=[{name:"Action",label:"Action",width:100,resizable:!0,ignoreCase:!0,frozen:!0,search:!1,sortable:!1,formatter:function(n,t,i){return i.IsNew==!0?'<div class="text-center input_form action_icons"><span class="deletedateremarks deletedateremarksrow_'+i.RowNo+'" data-lineno="'+i.RowNo+'" title="Delete"><i class="fas fa-trash color-delete"><\/i><\/span><span class="ml-2 editdateremarks editdateremarksrow_'+i.RowNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>':'<div class="text-center input_form action_icons"><span class="ml-2 editdateremarks editdateremarksrow_'+i.RowNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>'}},{name:"Date",label:"Baseline TTD Date",width:100,align:"center",resizable:!0,ignoreCase:!0},{name:"Remarks",label:"Baseline TTD Remarks",width:350,resizable:!0,ignoreCase:!0},{name:"CreatedBy",label:"Submitted By",width:150,align:"center",resizable:!0,ignoreCase:!0},{name:"CreatedOn",label:"Submitted On",width:150,align:"center",resizable:!0,ignoreCase:!0},],baseprodcolmodels=[{name:"Action",label:"Action",width:100,resizable:!0,ignoreCase:!0,frozen:!0,search:!1,sortable:!1,formatter:function(n,t,i){return i.IsNew==!0?'<div class="text-center input_form action_icons"><span class="deletedateremarks deletedateremarksrow_'+i.RowNo+'" data-lineno="'+i.RowNo+'" title="Delete"><i class="fas fa-trash color-delete"><\/i><\/span><span class="ml-2 editdateremarks editdateremarksrow_'+i.TTDLineNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>':'<div class="text-center input_form action_icons"><span class="ml-2 editdateremarks editdateremarksrow_'+i.TTDLineNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>'}},{name:"Date",label:"Baseline Production Date",width:100,align:"center",resizable:!0,ignoreCase:!0},{name:"Remarks",label:"Baseline Production Remarks",width:350,resizable:!0,ignoreCase:!0},{name:"CreatedBy",label:"Submitted By",width:150,align:"center",resizable:!0,ignoreCase:!0},{name:"CreatedOn",label:"Submitted On",width:150,align:"center",resizable:!0,ignoreCase:!0},],ttdtargetcolmodels=[{name:"Action",label:"Action",width:100,resizable:!0,ignoreCase:!0,frozen:!0,search:!1,sortable:!1,formatter:function(n,t,i){return i.IsNew==!0?'<div class="text-center input_form action_icons"><span class="deletedateremarks deletedateremarksrow_'+i.RowNo+'" data-lineno="'+i.RowNo+'" title="Delete"><i class="fas fa-trash color-delete"><\/i><\/span><span class="ml-2 editdateremarks editdateremarksrow_'+i.RowNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>':'<div class="text-center input_form action_icons"><span class="ml-2 editdateremarks editdateremarksrow_'+i.RowNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>'}},{name:"Date",label:"TTD Target Date",width:100,align:"center",resizable:!0,ignoreCase:!0},{name:"Remarks",label:"TTD Target Remarks",width:350,resizable:!0,ignoreCase:!0},{name:"CreatedBy",label:"Submitted By",width:150,align:"center",resizable:!0,ignoreCase:!0},{name:"CreatedOn",label:"Submitted On",width:150,align:"center",resizable:!0,ignoreCase:!0},],prodtargetcolmodels=[{name:"Action",label:"Action",width:100,resizable:!0,ignoreCase:!0,frozen:!0,search:!1,sortable:!1,formatter:function(n,t,i){return i.IsNew==!0?'<div class="text-center input_form action_icons"><span class="deletedateremarks deletedateremarksrow_'+i.RowNo+'" data-lineno="'+i.RowNo+'" title="Delete"><i class="fas fa-trash color-delete"><\/i><\/span><span class="ml-2 editdateremarks editdateremarksrow_'+i.RowNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>':'<div class="text-center input_form action_icons"><span class="ml-2 editdateremarks editdateremarksrow_'+i.RowNo+'" data-lineno="'+i.TTDLineNo+'" title="Edit"><i class="fas fa-pen text-primary"><\/i><\/span><\/div>'}},{name:"Date",label:"Production Target Date",width:100,align:"center",resizable:!0,ignoreCase:!0},{name:"Remarks",label:"Production Target Remarks",width:350,resizable:!0,ignoreCase:!0},{name:"CreatedBy",label:"Submitted By",width:150,align:"center",resizable:!0,ignoreCase:!0},{name:"CreatedOn",label:"Submitted On",width:150,align:"center",resizable:!0,ignoreCase:!0},];$(document).off("click",".openremarksmodel").on("click",".openremarksmodel",function(){var t=parseInt($(this).data("rowno")),i=$(this).data("columnname"),r=$(this).data("datecolumn"),u=$(this).data("valid"),n;$("#remarks_mandate").addClass("_hide");$(".ttdlineno").val(0);n=grid_arr_new.findIndex(function(n){return n.RowNo==t});grid_arr_new[n].IsEdit!=!0||grid_arr_new[n][i+"_HasRemarks"]?($(".remarksedit").attr("disabled",!0),$(".remarksedit").hide()):($(".remarksedit").attr("disabled",!1),$(".remarksedit").show());createcolmodels(i,t,r,u)});$(document).off("click",".adddateremarks").on("click",".adddateremarks",function(){var r=$(".dateremarkstext").val().trim(),t=parseInt($(".dateremarksrowno").val()),n=$(".dateremarkscolumn").val(),e=$(".dateremarksdatecolumn").val(),o=$(".dateremarksvalidclass").val(),s=parseInt($(".ttdlineno").val()),u,f,i;r==""||r==null?$("#remarks_mandate").removeClass("_hide"):($("#remarks_mandate").addClass("_hide"),s>0?saveeditedRemarks():(i=grid_arr_new.findIndex(function(n){return n.RowNo==t}),i>=0&&(grid_arr_new[i][n]=r,grid_arr_new[i][n+"_HasRemarks"]=!0),u=dateremarks_arr[n],f=-1,u!=""&&u!=null&&(f=u.findIndex(function(n){return n.RowNo==t&&n.IsNew==!0})),f==-1?dateremarks_arr[n].push({RowNo:t,Date:"",Remarks:r,CreatedBy:"",CreatedOn:"",IsNew:!0}):dateremarks_arr[n][f].Remarks=r),$(".dateremarkstext").val(""),$(".ttdlineno").val(0),updateIsChanged(t),i=dateremarks_arr[n].findIndex(function(n){return n.RowNo===t&&n.IsNew==!0&&n.Remarks==""}),i>-1?($(".remarksedit").attr("disabled",!1),$(".remarksedit").show()):($(".remarksedit").attr("disabled",!0),$(".remarksedit").hide()),createcolmodels(n,t,e,o))});$(document).off("click",".deletedateremarks").on("click",".deletedateremarks",function(){var u=$(".dateremarkstext").val(),t=parseInt($(".dateremarksrowno").val()),n=$(".dateremarkscolumn").val(),i=$(".dateremarksdatecolumn").val(),r=$(".dateremarksvalidclass").val();confirm("Are you sure, you want to Delete Remarks",function(){var e=grid_arr_new.findIndex(function(n){return n.RowNo==t}),u,f;e>=0&&(grid_arr_new[e][n]="",grid_arr_new[e][n+"_HasRemarks"]=!1);u=dateremarks_arr[n];f=-1;u!=""&&u!=null&&(f=u.findIndex(function(n){return n.RowNo==t&&n.IsNew==!0}));f>-1&&(dateremarks_arr[n][f].Remarks="");updateIsChanged(t);$(".remarksedit").attr("disabled",!1);$(".remarksedit").show();createcolmodels(n,t,i,r);$("#remarks_mandate").addClass("_hide")})});$(document).off("click",".editdateremarks").on("click",".editdateremarks",function(){var n,t;var u=parseInt($(".dateremarksrowno").val()),i=$(".dateremarkscolumn").val(),e=$(".dateremarksdatecolumn").val(),o=$(".dateremarksvalidclass").val(),f=$(this),r=parseInt($(f).data("lineno"));$(".ttdlineno").val(r);r>0?(n=dateremarks_arr[i],t=-1,n!=""&&n!=null&&(t=n.findIndex(function(n){return n.TTDLineNo==r}))):(n=dateremarks_arr[i],t=-1,n!=""&&n!=null&&(t=n.findIndex(function(n){return n.RowNo==u})));t>-1&&(remarks=dateremarks_arr[i][t].Remarks,$(".dateremarkstext").val(remarks));$(".dateremarkstext").val(remarks);$(".remarksedit").attr("disabled",!1);$(".remarksedit").show();$("#remarks_mandate").addClass("_hide")});var historyttdtargetremarks=[{name:"Remarks",label:"TTD Target Remarks",width:300,resizable:!0,ignoreCase:!0},{name:"CreatedBy",label:"Submitted By",width:150,resizable:!0,ignoreCase:!0,align:"center"},{name:"CreatedOn",label:"Submitted On",width:100,resizable:!0,ignoreCase:!0,align:"center"},],historyproductiontargetremarks=[{name:"Remarks",label:"Production Target Remarks",width:300,resizable:!0,ignoreCase:!0},{name:"CreatedBy",label:"Submitted By",width:150,resizable:!0,ignoreCase:!0,align:"center"},{name:"CreatedOn",label:"Submitted On",width:100,resizable:!0,ignoreCase:!0,align:"center"},],historyremarks=[{name:"Remarks",label:"Remarks",width:300,resizable:!0,ignoreCase:!0},{name:"CreatedBy",label:"Submitted By",width:150,resizable:!0,ignoreCase:!0},{name:"CreatedOn",label:"Submitted On",width:100,resizable:!0,ignoreCase:!0},],historyaction=[{name:"Action",label:"Action",width:100,resizable:!0,ignoreCase:!0},{name:"ActionBy",label:"Action By",width:150,resizable:!0,ignoreCase:!0},{name:"ActionOn",label:"Action On",width:100,resizable:!0,ignoreCase:!0},];$(document).off("click",".historydetails").on("click",".historydetails",function(){var u=parseInt($(this).data("rowno")),i=$(this).data("columnname"),r=grid_arr_new.findIndex(function(n){return n.RowNo==u}),f=year_old,e=grid_arr_new[r].TTDHeaderId,n=i.replaceAll(" ",""),t="";n.toLowerCase()=="ttdtargetcomments"?t=historyttdtargetremarks:n.toLowerCase()=="productiontargetcomments"?t=historyproductiontargetremarks:n.toLowerCase()=="remarks"?t=historyremarks:n.toLowerCase()=="actionhistory"&&(t=historyaction);n.toLowerCase()=="actionhistory"?$(".historytitle").text("Action History"):$(".historytitle").text(i+" History");$(".historyproduct").text(grid_arr_new[r].ProductName);$.ajax({type:"GET",url:ROOT+"TTDDashboard/GetHistoryData",data:{prodyear:f,ttdheaderid:e,historytype:n},"async":!1,success:function(n){createHistortGrid(n,t);$("#historymodal").modal("show")},error:function(n){alert(n)}})});$(document).off("click",".btn-cancel").on("click",".btn-cancel",function(){$(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 240px)"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});var n=$(".ui-jqgrid-bdiv").find("tbody").height();n>130?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","4px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"))});$(document).off("click","#exceldownload").on("click","#exceldownload",function(){var t=!0,r=year_old,n=$("#ProdName option:selected").text(),i;n=="Select"&&(n="");i=$("#TTDDashboard_grid").jqGrid("getGridParam","data");i.length==0&&(alert("There is no data present in the grid"),t=!1);t&&(window.location.href=ROOT+"TTDDashboard/GetTTDExcelData?prodyear="+r+"&&product="+n)});window.confirmSearch=function(n,t,i){if($("#confirmpopupmesssage").empty().html(n),$("#confirmpopup").modal("show"),t){$("#ConfirmOKbutton").unbind("click");$("#ConfirmOKbutton").on("click",t)}if(i){$("#Confirmcancelbutton").unbind("click");$("#Confirmcancelbutton").on("click",i)}};