function UsageStatus(n){if(n!=null){if(n=="Red")return'<span class="red_circle"><\/span>';if(n=="Blue")return'<span class="purple_circle"><\/span>';if(n=="Yellow")return'<span class="yellow_circle"><\/span>';if(n=="Green")return'<span class="green_circle"><\/span>'}else return""}function ExcelDownload(n,t,i){var r=!0,u=$("#IngredientListGrid").jqGrid("getGridParam","data");u.length===0&&(alert("There is no data present in the grid"),r=!1);r&&(window.location.href=ROOT+"NewRID/DownloadRIDCosmeticsExcel?StartDate="+n+"&&EndDate="+t+"&searchText="+i)}function GetParticularIngredientData(n){var r=n.getAttribute("data-ingredientid"),f=n.getAttribute("data-ingredientname"),i=n.getAttribute("data-synonyms"),t,u;i==="null"&&(i="");t=n.getAttribute("data-casno");t==="null"&&(t="");u=n.getAttribute("data-function");$.ajax({type:"GET",url:ROOT+"NewRID/GetIngredientsRegulationById",data:{IngredientId:r},dataType:"JSON",success:function(n){$("#ParticularIngredientModal").modal("show");$.jgrid.gridUnload("#particular-ingredient-details");data=JSON.parse(n);createModalGrid();$("#ActiveIngredientName").text(f);$("#ActiveSynonymName").text(i);$("#ActiveCASName").text(t);$("#ActiveFunctions").text(u);$("#IngredientId").val(r)},error:function(){alert("Error occured!!")}})}function createModalGrid(){oldRegion="";$("#particular-ingredient-details").jqGrid({url:"",datatype:"local",data:data,mtype:"GET",colModel:IngridentColModels,loadonce:!0,viewrecords:!0,pager:"#particular-ingredient-details-pager",rowNum:data.length,scroll:1,gridComplete:function(){var t=$("#particular-ingredient-details tbody tr"),r=$("#particular-ingredient-details tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#particular-ingredient-details").closest(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 280px )"});$("#particular-ingredient-details").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var n=$("#particular-ingredient-details").closest(".ui-jqgrid-bdiv").find("tbody").height();n>280?($("#particular-ingredient-details").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#particular-ingredient-details").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#particular-ingredient-details").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#particular-ingredient-details").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}function ViewUploadedFiles(n,t){var i=parseInt($("#IngredientId").val());$.ajax({url:ROOT+"NewRID/DisplayUploadedFiles",type:"POST",dataType:"JSON",data:{IngredientId:i,RegionId:n,CategoryId:t},success:function(n){$.jgrid.gridUnload("#FileUploadjqgrid");var t=JSON.parse(n);$("#displayuploadedfiles").modal("show");CreateJQGridUploadFile(t)}})}function CreateJQGridUploadFile(n){$("#FileUploadjqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:IngredientFileColModels,loadonce:!0,viewrecords:!0,pager:"#FileUploadpager",rowNum:100,scroll:1,gridComplete:function(){var t=$("#FileUploadjqgrid tbody tr"),r=$("#FileUploadjqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 280px )"});$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var t=$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").find("tbody").height();t>280?($("#FileUploadjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#FileUploadjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#FileUploadjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#FileUploadjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}function downloadoc(n){var t=parseInt($("#IngredientId").val()),i=n.getAttribute("data-region"),r=n.getAttribute("data-category"),u=n.getAttribute("data-enclosure");window.location.href=ROOT+"NewRID/FileDownload?docName="+u+"&&ingredientId="+t+"&&regionId="+i+"&&categoryId="+r}function UsageStatusWithComments(n){if(n!=null){var t="",i="",r=n.indexOf("-");return t=n.substr(0,r),i=n.substr(r+1,n.length),t=="Blue"?`<span>`+i+`</span>`:t=="Green"?`<span>`+i+`</span>`:t=="Yellow"?`<span>`+i+`</span>`:t=="Red"?`<span>`+i+`</span>`:""}return""}function FormateDateForSearch(n){var t=n.getDate(),i=n.getMonth()+1;return t=(t<10?"0":"")+t,i=(i<10?"0":"")+i,n.getFullYear()+"-"+i+"-"+t}function GetSearchResult(n,t,i){$.ajax({type:"GET",url:ROOT+"NewRID/GetIngredientBasedOnSearch",data:{StartDate:n,EndDate:t,SearchText:i,Source:"RnD"},dataType:"JSON",success:function(n){var t=n;$("#IngredientListGrid").jqGrid("clearGridData");t!=undefined&&$("#IngredientListGrid").jqGrid("setGridParam",{data:t}).trigger("reloadGrid",[{page:1}])},error:function(){alert("Error occured!!")}})}function CheckValidIngredient(n){var t=ingredientNames.findIndex(function(t){return t.IngredientName.trim().toLowerCase()===n.trim().toLowerCase()});return t>-1?0:1}function CheckValidCASNumber(n){var t=CASNumbers.findIndex(function(t){return t.CASNumber.trim()===n.trim()});return t>-1?0:1}function UsageStatusWithCommentsForPopup(n){if(n!=null){var t="",i="";return t=t+n,t=="Blue"?`<span><span class="purple_circle"></span>`+i+`</span>`:t=="Green"?`<span><span class="green_circle"></span>`+i+`</span>`:t=="Yellow"?`<span><span class="yellow_circle"></span>`+i+`</span>`:t=="Red"?`<span><span class="red_circle"></span>`+i+`</span>`:""}return""}var oldRegion="",data=[],DivisionBasedIngredientList=[],ingredientNames=[],CASNumbers=[],IngridentColModels,IngredientFileColModels,$TableHeight;$(document).ready(function(){var t=new Date,r=new Date((new Date).setYear(t.getFullYear()+1)),n,u;$("[data-datepicker-startdate]").datepicker({format:"dd/mm/yyyy",endDate:r,autoclose:!0}).on("changeDate",function(){$("[data-datepicker-enddate]").datepicker("setStartDate",$(this).val())});$("[data-datepicker-enddate]").datepicker({format:"dd/mm/yyyy",startDate:t,endDate:r,autoclose:!0});n=$("#DivisionBasedIngredientListJson").val();n!=undefined&&n!=null&&n!=""&&(DivisionBasedIngredientList=$.parseJSON(n));ingredientNames=JSON.parse($("#IngredientNameList").val());CASNumbers=JSON.parse($("#CASNumberList").val());IngridentListColModels=[{name:"IsEdited",label:"IsEdited",resizable:!0,ignoreCase:!0,hidden:!0,cellattr:add_color},{name:"IngredientName",label:"Ingredient Name",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return'<a href="javascript:void(0)" class="rid_" data-target="#ParticularIngredientModal" data-ingredientid="'+i.IngredientId+'" data-ingredientname="'+i.IngredientName+'"  data-synonyms="'+i.Synonyms+'" data-casno = "'+i.CASNumber+'" data-function = "'+i.FunctionName+'" onclick="GetParticularIngredientData(this)">'+n+"<\/a>"}},{name:"Synonyms",label:"Synonyms",resizable:!0,ignoreCase:!0,index:"Synonyms"},{name:"CASNumber",label:"CAS Number",resizable:!0,ignoreCase:!0},{name:"FunctionName",label:"Functions",resizable:!0,ignorecase:!0,cellattr:functionAttrSetting},{name:"AdultLeaveOn",label:"Adult - Leave On",resizable:!0,ignorecase:!0,width:100,align:"center",index:"AdultLeaveOn",formatter:function(n){return UsageStatus(n)}},{name:"AdultRinseOff",label:"Adult - Rinse Off",resizable:!0,ignorecase:!0,width:100,align:"center",index:"AdultRinseOff",formatter:function(n){return UsageStatus(n)}},{name:"BabyLeaveOn",label:"Baby - Leave On",resizable:!0,ignorecase:!0,width:100,align:"center",index:"BabyLeaveOn",formatter:function(n){return UsageStatus(n)}},{name:"BabyRinseOff",label:"Baby - Rinse Off",resizable:!0,ignorecase:!0,width:100,align:"center",index:"BabyRinseOff",formatter:function(n){return UsageStatus(n)}},{name:"LastUpdatedDate",label:"Last Updated Date",width:100,resizable:!0,ignorecase:!0,sorttype:"date",formatter:"date",formatoptions:{newformat:"d/m/Y"},searchoptions:{sopt:["eq"],dataInit:function(n){$(n).datepicker({format:"dd/mm/yyyy",autoclose:!0}).change(function(){$("#IngredientListGrid")[0].triggerToolbar()})}}},];$("#IngredientListGrid").jqGrid({url:"",datatype:"local",data:DivisionBasedIngredientList.length>0?DivisionBasedIngredientList:[],mtype:"GET",colModel:IngridentListColModels,loadonce:!0,viewrecords:!0,pager:"#IngredientListGrid_Pager",rowNum:20,scroll:1,gridComplete:function(){var t=$("#IngredientListGrid tbody tr"),r=$("#IngredientListGrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"));$(".add-edited-color").siblings("td").addClass("add-edited-color");$(".add-rollback-color").siblings("td").addClass("add-rollback-color")}});$("#IngredientListGrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});jQuery("#IngredientListGrid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:"AdultLeaveOn",numberOfColumns:4,titleText:'<div id="Usage" class="text-center">Usage<\/div>',index:"Usage",name:"Usage"}]});$("#Usage").closest("th").addClass("testing");$("#IngredientListGrid").closest(".jqg-first-row-header").hide();$("#IngredientListGrid").closest(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 290px )"});$("#IngredientListGrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});u=$("#IngredientListGrid").closest(".ui-jqgrid-bdiv").find("tbody").height();u>130?($("#IngredientListGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#IngredientListGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#IngredientListGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#IngredientListGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));$("#IngredientListGrid").closest("#gview_IngredientListGrid").css({"z-index":"0"})});functionAttrSetting=function(n,t){return t.length>200?'style="white-space:nowrap !important;"':""};arrtSetting=function(n,t){var i,r,u;return oldRegion===""||oldRegion!=t?(r=data.filter(function(n){return n.Region===t}),u=r.length,i=' rowspan="'+u+'"'):i=' style="display:none"',oldRegion=t,i};add_color=function(n,t,i){var r="";return(i.IsEdited==1||i.IsEdited==2)&&(r='class="add-edited-color"'),r};$("#excel-download").on("click",function(){var n=$("[data-datepicker-startdate]").datepicker("getDate"),t=$("[data-datepicker-enddate]").datepicker("getDate"),i=$("#global_search").val().trim(),r,u;n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&i!=undefined&&i!=null&&i!=""?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),ExcelDownload(r,u,i)):n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&(i==undefined||i==null||i=="")?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),ExcelDownload(r,u,"")):(n==undefined||n==null||n=="")&&(t==undefined||t==null||t=="")?ExcelDownload("","",i):ExcelDownload("","","")});IngridentColModels=[{name:"RowNo",align:"center",sortable:!1,hidden:!0},{name:"Region",align:"center",classes:"trs",width:80,sortable:!1,cellattr:arrtSetting,formatter:function(n){return n}},{name:"Category",classes:"trs1",width:80,sortable:!1,formatter:function(n){return n}},{name:"RegulatoryStatus",label:"Regulatory<br>Status",align:"center",resizable:!0,ignoreCase:!0,search:!0,sortable:!1,width:80,hidden:!0,formatter:function(n){return UsageStatusWithCommentsForPopup(n)}},{name:"CRemarks",label:"Compliance Remarks",resizable:!0,ignoreCase:!0,search:!0,sortable:!1,width:250,formatter:function(n){if(n!=null&&n.length>0){var t=n.length,i=Math.ceil(t/100)+1;return`<textarea class="form-control date_text_freezed" rows="${i}" readonly>${n}</textarea>`}return""}},{name:"ImpactDates",label:"Impact Date",resizable:!0,ignoreCase:!0,sortable:!1,search:!0,width:80},{name:"References",label:"References",resizable:!0,ignoreCase:!0,sortable:!1,search:!0,width:120},{name:"ReferenceDoc",label:"Reference Doc",align:"center",sortable:!1,resizable:!0,ignoreCase:!0,search:!0,width:80,formatter:function(n,t,i){return i.IsFileExists==!0?'<a href="javascript: void(0);" class="grid-icon-only approveicon" onclick="ViewUploadedFiles('+i.RegionId+","+i.CategoryId+')" class="icon_color text-success btn_button" title="view"><i class="fas fa-eye"><\/i><\/a>':""}},];IngredientFileColModels=[{name:"RegionId",label:"RegionId",hidden:!0},{name:"CategoryId",label:"CategoryId",hidden:!0},{name:"EnclosureName",label:"File Name",width:250},{name:"UploadedBy",label:"Uploaded By",width:150},{name:"UploadedOn",label:"Uploaded Date",width:100},{name:"Action",align:"center",width:50,formatter:function(n,t,i){return'<div class="action_icons"><a href="#" title="Download" class="btn-icon" onclick="downloadoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" ><i class="fas fa-download color-download"><\/i><\/a><\/div >'}},];$("#search_ingredient").on("click",function(){var n=$("[data-datepicker-startdate]").datepicker("getDate"),t=$("[data-datepicker-enddate]").datepicker("getDate"),i=$("#global_search").val().trim(),r,u;n==null&&t==null&&i==""?alert("There is no data to search"):n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&i!=undefined&&i!=null&&i!=""?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),GetSearchResult(r,u,i)):n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&(i==undefined||i==null||i=="")?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),GetSearchResult(r,u,"")):(n==undefined||n==null||n=="")&&(t==undefined||t==null||t=="")&&i!=undefined&&i!=null&&i!=""?GetSearchResult("","",i):n!=undefined&&n!=null&&n!=""&&(t==undefined||t==null||t=="")||(n==undefined||n==null||n=="")&&t!=undefined&&t!=null&&t!=""?alert("Please select both start date and end date for search"):alert("There is no data to search")});$("#refresh_date").on("click",function(){$("[data-datepicker-startdate]").datepicker("destroy");$("[data-datepicker-startdate]").val("");$("[data-datepicker-startdate]").datepicker({format:"dd/mm/yyyy",autoclose:!0});$("[data-datepicker-enddate]").datepicker("destroy");$("[data-datepicker-enddate]").val("");$("[data-datepicker-enddate]").datepicker({format:"dd/mm/yyyy",autoclose:!0});$("#global_search").val("");GetSearchResult("","","")});$("#ComplianceRequest_popup").on("click",function(){$("#Request_Ingrident").val("");$("#Request_CASNumber").val("");$("#Request_Region").val("").multiselect("refresh");$("#Request_Function").val("").multiselect("refresh");$("#IRAStatusDropDown").val("111").trigger("change");$("#search_ComplianceRequestList").trigger("click");$("#Err_Request_Region").hide();$("#Request_Ingrident").siblings("span").addClass("hide");$("#Request_CASNumber").siblings("span").addClass("hide");$("#NewIngredient_Request").modal("show")});$(document).on("change","#Request_Ingrident",function(){if($(this).val().trim()!=""){$(this).siblings("span:first").addClass("hide");var n=CheckValidIngredient($(this).val());n==0?$(".ingredient-exists").removeClass("hide"):$(".ingredient-exists").addClass("hide")}});$(document).on("change","#Request_CASNumber",function(){if($(this).val().trim()!=""){$(this).siblings("span:first").addClass("hide");var n=CheckValidCASNumber($(this).val());n==0?$(".casnumber-exists").removeClass("hide"):$(".casnumber-exists").addClass("hide")}});$("#Request_Region").on("change",function(){var n=$.trim($("#Request_Region").val());n.length>0?$("#Err_Request_Region").hide():$("#Err_Request_Region").show()});$("#ComplianceRequest_save").on("click",function(){var t,n,r;$(".Err_Request").hide();t=$.trim($("#Request_Ingrident").val());n=$.trim($("#Request_CASNumber").val());(n==null||typeof n=="undefined")&&(n="");var i=$.trim($("#Request_Region").val()),u=$.trim($("#Request_Function").val()),f=CheckValidIngredient(t);if(f==0)return $(".ingredient-exists").removeClass("hide"),!1;if($(".ingredient-exists").addClass("hide"),r=CheckValidCASNumber(n),r==0)return $(".casnumber-exists").removeClass("hide"),!1;if($(".casnumber-exists").addClass("hide"),t.length==0||i.length==0)return t.length==0?$("#Request_Ingrident").siblings("span:first").removeClass("hide"):$("#Request_Ingrident").siblings("span:first").addClass("hide"),i.length==0?$("#Err_Request_Region").show():$("#Err_Request_Region").hide(),!1;$("#confirmpopupmesssage").empty().html("Are you sure you want to save the details ?");$("#confirmpopup").modal("show");$("#ConfirmOKbutton").off("click").on("click",function(){$("#confirmpopup").modal("hide");$.ajax({type:"POST",url:ROOT+"NewRID/ComplianceRequest_Save",data:{IngredientName:t,Region:i,FunctionId:u,CASNumber:n},success:function(n){var i=JSON.parse(n.Item1),t,r;n.Item2!=""&&(ingredientNames=JSON.parse(n.Item2));t=document.getElementById("ComplianceRequestResultAlert");r=document.getElementById("ComplianceRequestResultMessage");t.classList.remove("alert-success","alert-danger");t.classList.add(i.Item2);r.textContent=i.Item1;t.style.display="block";i.Item2.toLowerCase().includes("success")&&($("#Request_Ingrident").val(""),$("#Request_CASNumber").val(""),$("#Request_Region").val("").multiselect("refresh"),$("#Request_Function").val("").multiselect("refresh"),$("#IRAStatusDropDown").val("111").trigger("change"),$("#search_ComplianceRequestList").trigger("click"));setTimeout(function(){$("#ComplianceRequestResultAlert").hide()},3e3)},error:function(n){alert(n)}})})});ComplianceRequestListColModels=[{name:"IngredientName",label:"Ingredient Name",resizable:!0,ignoreCase:!0,width:150},{name:"CASNumber",label:"CAS Number",resizable:!0,ignoreCase:!0,width:120},{name:"FunctionName",label:"Functions",width:250,resizable:!0,ignorecase:!0,cellattr:functionAttrSetting},{name:"Region",label:"Region",width:120,resizable:!0,ignorecase:!0},{name:"Status",label:"Status",resizable:!0,ignoreCase:!0,width:80},{name:"CreatedBy",label:"Requested By",resizable:!0,ignoreCase:!0,search:!0,width:80},{name:"CreatedDate",label:"Requested Date",resizable:!0,ignoreCase:!0,search:!0,width:80,sorttype:"date",formatter:"date",formatoptions:{newformat:"d/m/Y"},searchoptions:{sopt:["eq"],dataInit:function(n){$(n).datepicker({format:"dd/mm/yyyy",autoclose:!0}).change(function(){$("#ComplianceRequestGrid")[0].triggerToolbar()})}}},];$("#ComplianceRequestGrid").jqGrid({url:"",datatype:"local",data:[],mtype:"GET",colModel:ComplianceRequestListColModels,loadonce:!0,viewrecords:!0,pager:"#ComplianceRequestGrid_Pager",rowNum:20,scroll:1,gridComplete:function(){var t=$("#ComplianceRequestGrid tbody tr"),r=$("#ComplianceRequestGrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#ComplianceRequestGrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$("#ComplianceRequestGrid").closest(".jqg-first-row-header").hide();$("#ComplianceRequestGrid").closest(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 370px )"});$("#ComplianceRequestGrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});$TableHeight=$("#ComplianceRequestGrid").closest(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>130?($("#ComplianceRequestGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#ComplianceRequestGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#ComplianceRequestGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#ComplianceRequestGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));$("#search_ComplianceRequestList").on("click",function(){var n=$("#IRAStatusDropDown").val();$.ajax({type:"GET",url:ROOT+"NewRID/GetComplianceRequestBasedOnSearch",data:{ingredientTypeId:0,Status:n},dataType:"JSON",success:function(n){var t=JSON.parse(n);$("#ComplianceRequestGrid").jqGrid("clearGridData");t!=undefined&&$("#ComplianceRequestGrid").jqGrid("setGridParam",{data:t}).trigger("reloadGrid",[{page:1}])},error:function(){alert("Error occured!!")}})});