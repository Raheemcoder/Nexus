function PageJqgrid(){$.jgrid.gridUnload("#Approve_IngredientListGrid");$("#Approve_IngredientListGrid").jqGrid({url:"",datatype:"local",data:Approve_DivisionBasedIngredientList.length>0?Approve_DivisionBasedIngredientList:[],mtype:"GET",colModel:Approve_IngridentListColModels,loadonce:!0,viewrecords:!0,hoverrows:!1,pager:"#Approve_IngredientListGrid_Pager",rowNum:20,scroll:1,gridComplete:function(){var u=$("#Approve_IngredientListGrid tbody tr"),e=$("#Approve_IngredientListGrid tbody tr td"),n,t,r,f;if(u.length>1)for(n=$(u[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(e[i]).css("width"));$("[data-singleselect]").select2();$(".add-edited-color").siblings("td").addClass("add-edited-color");$(".add-rollback-color").siblings("td").addClass("add-rollback-color");t=document.getElementById("cbox");r=!0;$("#Approve_IngredientListGrid tbody .checkbox").each(function(){if(!this.checked)return r=!1,!1});f=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records");r?f>0&&(t.checked=!0):t.checked=!1}});$("#Approve_IngredientListGrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});jQuery("#Approve_IngredientListGrid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:"AdultLeaveOn",numberOfColumns:4,titleText:'<div id="ApproveUsage" class="text-center">Usage<\/div>',index:"Usage",name:"Usage"}]});$("#ApproveUsage").closest("th").addClass("testing");$("#Approve_IngredientListGrid").closest(".jqg-first-row-header").hide();$("#Approve_IngredientListGrid").closest(".ui-jqgrid-bdiv").css({"max-height":"calc(-250px + 100vh)"});$("#Approve_IngredientListGrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});var n=$("#Approve_IngredientListGrid").closest(".ui-jqgrid-bdiv").find("tbody").height();n>130?($("#Approve_IngredientListGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_IngredientListGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#Approve_IngredientListGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_IngredientListGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"))}function CreateJQGridForRemarks(n){$("#Remarksjqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:IngredientRemarksColModels,loadonce:!0,viewrecords:!0,pager:"#Remarkspager",rowNum:100,scroll:1,gridComplete:function(){var t=$("#Remarksjqgrid tbody tr"),r=$("#Remarksjqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#Remarksjqgrid").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#Remarksjqgrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var t=$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").find("tbody").height();t>280?($("#Remarksjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Remarksjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#Remarksjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Remarksjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}function ViewRemarks(n,t){$.ajax({url:ROOT+"NewRID/DisplayRemarksById",type:"GET",dataType:"JSON",data:{IngredientId:n,IngredientName:t},success:function(n){$.jgrid.gridUnload("#Remarksjqgrid");$("#displayremarks").modal("show");CreateJQGridForRemarks(n)}})}function Level1_GetApprovalDropDown(n,t,i){function o(n){return u[0].toLowerCase()==n.toLowerCase()?1:0}var n,u,r;n==null||n==undefined?u="Not Selected":(n=colorStatusMapping_Level1.filter(t=>t.key.toLowerCase()===n.toLowerCase()),u=n.map(n=>n.value));var s=CategoryValue.filter(function(n){return n.CategoryName.toLowerCase()===i.toLowerCase()}),f=s[0].CategoryId,h={IngredientId:parseInt(t),CategoryId:f,RegStatusId:0},c=JSON.stringify(h).replace(/"/g,"'"),e='<select class="demo-content ApproveDropDown" data-singleselect ><option value='+c+"> ---Select--- <\/option>";for(r=0;r<RegulartoryStatusValue.length;r++){var l={IngredientId:parseInt(t),CategoryId:f,RegStatusId:RegulartoryStatusValue[r].RegulatoryStatusId},a=JSON.stringify(l).replace(/"/g,"'"),v=o(RegulartoryStatusValue[r].RegulatoryStatusName)==1?"selected":"";e+='<option value="'+a+'" '+v+" >"+RegulartoryStatusValue[r].RegulatoryStatusName+"<\/option>"}return e+"<\/select>"}function Level2_GetSelectedLabel(n){if(n==null||n==undefined)return"";var n=colorStatusMapping_Level2.filter(t=>t.key.toLowerCase()===n.toLowerCase());return n.map(n=>n.value)}function Approve_GetParticularIngredientData(n,t){var r=t.closest("tr.jqgrow"),u=r.id,i=$("#Approve_IngredientListGrid").jqGrid("getRowData",u),f=i.IngredientName,e=$(f).text().trim(),o=i.Synonyms,s=i.CASNumber,h=i.FunctionName;$.ajax({type:"GET",url:ROOT+"NewRID/Approve_GetParticularIngredientDetails",data:{IngredientId:n},dataType:"JSON",success:function(n){var t=JSON.parse(n);groupedByRegion={};t.forEach(n=>{const t=n.Region.toUpperCase();groupedByRegion[t]||(groupedByRegion[t]=[]);groupedByRegion[t].push(n)});const i=Object.values(groupedByRegion).flat();t!=undefined&&(particularingredientdetails=i,CreateParticularIngDataGrid(particularingredientdetails));$("#Approve_ParticularIngredientDetailsModal").modal("show");$("#Approve_ActiveIngredientName").text(e);$("#Approve_Synonyms").text(o);$("#Approve_CAS").text(s);$("#Approve_Functions").text(h)},error:function(){alert("Error occured!!")}})}function checkBox(n){n=n||event;n.stopPropagation?n.stopPropagation():n.cancelBubble=!1;var t=document.getElementById("cbox"),i=t.checked;i?($("#Approve_IngredientListGrid .checkbox").prop("checked",!0),Approve_DivisionBasedIngredientList.forEach(n=>{n.IsChecked=!0})):($("#Approve_IngredientListGrid .checkbox").prop("checked",!1),Approve_DivisionBasedIngredientList.forEach(n=>{n.IsChecked=!1}))}function CreateParticularIngDataGrid(n){$.jgrid.gridUnload("#Approve_ParticularIngredientDetails");ParticularIngredientDetailsColModel=[{label:"Region",name:"Region",align:"center",classes:"trs",cellattr:arrtSetting,width:80},{label:"Category",name:"Category",classes:"trs1",width:80},{label:"Regulatory Status",name:"RegulatoryStatus",align:"center",width:80,formatter:function(n){return UsageStatus(n)}},{label:"Compliance Remarks",name:"CRemarks",width:250,formatter:function(n){if(n!=null&&n.length>0){var t=n.length,i=Math.ceil(t/100)+1;return`<textarea class="form-control date_text_freezed" rows="${i}" readonly>${n}</textarea>`}return""}},{label:"Impact Dates",name:"ImpactDates",width:80},{label:"References",name:"References",width:120},];$("#Approve_ParticularIngredientDetails").jqGrid({datatype:"local",data:n,colModel:ParticularIngredientDetailsColModel,cmTemplate:{sortable:!1},loadonce:!0,viewrecords:!0,pager:"#Approve_ParticularIngredientDetails_Pager",rowNum:particularingredientdetails.length,hoverrows:!1,scroll:1,beforeSelectRow:function(){return!1},gridComplete:function(){oldRegion=""}});$("#Approve_ParticularIngredientDetails").closest(".jqg-first-row-header").hide();$("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid-bdiv").css({"max-height":"50vh"});$("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});var t=$("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid-bdiv").find("tbody").height();t>130?($("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_ParticularIngredientDetails").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_ParticularIngredientDetails").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"))}function UsageStatus(n){if(n!=null&&n!=undefined){if(n=="Red")return'<span class="pe-2"><i class="red_circle"><\/i><\/span>';if(n=="Blue")return'<span class="pe-2"><i class="purple_circle"><\/i><\/span>';if(n=="Yellow")return'<span class="pe-2"><i class="yellow_circle"><\/i><\/span>';if(n=="Green")return'<span class="pe-2"><i class="green_circle"><\/i><\/span>'}else return""}function AlertIngredientNotFilled(n){var t=[],t=Approve_DivisionBasedIngredientList.filter(t=>n.includes(t.IngredientId)).map(n=>n.IngredientName),i=`<div><span class="alert-fill-span">Please select all the category for below Ingredients to Approve</span><div><br><strong class="alert-fill-strong">${t.join(", ")} </strong>`;alert(i)}function GetJson(n,t,i){var e=CategoryValue.filter(function(n){return n.CategoryName.toLowerCase()===t.toLowerCase()}),o=e[0].CategoryId,n,r,f,u;return n==null||n==undefined?r="Not Selected":(n=colorStatusMapping_Level1.filter(t=>t.key.toLowerCase()===n.toLowerCase()),r=n.map(n=>n.value)),r!="Not Selected"?(f=RegulartoryStatusValue.filter(n=>n.RegulatoryStatusName.toLowerCase()==r[0].toLowerCase()),u=f[0].RegulatoryStatusId):u=0,{IngredientId:i,CategoryId:o,RegStatusId:u,ComplianceRemarks:""}}function Addto_GenerateDataToSave(n){GenerateDataToSave.push({parsedData:n})}function SubmitApproval(n,t){$("#Remarks_modal").modal("hide");$.ajax({type:"POST",url:ROOT+"NewRID/ApproveRevertIngredient",data:{IngredientToApprove:JSON.stringify(n),Action:"Approve",Remarks:$("#Remarks_text").val().trim(),ApprovalLevel:UserApprovalLevel,IsSubmitted:t},success:function(n){n=="1"||n=="2"?window.location.reload():alert("Error Occured!!!")},error:function(n){alert(n)}})}function SubmitReverted(n){$("#Remarks_modal").modal("hide");$.ajax({type:"POST",url:ROOT+"NewRID/ApproveRevertIngredient",data:{IngredientToApprove:JSON.stringify(n),Action:"RollBack",Remarks:$("#Remarks_text").val().trim(),ApprovalLevel:UserApprovalLevel},success:function(n){n=="1"?window.location.reload():alert("Error Occured!!!")},error:function(n){alert(n)}})}function SubmitCheckedRecord(n,t){var u,r;for(GenerateDataToSave=[],u=0;u<n.length;u++)var i=Approve_DivisionBasedIngredientList.find(t=>t.IngredientId==n[u]),f=Addto_GenerateDataToSave(GetJson(i.AdultLeaveOn,"Adult - Leave on",i.IngredientId)),e=Addto_GenerateDataToSave(GetJson(i.AdultRinseOff,"Adult - Rinse off",i.IngredientId)),o=Addto_GenerateDataToSave(GetJson(i.BabyLeaveOn,"Baby - Leave on",i.IngredientId)),s=Addto_GenerateDataToSave(GetJson(i.BabyRinseOff,"Baby - Rinse off",i.IngredientId));r=[];GenerateDataToSave.forEach(n=>{r.push(n.parsedData)});t.toLowerCase()=="approve"?SubmitApproval(r,!0):t.toLowerCase()=="rollback"?SubmitReverted(r):t.toLowerCase()=="save"&&SubmitApproval(r,!1)}function GetIngredientChecked(){ingredientCheckedForSave=[];$("#Approve_IngredientListGrid tbody .checkbox").each(function(){if(this.checked){var n=$(this).closest("tr.jqgrow"),t=parseInt(n.attr("id"));ingredientCheckedForSave.push(t)}})}function validateRemarks(n){var t=$("#Remarks_text").val().trim();n.toLowerCase()=="rollback"?t!=""?($("#Err_Remarks_text").hide(),$("#RollBack_modal").modal("hide"),SubmitCheckedRecord(ingredientCheckedForSave,n)):$("#Err_Remarks_text").show():SubmitCheckedRecord(ingredientCheckedForSave,n)}var Approve_DivisionBasedIngredientList=[],AlreadySaved_Approve_DivisionBasedIngredientList=[],groupedByRegion,CategoryValue=[],RegulartoryStatusValue=[],UserApprovalLevel="",particularingredientdetails=[],IngredientRemarksColModels,oldRegion;$(document).ready(function(){var n=$("#Approve_DivisionBasedIngredientListJson").val();n!=undefined&&n!=null&&n!=""&&(Approve_DivisionBasedIngredientList=$.parseJSON(n),AlreadySaved_Approve_DivisionBasedIngredientList=$.parseJSON(n));UserApprovalLevel=$("#UserApprovalLevel").val();(UserApprovalLevel==undefined||UserApprovalLevel==null||UserApprovalLevel=="")&&(UserApprovalLevel="");$.ajax({type:"GET",url:ROOT+"NewRID/RegulatoryStatusDropDownData",data:{},dataType:"JSON","async":!1,success:function(n){var t=JSON.parse(n);CategoryValue=t.Item2;RegulartoryStatusValue=t.Item1},error:function(){alert("Error occured!!")}});PageJqgrid()});var colorStatusMapping_Level1=[{key:"Red",value:"Prohibited"},{key:"Blue",value:"PR issue/Upcoming restriction/ Upcoming Ban"},{key:"Green",value:"Allowed"},{key:"Yellow",value:"Restrictions"}],colorStatusMapping_Level2=[{key:"Red",value:"Prohibited"},{key:"Blue",value:"HGML Approval Required"},{key:"Green",value:"Allowed"},{key:"Yellow",value:"Restrictions"}],categoryNameMapping=[{key:"AdultLeaveOn",value:"Adult - Leave on"},{key:"AdultRinseOff",value:"Adult - Rinse off"},{key:"BabyLeaveOn",value:"Baby - Leave on"},{key:"BabyRinseOff",value:"Baby - Rinse off"}];add_color=function(n,t,i){var r="";return(i.IsEdited==1||i.IsEdited==2)&&(r='class="add-edited-color"'),(i.IsRollback==1||i.IsRollback==2)&&(r='class="add-rollback-color"'),r};functionAttrSetting=function(n,t){return t.length>200?'style="white-space:nowrap !important;"':""};Approve_IngridentListColModels=[{name:"IsRollback",label:"IsRollback",resizable:!0,ignoreCase:!0,hidden:!0,cellattr:add_color},{name:"IsEdited",label:"IsEdited",resizable:!0,ignoreCase:!0,hidden:!0},{name:"IngredientId",label:"Ingredient Id",resizable:!0,ignoreCase:!0,hidden:!0,key:!0},{name:"IngredientName",label:"Ingredient Name",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return'<a href="javascript:void(0)" class="rid_" onclick="Approve_GetParticularIngredientData('+i.IngredientId+',this)">'+n+"<\/a>"}},{name:"Synonyms",label:"Synonyms",resizable:!0,ignoreCase:!0,index:"Synonyms"},{name:"CASNumber",label:"CAS Number",resizable:!0,ignoreCase:!0},{name:"FunctionName",label:"Functions",resizable:!0,ignorecase:!0,cellattr:functionAttrSetting},{name:"AdultLeaveOn",label:"Adult - Leave On",resizable:!0,align:"center",search:!1,ignorecase:!0,index:"AdultLeaveOn",formatter:function(n,t){var i;return UserApprovalLevel.toLowerCase()=="level1"?Level1_GetApprovalDropDown(n,t.rowId,t.colModel.label):UserApprovalLevel.toLowerCase()=="level2"?`<strong style="font-weight:700">`+Level2_GetSelectedLabel(n)+`</strong>`:void 0}},{name:"AdultRinseOff",label:"Adult - Rinse Off",resizable:!0,ignorecase:!0,search:!1,align:"center",index:"AdultRinseOff",formatter:function(n,t){var i;return UserApprovalLevel.toLowerCase()=="level1"?Level1_GetApprovalDropDown(n,t.rowId,t.colModel.label):UserApprovalLevel.toLowerCase()=="level2"?`<strong style="font-weight:700">`+Level2_GetSelectedLabel(n)+`</strong>`:void 0}},{name:"BabyLeaveOn",label:"Baby - Leave On",resizable:!0,ignorecase:!0,search:!1,align:"center",index:"BabyLeaveOn",formatter:function(n,t){var i;return UserApprovalLevel.toLowerCase()=="level1"?Level1_GetApprovalDropDown(n,t.rowId,t.colModel.label):UserApprovalLevel.toLowerCase()=="level2"?`<strong style="font-weight:700">`+Level2_GetSelectedLabel(n)+`</strong>`:void 0}},{name:"BabyRinseOff",label:"Baby - Rinse Off",resizable:!0,ignorecase:!0,search:!1,align:"center",index:"BabyRinseOff",formatter:function(n,t){var i;return UserApprovalLevel.toLowerCase()=="level1"?Level1_GetApprovalDropDown(n,t.rowId,t.colModel.label):UserApprovalLevel.toLowerCase()=="level2"?`<strong style="font-weight:700">`+Level2_GetSelectedLabel(n)+`</strong>`:void 0}},{name:"CreatedBy",label:"Requested By",resizable:!0,ignoreCase:!0,width:90},{name:"Remarks",label:"Remarks",resizable:!0,ignoreCase:!0,width:90,align:"center",search:!1,formatter:function(n,t,i){return'<a href="javascript: void(0);" class="grid-icon-only approveicon" onclick="ViewRemarks('+i.IngredientId+", '"+i.IngredientName+'\')" class="icon_color text-success btn_button" title="view"><i class="fas fa-info"><\/i><\/a>'}},{name:"IsChecked",label:'Action <input type="checkbox" id="cbox" onclick="checkBox(event)" class="ml-2"/>',editable:!0,index:"Check_Box",width:60,resizable:!1,edittype:"checkbox",formatoptions:{disabled:!1},editoptions:{value:"True:False"},sortable:!1,search:!1,align:"center",formatter:function(n,t){var i=n==!0?"checked":"",r="checkbox-"+t.rowId;return'<input type="checkbox" '+i+' id="'+r+'" class="checkbox"/>'}},];IngredientRemarksColModels=[{name:"Remarks",label:"Remarks",width:150,sortable:!1},{name:"Action",label:"Action",width:100,sortable:!1},{name:"CreatedBy",label:"Action By",width:100,sortable:!1},{name:"CreatedDate",label:"Action Date",width:100,sortable:!1},];$("#exceldownload").on("click",function(){window.location.href=ROOT+"NewRID/GetApprovalRemarksExcelData"});$("body").on("click","#Approve_IngredientListGrid tr td .checkbox",function(){var r=$(this).closest("tr.jqgrow"),t=parseInt(r.attr("id")),i,n;$(this).prop("checked")?Approve_DivisionBasedIngredientList.forEach(n=>{n.IngredientId==t&&(n.IsChecked=!0)}):Approve_DivisionBasedIngredientList.forEach(n=>{n.IngredientId==t&&(n.IsChecked=!1)});i=document.getElementById("cbox");n=!0;$("#Approve_IngredientListGrid tbody .checkbox").each(function(){if(!this.checked)return n=!1,!1});i.checked=n?!0:!1});oldRegion="";arrtSetting=function(n,t){var i,r;return Object.keys(groupedByRegion).forEach(n=>{if(n===t.toUpperCase()){const t=groupedByRegion[n].length;i=t}}),r=(oldRegion=undefined||oldRegion!=t.toUpperCase())?' rowspan="'+i+'"':' style="display:none"',oldRegion=t.toUpperCase(),r};$(document).on("change",".ApproveDropDown",function(){for(var r,s=$(this).closest("tr.jqgrow"),h=parseInt(s.attr("id")),i,n=0;n<Approve_DivisionBasedIngredientList.length;n++)if(r=Approve_DivisionBasedIngredientList[n],r.IngredientId==h){i=n;break}var c=$(this).find("option:selected").val(),l=c.replace(/'/g,'"'),t=JSON.parse(l);if(t.RegStatusId!=0){var a=RegulartoryStatusValue.filter(n=>n.RegulatoryStatusId==t.RegStatusId),v=a[0].RegulatoryStatusName,y=colorStatusMapping_Level1.filter(n=>n.value.toLowerCase()===v.toLowerCase()),p=y.map(n=>n.key),u=CategoryValue.filter(n=>n.CategoryId==t.CategoryId),f=u[0].CategoryName,e=categoryNameMapping.filter(n=>n.value.toLowerCase()===f.toLowerCase()),o=e.map(n=>n.key);Approve_DivisionBasedIngredientList[i][o]=p[0]}else{var u=CategoryValue.filter(n=>n.CategoryId==t.CategoryId),f=u[0].CategoryName,e=categoryNameMapping.filter(n=>n.value.toLowerCase()===f.toLowerCase()),o=e.map(n=>n.key);Approve_DivisionBasedIngredientList[i][o]=null}});$(document).on("change","#Remarks_text",function(){var n=$("#Remarks_text").val().trim();n.length>0?$("#Err_Remarks_text").hide():$("#Err_Remarks_text").show()});$("#Level2_Remarks").click(function(){var i=$("#MostRecentRemark").val(),r=$.parseJSON(i);$("#Remarks_table").empty();var n=$("#Remarks_table"),t="";r.forEach(function(n){t+='<tr><td class="word-wrap-td">'+n.IngredientName+"<\/td><td>"+n.ActionBy+"<\/td><td>"+n.ActionDate+"<\/td><td>"+n.Remarks+"<\/td><\/tr>"});n.append('<thead class="remarks-table-header"><tr><th>Ingredient Name<\/th><th>Rollback By<\/th><th>Rollback On<\/th><th>Remarks<\/th><\/tr><\/thead>');n.append('<tbody class="remarks-table-body">'+t+"<\/tbody>");$("#RollBack_RemarksToShow").modal("show")});var rowtofill=[],GenerateDataToSave=[],ingredientCheckedForSave=[];$("#approvebtn").click(function(){var r=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records"),i,n,t;if(GetIngredientChecked(),r==0)alert("There is no data to approve");else if(ingredientCheckedForSave.length==0)alert("Please select atleast one ingredient to approve");else if(UserApprovalLevel.toLowerCase()=="level1"){for($("#remarks-mandatory").addClass("hide"),rowtofill=[],i=0;i<ingredientCheckedForSave.length;i++)if(n=Approve_DivisionBasedIngredientList.find(n=>n.IngredientId==ingredientCheckedForSave[i]),t=n.IngredientId,n.AdultLeaveOn==null||n.AdultRinseOff==null||n.BabyLeaveOn==null||n.BabyRinseOff==null||n.AdultLeaveOn==undefined||n.AdultRinseOff==undefined||n.BabyLeaveOn==undefined||n.BabyRinseOff==undefined){const n=rowtofill.includes(t);n?rowtofill=rowtofill.map(n=>n===t?t:n):rowtofill.push(t)}else rowtofill=rowtofill.filter(n=>n!==t);if(rowtofill.length>0)AlertIngredientNotFilled(rowtofill);else if(rowtofill.length==0){$("#Err_Remarks_text").hide();$("#Remarks_text").val("");$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){validateRemarks("Approve")})}}else if(UserApprovalLevel.toLowerCase()=="level2"){$("#remarks-mandatory").addClass("hide");$("#Err_Remarks_text").hide();$("#Remarks_text").val("");$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){validateRemarks("Approve")})}});$("#cancelbtn").click(function(){window.location.href=ROOT+"NewRID/CosmeticsRIDList"});$("#revertbtn").click(function(){var n=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records");if(GetIngredientChecked(),n>0)if(ingredientCheckedForSave.length>0){$("#Err_Remarks_text").hide();$("#Remarks_text").val("");$("#remarks-mandatory").removeClass("hide");$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){validateRemarks("RollBack")})}else alert("Please select atleast one ingredient to rollback");else alert("There is no data to roll back")});$("#saveasdraftbtn").on("click",function(){var r=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records"),i,n,t;if(GetIngredientChecked(),r==0)alert("There is no data to save");else if(ingredientCheckedForSave.length==0)alert("Please select atleast one ingredient to save");else if(UserApprovalLevel.toLowerCase()=="level1"){for($("#remarks-mandatory").addClass("hide"),rowtofill=[],i=0;i<ingredientCheckedForSave.length;i++)if(n=Approve_DivisionBasedIngredientList.find(n=>n.IngredientId==ingredientCheckedForSave[i]),t=n.IngredientId,n.AdultLeaveOn==null||n.AdultRinseOff==null||n.BabyLeaveOn==null||n.BabyRinseOff==null||n.AdultLeaveOn==undefined||n.AdultRinseOff==undefined||n.BabyLeaveOn==undefined||n.BabyRinseOff==undefined){const n=rowtofill.includes(t);n?rowtofill=rowtofill.map(n=>n===t?t:n):rowtofill.push(t)}else rowtofill=rowtofill.filter(n=>n!==t);if(rowtofill.length>0)AlertIngredientNotFilled(rowtofill);else if(rowtofill.length==0){$("#confirmpopupmesssage").empty().html("Are you sure you want to save the details ?");$("#confirmpopup").modal("show");$("#ConfirmOKbutton").off("click").on("click",function(){validateRemarks("save")})}}});