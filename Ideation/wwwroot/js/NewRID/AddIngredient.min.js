function validateSave(){var n=!1,t=$("#Synonyms").val().toLowerCase().trim(),i=$("#CASNumber").val().toLowerCase().trim(),r=$("#FunctionId_arr").val().join(",").toString(),u=JSON.parse($("#IngredientFileData").val());return(old_synonyms!=t||old_casnumber!=i||old_functionid!=r)&&(n=!0),$.each(gridData,function(t){var i=convertDateToString(old_gridData[t].ImpactDates),r=convertDateToString(gridData[t].ImpactDates);(parseInt(old_gridData[t].RegionId)!=parseInt(gridData[t].RegionId)||parseInt(old_gridData[t].CategoryId)!=parseInt(gridData[t].CategoryId)||parseInt(old_gridData[t].RegulatoryStatus)!=parseInt(gridData[t].RegulatoryStatus)||old_gridData[t].CRemarks.toLowerCase().trim()!=gridData[t].CRemarks.toLowerCase().trim()||i!=r||old_gridData[t].References.toLowerCase().trim()!=gridData[t].References.toLowerCase().trim())&&(n=!0)}),documentData.length>0&&(n=!0),$.each(u,function(t,i){var r=oldfiles_uploadedData.findIndex(function(n){return i.RegionId===n.RegionId&&i.CategoryId===n.CategoryId&&i.EnclosureName===n.EnclosureName});r==-1&&(n=!0)}),n}function SaveUploadedFiles(n,t){var n=parseInt(n),i=new FormData;i.append("IngredientId",n);i.append("JsonFileNames",JSON.stringify(EnclosureName));i.append("Division_Id",$("#Division_Id").val());t!="Save"?i.append("Source",$("#Source").val()):"";$.each(oldfiles_uploadedData,function(n,t){documentData.push({RegionId:t.RegionId,CategoryId:t.CategoryId,EnclosureName:t.EnclosureName})});i.append("DocumentData",JSON.stringify(documentData));const r=gridData.map(n=>n.RegionId),u=[...new Set(r)];$.each(u,function(n,t){for(var o,s,r,f,e=0,u=1;u<=gridData.length;u++)if(o=$("#RefDoc_"+u).get(0),s=gridData[u-1].RegionId,parseInt(t)===parseInt(s)&&(r=o.files,r.length!="0"||r.length!=0))for(e++,f=0;f<r.length;f++)i.append("PostedFile",r[f]);e>0&&$.ajax({url:ROOT+"NewRID/UploadFile",dataType:"JSON",type:"POST","async":!1,data:i,contentType:!1,processData:!1,success:function(){},error:function(){alert(" An Error occured!!")}})})}function bindregulatorystatusDropDown(){$.ajax({url:ROOT+"NewRID/GetRegulatoryStatus",dataType:"JSON","async":!1,type:"GET",success:function(n){$.each(n,function(n,t){$(".regulatorystatus_c").append("<option value="+t.Value+">"+t.Text+"<\/option>")})}});$(".regulatorystatus_c").select2()}function convertToDate(n){const[t,i,r]=n.split("/");return new Date(`${r}-${i}-${t}`)}function convertDateToString(n){if(n===""||n===null)return"";const t=new Date(n),i=t.getFullYear(),r=("0"+(t.getMonth()+1)).slice(-2),u=("0"+t.getDate()).slice(-2);return`${i}-${r}-${u}`}function bindFilesGrid(){$.each(oldfiles_uploadedData,function(n,t){$("#old_"+t.RegionId+"_"+t.CategoryId).removeClass("_hide")})}function deletedoc(n){var t=n.getAttribute("data-region"),i=n.getAttribute("data-category"),r=n.getAttribute("data-enclosure");$("#closebtn").trigger("click");$("#confirmpopup1").modal("show");$("#ConfirmDeletebutton").on("click",function(){var n=oldfiles_uploadedData.findIndex(n=>n.RegionId===parseInt(t)&&n.CategoryId===parseInt(i)&&n.EnclosureName===r);oldfiles_uploadedData.splice(n,1);alert("Document Deleted Successfully")});$("#confirmpopup1").modal("hide")}function downloadoc(n){var t=n.getAttribute("data-region"),i=n.getAttribute("data-category"),r=n.getAttribute("data-enclosure");window.location.href=ROOT+"NewRID/FileDownload?docName="+r+"&&ingredientId="+ingredientId+"&&regionId="+t+"&&categoryId="+i}function ViewDocumentsDataModal(n){var i=parseInt(n.getAttribute("data-categoryId")),r=parseInt(n.getAttribute("data-regionId")),u=n.getAttribute("data-region"),t;$.jgrid.gridUnload("#viewlist");view_file_data=[];t=oldfiles_uploadedData.filter(n=>n.RegionId===r&&n.CategoryId===i);$.each(t,function(n,t){view_file_data.push({EnclosureName:t.EnclosureName,CategoryId:t.CategoryId,RegionId:t.RegionId,Region:t.Region})});createModalGrid();$("#IngredientModal1").modal("show")}function createModalGrid(){$("#viewlist").jqGrid({url:"",datatype:"local",data:view_file_data,mtype:"GET",colModel:IngridentDocViewColModels,loadonce:!0,viewrecords:!0,pager:"#pager_expected2",rowNum:200,scroll:1,gridComplete:function(){var t=$("#viewlist tbody tr"),r=$("#viewlist tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#viewlist").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#viewlist").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var n=$("#viewlist").closest(".ui-jqgrid-bdiv").find("tbody").height();n>280?($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}var gridData=[],old_gridData=[],old_synonyms=$("#Synonyms").val().toLowerCase().trim(),old_casnumber=$("#CASNumber").val().toLowerCase().trim(),old_functionid=$("#FunctionId_arr").val().join(",").toString(),EnclosureName=[],filesData=[],oldfiles_uploadedData=[],documentData=[],view_file_data=[],ingredientId=parseInt($("#IngredientId").val()),ingredientreqId=parseInt($("#IngredientId").val()),colModel=[],oldRegion,login_region=[],ingredientNames=[],isConfirmed=0;arrtSetting=function(n,t){var i,r,u;return(oldRegion=undefined||oldRegion!=t)?(r=gridData.filter(function(n){return n.Region===t}),u=r.length,i=' rowspan="'+u+'"'):i=' style="display:none"',oldRegion=t,i};var insertcolmodels=[{name:"RowNo",align:"center",hidden:!0},{name:"Region",width:50,align:"center",classes:"trs",cellattr:arrtSetting,formatter:function(n,t,i){if(i.IsEditable==!0){var r=login_region.findIndex(function(t){return t===n});r==-1?login_region.push(n):""}return n}},{name:"Category",classes:"trs1",width:60,formatter:function(n){return n}},{name:"RegulatoryStatus",search:!1,width:80,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect><option value="0">Select<\/option><\/select><span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span><\/div>':'<div class="demo-content"><select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect disabled><option value="0">Select<\/option><\/select><span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span><\/div>'}},{name:"CRemarks",width:125,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text noSpacesField" id="cremarks_selected_'+i.RowNo+'" rows="2" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"><\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>':'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text noSpacesField" id="cremarks_selected_'+i.RowNo+'" rows="2" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"readonly><\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>'}},{name:"ImpactDates",search:!1,width:55,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" readonly class= "form-control form-control-sm data-datepicker ImpactDates_text ImpactDates_text_freezed" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>':'<div class="demo-content" ><input type="text" readonly disabled class= "form-control form-control-sm data-datepicker ImpactDates_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>'}},{name:"References",width:60,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text noSpacesField" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'"/> <\/div>':'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text noSpacesField" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" readonly/> <\/div>'}},{name:"ReferenceDoc",width:80,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><input type="file" id="RefDoc_'+i.RowNo+'" class="form-control form-control-sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple/><\/div>':'<div class="demo-content"><input type="file" id="RefDoc_'+i.RowNo+'" class="form-control form-control-sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple disabled/><\/div>'}},],updatecolmodels=[{name:"RowNo",align:"center",hidden:!0},{name:"Region",align:"center",classes:"trs",width:50,cellattr:arrtSetting,formatter:function(n,t,i){if(i.IsEditable==!0){var r=login_region.findIndex(function(t){return t===n});r==-1?login_region.push(n):""}return n}},{name:"Category",classes:"trs1",width:60,formatter:function(n){return n}},{name:"RegulatoryStatus",search:!1,width:80,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect><option value="0">Select<\/option><\/select><span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span><\/div>':'<div class="demo-content"><select id="regulatory_status_selected_'+i.RowNo+'" class="form-control singleselect regulatorystatus_c" data-lineno="'+i.RowNo+'"  data-name="'+t.colModel.name+'" singleselect disabled><option value="0">Select<\/option><\/select><span class="text-danger _hide" id="regulatory_status_selected_'+i.RowNo+'_valid">Please select Regulatory Status<\/span><\/div>'}},{name:"CRemarks",width:125,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text noSpacesField" id="cremarks_selected_'+i.RowNo+'" rows="2"  data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'">'+i.CRemarks+'<\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>':'<div class="demo-content"><textarea class="form-control textvalid form-control-sm Cremarks_text noSpacesField" id="cremarks_selected_'+i.RowNo+'" rows="2"  data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" readonly>'+i.CRemarks+'<\/textarea><span class="text-danger _hide" id="cremarks_selected_'+i.RowNo+'_valid" >Please enter Remarks<\/span><\/div>'}},{name:"ImpactDates",search:!1,width:55,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" readonly class= "form-control form-control-sm data-datepicker ImpactDates_text ImpactDates_text_freezed" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ImpactDates+'"/> <\/div>':'<div class="demo-content" ><input type="text" readonly disabled class= "form-control form-control-sm data-datepicker ImpactDates_text" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.ImpactDates+'"/> <\/div>'}},{name:"References",width:60,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text noSpacesField" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.References+'"/> <\/div>':'<div class="demo-content" ><input type="text" class= "form-control form-control-sm  References_text noSpacesField" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" value="'+i.References+'" readonly/> <\/div>'}},{name:"ReferenceDoc",width:80,formatter:function(n,t,i){return i.IsEditable==!0?'<div class="demo-content "><div class="row"><div class="_hide col-md-1 pdt_9" id="old_'+i.RegionId+"_"+i.CategoryId+'"><a href="#" data-target="#IngredientModal1" data-categoryId="'+i.CategoryId+'" data-regionId="'+i.RegionId+'"data-region="'+i.Region+'" onclick="ViewDocumentsDataModal(this)" title="View Documents"><i class="fa fa-info-circle"><\/i><\/a><\/div> <div class="col-md-10"><input type="file" id="RefDoc_'+i.RowNo+'" class="form - control form - control - sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple/><\/div><\/div ><\/div >':'<div class="demo-content "><div class="row"><div class="_hide col-md-1 pdt_9" id="old_'+i.RegionId+"_"+i.CategoryId+'"><a href="#" data-target="#IngredientModal1" data-categoryId="'+i.CategoryId+'" data-regionId="'+i.RegionId+'"data-region="'+i.Region+'" onclick="ViewDocumentsDataModal(this)" title="View Documents"><i class="fa fa-info-circle"><\/i><\/a><\/div> <div class="col-md-10"><input type="file" id="RefDoc_'+i.RowNo+'" class="form - control form - control - sm RefDocs_text" data-regionId="'+i.RegionId+'" data-categoryId="'+i.CategoryId+'" data-lineno="'+i.RowNo+'" data-name="'+t.colModel.name+'" accept=".pdf, .docx, .xlsx,xls,.docx" multiple disabled/><\/div><\/div ><\/div >'}},],IngridentDocViewColModels=[{name:"EnclosureName",label:"Document Name"},{name:"CategoryId",label:"CategoryId",align:"center",hidden:!0},{name:"RegionId",label:"RegionId",align:"center",hidden:!0},{name:"Region",label:"Region",align:"center",hidden:!0},{name:"Action",label:"Action",align:"center",formatter:function(n,t,i){var r=login_region.findIndex(function(n){return n==i.Region});return r>-1?'<div class="d-flex action_icons align-items-center"><a href="#" title="Download" class="" onclick="downloadoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" ><i class="fas fa-download color-download"><\/i><\/a><a href="#" title="Delete" onclick="deletedoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" class=""><i class="fa fa-trash color-delete"><\/i><\/a><\/div >':'<div class="d-flex action_icons align-items-center "><a href="#" title="Download" class="btn-icon" onclick="downloadoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" ><i class="fas fa-download color-download"><\/i><\/a><\/div >'}}];$(document).ready(function(){var n,t;isConfirmed=parseInt($("#IsConfirmed").val());$("body").on("change",".textvalid",function(){var n=$(this)[0].id,t=this.value.trim();t===""?$("#"+n+"_valid").removeClass("_hide"):$("#"+n+"_valid").addClass("_hide")});$("body").on("change",".regulatorystatus_c",function(){var n=$(this)[0].id,t=this.value;parseInt(t)===0?$("#"+n+"_valid").removeClass("_hide"):$("#"+n+"_valid").addClass("_hide")});$("body").on("keyup",".textvalid",function(){var n=$(this)[0].id,t=this.value.trim();t===""?($("#"+n+"_valid").removeClass("_hide"),$("#IngredientName_exists").addClass("_hide")):$("#"+n+"_valid").addClass("_hide")});ingredientId>0?(gridData=JSON.parse($("#IngredientListData").val()),old_gridData=JSON.parse($("#IngredientListData").val()),colModel=updatecolmodels,oldfiles_uploadedData=JSON.parse($("#IngredientFileData").val()),$("#title").text("Edit Ingredient")):(n=JSON.parse($("#DivisionBasedIngredientListJson").val()),gridData=n,colModel=insertcolmodels,ingredientNames=JSON.parse($("#IngredientNameList").val()),$("#title").text("Add Ingredient"));$("#list").jqGrid({datatype:"local",data:gridData,colNames:["RowNo","Region","Category","Regulatory Status","Compliance Remarks","Impact Date","References","Ref Documents"],colModel:colModel,cmTemplate:{sortable:!1},loadonce:!0,viewrecords:!0,pager:"#list_pager",rowNum:200,hoverrows:!1,scroll:1,beforeSelectRow:function(){return!1},gridComplete:function(){bindregulatorystatusDropDown();$(".regulatorystatus_c").select2();ingredientId>0&&$.each(gridData,function(n,t){if(gridData.length>=1){var i=n+1;parseInt(t.RegulatoryStatus)!=0&&$("#regulatory_status_selected_"+i).val(t.RegulatoryStatus).trigger("change")}})}});$(".ui-jqgrid-bdiv").css({"max-height":"58vh"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});t=$(".ui-jqgrid-bdiv").find("tbody").height();t>130?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","10px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));$("#list").closest("#gview_list").css({"z-index":"0"});$("[data-singleselect]").select2();$(".data-singleselect").select2();$(".data-singleselect").select2({dropdownParent:$("#add_project")});$(".data-datepicker").datepicker({todayHighlight:!0,format:"dd/mm/yyyy",autoclose:!0});ingredientId>0?$(".readonly").attr("disabled",!0):$(".readonly").attr("disabled",!1);$(gridData).each(function(n,t){gridData[n].ImpactDates=t.ImpactDates===""||t.ImpactDates===null||typeof t.ImpactDates=="undefined"?"":convertToDate(t.ImpactDates)});$(old_gridData).each(function(n,t){old_gridData[n].ImpactDates=t.ImpactDates===""||t.ImpactDates===null||typeof t.ImpactDates=="undefined"?"":convertToDate(t.ImpactDates)});bindFilesGrid()});$("#save_draftbtn").on("click",function(){var i=!0,r=parseInt($("#IngredientId").val()),t=$("#IngredientName").val(),f=$("#Synonyms").val(),e=$("#CASNumber").val(),o=$("#FunctionId_arr").val().join(",").toString(),s=$("#Division_Id").val(),n=new FormData,u;n.append("IngredientId",r);n.append("IngredientName",t);n.append("Synonyms",f);n.append("CASNumber",e);n.append("FunctionId",o);n.append("GridData",JSON.stringify(gridData));n.append("JsonFileNames",JSON.stringify(EnclosureName));n.append("Division_Id",$("#Division_Id").val());n.append("IsConfirmed",0);r>0?n.append("Source",$("#Source").val()):"";!r>0&&(u=ingredientNames.findIndex(function(n){return n.IngredientName.trim().toLowerCase()===t.trim().toLowerCase()}),u>-1&&(alert("Ingredient Name Already Exists"),i=!1));t==null||t===""||typeof t=="undefined"?($("#IngredientName_valid").removeClass("_hide"),$("#IngredientName_exists").addClass("_hide"),i=!1):$("#IngredientName_valid").addClass("_hide");i&&r>0?validateSave()?handelConfirmPopup("Are you sure, you want to save the ingredients details as draft",function(){$.each(oldfiles_uploadedData,function(n,t){documentData.push({RegionId:t.RegionId,CategoryId:t.CategoryId,EnclosureName:t.EnclosureName})});n.append("DocumentData",JSON.stringify(documentData));$.ajax({url:ROOT+"NewRID/UpdateDetails",dataType:"JSON",type:"POST",data:n,contentType:!1,processData:!1,success:function(n){var t=n.split("_")[1];n.includes("Successfully")?(SaveUploadedFiles(t,"Update"),window.location.href=ROOT+"NewRID/IngredientsRegulation"):alert(n)},error:function(){alert(" An Error occured!!")}})}):alert("There are no changes to save"):i&&handelConfirmPopup("Are you sure, you want to save the ingredients details as draft",function(){$.each(oldfiles_uploadedData,function(n,t){documentData.push({RegionId:t.RegionId,CategoryId:t.CategoryId,EnclosureName:t.EnclosureName})});n.append("DocumentData",JSON.stringify(documentData));$.ajax({url:ROOT+"NewRID/SaveDetails",dataType:"JSON",type:"POST",data:n,contentType:!1,processData:!1,success:function(n){var t=n.split("_")[1];n.includes("Successfully")?(SaveUploadedFiles(t,"Save"),window.location.href=ROOT+"NewRID/IngredientsRegulation"):alert(n)},error:function(){alert(" An Error occured!!")}})})});$("#savebtn").on("click",function(){var t=!0,i=parseInt($("#IngredientId").val()),r=$("#IngredientName").val(),p=$("#Synonyms").val(),w=$("#CASNumber").val(),u=$("#FunctionId_arr").val().join(",").toString(),b=$("#Division_Id").val(),n=new FormData,y;n.append("IngredientId",i);n.append("IngredientName",r);n.append("Synonyms",p);n.append("CASNumber",w);n.append("FunctionId",u);n.append("GridData",JSON.stringify(gridData));n.append("JsonFileNames",JSON.stringify(EnclosureName));n.append("Division_Id",$("#Division_Id").val());n.append("IsConfirmed",1);i>0?n.append("Source",$("#Source").val()):"";var f=[],o=login_region.length==1?login_region[0]:"atleast one",s="Please enter the Regulatory Status and Compliance Remarks for "+o+" Region ",e=0,h=0,c=0,l=!0,a=!0,v=!1;if(!i>0&&(y=ingredientNames.findIndex(function(n){return n.IngredientName.trim().toLowerCase()===r.trim().toLowerCase()}),y>-1&&(alert("Ingredient Name Already Exists"),t=!1)),r==null||r===""||typeof r=="undefined"?($("#IngredientName_valid").removeClass("_hide"),$("#IngredientName_exists").addClass("_hide"),t=!1):$("#IngredientName_valid").addClass("_hide"),u==null||u===""||typeof u=="undefined"||u.length===0?($("#FunctionId_arr_valid").removeClass("_hide"),t=!1):$("#FunctionId_arr_valid").addClass("_hide"),$.each(login_region,function(n,t){var i=gridData.filter(function(n){return n.Region.toLowerCase()==t.toLowerCase()});f.indexOf(parseInt(i[0].RegionId))>-1?"":f.push(parseInt(i[0].RegionId))}),$.each(f,function(n,t){var r=gridData.filter(function(n){return parseInt(n.RegulatoryStatus)!=0&&parseInt(t)===parseInt(n.RegionId)}).length,u=gridData.filter(function(n){return!(n.CRemarks===""||n.CRemarks===null)&&parseInt(t)===parseInt(n.RegionId)}).length,i=gridData.filter(function(n){return parseInt(t)===parseInt(n.RegionId)}).length,f=gridData.filter(function(n){return!(parseInt(n.RegulatoryStatus)===0&&(n.CRemarks===""||n.CRemarks===null))&&parseInt(t)===parseInt(n.RegionId)}),y=gridData.filter(function(n){return parseInt(t)===parseInt(n.RegionId)});r===i&&u===i?e++:e;l&&a&&(r===i?h++:h,u===i?c++:c,r==0&&u==0||(r==i||u==i)&&(v=!0,r!=i&&(l=!1,s="Please enter the Regulatory Status for "+o+" Region "),u!=i&&(a=!1,s="Please enter the Compliance Remarks for "+o+" Region ")))}),$.each(f,function(n,i){var r=gridData.filter(function(n){return parseInt(n.RegulatoryStatus)!=0&&parseInt(i)===parseInt(n.RegionId)}).length,u=gridData.filter(function(n){return!(n.CRemarks===""||n.CRemarks===null)&&parseInt(i)===parseInt(n.RegionId)}).length,f=gridData.filter(function(n){return parseInt(i)===parseInt(n.RegionId)}).length,s=gridData.filter(function(n){return!(parseInt(n.RegulatoryStatus)===0&&(n.CRemarks===""||n.CRemarks===null))&&parseInt(i)===parseInt(n.RegionId)}),h=gridData.filter(function(n){return parseInt(i)===parseInt(n.RegionId)}),o;(r>0||u>0)&&(r<f||u<f)&&(o=e===0&&v==!1?h:s,$.each(o,function(n,i){parseInt(i.RegulatoryStatus)===0?($("#regulatory_status_selected_"+i.RowNo+"_valid").removeClass("_hide"),t=!1):$("#regulatory_status_selected_"+i.RowNo+"_valid").addClass("_hide");i.CRemarks===""||i.CRemarks===null?($("#cremarks_selected_"+i.RowNo+"_valid").removeClass("_hide"),t=!1):$("#cremarks_selected_"+i.RowNo+"_valid").addClass("_hide")}))}),e===0&&(alert(s),t=!1),t&&i>0)if(isConfirmed==0||validateSave()){$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){$.each(oldfiles_uploadedData,function(n,t){documentData.push({RegionId:t.RegionId,CategoryId:t.CategoryId,EnclosureName:t.EnclosureName})});var t={IngredientId:i,Approvallevel:"",Action:"Sent for Level 1 Approval",Remarks:$("#Remarks_text").val().trim()};n.append("DocumentData",JSON.stringify(documentData));n.append("RemarksData",JSON.stringify(t));$.ajax({url:ROOT+"NewRID/UpdateDetails",dataType:"JSON",type:"POST",data:n,contentType:!1,processData:!1,success:function(n){var t=n.split("_")[1];n.includes("Successfully")?(SaveUploadedFiles(t,"Update"),window.location.href=ROOT+"NewRID/IngredientsRegulation"):alert(n)},error:function(){alert(" An Error occured!!")}});$("#confirmpopup").modal("hide")})}else alert("There are no changes to save");else if(t)if(isConfirmed==0||validateSave()){$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){$.each(oldfiles_uploadedData,function(n,t){documentData.push({RegionId:t.RegionId,CategoryId:t.CategoryId,EnclosureName:t.EnclosureName})});var t={IngredientId:i,Approvallevel:"",Action:"Sent for Level 1 Approval",Remarks:$("#Remarks_text").val().trim()};n.append("DocumentData",JSON.stringify(documentData));n.append("RemarksData",JSON.stringify(t));$.ajax({url:ROOT+"NewRID/SaveDetails",dataType:"JSON",type:"POST",data:n,contentType:!1,processData:!1,success:function(n){var t=n.split("_")[1];n.includes("Successfully")?(SaveUploadedFiles(t,"Save"),window.location.href=ROOT+"NewRID/IngredientsRegulation"):alert(n)},error:function(){alert(" An Error occured!!")}});$("#confirmpopup").modal("hide")})}else alert("There are no changes to save")});$("#IngredientName").on("change",function(){var n=$(this).val().trim(),t=ingredientNames.findIndex(function(t){return t.IngredientName.trim().toLowerCase()===n.trim().toLowerCase()});t>-1?($("#IngredientName_exists").removeClass("_hide"),$("#IngredientName_valid").addClass("_hide")):$("#IngredientName_exists").addClass("_hide")});$(document).on("change",".regulatorystatus_c",function(n){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo===i),f=$("#list").getRowData(i),u;t>=0&&(gridData[t][r]=$(this).val(),u=gridData[t].Region)});$(document).on("change",".RefDocs_text",function(n){for(var c,f,l,y,i,e=!0,p=$(this).data("lineno"),r=$(this).data("regionid"),u=$(this).data("categoryid"),o=n.target.files.length,a=$(this).data("name"),v=parseInt($(this).data("lineno")),s=gridData.findIndex(n=>n.RowNo===v),h=0,o=n.target.files.length,t=0;t<o;t++)h+=n.target.files[t].size;if(c=10485760,h>c)return alert("The file size should be less than 10 MB"),$(this).val(""),e=!1,!1;if(e){for(s>=0&&(gridData[s][a]=i),f=documentData.filter(function(n){return n.RegionId===r&&n.CategoryId===u}).length;f>0;)l=documentData.findIndex(n=>n.RegionId===r&&n.CategoryId===u),documentData.splice(l,1),f--;for(t=0;t<o;t++)y=n.target.files[t],i=n.target.files[t].name,documentData.push({RegionId:r,CategoryId:u,EnclosureName:i.replaceAll(" ","")}),EnclosureName.push(i.replaceAll(" ",""))}});$(document).on("keyup",".Cremarks_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo===i);t>=0&&(gridData[t][r]=$(this).val())});$(document).on("change",".ImpactDates_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=convertToDate($(this).val()))});$(document).on("keyup",".References_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=$(this).val())});$(document).on("keyup",".INCI_text",function(){var n=$(this),i=parseInt($(n).data("lineno")),r=$(n).data("name"),t=gridData.findIndex(n=>n.RowNo==i);t>=0&&(gridData[t][r]=$(this).val())});$("#cancelbtn").click(function(){window.location.href=ROOT+"NewRID/IngredientsRegulation"});$(".data-multiselect").multiselect({enableFiltering:!0,includeSelectAllOption:!0,enableCaseInsensitiveFiltering:!0,maxHeight:5,buttonWidth:"75%",dropUp:!0});$("#closebtn").click(function(){$("#IngredientModal1").modal("hide")});