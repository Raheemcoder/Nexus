function showAlertMessage(n,t){$("#alertText").text(n);$("#alertMessage").removeClass().addClass("alert "+t);$("#alertMessage").show();setTimeout(function(){$("#alertMessage").hide()},5e3)}function getapprovallist(n){ingredienttypeid=$(n).attr("data-value");ingredienttypeName=$(n).attr("data-ingredienttype");$.ajax({url:ROOT+"NewRID/FoodSupplementGetApprovalData",type:"GET",dataType:"JSON",data:{IngredientTypeId:ingredienttypeid,pageAppLevel:UserApprovalLevel},success:function(n){$.jgrid.gridUnload("#Approve_IngredientListGrid");CreateMainJQGrid(n)}})}function updateGridColumns(){ingredienttypeName.trim().toLowerCase()==="active herbs"&&($("#Approve_IngredientListGrid").jqGrid("hideCol","CASNumber"),$("#Approve_IngredientListGrid").jqGrid("hideCol","ENumber"));ingredienttypeName.trim().toLowerCase()==="active others"?($("#Approve_IngredientListGrid").jqGrid("hideCol","BotanicalName"),$("#Approve_IngredientListGrid").jqGrid("hideCol","ENumber"),$("#Approve_IngredientListGrid").jqGrid("showCol","CASNumber")):ingredienttypeName.trim().toLowerCase()==="inactives"&&$("#Approve_IngredientListGrid").jqGrid("hideCol","BotanicalName");$("#Approve_IngredientListGrid").jqGrid("setGridWidth",$("#Approve_IngredientListGrid").width())}function CreateMainJQGrid(n){var f=ingredienttypeName.trim().toLowerCase()==="active herbs"?"Ingredient Name (Sanskrit/English)":"Ingredient Name",t=n,r,u;t!=undefined&&t!=null&&t!=""?(Approve_DivisionBasedIngredientList=t,AlreadySaved_Approve_DivisionBasedIngredientList=t):(Approve_DivisionBasedIngredientList=[],AlreadySaved_Approve_DivisionBasedIngredientList=[]);$.ajax({type:"GET",url:ROOT+"NewRID/FoodSupplementRegulatoryStatusDropDownData",data:{},dataType:"JSON","async":!1,success:function(n){var t=JSON.parse(n);CategoryValue=t.Item2;RegulartoryStatusValue=t.Item1},error:function(){alert("Error occured!!")}});r=[{name:"IsRollback",label:"IsRollback",resizable:!0,ignoreCase:!0,hidden:!0,cellattr:add_color},{name:"IsEdited",label:"IsEdited",resizable:!0,ignoreCase:!0,hidden:!0},{name:"IngredientId",label:"Ingredient Id",resizable:!0,ignoreCase:!0,hidden:!0,key:!0},{name:"BotanicalName",label:"Botanical Name",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return ingredienttypeName.trim().toLowerCase()=="active herbs"?'<a href="javascript:void(0)" class="rid_" onclick="GetParticularIngredientData('+i.IngredientId+',this)">'+n+"<\/a>":n}},{name:"IngredientName",label:f,resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return ingredienttypeName.trim().toLowerCase()!="active herbs"?'<a href="javascript:void(0)" class="rid_" onclick="GetParticularIngredientData('+i.IngredientId+',this)">'+n+"<\/a>":n}},{name:"Synonyms",label:"Synonyms",resizable:!0,ignoreCase:!0,index:"Synonyms"},{name:"CASNumber",label:"CAS Number",resizable:!0,ignoreCase:!0},{name:"ENumber",label:"E Number",resizable:!0,ignoreCase:!0},{name:"InMedicine",label:"In Medicine",resizable:!0,align:"center",search:!1,ignorecase:!0,formatter:function(n,t){var i;return UserApprovalLevel.toLowerCase()=="level1"?Level1_GetApprovalDropDown(n,t.rowId,t.colModel.label):UserApprovalLevel.toLowerCase()=="level2"?`<strong style="font-weight:700">`+Level2_GetSelectedLabel(n)+`</strong>`:void 0}},{name:"InFoodSupplement",label:"In Food Supplement",resizable:!0,ignorecase:!0,search:!1,align:"center",formatter:function(n,t){var i;return UserApprovalLevel.toLowerCase()=="level1"?Level1_GetApprovalDropDown(n,t.rowId,t.colModel.label):UserApprovalLevel.toLowerCase()=="level2"?`<strong style="font-weight:700">`+Level2_GetSelectedLabel(n)+`</strong>`:void 0}},{name:"CreatedBy",label:"Requested By",resizable:!0,ignoreCase:!0,width:90},{name:"Remarks",label:"Remarks",resizable:!0,ignoreCase:!0,width:90,align:"center",search:!1,formatter:function(n,t,i){return'<a href="javascript: void(0);" class="grid-icon-only approveicon" style="text-align:center" onclick="ViewRemarks('+i.IngredientId+", '"+i.IngredientName+'\')" class="icon_color text-success btn_button" title="view"><i class="fas fa-info"><\/i><\/a>'}},{name:"IsChecked",label:'Action <div><input type="checkbox" id="cbox" onclick="checkBox(event)" class="ml-4"/><\/div>',editable:!0,index:"Check_Box",width:60,resizable:!1,edittype:"checkbox",formatoptions:{disabled:!1},editoptions:{value:"True:False"},sortable:!1,search:!1,align:"center",formatter:function(n,t){var i=n==!0?"checked":"",r="checkbox-"+t.rowId;return'<input type="checkbox" '+i+' id="'+r+'" class="checkbox"/>'}},];$("#Approve_IngredientListGrid").jqGrid({url:"",datatype:"local",data:Approve_DivisionBasedIngredientList.length>0?Approve_DivisionBasedIngredientList:[],mtype:"GET",colModel:r,loadonce:!0,viewrecords:!0,hoverrows:!1,pager:"#Approve_IngredientListGrid_Pager",rowNum:20,scroll:1,gridComplete:function(){var u=$("#Approve_IngredientListGrid tbody tr"),e=$("#Approve_IngredientListGrid tbody tr td"),n,t,r,f;if(u.length>1)for(n=$(u[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(e[i]).css("width"));updateGridColumns();$("[data-singleselect]").select2();$(".add-edited-color").siblings("td").addClass("add-edited-color");$(".add-rollback-color").siblings("td").addClass("add-rollback-color");t=document.getElementById("cbox");r=!0;$("#Approve_IngredientListGrid tbody .checkbox").each(function(){if(!this.checked)return r=!1,!1});f=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records");r?f>0&&(t.checked=!0):t.checked=!1}});$("#Approve_IngredientListGrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});jQuery("#Approve_IngredientListGrid").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:"InMedicine",numberOfColumns:2,titleText:'<div id="ApproveUsage" class="text-center">Usage<\/div>',index:"Usage",name:"Usage"}]});$("#ApproveUsage").closest("th").addClass("testing");$("#Approve_IngredientListGrid").closest(".jqg-first-row-header").hide();$("#Approve_IngredientListGrid").closest(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 310px)"});$("#Approve_IngredientListGrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});u=$("#Approve_IngredientListGrid").closest(".ui-jqgrid-bdiv").find("tbody").height();u>130?($("#Approve_IngredientListGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_IngredientListGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#Approve_IngredientListGrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_IngredientListGrid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"))}function CreateJQGridForRemarks(n){$("#Remarksjqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:IngredientRemarksColModels,loadonce:!0,viewrecords:!0,pager:"#Remarkspager",rowNum:100,scroll:1,gridComplete:function(){var t=$("#Remarksjqgrid tbody tr"),r=$("#Remarksjqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#Remarksjqgrid").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#Remarksjqgrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var t=$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").find("tbody").height();t>280?($("#Remarksjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Remarksjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#Remarksjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Remarksjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}function ViewRemarks(n,t){$.ajax({url:ROOT+"NewRID/DisplayRemarksById",type:"GET",dataType:"JSON",data:{IngredientId:n,IngredientName:t},success:function(n){$.jgrid.gridUnload("#Remarksjqgrid");$("#displayremarks").modal("show");CreateJQGridForRemarks(n)}})}function applyRowSpan(){oldRegion="";regionId_CRemarks=""}function OpenClaimsInfoPopup(n,t,i,r){var u=$("#IngredientIdForCompliance").val(),f=ingredientnameforpopup;$.ajax({type:"GET",url:ROOT+"NewRID/GetFoodSupplementClaimsInfo",data:{ingredientId:u,regionId:n,categoryId:i},success:function(n){$("#richeditordata_claims").html(n[0].ClaimsInfo);$("#Claims_Region").text(t);$("#Claims_Ingredient").text(f);$("#Claims_Category").text(r);$("#claimsinfopopup").modal("show")}})}function OpenInactivesCRemarksPopup(n,t,i,r){var u=$("#IngredientIdForCompliance").val(),f=ingredientnameforpopup;$.ajax({type:"GET",url:ROOT+"NewRID/GetFoodSupplementComplianceRemarksInactives",data:{ingredientId:u,regionId:n,categoryId:i},success:function(n){n?($("#ComplianceInactives_Ingredient").text(f),$("#ComplianceInactives_Region").text(t),$("#ComplianceInactives_Category").text(r),$("#richeditordata_complianceinactives").html(n),$("#complianceremarksinactivespopup").modal("show")):alert("Error Occured : "+n)},error:function(){alert("Error occured!!")}})}function OpenCRemarksPopup(n,t){var i=$("#IngredientIdForCompliance").val(),r=ingredientnameforpopup;$.ajax({type:"GET",url:ROOT+"NewRID/GetFoodSupplementComplianceRemarks",data:{ingredientTypeId:ingredienttypeid,ingredientId:i,regionId:n},success:function(i){var e=i.HeaderData,u=i.CRemarksData,f;$("#complianceremarkspopup-fs-pdf-download").modal("show");f=$("#complianceremarkspopup-fs-pdf-download tbody");f.empty();$.each(e,function(n,t){var i=`<tr>
                          <th>${t.RegionGroupName}</th>
                          <td>${t.RegionGroupData}</td>
                       </tr>`;f.append(i)});$("#Compliance_RegionId").val(n);$("#Compliance_Region").text(t);$("#Compliance_Ingredient").text(r);$("#richeditordata").html(u[0].AdditionalInfo);$("#InMedicineForClaims").val(u[0].MedicineRecommendation);$("#InfoodSupplementsForClaims").val(u[0].FoodSupplementRecommendation);$("#recommendationforregion").text(t+" Recommendation")}})}function createModalGrid(n){$("#particular-ingredient-details-fs-pdf-download").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:IngridentColModels,loadonce:!0,viewrecords:!0,pager:"#particular-ingredient-details-pager-fs-pdf-download",rowNum:20,scroll:1,gridComplete:function(){var t=$("#particular-ingredient-details-fs-pdf-download tbody tr"),r=$("#particular-ingredient-details-fs-pdf-download tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"));ingredienttypeName.trim().toLowerCase()=="inactives"&&$("#particular-ingredient-details-fs-pdf-download").jqGrid("hideCol","CInfo");$("#particular-ingredient-details-fs-pdf-download").jqGrid("setGridWidth",$("#particular-ingredient-details-fs-pdf-download").width());applyRowSpan()}});$("#particular-ingredient-details-fs-pdf-download").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#particular-ingredient-details-fs-pdf-download").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var t=$("#particular-ingredient-details-fs-pdf-download").closest(".ui-jqgrid-bdiv").find("tbody").height();t>280?($("#particular-ingredient-details-fs-pdf-download").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#particular-ingredient-details-fs-pdf-download").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#particular-ingredient-details-fs-pdf-download").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#particular-ingredient-details-fs-pdf-download").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"));ingredienttypeName.trim().toLowerCase()==="inactives"?$("#download-ing-com-rem-pdf").hide():$("#download-ing-com-rem-pdf").show();$("#ParticularIngredientModal-fs-pdf-download").modal("show")}function GetParticularIngredientData(n){$.ajax({type:"GET",url:ROOT+"NewRID/GetParticularIngredientDetails",data:{IngredientId:n},dataType:"JSON",success:function(t){$("#IngredientIdForCompliance").val(n);var i=JSON.parse(t);$.jgrid.gridUnload("#particular-ingredient-details-fs-pdf-download");ParticularIngredientDetails=i.Item2;ingredienttypeName.trim().toLowerCase()=="active herbs"&&($(".hidebotanicalname").show(),$(".ing-bot-name").text(i.Item1[0].BotanicalName));ingredienttypeName.trim().toLowerCase()=="active others"&&($(".hidecas").show(),$(".hideenumber").hide(),$(".hidebotanicalname").hide(),$(".hideingnamesforactives").hide(),$(".hideingnamesforinactives").show(),$(".ing-cas-no").text(i.Item1[0].CASNumber),$(".ing-e-no").text(i.Item1[0].ENumber));ingredienttypeName.trim().toLowerCase()=="inactives"&&($(".hidecas").show(),$(".hideenumber").show(),$(".hidebotanicalname").hide(),$(".ing-cas-no").text(i.Item1[0].CASNumber),$(".ing-e-no").text(i.Item1[0].ENumber));$(".ing-name").text(i.Item1[0].IngredientName);$(".ing-sys").text(i.Item1[0].Synonyms);ingredientnameforpopup=i.Item1[0].IngredientName;createModalGrid(ParticularIngredientDetails)},error:function(){alert("Error occured!!")}})}function Level1_GetApprovalDropDown(n,t,i){function o(n){return u[0].toLowerCase()==n.toLowerCase()?1:0}var n,u,r;n==null||n==undefined?u="Not Selected":(n=colorStatusMapping_Level1.filter(t=>t.key.toLowerCase()===n.toLowerCase()),u=n.map(n=>n.value));var s=CategoryValue.filter(function(n){return n.CategoryName.toLowerCase()===i.toLowerCase()}),f=s[0].CategoryId,h={IngredientId:parseInt(t),CategoryId:f,RegStatusId:0},c=JSON.stringify(h).replace(/"/g,"'"),e='<select class="demo-content ApproveDropDown" data-singleselect ><option value='+c+"> ---Select--- <\/option>";for(r=0;r<RegulartoryStatusValue.length;r++){var l={IngredientId:parseInt(t),CategoryId:f,RegStatusId:RegulartoryStatusValue[r].RegulatoryStatusId},a=JSON.stringify(l).replace(/"/g,"'"),v=o(RegulartoryStatusValue[r].RegulatoryStatusName)==1?"selected":"";e+='<option value="'+a+'" '+v+" >"+RegulartoryStatusValue[r].RegulatoryStatusName+"<\/option>"}return e+"<\/select>"}function Level2_GetSelectedLabel(n){if(n==null||n==undefined)return"";var n=colorStatusMapping_Level2.filter(t=>t.key.toLowerCase()===n.toLowerCase());return n.map(n=>n.value)}function checkBox(n){n=n||event;n.stopPropagation?n.stopPropagation():n.cancelBubble=!1;var t=document.getElementById("cbox"),i=t.checked;i?($("#Approve_IngredientListGrid .checkbox").prop("checked",!0),Approve_DivisionBasedIngredientList.forEach(n=>{n.IsChecked=!0})):($("#Approve_IngredientListGrid .checkbox").prop("checked",!1),Approve_DivisionBasedIngredientList.forEach(n=>{n.IsChecked=!1}))}function UsageStatus(n){if(n!=null&&n!=undefined){if(n=="Red")return'<span class="pe-2"><i class="red_circle"><\/i><\/span>';if(n=="Blue")return'<span class="pe-2"><i class="purple_circle"><\/i><\/span>';if(n=="Yellow")return'<span class="pe-2"><i class="yellow_circle"><\/i><\/span>';if(n=="Green")return'<span class="pe-2"><i class="green_circle"><\/i><\/span>'}else return""}function AlertIngredientNotFilled(n){var t=[],t=Approve_DivisionBasedIngredientList.filter(t=>n.includes(t.IngredientId)).map(n=>n.IngredientName),i=`<div><span class="alert-fill-span">Please select all the category for below Ingredients to Approve</span><div><br><strong class="alert-fill-strong">${t.join(", ")} </strong>`;alert(i)}function GetJson(n,t,i){var e=CategoryValue.filter(function(n){return n.CategoryName.toLowerCase()===t.toLowerCase()}),o=e[0].CategoryId,n,r,f,u;return n==null||n==undefined?r="Not Selected":(n=colorStatusMapping_Level1.filter(t=>t.key.toLowerCase()===n.toLowerCase()),r=n.map(n=>n.value)),r!="Not Selected"?(f=RegulartoryStatusValue.filter(n=>n.RegulatoryStatusName.toLowerCase()==r[0].toLowerCase()),u=f[0].RegulatoryStatusId):u=0,{IngredientId:i,CategoryId:o,RegStatusId:u,ComplianceRemarks:""}}function Addto_GenerateDataToSave(n){GenerateDataToSave.push({parsedData:n})}function SubmitApproval(n,t){$("#Remarks_modal").modal("hide");$.ajax({type:"POST",url:ROOT+"NewRID/ApproveRevertIngredient",data:{IngredientToApprove:JSON.stringify(n),Action:"Approve",Remarks:$("#Remarks_text").val().trim(),ApprovalLevel:UserApprovalLevel,IsSubmitted:t},success:function(n){n=="1"?window.location.reload():n=="2"?($("#confirmpopup").modal("hide"),showAlertMessage("Ingredient Details Saved Successfully","alert-success")):alert("Error Occured!!!")},error:function(n){alert(n)}})}function SubmitReverted(n){$("#Remarks_modal").modal("hide");$.ajax({type:"POST",url:ROOT+"NewRID/ApproveRevertIngredient",data:{IngredientToApprove:JSON.stringify(n),Action:"RollBack",Remarks:$("#Remarks_text").val().trim(),ApprovalLevel:UserApprovalLevel},success:function(n){n=="1"?window.location.reload():alert("Error Occured!!!")},error:function(n){alert(n)}})}function SubmitCheckedRecord(n,t){var r,i;for(GenerateDataToSave=[],r=0;r<n.length;r++)var u=Approve_DivisionBasedIngredientList.find(t=>t.IngredientId==n[r]),f=Addto_GenerateDataToSave(GetJson(u.InMedicine,"In Medicine",u.IngredientId)),e=Addto_GenerateDataToSave(GetJson(u.InFoodSupplement,"In Food Supplement",u.IngredientId));i=[];GenerateDataToSave.forEach(n=>{i.push(n.parsedData)});t.toLowerCase()=="approve"?SubmitApproval(i,!0):t.toLowerCase()=="rollback"?SubmitReverted(i):t.toLowerCase()=="save"&&SubmitApproval(i,!1)}function GetIngredientChecked(){ingredientCheckedForSave=[];$("#Approve_IngredientListGrid tbody .checkbox").each(function(){if(this.checked){var n=$(this).closest("tr.jqgrow"),t=parseInt(n.attr("id"));ingredientCheckedForSave.push(t)}})}function validateRemarks(n){var t=$("#Remarks_text").val().trim();n.toLowerCase()=="rollback"?t!=""?($("#Err_Remarks_text").hide(),$("#RollBack_modal").modal("hide"),SubmitCheckedRecord(ingredientCheckedForSave,n)):$("#Err_Remarks_text").show():SubmitCheckedRecord(ingredientCheckedForSave,n)}var Approve_DivisionBasedIngredientList=[],AlreadySaved_Approve_DivisionBasedIngredientList=[],groupedByRegion,CategoryValue=[],RegulartoryStatusValue=[],UserApprovalLevel="",ingredienttypeid,ingredienttypeName,ingredientnameforpopup,oldRegion="",regionId_CRemarks="",rollbackremarks_arr=[],IngridentColModels,$TableHeight;$(document).ready(function(){var n,t;UserApprovalLevel=$("#UserApprovalLevel").val();(UserApprovalLevel==undefined||UserApprovalLevel==null||UserApprovalLevel=="")&&(UserApprovalLevel="");n=$("#firstingredient").val();$("#selectedingredient_"+n).addClass("active");t=$("#selectedingredient_"+n);getapprovallist(t);ingredienttypeName=$("#firstingredientname").val();$(".hidebotanicalname").hide();$(".hidecas").hide();$(".hideenumber").hide();$(".hideingnamesforinactives").hide();$(".hideingnamesforactives").show();$("#submit_confirm").hide();$("#rollback_confirm").hide()});add_color=function(n,t,i){var r="";return(i.IsEdited==1||i.IsEdited==2)&&(r='class="add-edited-color"'),(i.IsRollback==1||i.IsRollback==2)&&(r='class="add-rollback-color"'),r};functionAttrSetting=function(n,t){return t.length>200?'style="white-space:nowrap !important;"':""};arrtSetting=function(n,t){var i,r,u;return oldRegion===""||oldRegion!=t?(r=ParticularIngredientDetails.filter(function(n){return n.Region===t}),u=r.length,i=' rowspan="'+u+'"'):i=' style="display:none"',oldRegion=t,i};arrtSetting_CRemarks=function(n,t,i){var r,u=i.RegionId,f,e;return regionId_CRemarks===""||regionId_CRemarks!=u?(f=ParticularIngredientDetails.filter(function(n){return n.RegionId===u}),e=f.length,r=' rowspan="'+e+'"'):r=' style="display:none"',regionId_CRemarks=u,r};var colorStatusMapping_Level1=[{key:"Red",value:"Prohibited"},{key:"Blue",value:"Higher Management/HUB Decision Required"},{key:"Green",value:"Allowed"},{key:"Yellow",value:"Allowed With Restrictions"}],colorStatusMapping_Level2=[{key:"Red",value:"Prohibited"},{key:"Blue",value:"Higher Management/HUB Decision Required"},{key:"Green",value:"Allowed"},{key:"Yellow",value:"Allowed With Restrictions"}],categoryNameMapping=[{key:"InMedicine",value:"In Medicine"},{key:"InFoodSupplement",value:"In Food Supplement"}],IngredientRemarksColModels=[{name:"Remarks",label:"Remarks",width:150},{name:"Action",label:"Action",width:100},{name:"CreatedBy",label:"Action By",width:100},{name:"CreatedDate",label:"Action Date",width:100},];$("#exceldownload").on("click",function(){var n=!0,t=$("#Remarksjqgrid").jqGrid("getGridParam","data");t.length===0&&(alert("No data in Grid"),n=!1);n&&(window.location.href=ROOT+"NewRID/GetApprovalRemarksExcelData")});IngridentColModels=[{name:"Region",align:"center",classes:"trs",cellattr:arrtSetting,sortable:!1,formatter:function(n){return n}},{name:"Category",classes:"trs1",sortable:!1,formatter:function(n){return n}},{name:"RegulatoryStatuscolor",label:"Regulatory Status",align:"center",sortable:!1,resizable:!0,ignoreCase:!0,search:!0,formatter:function(n){return n!=""&&n!=null?UsageStatus(n):n}},{name:"CRemarks",label:"Compliance Remarks",resizable:!0,ignoreCase:!0,sortable:!1,align:"center",classes:"align-middle",cellattr:function(n,t,i){return i.ComplianceExists==1?arrtSetting_CRemarks(n,t,i):""},formatter:function(n,t,i){return i.ComplianceExists==1?'<div class="cremarks_icon mt-3" style="text-align:center;"><a href="javascript:void(0)" onclick="OpenCRemarksPopup(\''+i.RegionId+"', '"+i.Region+'\')"><i class="fas fa-info-circle" title="compliance remarks"><\/i><\/a><\/div>':ingredienttypeName.trim().toLowerCase()=="inactives"&&i.InActivesCRemarks!=""?'<div class="cremarks_icon" style="text-align:center;"><a href="javascript:void(0)" onclick="OpenInactivesCRemarksPopup(\''+i.RegionId+"', '"+i.Region+"','"+i.CategoryId+"','"+i.Category+'\')"><i class="fas fa-info-circle" title="compliance remarks"><\/i><\/a><\/div>':""}},{name:"CInfo",label:"Claims Info",sortable:!1,resizable:!0,ignoreCase:!0,align:"center",formatter:function(n,t,i){return i.CInfo!=""?'<div class=""><a href="javascript:void(0)" onclick="OpenClaimsInfoPopup(\''+i.RegionId+"', '"+i.Region+"','"+i.CategoryId+"','"+i.Category+'\')"><i class="fas fa-info-circle" title="compliance remarks"><\/i><\/a><\/div>':""}},{name:"ImpactDates",label:"Impact Date",sortable:!1,resizable:!0,ignoreCase:!0,search:!0}];$("body").on("click","#Approve_IngredientListGrid tr td .checkbox",function(){var r=$(this).closest("tr.jqgrow"),t=parseInt(r.attr("id")),i,n;$(this).prop("checked")?Approve_DivisionBasedIngredientList.forEach(n=>{n.IngredientId==t&&(n.IsChecked=!0)}):Approve_DivisionBasedIngredientList.forEach(n=>{n.IngredientId==t&&(n.IsChecked=!1)});i=document.getElementById("cbox");n=!0;$("#Approve_IngredientListGrid tbody .checkbox").each(function(){if(!this.checked)return n=!1,!1});i.checked=n?!0:!1});oldRegion="";arrtSetting=function(n,t){var i,r;return Object.keys(groupedByRegion).forEach(n=>{if(n===t.toUpperCase()){const t=groupedByRegion[n].length;i=t}}),r=(oldRegion=undefined||oldRegion!=t.toUpperCase())?' rowspan="'+i+'"':' style="display:none"',oldRegion=t.toUpperCase(),r};$("#Approve_ParticularIngredientDetails").jqGrid({datatype:"local",data:[],colNames:["Region","Category","Regulatory Status","Compliance Remarks","Impact Dates","References",],colModel:[{name:"Region",align:"center",classes:"trs",cellattr:arrtSetting},{name:"Category",classes:"trs1"},{name:"RegulatoryStatus",align:"center",formatter:function(n){return UsageStatus(n)}},{name:"CRemarks"},{name:"ImpactDates"},{name:"References"},],cmTemplate:{sortable:!1},loadonce:!0,viewrecords:!0,pager:"#Approve_ParticularIngredientDetails_Pager",rowNum:20,hoverrows:!1,scroll:1,beforeSelectRow:function(){return!1},gridComplete:function(){oldRegion=""}});$("#Approve_ParticularIngredientDetails").closest(".jqg-first-row-header").hide();$("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid-bdiv").css({"max-height":"50vh"});$("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});$TableHeight=$("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid-bdiv").find("tbody").height();$TableHeight>130?($("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_ParticularIngredientDetails").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#Approve_ParticularIngredientDetails").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#Approve_ParticularIngredientDetails").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"));$(document).on("change",".ApproveDropDown",function(){for(var r,s=$(this).closest("tr.jqgrow"),h=parseInt(s.attr("id")),i,n=0;n<Approve_DivisionBasedIngredientList.length;n++)if(r=Approve_DivisionBasedIngredientList[n],r.IngredientId==h){i=n;break}var c=$(this).find("option:selected").val(),l=c.replace(/'/g,'"'),t=JSON.parse(l);if(t.RegStatusId!=0){var a=RegulartoryStatusValue.filter(n=>n.RegulatoryStatusId==t.RegStatusId),v=a[0].RegulatoryStatusName,y=colorStatusMapping_Level1.filter(n=>n.value.toLowerCase()===v.toLowerCase()),p=y.map(n=>n.key),u=CategoryValue.filter(n=>n.CategoryId==t.CategoryId),f=u[0].CategoryName,e=categoryNameMapping.filter(n=>n.value.toLowerCase()===f.toLowerCase()),o=e.map(n=>n.key);Approve_DivisionBasedIngredientList[i][o]=p[0]}else{var u=CategoryValue.filter(n=>n.CategoryId==t.CategoryId),f=u[0].CategoryName,e=categoryNameMapping.filter(n=>n.value.toLowerCase()===f.toLowerCase()),o=e.map(n=>n.key);Approve_DivisionBasedIngredientList[i][o]=null}});$(document).on("change","#Remarks_text",function(){var n=$("#Remarks_text").val().trim();n.length>0?$("#Err_Remarks_text").hide():$("#Err_Remarks_text").show()});$("#Level2_Remarks").click(function(){$.ajax({url:ROOT+"NewRID/FoodSupplementGetMostRecentRemark",type:"GET",dataType:"JSON",data:{ingredientTypeId:ingredienttypeid},success:function(n){var t;rollbackremarks_arr=n;t=rollbackremarks_arr.length>0?rollbackremarks_arr[0]:null;$("#Remarks_table").empty();var r=$("#Remarks_table"),i="";t?i+='<tr><td class="word-wrap-td">'+t.IngredientName+"<\/td><td>"+t.ActionBy+"<\/td><td>"+t.ActionDate+"<\/td><td>"+t.Remarks+"<\/td><\/tr>":i='<tr><td colspan="4" class="text-center">No remarks available<\/td><\/tr>';r.append('<thead class="remarks-table-header"><tr><th>Ingredient Name<\/th><th>Rollback By<\/th><th>Rollback On<\/th><th>Remarks<\/th><\/tr><\/thead>');r.append('<tbody class="remarks-table-body">'+i+"<\/tbody>");$("#RollBack_RemarksToShow").modal("show")}})});var rowtofill=[],GenerateDataToSave=[],ingredientCheckedForSave=[];$("#approvebtn").click(function(){var r=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records"),t,i,n;if(GetIngredientChecked(),r==0)alert("There is no data to approve");else if(ingredientCheckedForSave.length==0)alert("Please select atleast one ingredient to approve");else if(UserApprovalLevel.toLowerCase()=="level1"){for($("#remarks-mandatory").addClass("hide"),rowtofill=[],t=0;t<ingredientCheckedForSave.length;t++)if(i=Approve_DivisionBasedIngredientList.find(n=>n.IngredientId==ingredientCheckedForSave[t]),n=i.IngredientId,i.InMedicine==null||i.InFoodSupplement==null){const t=rowtofill.includes(n);t?rowtofill=rowtofill.map(t=>t===n?n:t):rowtofill.push(n)}else rowtofill=rowtofill.filter(t=>t!==n);if(rowtofill.length>0)AlertIngredientNotFilled(rowtofill);else if(rowtofill.length==0){$("#Err_Remarks_text").hide();$("#Remarks_text").val("");$("#submit_confirm").show();$("#rollback_confirm").hide();$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){validateRemarks("Approve")})}}else if(UserApprovalLevel.toLowerCase()=="level2"){$("#remarks-mandatory").addClass("hide");$("#Err_Remarks_text").hide();$("#Remarks_text").val("");$("#submit_confirm").show();$("#rollback_confirm").hide();$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){validateRemarks("Approve")})}});$("#cancelbtn").click(function(){window.location.href=ROOT+"NewRID/FoodSupplementRIDList"});$("#revertbtn").click(function(){var n=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records");if(GetIngredientChecked(),n>0)if(ingredientCheckedForSave.length>0){$("#Err_Remarks_text").hide();$("#Remarks_text").val("");$("#remarks-mandatory").removeClass("hide");$("#rollback_confirm").show();$("#submit_confirm").hide();$("#Remarks_modal").modal("show");$("#SendtoApproveRevert").off("click").on("click",function(){validateRemarks("RollBack")})}else alert("Please select atleast one ingredient to rollback");else alert("There is no data to roll back")});$("#saveasdraftbtn").on("click",function(){var r=$("#Approve_IngredientListGrid").jqGrid("getGridParam","records"),t,i,n;if(GetIngredientChecked(),r==0)alert("There is no data to save");else if(ingredientCheckedForSave.length==0)alert("Please select atleast one ingredient to save");else if(UserApprovalLevel.toLowerCase()=="level1"){for($("#remarks-mandatory").addClass("hide"),rowtofill=[],t=0;t<ingredientCheckedForSave.length;t++)if(i=Approve_DivisionBasedIngredientList.find(n=>n.IngredientId==ingredientCheckedForSave[t]),n=i.IngredientId,i.InMedicine==null||i.InFoodSupplement==null){const t=rowtofill.includes(n);t?rowtofill=rowtofill.map(t=>t===n?n:t):rowtofill.push(n)}else rowtofill=rowtofill.filter(t=>t!==n);if(rowtofill.length>0)AlertIngredientNotFilled(rowtofill);else if(rowtofill.length==0){$("#confirmpopupmesssage").empty().html("Are you sure you want to save the details ?");$("#confirmpopup").modal("show");$("#ConfirmOKbutton").off("click").on("click",function(){validateRemarks("save")})}}});