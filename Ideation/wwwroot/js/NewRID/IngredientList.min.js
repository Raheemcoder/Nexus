function UsageStatus(n){if(n!=null){if(n=="Red")return'<span class="pe-2"><i class="red_circle"><\/i><\/span>';if(n=="Blue")return'<span class="pe-2"><i class="purple_circle"><\/i><\/span>';if(n=="Yellow")return'<span class="pe-2"><i class="yellow_circle"><\/i><\/span>';if(n=="Green")return'<span class="pe-2"><i class="green_circle"><\/i><\/span>'}else return""}function UsageStatusWithComments(n){if(n!=null){var t="",i="";return t=t+n,t=="Blue"?`<span><span class="pe-2"><i class="purple_circle"></i></span>`+i+`</span>`:t=="Green"?`<span><span class="pe-2"><i class="green_circle"></i></span>`+i+`</span>`:t=="Yellow"?`<span><span class="pe-2"><i class="yellow_circle"></i></span>`+i+`</span>`:t=="Red"?`<span><span class="pe-2"><i class="red_circle"></i></span>`+i+`</span>`:""}return""}function GetParticularIngredientData(n){var r=n.getAttribute("data-ingredientid"),f=n.getAttribute("data-ingredientname"),i=n.getAttribute("data-synonyms"),t,u;i==="null"&&(i="");t=n.getAttribute("data-casno");t==="null"&&(t="");u=n.getAttribute("data-function");$.ajax({type:"GET",url:ROOT+"NewRID/GetIngredientsRegulationById",data:{IngredientId:r},dataType:"JSON",success:function(n){data=JSON.parse(n);$.jgrid.gridUnload("#viewlist");createModalGrid();$("#IngredientModal1").modal("show");$("#ActiveIngredientName").text(f);$("#ActiveSynonymName").text(i);$("#ActiveCASName").text(t);$("#ActiveFunctions").text(u);$("#IngredientId").val(r)},error:function(){alert("Error occured!!")}})}function createModalGrid(){oldRegion="";$("#viewlist").jqGrid({url:"",datatype:"local",data:data,mtype:"GET",colModel:IngridentDetailColModels,loadonce:!0,viewrecords:!0,pager:"#viewlist_pager",rowNum:data.length,sortable:!1,cmTemplate:{sortable:!1},scroll:1,gridComplete:function(){var t=$("#viewlist tbody tr"),r=$("#viewlist tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#viewlist").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#viewlist").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var n=$("#viewlist").closest(".ui-jqgrid-bdiv").find("tbody").height();n>280?($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}function FormateDateForSearch(n){var t=n.getDate(),i=n.getMonth()+1;return t=(t<10?"0":"")+t,i=(i<10?"0":"")+i,n.getFullYear()+"-"+i+"-"+t}function GetSearchResult(n,t,i){$.ajax({type:"GET",url:ROOT+"NewRID/GetIngredientBasedOnSearch",data:{StartDate:n,EndDate:t,SearchText:i,Source:"IRA"},dataType:"JSON",success:function(n){$.jgrid.gridUnload("#prd_desc1");createGrid(n)},error:function(){alert("Error occured!!")}})}function createGrid(n){jQuery("#prd_desc1").jqGrid({datatype:"local",data:n,colModel:[{name:"IsEdited",label:"IsEdited",resizable:!0,ignoreCase:!0,hidden:!0,cellattr:add_color},{name:"Action",label:"Action",width:70,resizable:!0,ignoreCase:!0,search:!1,formatter:function(n,t,i){return'<div class="action_icons d-flex justify-content-around align-items-center"><a href="#" class="btn-icon" onclick="ShowHistory('+i.IngredientId+', this)" data-ingName="'+i.IngredientName+'" title="History"><i class="fas fa-history text-warning"><\/i><\/a>'+(i.IsConfirmed==1?'<a href="'+ROOT+"NewRID/AddIngredient?q="+Encrypt("ingredientid="+i.IngredientId)+'" class="btn-icon edit-color" title="Edit"><i class="fas fa-pen"><\/i><\/a>':"")+'<a href="#" class="btn-icon" onclick="DeleteIngredient(this)" data-ingredientid="'+i.IngredientId+'" title="Delete"><i class="fas fa-trash color-delete"><\/i><\/a><\/div>'}},{name:"IngredientName",label:"Ingredient Name",resizable:!0,ignoreCase:!0,search:!0,width:200,formatter:function(n,t,i){return'<a href="#" class="rid_" data-target="#IngredientModal1" data-ingredientid="'+i.IngredientId+'" data-ingredientname="'+i.IngredientName+'"  data-synonyms="'+i.Synonyms+'" data-casno = "'+i.CASNumber+'" data-function = "'+i.FunctionName+'" onclick="GetParticularIngredientData(this)">'+n+"<\/a>"}},{name:"Synonyms",label:"Synonyms",resizable:!0,ignoreCase:!0,search:!0,width:120,index:"Synonyms"},{name:"CASNumber",label:"CAS Number",resizable:!0,ignoreCase:!0,search:!0,width:130},{name:"FunctionName",label:"Functions",width:150,resizable:!0,search:!0,ignorecase:!0,cellattr:functionAttrSetting},{name:"AdultLeaveOn",label:"Adult - Leave On",resizable:!0,width:100,align:"center",ignorecase:!0,index:"AdultLeaveOn",formatter:function(n){return UsageStatus(n)}},{name:"AdultRinseOff",label:"Adult - Rinse Off",width:100,resizable:!0,ignorecase:!0,align:"center",index:"AdultRinseOff",formatter:function(n){return UsageStatus(n)}},{name:"BabyLeaveOn",label:"Baby - Leave On",resizable:!0,width:100,ignorecase:!0,align:"center",index:"BabyLeaveOn",formatter:function(n){return UsageStatus(n)}},{name:"BabyRinseOff",label:"Baby - Rinse Off",resizable:!0,width:100,ignorecase:!0,align:"center",index:"BabyRinseOff",formatter:function(n){return UsageStatus(n)}},],loadonce:!0,pager:"#pager_expected1",viewrecords:!0,ignoreCase:!0,rowNum:20,sortable:!1,cmTemplate:{sortable:!1},scroll:1,gridComplete:function(){var t=$("#ingredient tbody tr"),r=$("#ingredient tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"));$(".add-edited-color").siblings("td").addClass("add-edited-color");$(".add-rollback-color").siblings("td").addClass("add-rollback-color")}});$("#prd_desc1").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$("#prd_desc1").closest(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 280px )"});$("#prd_desc1").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var t=$("#prd_desc1").closest(".ui-jqgrid-bdiv").find("tbody").height();t>280?($("#prd_desc1").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#prd_desc1").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#prd_desc1").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#prd_desc1").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"));$("#prd_desc1").closest("#gview_prd_desc1").css({"z-index":"0"});jQuery("#prd_desc1").jqGrid("setGroupHeaders",{useColSpanStyle:!0,groupHeaders:[{startColumnName:"AdultLeaveOn",numberOfColumns:4,titleText:'<div id="Usage" class="text-center">Usage<\/div>',index:"Usage",name:"Usage"}]})}function DeleteIngredient(n){var t=n.getAttribute("data-ingredientid");$("#confirmpopupmesssage").text("Are you sure, you want to delete");$("#confirmpopup").modal("show");$("#ConfirmOKbutton").on("click",function(){$.ajax({type:"POST",url:ROOT+"NewRID/DeleteIngredient",data:{IngredientId:t},dataType:"JSON",success:function(n){n.includes("Successfully")?window.location.reload():alert(n)},error:function(){alert("Error occured!!")}});$("#confirmpopup").modal("hide")})}function ViewUploadedFiles(n,t){var i=parseInt($("#IngredientId").val());$.ajax({url:ROOT+"NewRID/DisplayUploadedFiles",type:"POST",dataType:"JSON",data:{IngredientId:i,RegionId:n,CategoryId:t},success:function(n){$.jgrid.gridUnload("#FileUploadjqgrid");var t=JSON.parse(n);$("#displayuploadedfiles").modal("show");CreateJQGridUploadFile(t)}})}function CreateJQGridUploadFile(n){$("#FileUploadjqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:IngredientFileColModels,loadonce:!0,viewrecords:!0,pager:"#FileUploadpager",rowNum:100,scroll:1,gridComplete:function(){var t=$("#FileUploadjqgrid tbody tr"),r=$("#FileUploadjqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var t=$("#FileUploadjqgrid").closest(".ui-jqgrid-bdiv").find("tbody").height();t>280?($("#FileUploadjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#FileUploadjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#FileUploadjqgrid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#FileUploadjqgrid").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}function downloadoc(n){var t=parseInt($("#IngredientId").val()),i=n.getAttribute("data-region"),r=n.getAttribute("data-category"),u=n.getAttribute("data-enclosure");window.location.href=ROOT+"NewRID/FileDownload?docName="+u+"&&ingredientId="+t+"&&regionId="+i+"&&categoryId="+r}function getDateForExcel(n,t){var i=!0,r=$("#global_search").text(),u=$("#prd_desc1").jqGrid("getGridParam","data");u.length===0&&(alert("There is no data present in the grid"),i=!1);i&&(window.location.href=ROOT+"NewRID/GetRegionWiseComplianceData?StartDate="+n+"&&EndDate="+t+"&searchText="+r)}var oldRegion="",data=[],Loginid=$("#LoginId").val(),IngridentDetailColModels,isValidStartDateFlag,isValidEndDateFlag,start,end,IngredientFileColModels;arrtSetting=function(n,t){var i,r,u;return oldRegion===""||oldRegion!=t?(r=data.filter(function(n){return n.Region===t}),u=r.length,i=' rowspan="'+u+'"'):i=' style="display:none"',oldRegion=t,i};IngridentDetailColModels=[{name:"RowNo",align:"center",hidden:!0},{name:"Region",align:"center",classes:"trs",cellattr:arrtSetting,width:80,formatter:function(n){return n}},{name:"Category",classes:"trs1",width:80,formatter:function(n){return n}},{name:"RegulatoryStatus",label:"Regulatory<br>Status",align:"center",resizable:!0,ignoreCase:!0,search:!0,width:80,formatter:function(n){return UsageStatusWithComments(n)}},{name:"CRemarks",label:"Compliance Remarks",resizable:!0,ignoreCase:!0,search:!0,width:250,formatter:function(n){if(n!=null&&n.length>0){var t=n.length,i=Math.ceil(t/100)+1;return`<textarea class="form-control date_text_freezed" rows="${i}" readonly>${n}</textarea>`}return""}},{name:"ImpactDates",label:"Impact Date",resizable:!0,ignoreCase:!0,search:!0,width:80},{name:"References",label:"References",resizable:!0,ignoreCase:!0,search:!0,width:120},{name:"ReferenceDoc",label:"Reference Doc",align:"center",resizable:!0,ignoreCase:!0,search:!0,width:80,formatter:function(n,t,i){return i.IsFileExists==!0?'<a href="javascript: void(0);" class="grid-icon-only approveicon" onclick="ViewUploadedFiles('+i.RegionId+","+i.CategoryId+')" class="icon_color text-success btn_button" title="view"><i class="fas fa-eye"><\/i><\/a>':""}},];$(document).ready(function(){var n=JSON.parse($("#DivisionBasedIngredientListJson").val());createGrid(n)});$("#prd_desc1").closest("#Usage").closest("th").addClass("testing");$("#prd_desc1").closest(".jqg-first-row-header").hide();$("#global-search").on("input",function(){var n=$(this).val().toLowerCase(),t=$(".card-section");t.each(function(){var t=$(this).find(".card_details_search"),i=t.text().toLowerCase();i.includes(n)?$(this).css("display","block"):$(this).css("display","none")})});$(".board_view").hide();$(".list_gridview").hide();$(".list").click(function(){$(".grid_view").addClass("list_view");$(".grid_view").removeClass("listgrid_table");$(".list_gridview").show();$(".grid_table").hide()});$(".table_view").click(function(){$(".grid_view").addClass("listgrid_table");$(".grid_view").removeClass("list_view");$(".grid_table").show()});$(".collapse_cell").click(function(){$(this).closest("li").addClass("cell_close")});$(".expand_cell").click(function(){$(this).closest("li").removeClass("cell_close")});$("#closebtn").click(function(){$("#IngredientModal1").modal("hide")});isValidStartDateFlag=1;isValidEndDateFlag=1;$("#Search_Start_Date").on("change",function(){var n=$("#Search_Start_Date").val();n.length>10||n.length<10?($("#Err_Search_Start_Date").show(),isValidStartDateFlag=0):($("#Err_Search_Start_Date").hide(),isValidStartDateFlag=1)});$("#Search_End_Date").on("change",function(){var n=$("#Search_End_Date").val();n.length>10||n.length<10?($("#Err_Search_End_Date").show(),isValidEndDateFlag=0):($("#Err_Search_End_Date").hide(),isValidEndDateFlag=1)});$("#search_ingredient").on("click",function(){var r,u;if(isValidEndDateFlag==1&&isValidStartDateFlag==1){var n=$("[data-datepicker-startdate]").datepicker("getDate"),t=$("[data-datepicker-enddate]").datepicker("getDate"),i=$("#global_search").val().trim();n==null&&t==null&&i==""?alert("There is no data to search"):n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&i!=undefined&&i!=null&&i!=""?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),GetSearchResult(r,u,i)):n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&(i==undefined||i==null||i=="")?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),GetSearchResult(r,u,"")):(n==undefined||n==null||n=="")&&(t==undefined||t==null||t=="")&&i!=undefined&&i!=null&&i!=""?GetSearchResult("","",i):n!=undefined&&n!=null&&n!=""&&(t==undefined||t==null||t=="")||(n==undefined||n==null||n=="")&&t!=undefined&&t!=null&&t!=""?alert("Please select both start date and end date for search"):alert("There is no data to search")}else alert("Please select a valid date")});$("#refresh_date").on("click",function(){$("[data-datepicker-startdate]").datepicker("destroy");$("[data-datepicker-startdate]").val("");$("[data-datepicker-startdate]").datepicker({format:"dd/mm/yyyy",autoclose:!0});$("[data-datepicker-enddate]").datepicker("destroy");$("[data-datepicker-enddate]").val("");$("[data-datepicker-enddate]").datepicker({format:"dd/mm/yyyy",autoclose:!0});$("#global_search").val("");GetSearchResult("","","")});start=new Date;end=new Date((new Date).setYear(start.getFullYear()+1));$("[data-datepicker-startdate]").datepicker({format:"dd/mm/yyyy",endDate:end,autoclose:!0}).on("changeDate",function(){$("[data-datepicker-enddate]").datepicker("setStartDate",$(this).val())});$("[data-datepicker-enddate]").datepicker({format:"dd/mm/yyyy",startDate:start,endDate:end,autoclose:!0}).on("changeDate",function(){$("[data-datepicker-startdate]").datepicker("setEndDate",$(this).val())});add_color=function(n,t,i){var r="";return(i.IsEdited==1||i.IsEdited==2)&&(r='class="add-edited-color"'),i.IsRollback==1&&i.IsApproved==1&&(r='class="add-rollback-color"'),r};functionAttrSetting=function(n,t){return t.length>200?'style="white-space:nowrap !important;"':""};IngredientFileColModels=[{name:"RegionId",label:"RegionId",hidden:!0},{name:"CategoryId",label:"CategoryId",hidden:!0},{name:"EnclosureName",label:"File Name",width:250},{name:"UploadedBy",label:"Uploaded By",width:150},{name:"UploadedOn",label:"Uploaded Date",width:100},{name:"Action",align:"center",width:50,formatter:function(n,t,i){return'<div class="action_icons "><a href="#" title="Download" class="fas fa-download color-download" onclick="downloadoc(this)" data-region="'+i.RegionId+'" data-category="'+i.CategoryId+'" data-enclosure="'+i.EnclosureName+'" ><\/a><\/div >'}},];$("#exceldownload").on("click",function(){var r,u;if(isValidEndDateFlag==1&&isValidStartDateFlag==1){var n=$("[data-datepicker-startdate]").datepicker("getDate"),t=$("[data-datepicker-enddate]").datepicker("getDate"),i=$("#global_search").val().trim();n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&i!=undefined&&i!=null&&i!=""?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),getDateForExcel(r,u,i)):n!=undefined&&n!=null&&n!=""&&t!=undefined&&t!=null&&t!=""&&(i==undefined||i==null||i=="")?(r=FormateDateForSearch(n),u=FormateDateForSearch(t),getDateForExcel(r,u,"")):(n==undefined||n==null||n=="")&&(t==undefined||t==null||t=="")&&getDateForExcel("","",i)}else alert("Please select a valid date")});