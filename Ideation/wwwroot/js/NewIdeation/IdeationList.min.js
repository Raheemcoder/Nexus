function createJqgrid(n){$.jgrid.gridUnload("#ideation_grid");$("#ideation_grid").jqGrid({url:"",datatype:"local",data:n,mtype:"GET",colModel:colmodels,loadonce:!0,viewrecords:!0,pager:"#ideation_pager",rowNum:20,scroll:1,onSelectRow:function(n){var t=$("#ideation_grid").jqGrid("getRowData",n),i=t.innovationid},gridComplete:function(){var t=$("#ideation_grid tbody tr"),r=$("#ideation_grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$(".ui-jqgrid-bdiv").css({"max-height":"calc(100vh - 270px)"});$(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});var t=$(".ui-jqgrid-bdiv").find("tbody").height();t>330?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","10px"),$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","10px")):($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"),$(".-virtual-scroll").find(".ui-jqgrid-htable").css("padding-right","0px"));$("#ideation_grid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"})}function ideationstatu(n){$.ajax({type:"POST",url:ROOT+"NewIdeation/UpdateIdeationStatus",data:{idstats:n},dataType:"json",success:function(){alert("Change is Submited Successfully");$("#Innovation_Details").css({opacity:0});$("#Innovation_Details").hide();$("body").removeClass("modal-open");window.location.reload()},error:function(){alert("Error occured!!")}})}var data=JSON.parse($("#IdeationListData").val()),colmodels=[{name:"InnovationId",label:"Innovation Id",width:15,resizable:!0,ignoreCase:!0,sorttype:"number",formatter:function(n,t,i){var r='data-innovationid="'+i.InnovationId+'"';return"<div "+r+">"+n+"<\/div>"}},{name:"InnovationTitle",label:"Innovation Title",width:100,resizable:!0,ignoreCase:!0},{name:"BusinessDivisionName",label:"Platform Domain",width:40,resizable:!0,ignoreCase:!0},{name:"PlatformTypeName",label:"Platform Type",width:40,resizable:!0,ignoreCase:!0},{name:"GeographicName",label:"Geographic Scope",width:40,resizable:!0,ignoreCase:!0},{name:"StatusName",label:"Status",width:20,resizable:!0,ignoreCase:!0,formatter:function(n,t,i){return i.StatusName=="Pending"?'<a href="#"> <span class="text-warning">Pending<\/span><\/a>':i.StatusName=="Approved"?'<a href="#"  > <span class="text-success">Approved<\/span><\/a>':i.StatusName=="Declined"?'<a href="#"> <span class="text-danger">Declined<\/span><\/a>':i.StatusName=="SendBack"?'<a  href="#"> <span class="text-info">SendBack<\/span><\/a>':i.StatusName=="Existing"?'<a  href="#"> <span class="text-primary">Existing<\/span><\/a>':" "}},{name:"CreatedBy",label:"Submitted By",width:30,resizable:!0,ignoreCase:!0},{name:"CreatedDate",label:"Submitted Date",width:30,resizable:!0,ignoreCase:!0,sorttype:"date",formatter:"date",formatoptions:{newformat:"d M Y"},searchoptions:{sopt:["eq"],dataInit:function(n){$(n).datepicker({format:"dd M yyyy",autoclose:!0}).change(function(){$("#ideation_grid")[0].triggerToolbar()})}}},];$(document).ready(function(){$("#StartDate").datepicker({format:"dd-mm-yyyy",todayHighlight:!0,autoclose:!0,clearBtn:!0}).on("changeDate",function(n){var t=new Date(n.date.valueOf()),r=$("#EndDate").datepicker("getDate"),i=new Date;return(t.setHours(0,0,0,0),i.setHours(0,0,0,0),$("#EndDate").datepicker("setStartDate",t),t<=i)?($("#EndDate").datepicker("update",i),!1):t>r?($("#EndDate").val(""),!1):void 0});$("#EndDate").datepicker({format:"dd-mm-yyyy",todayHighlight:!0,autoclose:!0,clearBtn:!0});$("#EndDate").datepicker("setStartDate",$("#StartDate").datepicker("getDate"));createJqgrid(data)});$("#btn-search").on("click",function(){var i=!0,n=$("#StartDate").val(),t=$("#EndDate").val(),r=$("#BusinessDivisionId").val(),u=$("#PlatformTypeId").val(),f=$("#GeographicId").val(),e=$("#StatusId").val();if((n==""||n==null)&&(t==""||t==null))return alert("Please select Start Date and End Date"),i=!1,!1;if(n==""||n==null)return alert("Please select Start Date"),i=!1,!1;if(t==""||t==null)return alert("Please select End Date"),i=!1,!1;i&&$.ajax({type:"GET",url:ROOT+"NewIdeation/GetIdeationSearchedResult",data:{startdate:n,enddate:t,platformdomainid:r,platformtypeid:u,geographicid:f,statusid:e},dataType:"JSON",success:function(n){createJqgrid(n)}})});$("#btn-refresh").on("click",function(){var n=new Date;n.setDate(n.getDate()-30);var i=("0"+n.getDate()).slice(-2),r=("0"+(n.getMonth()+1)).slice(-2),u=n.getFullYear(),f=i+"-"+r+"-"+u;$("#StartDate").val(f);var t=new Date,i=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),u=t.getFullYear(),e=i+"-"+r+"-"+u;$("#EndDate").val(e);$("#BusinessDivisionId").val("").trigger("change");$("#PlatformTypeId").val("").trigger("change");$("#GeographicId").val("").trigger("change");$("#StatusId").val(2).trigger("change");createJqgrid(data)});$("#exporttoexcel").on("click",function(){var n=$("#StartDate").val(),t=$("#EndDate").val(),i=$("#BusinessDivisionId").val(),r=$("#PlatformTypeId").val(),u=$("#GeographicId").val(),f=$("#StatusId").val();window.location.href=ROOT+"NewIdeation/GetIdeationExceldata?startdate="+n+"&&enddate="+t+"&&platformdomainid="+i+"&&platformtypeid="+r+"&&geographicid="+u+"&&statusid="+f});$(".ideationdata_table").on("click","#ideation_grid tr.jqgrow",function(){var n=$(this).find("div[data-innovationid]").attr("data-innovationid"),t=$("#role").val();$.ajax({type:"POST",url:ROOT+"NewIdeation/GetIdeationById",data:{InnovationId:parseInt(n)},dataType:"json",success:function(i){if($(".valStatus").hide(),i=="")alert("Please enter the correct no");else if(i!=null){$("#Innovation_Details").modal("show");var r=' <tr>  <td class="rd">'+i.BusinessDivisionName+"<\/td><td>"+i.CreatedBy+"<\/td><td>"+i.CreatedDate+"<\/td><td>"+i.StatusName+"<\/td><td>"+i.ActionBy+'<\/td><td><a class="remark" target="_blank" data-bs-toggle="modal" data-bs-target="#remarkModal" data-bs-dismiss="modal" data-val="'+i.InnovationId+'" ><i class="fa fa-download" aria-hidden="true"><\/i>View Remarks<\/a><\/td>';$("#modal_innovationtile").text(i.InnovationTitle);$("#modal_innovationid").val(n);$("#modal_keywords").val(i.Keyword);$("#modal_keywords").attr("title",i.Keyword);$("#modal_pt").val(i.PlatformTypeName);$("#modal_pt").attr("title",i.PlatformTypeName);$("#modal_other").val(i.Other);$("#modal_other").attr("title",i.Other);$("#modal_bd").val(i.BusinessDivisionName);$("#modal_bd").attr("title",i.BusinessDivisionName);$("#modal_gs").val(i.GeographicName);$("#modal_gs").attr("title",i.GeographicName);$("#modal_region").val(i.Region);$("#modal_region").attr("title",i.Region);$("#modal_st").val(i.StrategicFitName);$("#modal_st").attr("title",i.StrategicFitName);$("#modal_description").val(i.Description);$("#modal_description").attr("title",i.Description);$("#modal_CreatedBy").val(i.CreatedBy);$("#modal_CreatedBy").attr("title",i.CreatedBy);$("#modal_status").val();t.toLowerCase()=="view ideation"?($("#remarkfield").hide(),$("#remarkDrop").hide(),$("#model_submit").hide(),i.FilePath==null||i.FilePath==""?($("#model_filedownload").hide(),$("#filelabel").hide()):($("#model_filedownload").show(),$("#filelabel").show(),$("#model_filedownload").attr("href",ROOT+"imageUpload/"+i.FilePath)),$("#modal_table tbody").html(r)):($("#modal_remarks").attr("title",i.Remarks),$("#mailDrop").hide(),$("#modal_status").change(function(){var n=$(this).val(),t=$("#modal_status option:selected").text();$.ajax({type:"POST",url:ROOT+"NewIdeation/GetRemarkDiscription",data:{RemarkId:n},dataType:"json",success:function(t){t!=null&&t!=0?($("#mailDrop").show(),$(".valStatus").hide(),$("#modal_emailcontent").val(t[0].RemarkDiscription)):($(".valStatus").show(),$("#loader").hide());(n==5||n==4||n=="")&&$("#mailDrop").hide()},error:function(){alert("Error occured!!")}})}),i.FilePath==null||i.FilePath==""?($("#model_filedownload").hide(),$("#filelabel").hide()):($("#model_filedownload").show(),$("#filelabel").show(),$("#model_filedownload").attr("href",ROOT+"imageUpload/"+i.FilePath)),$("#modal_table tbody").html(r),i.StatusName=="Approved"||i.StatusName=="Declined"||i.StatusName=="SendBack"||i.StatusName=="Existing"?($("#modal_buttons").hide(),$("#remarkfield").hide(),$("#remarkDrop").hide()):($("#modal_buttons").show(),$("#remarkfield").show(),$("#remarkDrop").show()),$("#Innovation_Details").css({opacity:1}),$("#Innovation_Details").show(),$("body").addClass("modal-open"))}},error:function(){alert("Error occured!!")}})});$("#modalclose").click(function(){$("#Innovation_Details").css({opacity:0});$("#Innovation_Details").hide();$("body").removeClass("modal-open")});$(".valStatus").hide();$("#model_submit").click(function(){var n="",t=0,i;$("#modal_status").val()!=""&&$("#modal_status").val()!=null?($(".valStatus").hide(),$("#modal_remarks").val()==""?$("#modal_status").val()==5?alert("Please enter remarks"):($("#modal_status").val()==1?(t=1,n="Declined"):$("#modal_status").val()==2?(t=5,n="Existing"):$("#modal_status").val()==3?(t=3,n="Approved"):$("#modal_status").val()==5&&(t=4,n="SendBack"),i={InnvoationId:$("#modal_innovationid").val(),ActionBy:"",Action:n,Remarks:$("#modal_remarks").val(),RemarkId:$("#modal_status").val(),StatusId:t,CreatedBy:$("#modal_CreatedBy").val(),InnovationTitle:$("#modal_innovationtile").text()},ideationstatu(i)):($("#modal_status").val()==1?(t=1,n="Declined"):$("#modal_status").val()==2?(t=5,n="Existing"):$("#modal_status").val()==3?(t=3,n="Approved"):$("#modal_status").val()==5&&(t=4,n="SendBack"),i={InnvoationId:$("#modal_innovationid").val(),ActionBy:"",Action:n,Remarks:$("#modal_remarks").val(),RemarkId:$("#modal_status").val(),StatusId:t,CreatedBy:$("#modal_CreatedBy").val(),InnovationTitle:$("#modal_innovationtile").text()},ideationstatu(i))):$(".valStatus").show()});$("body").on("click",".remark",function(){var n=$(this).data("val");$.ajax({type:"POST",url:ROOT+"NewIdeation/GetIdeationRemarks",data:{InnovationId:n},dataType:"json",success:function(n){n!=null&&($("#remark_body").empty(),$.each(n,function(n,t){var i=' <tr>  <td class="rd">'+t.BusinessDivisionName+"<\/td><td>"+t.CreatedBy+"<\/td><td>"+t.CreatedDate+"<\/td><td>"+t.StatusName+"<\/td><td>"+t.ActionBy+"<\/td><td>"+t.RemarkName+"<\/td><tr>";$("#remark_body").append(i)}))},error:function(){alert("Error occured!!")}})});$("#closemodal").on("click",function(){$("#modal_remarks").val("");$("#modal_status").val("");$(".valStatus").hide()});