function split(n){return n.split(/,\s*/)}function extractLast(n){return split(n).pop()}function getDate(n){var t;try{t=$.datepicker.parseDate(dateFormat,n.value)}catch(i){t=null}return t}function isWeekend(n){var t=n.getDay();return[0,6].indexOf(t)===-1}function ajaxtocallgetdata(){$.ajax({url:ROOT+"Master/CheckForApproval",type:"POST",dataType:"JSON","async":!1,data:{projectId:parseInt($("#ProjectId").val()),HubId:parseInt($("#Hub option:selected").val())},success:function(n){if(n.length>0){isSavable=0;getData();var t="<b><ul>";$.each(n,function(n,i){t+="<li>"+i.TaskDesc+"<\/li>"});t+="<\/ul><\/b>";($("#RevisedRequestData").val()==null||$("#RevisedRequestData").val()==undefined||$("#RevisedRequestData").val()=="")&&alert("There is a end date request for the following Task(s).You cannot update the dates in the New PMU Mapping page until you approve the tasks.<\/br>"+t)}else isSavable=1,getData()}})}function submitAutoData(n,t){var i=new FormData,r=[];$("#pmumapping").dataTable().$("tr").each(function(n,t){var l=$(t).find("[data-wbsheader]").attr("data-wbsheader"),p=$(t).attr("data-headerid"),a=$(t).find("[data-task]").attr("data-task"),h=$(t).find("[data-dependency]").val(),e=$(t).find("[data-duration]").val(),o=$(t).find("[data-startdate]").val(),s=$(t).find("[data-enddate]").val(),k=$(t).find("[data-percentage]").val()!==null&&$(t).find("[data-percentage]").val()!==""&&typeof $(t).find("[data-percentage]").val()!="undefined"?parseFloat($(t).find("[data-percentage]").val()):0,c=$(t).find("[data-resources]").val(),d=$(t).find("[data-remarks]").val(),f=$("#ProjectId").val(),u=$(t).find("[data-slno]").attr("data-slno"),g=$(t).find("[data-files]")[0].files,v=$(t).attr("data-relationid"),nt=$(t).attr("data-milestonestatus"),y=[],w=[],b;if(c!==null&&c!==""&&typeof c!="undefined"&&$.each(c.split(","),function(n,t){var i=t.split("-"),r,e;i.length>1&&(r=autocompleteDrodownArray.Resources.findIndex(function(n){return n.UserName===i[1].replace(" ","")}),r>=0&&(e={ProjectId:parseInt(f),RowNum:parseInt(u),ResourceName:i[1].replace(" ","")},w.push(e)))}),p!==null&&p!==""&&typeof p!="undefined"&&l!==null&&l!==""&&typeof l!="undefined"&&e!==null&&e!==""&&typeof e!="undefined"&&o!==null&&o!==""&&typeof o!="undefined"&&s!==null&&s!==""&&typeof s!="undefined"){$.each(g,function(n,t){var r,o,e;t.size>0&&(r=moment().valueOf(),i.append(f+"_"+u+"_"+(n+1)+"_"+r,t),o=t.name.split(".").pop(),e={ProjectId:parseInt(f),RowNum:parseInt(u),DocumentName:$.trim(f+"_"+u+"_"+(n+1)+"_"+r+t.name).replace(" "," ")},y.push(e))});var tt=deletedDocumentsArray.filter(function(n){return n.SlNo===parseInt(u)}),it=DeletedRemarksArray.filter(function(n){return n.SlNo===parseInt(u)}),rt={WBSHeader:parseInt(l),Task:0,RelationId:0,Dependency:h,Duration:parseInt(e),StartDate:moment(o,"DD/MM/YYYY").format("YYYY-MM-DD"),EndDate:moment(s,"DD/MM/YYYY").format("YYYY-MM-DD"),Percentage:parseFloat(k),Resources:c,Remarks:d,ProjectId:parseInt(f),RowNum:parseInt(u),DocumentArray:y,DependencyArray:[],DeletedDocumentsArray:tt,DeletedRemarksArray:it,ResourcesArray:w,MileStoneStatus:nt,VersionRemarks:$("#VersionRemarks").val()};r.push(rt)}if(v!==null&&v!==""&&typeof v!="undefined"&&a!==null&&a!==""&&typeof a!="undefined"&&e!==null&&e!==""&&typeof e!="undefined"&&o!==null&&o!==""&&typeof o!="undefined"&&s!==null&&s!==""&&typeof s!="undefined"){b=[];$.each(g,function(n,t){var r,o,e;t.size>0&&(r=moment().valueOf(),i.append(f+"_"+u+"_"+(n+1)+"_"+r,t),o=t.name.split(".").pop(),e={ProjectId:parseInt(f),RowNum:parseInt(u),DocumentName:$.trim(f+"_"+u+"_"+(n+1)+"_"+r+t.name).replace(" "," ")},y.push(e))});h!==null&&h!==""&&typeof h!="undefined"&&$.each(h.split(","),function(n,t){var i=t.indexOf("F")>-1?t.indexOf("F"):t.indexOf("S"),r=t.substr(0,i),e=t.substr(i,2),o=t.indexOf("+")>-1?t.indexOf("+"):t.indexOf("-"),s=t.substr(o,t.length);b.push({RowNum:parseInt(u),ProjectId:parseInt(f),Depedency:parseInt(r),DependencyType:e,LeadOrLag:parseInt(s)})});var tt=deletedDocumentsArray.filter(function(n){return n.SlNo===parseInt(u)}),it=DeletedRemarksArray.filter(function(n){return n.SlNo===parseInt(u)}),rt={WBSHeader:0,Task:parseInt(a),RelationId:parseInt(v),Dependency:h,Duration:parseInt(e),StartDate:moment(o,"DD/MM/YYYY").format("YYYY-MM-DD"),EndDate:moment(s,"DD/MM/YYYY").format("YYYY-MM-DD"),Percentage:parseFloat(k),Resources:c,Remarks:d,ProjectId:parseInt(f),RowNum:parseInt(u),DocumentArray:y,DependencyArray:b,DeletedDocumentsArray:tt,DeletedRemarksArray:it,ResourcesArray:w,MileStoneStatus:nt,VersionRemarks:$("#VersionRemarks").val()};r.push(rt)}});i.append("PMUMappings",JSON.stringify(r));i.append("PMUVersion",n);i.append("IsLatest",t);i.append("IsWeekendExcluded",$("#weekend-switching option:selected").val());i.append("HubId",parseInt($("#Hub option:selected").val()));i.append("ProjectId",$("#ProjectId").val());$.ajax({url:ROOT+"Master/AutoSavePMUMappings",type:"POST",data:i,contentType:!1,processData:!1,success:function(n){$("#VersionRemarks").val("");$("#RemarkDetails").val("");$("#DocumentDetails").val("");remarksDetails=JSON.parse(n.Item2);documentDetails=JSON.parse(n.Item1);$("#pmumapping").dataTable().$("tr").each(function(n,t){$(t).find("[data-remarks]").val()===""||$("#newRemarks_"+(n+1)).css("display","block");$(t).find("[data-files]").val()===""||$("#newDocuments_"+(n+1)).css("display","block");documentDetails===null||documentDetails===""||(documentDetails.filter(function(t){return t.SlNo===n+1}).length=0)&&$("#newDocuments_"+(n+1)).css("display","none");$(t).find("[data-remarks]").val("");$(t).find("[data-files]").val("");deletedDocumentsArray=[];DeletedRemarksArray=[]})},error:function(n,t,i){alert(i)}})}function loadAutoCompleteDropdowns(n){$(".from").datepicker("destroy");$(".to").datepicker("destroy");$("#isWeekEndExclude").val()=="True"?(from=$(".from").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"dd/mm/yy",beforeShowDay:function(n){return[isWeekend(n),""]}}).on("change",function(){to.datepicker("option","minDate",getDate(this))}),to=$(".to").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"dd/mm/yy",beforeShowDay:function(n){return[isWeekend(n),""]}}).on("change",function(){from.datepicker("option","maxDate",getDate(this))})):(from=$(".from").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"dd/mm/yy"}).on("change",function(){to.datepicker("option","minDate",getDate(this))}),to=$(".to").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"dd/mm/yy"}).on("change",function(){from.datepicker("option","maxDate",getDate(this))}));$("[data-wbsheader]").autocomplete({minLength:0,source:function(t,i){selectedWBSHeadrId=0;var r=new RegExp($.ui.autocomplete.escapeRegex(t.term),"i"),u=[],f=0,e=$.grep(n.WBSHeader,function(n){var t=n.WBSHeaderDesc,i=n.WBSHeaderId;return r.test(t)&&f<10&&(u.push({value:t,id:i}),f++),r.test(i)});i(u)},select:function(n,t){selectedWBSHeadrId=0;$(n.target).attr("data-wbsheader",t.item.id);selectedWBSHeadrId=parseInt(t.item.id)},change:function(n,t){var i=$(n.target).closest("tr");if($(i).removeAttr("data-relationid"),$(i).find(".depndency").val(""),$("#pmumapping").dataTable().$("[data-relationid]").each(function(n,t){$(i).find("[data-slno]").html();$(i).find("[data-relationid]").html();var r=$(t).find("[data-dependency]").val()}),changedSLNoForSave+=$(i).find("[data-slno]").html()+",",t.item===null){i=$(n.target).closest("tr");$(i).removeAttr("data-headerid");$(i).find("[data-task]").attr("readonly",!1);$(i).find("[data-dependency]").attr("readonly",!1);$(i).find("[data-duration]").attr("readonly",!1);$(i).find("[data-duration]").siblings("i").removeClass("hide");$(i).find("[data-percentage]").attr("readonly",!1);$(i).find("[data-resources]").attr("readonly",!1);$(i).find("[data-startdate]").addClass("from");$(i).find("[data-enddate]").addClass("to");$(i).find("[data-dependency]").siblings("i").removeClass("hide");var r=$(".from").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"dd/mm/yy"}).on("change",function(){u.datepicker("option","minDate",getDate(this))}),u=$(".to").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"dd/mm/yy"}).on("change",function(){r.datepicker("option","maxDate",getDate(this))})}smartSheetCalculation(0)},close:function(t){var e,f,u,i;if($(t.target).val()!==""&&$(t.target).val()!==null&&typeof $(t.target).val()!="undefined")if(e=n.WBSHeader.filter(n=>n.WBSHeaderDesc==$(t.target).val()).length,selectedWBSHeadrId===0&&e==0)$(t.target).val(""),$(t.target).attr("data-wbsheader",""),alert("Please select the WBS Header from the list");else{$(t.target).siblings("span").addClass("hide");var s=$(t.target).closest("tr").attr("id"),o=$(t.target).parent().siblings("td[data-slno]").attr("data-slno"),r=0;selectedWBSHeadrId==0&&(selectedWBSHeadrId=autocompleteDrodownArray.WBSHeader.find(n=>n.WBSHeaderDesc==$(t.target).val()).WBSHeaderId);$("#pmumapping").dataTable().$("[data-wbsheader]").each(function(n,t){var i=$(t).closest("tr").attr("id"),u=$(t).attr("data-wbsheader")=="0"?-1:$(t).attr("data-wbsheader");s!=i&&parseInt(u)===selectedWBSHeadrId&&r++});r>0?($(t.target).val(""),$(t.target).attr("data-wbsheader",""),alert("WBS Header cannot be duplicated")):(i=$(t.target).closest("tr"),$(i).attr("data-headerid",o),$(i).find("td [data-task]").attr("readonly",!0),$(i).find("td [data-dependency]").attr("readonly",!0),$(i).find("td [data-duration]").attr("readonly",!0),$(i).find("td [data-percentage]").attr("readonly",!0),$(i).find("[data-resources]").attr("readonly",!0),$(i).find("td [data-startdate]").removeClass("from"),$(i).find("td [data-startdate]").datepicker("destroy"),$(i).find("td [data-enddate]").removeClass("to"),$(i).find("td [data-enddate]").datepicker("destroy"),$(i).find("td [data-startdate]").removeClass("hasDatepicker"),$(i).find("td [data-enddate]").removeClass("hasDatepicker"),$(i).find("[data-dependency]").siblings("i").addClass("hide"),f=[],u=o,$("#pmumapping").dataTable().$("[data-relationid]").each(function(n,t){var i=$(t).find("[data-dependency]").val(),e=[];i!==null&&i!==""&&typeof i!="undefined"&&($.each(i.split(","),function(n,i){var s=i.indexOf("F")>-1?i.indexOf("F"):i.indexOf("S"),o=i.substr(0,s),h,c,l;parseInt(o)!==parseInt(u)?(h=i.substr(s,i.length),parseInt(o)>u+r-1?(c=parseInt(o)-r+h,e.push(c)):parseInt(o)!==parseInt(u)&&e.push(i)):(l=f.findIndex(function(n){return parseInt(n)===parseInt($(t).find("[data-slno]").attr("data-slno"))}),l==-1&&f.push(parseInt($(t).find("[data-slno]").attr("data-slno"))))}),$(t).find("[data-dependency]").val(e.join(",")))}))}else i=$(t.target).closest("tr"),$(i).removeAttr("data-headerid"),$(i).find("[data-task]").attr("readonly",!1),$(i).find("[data-dependency]").attr("readonly",!1),$(i).find("[data-duration]").attr("readonly",!1),$(i).find("[data-duration]").siblings("i").removeClass("hide"),$(i).find("[data-percentage]").attr("readonly",!1),$(i).find("[data-resources]").attr("readonly",!1),$(i).find("[data-startdate]").addClass("from"),$(i).find("[data-enddate]").addClass("to"),$(i).find("[data-dependency]").siblings("i").removeClass("hide");smartSheetCalculation(0)}});$("[data-task]").autocomplete({minLength:0,source:function(t,i){selectedTaskId=0;var r=new RegExp($.ui.autocomplete.escapeRegex(t.term),"i"),u=[],f=0,e=$.grep(n.Task,function(n){var t=n.TaskDesc,i=n.TaskId;return r.test(t)&&f<10&&(u.push({value:t,id:i}),f++),r.test(i)});i(u)},select:function(n,t){selectedTaskId=0;$(n.target).attr("data-task",t.item.id);selectedTaskId=parseInt(t.item.id)},change:function(n,t){if(t.item===null){var i=$(n.target).closest("tr");$(i).find("[data-wbsheader]").attr("readonly",!1);$(i).find("[data-task]").attr("data-task","")}},close:function(t){var f,e,o,r,u;if($(t.target).val()!==""&&$(t.target).val()!==null&&typeof $(t.target).val()!="undefined")if(f=n.Task.filter(n=>n.TaskDesc==$(t.target).val()).length,selectedTaskId===0&&f==0)$(t.target).val(""),$(t.target).attr("data-task",""),alert("Please select the Task from the list");else if($(t.target).siblings("span").addClass("hide"),e=$(t.target).closest("tr").attr("id"),$("#pmumapping").dataTable().$("[data-headerid]").length===0)$(t.target).val(""),$(t.target).attr("data-task",""),alert("There is no parent mapped to the child");else{var s=$(this).closest("tr").find("td[data-slno]").attr("data-slno"),i=0;$("#pmumapping").dataTable().$("[data-headerid]").length>0&&($("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var i=parseInt($(t).attr("data-headerid"));if(i<s)o=t;else return!1}),i=$(o).attr("data-headerid"),$(this).closest("tr").attr("data-relationid",i));r=0;selectedTaskId==0&&(selectedTaskId=autocompleteDrodownArray.Task.find(n=>n.TaskDesc==$(t.target).val()).TaskId);$("#pmumapping").dataTable().$('[data-relationid="'+i+'"]').each(function(n,t){var i=$(t).attr("id"),u=$(t).find("td [data-task]").attr("data-task");e!=i&&parseInt(u)===selectedTaskId&&r++});r>0?($(t.target).val(""),$(t.target).attr("data-task",""),$(t.target).closest("tr").find("[data-wbsheader]").attr("readonly",!1),alert("Task cannot be duplicated")):(ChangedSLNo+=$(t.target).closest("tr").find("[data-slno]").attr("data-slno")+",",$(t.target).closest("tr").find("[data-wbsheader]").attr("readonly",!0))}else u=$(t.target).closest("tr"),$(u).find("[data-wbsheader]").attr("readonly",!1),$(u).find("[data-task]").attr("data-task","");smartSheetCalculation(0)}});$("[data-resources]").on("keydown",function(n){n.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active&&n.preventDefault()}).autocomplete({minLength:0,source:function(t,i){selectedResourcesId=0;var r=new RegExp($.ui.autocomplete.escapeRegex(extractLast(t.term)),"i"),u=[],f=0,e=$.grep(n.Resources,function(n){var t=n.EmployeeName+" - "+n.UserName,i=n.EmployeeName+" - "+n.UserName;return r.test(t)&&f<10&&(u.push({value:t,id:i}),f++),r.test(i)});i(u)},focus:function(){return!1},select:function(n,t){var i=split(this.value),r;return i.pop(),r=t.item.value,i.length>0&&i.filter(n=>n===r).length>0?(alert("Resource already selected"),selectedResourcesId=2,i.push(""),this.value=i.join(", ")):(selectedResourcesId=1,i.push(r),i.push(""),this.value=i.join(", ")),!1},close:function(n){var i,t,r;($(n.target).val()!==null||$(n.target).val()!==""||typeof $(n.target).val()!="undefined")&&(selectedResourcesId===0?(i=$(n.target).val(),t=i.split(","),t.pop(),r=t.join(","),$(n.target).val(r),$(n.target).attr("data-resources",""),alert("Please select the Resources from the list")):selectedResourcesId===1&&$(n.target).siblings("span").addClass("hide"))}})}function deleteRow(n){var t=$(n).closest("tr"),i=parseInt($(t).find("[data-slno]").attr("data-slno")),r=$(t).attr("data-headerid")!==null&&$(t).attr("data-headerid")!==""&&typeof $(t).attr("data-headerid")!="undefined"?!0:!1,f=$(t).attr("data-headerid"),e=r?"Are you sure, Do you want to delete this header and dependent tasks?":"Are you sure, Do you want to delete this task and it's dependencies will be cleared?",u=1;confirm(e,function(){var e,o,n;changedSLNoForSave+=i+",";$.fn.DataTable.isDataTable("#pmumapping")&&$("#pmumapping").dataTable().fnDestroy();$(t).remove();e=0;r?$('tr[data-relationid="'+f+'"]').each(function(n,t){$(t).remove();u++}):e=$(t).attr("data-relationid")!==null&&$(t).attr("data-relationid")!==""&&typeof $(t).attr("data-relationid")!="undefined"?parseInt($(t).attr("data-relationid")):0;o=$("#pmumapping tbody tr").length;initializeDataTable(o);$("#pmumapping").dataTable().$("td[data-slno]").each(function(n,t){var i=$(t).closest("tr");$(i).attr("id","row_"+(n+1));$(i).find("td[data-slno]").attr("data-slno",n+1);$(i).find("[data-files]").attr("name","files_"+(n+1));$(i).find("td[data-slno]").text(n+1)});$("#pmumapping").dataTable().$("tr[data-headerid]").each(function(n,t){var r=$(t).attr("data-headerid"),i=$(t).find("td[data-slno]").attr("data-slno");parseInt(r)!==parseInt(i)&&($(t).attr("data-headerid",i),$("#pmumapping").dataTable().$('tr[data-relationid="'+r+'"]').each(function(n,t){$(t).attr("data-relationid",i)}))});n=[];$("#pmumapping").dataTable().$("[data-relationid]").each(function(t,r){var f=$(r).find("[data-dependency]").val(),e=[];f!==null&&f!==""&&typeof f!="undefined"&&($.each(f.split(","),function(t,f){var s=f.indexOf("F")>-1?f.indexOf("F"):f.indexOf("S"),o=f.substr(0,s),h,c,l;parseInt(o)!==parseInt(i)?(h=f.substr(s,f.length),parseInt(o)>i+u-1?(c=parseInt(o)-u+h,e.push(c)):parseInt(o)!==parseInt(i)&&e.push(f)):(l=n.findIndex(function(n){return parseInt(n)===parseInt($(r).find("[data-slno]").attr("data-slno"))}),l==-1&&n.push(parseInt($(r).find("[data-slno]").attr("data-slno"))))}),$(r).find("[data-dependency]").val(e.join(",")))});r||smartSheetCalculation(e,1,n,"deleterow")})}function addRow(n){var u=$(n).closest("td").siblings("td[data-slno]"),t=parseInt($(u).attr("data-slno")),i,r;$.fn.DataTable.isDataTable("#pmumapping")&&$("#pmumapping").dataTable().fnDestroy();i='<tr id="row_'+(t+1)+'"><td data-slno="'+(t+1)+'">'+(t+1)+'<\/td><td><div class="action_width"><button type="button" class="mr-2" onclick="addRow(this)"><i class="fas fa-plus"><\/i><\/button><button class="trash_icon" type="button" onclick="deleteRow(this)"><i class="fas fa-trash"><\/i><\/button><\/div><\/td><td class="input_width"><input type="text" class="form-control"  data-wbsheader="" placeholder="" /><span class="text-danger hide">Please select WBS Header<\/span> <\/td><td><input type="text" class="form-control" data-task="" placeholder="" /><span class="text-danger hide">Please enter the Task<\/span> <\/td><td><span class="d-flex align-items-center"><input data-dependency="" type="text" class="form-control depndency -uppercase" /><i class="fas fa-pencil ml-2" title="Edit Predecessors" onclick="showDependency(this)"><\/i><\/span> <\/td><td><div class="duration"><input type="text" class="form-control text-right" data-duration="" /> <span class="text-danger hide">Please enter the Duration<\/span><\/div><\/td><td><input type="text" class="form-control from" readonly data-startdate="" /> <span class="text-danger hide">Please select the Start Date<\/span> <\/td><td><input type="text" class="form-control to" readonly data-enddate="" /> <\/td><td><div class="percentage_list"><input type="text" class="form-control text-right" data-percentage="" /><span class="w3-light-grey"><span class="w3-grey" style="height:24px;width:0%"><\/span><\/span><\/div><\/td><td><input type="text" class="form-control" data-resources="" placeholder="Please select the Resource" /><span class="text-danger hide">Please select the Resources<\/span> <\/td><td class="file_upload"><input type="file" class="form-control" name="files_'+(t+1)+'" data-files="" multiple /> <\/td><td class="input_width"><textarea class="form-control" data-remarks=""><\/textarea> <\/td><\/tr>';$("#row_"+t).after(i);r=$("#pmumapping tbody tr").length;initializeDataTable(r);$($("#row_"+(t+1)).find("[data-wbsheader]")).focus();$("#pmumapping").dataTable().$("td[data-slno]").each(function(n,t){var i=$(t).parent();$(i).attr("id","row_"+(n+1));$(i).find("td[data-slno]").attr("data-slno",n+1);$(i).find("[data-files]").attr("name","files_"+(n+1));$(i).find("td[data-slno]").text(n+1)});$("#pmumapping").dataTable().$("tr[data-headerid]").each(function(n,t){var r=$(t).attr("data-headerid"),i=$(t).find("td[data-slno]").attr("data-slno");parseInt(r)!==parseInt(i)&&($(t).attr("data-headerid",i),$("#pmumapping").dataTable().$('tr[data-relationid="'+r+'"]').each(function(n,t){$(t).attr("data-relationid",i)}))});$("#pmumapping").dataTable().$("[data-relationid]").each(function(n,i){var r=$(i).find("[data-dependency]").val(),u=[];r!==null&&r!==""&&typeof r!="undefined"&&($.each(r.split(","),function(n,i){var r=i.indexOf("F")>-1?i.indexOf("F"):i.indexOf("S"),f=i.substr(0,r),o=i.substr(r,i.length),e;parseInt(f)>parseInt(t)?(e=parseInt(f)+1+o,u.push(e)):u.push(i)}),$(i).find("[data-dependency]").val(u.join(",")))});loadAutoCompleteDropdowns(autocompleteDrodownArray);smartSheetCalculation(0)}function initializeDataTable(n=50){var t=$("#pmumapping").DataTable({orderCellsTop:!0,fixedHeader:!0,pageLength:n,scrollCollapse:!0,paging:!0,initComplete:function(){var n=this.api();n.columns().eq(0).each(function(t){var i=$(".filters th").eq($(n.column(t).header()).index()),r=$(n.column(t).header()).text();t==0?$(i).html('<input type="text" placeholder="'+r+'" />'):$(i).html("");$("input",$(".filters th").eq($(n.column(t).header()).index())).off("keyup change").on("change",function(){$(this).attr("title",$(this).val());var i=this.selectionStart;n.column(t).search(this.value!=""?"({search})".replace("{search}","((("+this.value+")))"):"",this.value!="",this.value=="").draw()}).on("keyup",function(n){n.stopPropagation();$(this).trigger("change");$(this).focus()[0].setSelectionRange(cursorPosition,cursorPosition)})})}});$("#pmumapping_paginate").hide()}function smartSheetCalculation(n,t=0,i=[],r=""){var s=[],h=[],c=[],l=[],y=[],p=[],w=[],b=[],u,f,k,d,g,e,o,nt,a,v,tt;requestedData=[];$("#RevisedRequestData").val()!=null&&$("#RevisedRequestData").val()!=undefined&&$("#RevisedRequestData").val()!=""&&(w=JSON.parse($("#RevisedRequestData").val()),b=w.Item1,requestedData=w.Item2);$("#pmumapping").dataTable().$("[data-relationid]").each(function(n,i){var l=$(i).closest("tr").find("[data-slno]").attr("data-slno"),w=0,k,a,d,v,s,h,c,y,r;if($("#pmumapping").dataTable().$("[data-headerid]").length>0&&($("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var i=parseInt($(t).attr("data-headerid"));i<l&&(k=t)}),w=$(k).attr("data-headerid"),$(i).closest("tr").attr("data-relationid",w)),a=$(i).find("[data-dependency]").val(),a!==null&&a!==""&&typeof a!="undefined"){if(d=a.split(","),v=[],$.each(d,function(n,t){var s=t.indexOf("F")>-1?t.indexOf("F"):t.indexOf("S"),h=t.substr(0,s),f=t.indexOf("+")>-1?t.indexOf("+"):t.indexOf("-"),c=Number(t.substr(f,t.length))<0?Number(t.substr(f,t.length)):Number(t.substr(f,t.length))===0?0:Number(t.substr(f,t.length)),e=$("#pmumapping").dataTable().$("#row_"+h),r=$(e).find("td [data-enddate]").val(),u,o;r!==null&&r!==""&&typeof r!="undefined"&&(r=$(i).find("[data-duration]").val()!==null&&$(i).find("[data-duration]").val()!==""&&typeof $(i).find("[data-duration]").val()!="undefined"&&parseInt($(i).find("[data-duration]").val())===0?moment(addBusinessDays(moment(r,"DD/MM/YYYY"),0)).format("DD/MM/YYYY"):moment(addBusinessDays(moment(r,"DD/MM/YYYY"),1)).format("DD/MM/YYYY"));u=t.indexOf("F")>-1?r:$(e).find("td [data-startdate]").val();u!==null&&u!==""&&typeof u!="undefined"&&(o=addBusinessDays(moment(u,"DD/MM/YYYY"),c),v.push(o))}),v.length>0){var r=moment.max(v),e=$(i).find("td [data-duration]").val()!==null&&$(i).find("td [data-duration]").val()!==""&&typeof $(i).find("td [data-duration]").val()!="undefined"?Number($(i).find("td [data-duration]").val()):0,p=e===0?0:e-1,o=addBusinessDays(r,p);parseInt(e)===0&&($(i).find("[data-duration]").val()!==null&&$(i).find("[data-duration]").val()!==""&&typeof $(i).find("[data-duration]").val()!="undefined"&&parseInt($(i).find("[data-duration]").val())===0?$(i).find("[data-duration]").val(0):$(i).find("[data-duration]").val(1));requestedData.length>0?(s=b.filter(n=>n.SlNo==l),h=requestedData.filter(n=>n.SlNo==l),s.length>0&&t==0?(u=s[0].UpdatedStartDate.split("/"),f=new Date(u[2],u[1]-1,u[0]),r=moment(f),u=s[0].UpdatedEndDate.split("/"),f=new Date(u[2],u[1]-1,u[0]),e=s[0].RevisedDuration,h.length>0?(c=h[0].ReqEndDate.split("/"),y=new Date(c[2],c[1]-1,c[0]),moment(f).isSameOrAfter(moment(y))?($(i).find("td:not([data-startdate])").addClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().addClass("add-approval-color")):($(i).find("td:not([data-startdate])").removeClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().removeClass("add-approval-color"))):($(i).find("td:not([data-startdate])").removeClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().removeClass("add-approval-color")),o=moment(f),$(i).find("td [data-duration]").val(e)):h.length>0&&t==1&&(u=h[0].ReqEndDate.split("/"),f=new Date(u[2],u[1]-1,u[0]),moment(o).isSameOrAfter(moment(f))?($(i).find("td:not([data-startdate])").addClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().addClass("add-approval-color")):($(i).find("td:not([data-startdate])").removeClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().removeClass("add-approval-color"))),$(i).find("td [data-startdate]").val(r.format("DD/MM/YYYY")),$(i).find("[data-enddate]").val(o.format("DD/MM/YYYY")),$(i).find("[data-enddate]").attr("data-previousvalue",o.format("DD/MM/YYYY"))):($(i).find("td [data-startdate]").val(r.format("DD/MM/YYYY")),$(i).find("[data-enddate]").val(o.format("DD/MM/YYYY")),$(i).find("[data-enddate]").attr("data-previousvalue",o.format("DD/MM/YYYY")))}}else if(requestedData.length>0){if($(i).find("[data-startdate]").val()!==null&&$(i).find("[data-startdate]").val()!==""&&typeof $(i).find("[data-startdate]").val()!="undefined"){var s=b.filter(n=>n.SlNo==l),h=requestedData.filter(n=>n.SlNo==l),r=moment($(i).find("[data-startdate]").val(),"DD/MM/YYYY"),e=$(i).find("td [data-duration]").val()!==null&&$(i).find("td [data-duration]").val()!==""&&typeof $(i).find("td [data-duration]").val()!="undefined"?Number($(i).find("td [data-duration]").val()):0,p=e===0?0:e-1,o=addBusinessDays(r,p);s.length>0&&t==0?(u=s[0].UpdatedStartDate.split("/"),f=new Date(u[2],u[1]-1,u[0]),r=moment(f),u=s[0].UpdatedEndDate.split("/"),f=new Date(u[2],u[1]-1,u[0]),h.length>0?(c=h[0].ReqEndDate.split("/"),y=new Date(c[2],c[1]-1,c[0]),moment(f).isSameOrAfter(moment(y))?($(i).find("td:not([data-startdate])").addClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().addClass("add-approval-color")):($(i).find("td:not([data-startdate])").removeClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().removeClass("add-approval-color"))):($(i).find("td:not([data-startdate])").removeClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().removeClass("add-approval-color")),o=moment(f),e=s[0].RevisedDuration,$(i).find("td [data-duration]").val(e)):h.length>0&&t==1&&(u=h[0].ReqEndDate.split("/"),f=new Date(u[2],u[1]-1,u[0]),moment(o).isSameOrAfter(moment(f))?($(i).find("td:not([data-startdate])").addClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().addClass("add-approval-color")):($(i).find("td:not([data-startdate])").removeClass("add-approval-color"),$(i).find("td:not([data-startdate])").siblings().removeClass("add-approval-color")));$(i).find("td [data-startdate]").val(r.format("DD/MM/YYYY"));$(i).find("[data-enddate]").val(o.format("DD/MM/YYYY"));$(i).find("[data-enddate]").attr("data-previousvalue",o.format("DD/MM/YYYY"))}}else if(r=moment($(i).find("[data-startdate]").val(),"DD/MM/YYYY"),$(i).find("[data-startdate]").val()!==null&&$(i).find("[data-startdate]").val()!==""&&typeof $(i).find("[data-startdate]").val()!="undefined"){$("#isWeekEndExclude").val()=="True"&&(r.day()==6&&(r=r.add(1,"days")),r.day()==0&&(r=r.add(1,"days")),$(i).find("[data-startdate]").val(r.format("DD/MM/YYYY")),$(i).find("[data-startdate]").attr("data-previousvalue",r.format("DD/MM/YYYY")));var e=$(i).find("[data-duration]").val()!==null&&$(i).find("[data-duration]").val()!==""&&typeof $(i).find("[data-duration]").val()!="undefined"?Number($(i).find("[data-duration]").val()):0,p=e===0?0:e-1,o=addBusinessDays(r,p);parseInt(e)===0&&($(i).find("[data-duration]").val()!==null&&$(i).find("[data-duration]").val()!==""&&typeof $(i).find("[data-duration]").val()!="undefined"&&parseInt($(i).find("[data-duration]").val())===0?$(i).find("[data-duration]").val(0):$(i).find("[data-duration]").val(1));$(i).find("[data-enddate]").val(o.format("DD/MM/YYYY"));$(i).find("[data-enddate]").attr("data-previousvalue",o.format("DD/MM/YYYY"))}});$("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var i=$(t).attr("data-headerid"),v,r,a,w,o,u,f,e;c=[];s=[];h=[];$("#pmumapping").dataTable().$('[data-relationid="'+i+'"]').each(function(n,t){var u=$(t).find("[data-startdate]").val(),i,r;u!==null&&u!==""&&typeof u!="undefined"&&s.push(moment(u,"DD/MM/YYYY"));i=$(t).find("[data-enddate]").val();i!==null&&i!==""&&typeof i!="undefined"&&h.push(moment(i,"DD/MM/YYYY"));r=$(t).find("[data-percentage]").val();r!==null&&r!==""&&typeof r!="undefined"&&c.push(Number(r))});v=$("#pmumapping").dataTable().$('[data-relationid="'+i+'"]').length;s.length>0&&h.length>0&&(r=moment.min(s),a=moment.max(h),$("#pmumapping").dataTable().$("#row_"+i).find("[data-startdate]").val(moment(r).format("DD/MM/YYYY")),$("#pmumapping").dataTable().$("#row_"+i).find("[data-startdate]").attr("data-previousvalue",moment(r).format("DD/MM/YYYY")),$("#pmumapping").dataTable().$("#row_"+i).find("[data-startdate]").siblings("span").hide(),$("#pmumapping").dataTable().$("#row_"+i).find("[data-enddate]").val(moment(a).format("DD/MM/YYYY")),$("#pmumapping").dataTable().$("#row_"+i).find("[data-enddate]").attr("data-previousvalue",moment(r).format("DD/MM/YYYY")),$("#pmumapping").dataTable().$("#row_"+i).find("[data-enddate]").siblings("span").hide(),w=getBusinessDays(moment(r),moment(a))+1,$("#pmumapping").dataTable().$("#row_"+i).find("[data-duration]").val(w),$("#pmumapping").dataTable().$("#row_"+i).find("[data-duration]").siblings("span").hide());o=0;c.length>0&&(o=c.reduce(function(n,t){return n+t},0)/v);$("#pmumapping").dataTable().$("#row_"+i).find("[data-percentage]").val(o.toFixed(2));$("#pmumapping").dataTable().$("#row_"+i).find("[data-percentage]").siblings("span").children("span").width(o+"%");u=$(t).find("[data-percentage]").val();u!==null&&u!==""&&typeof u!="undefined"&&l.push(Number(u));f=$(t).find("[data-startdate]").val();f!==null&&f!==""&&typeof f!="undefined"&&y.push(moment(f,"DD/MM/YYYY"));e=$(t).find("[data-enddate]").val();e!==null&&e!==""&&typeof e!="undefined"&&p.push(moment(e,"DD/MM/YYYY"))});k=0;l.length>0&&(k=l.reduce(function(n,t){return n+t},0)/l.length);d=autocompleteDrodownArray.Template.length;d>0?$("#ApprovedLatestVersion").val()!==null&&$("#ApprovedLatestVersion").val()!==""&&typeof $("#ApprovedLatestVersion").val()!="undefined"||($(".template-div").show(),g=autocompleteDrodownArray.Template,e=$("#fromtemplate"),e.empty(),e.append($('<option value="0">Select Template<\/option>')),$.each(g,function(n,t){e.append($("<option>",{value:t.TemplateId,text:t.TemplateName}))}),e.val($("#selectedTemplate").val())):$(".template-div").hide();o=$("#currentSelectedVersion").val();o===""||o===null||typeof o=="undefined"?($(".version-div").hide(),$("#notes_span").show()):($(".version-div").show(),$("#notes_span").hide(),nt=JSON.parse($("#PMUVersionList").val()),a=$("#Version"),a.empty(),$.each(nt,function(n,t){a.append($("<option>",{value:t.PMUVersion,text:t.PMUVersion}))}),a.val(o));v=$("#weekend-switching");v.empty();v.append('<option value="True">Excluded<\/option><option value="False">Included<\/option>');tt=$("#isWeekEndExclude").val();v.val(tt);$("#OverAllProjectPercentage").text(k.toFixed(2));y.length>0&&$("#OverAllStartDate").text(moment(moment.min(y)).format("DD/MM/YYYY"));p.length>0&&$("#OverAllEndDate").text(moment(moment.max(p)).format("DD/MM/YYYY"));$.each(i,function(n,t){r==="deleterow"?$("#pmumapping").dataTable().$("#row_"+t).find("[data-dependency]").closest("td").attr("style","background-color:#f0c756 !important"):(ChangedSLNo+=$("#pmumapping").dataTable().$("#row_"+t).find("[data-slno]").attr("data-slno")+",",$("#pmumapping").dataTable().$("#row_"+t).find("[data-startdate]").closest("td").attr("style","background-color:#bee520 !important"),$("#pmumapping").dataTable().$("#row_"+t).find("[data-enddate]").closest("td").attr("style","background-color:#bee520 !important"))})}function getData(n=false){var f=$("#pmumapping").dataTable().$("[data-headerid]").length,e=$("#pmumapping").dataTable().$("[data-relationid]").length;if(n&&(e>0||f>0))confirm("Are you sure do you want to override the existing data?",function(){DeletedRemarksArray=remarksDetails;deletedDocumentsArray=documentDetails;$.ajax({url:ROOT+"Master/PV_NewPMUMappings",type:"POST","async":!1,cache:!1,dataType:"HTML",data:{ProjectId:parseInt($("#ProjectId").val()),ProjectName:$("#ProjectId option:selected").text(),IsFromTemplate:n,HubId:parseInt($("#Hub option:selected").val()),HubName:$("#Hub option:selected").text(),CurrentSelectedVersion:$("#Version option:selected").text()==null?"":$("#Version option:selected").text(),Template_Id:parseInt($("#fromtemplate").val())},success:function(n){var i,t;$("#pmumappingtablediv").html(n);$("#pmumapping thead tr").clone(!0).addClass("filters").appendTo("#pmumapping thead");i=$("#pmumapping tbody tr").length;initializeDataTable(i);documentDetails=JSON.parse($("#DocumentDetails").val());remarksDetails=JSON.parse($("#RemarksDetails").val());loadAutoCompleteDropdowns(autocompleteDrodownArray);$("#ApprovedLatestVersion").val()!==null&&$("#ApprovedLatestVersion").val()!==""&&typeof $("#ApprovedLatestVersion").val()!="undefined"?(t=$("#isWeekEndExclude").val().toLowerCase(),t=t=="true"?"Excluded":"Included",$("#btnApprove").hide(),$("#btnClone").hide(),$(".template-div").hide(),$(".weekend-switching-div").hide(),$("#ApprovedLatestVersion").val()==$("#currentSelectedVersion").val()&&$("#save-template").show(),$(".version-div").show(),$("#weekend-selected").text(t),$(".weekend-selected-span").show()):($(".version-div").hide(),$("#weekend-selected").text(""),$(".weekend-selected-span").hide(),$("#ApprovedLatestVersion").val()==$("#currentSelectedVersion").val()&&$("#save-template").show(),$("#btnApprove").show(),$("#btnClone").show(),$(".template-div").show(),$(".weekend-switching-div").show());$("#ApprovedLatestVersion").val()==$("#currentSelectedVersion").val()?$("#RevisedRequestData").val()==null||$("#RevisedRequestData").val()==undefined||$("#RevisedRequestData").val()==""?isSavable==1?$("#btnSubmit").show():$("#btnSubmit").hide():$("#btnSubmit").show():$("#btnSubmit").hide();smartSheetCalculation(0)},error:function(n,t,i){alert(i)}})});else{var t="",i="",r="",u="";if($("#selectedProjectId").val()==parseInt($("#ProjectId").val())&&$("#selectedHubId").val()==parseInt($("#Hub option:selected").val()))t=$("#ApprovalSlNo").val(),i=$("#ApprovalVersion").val(),r=$("#ApprovalStartDate").val(),u=$("#ApprovalEndDate").val();else{let n=new URL(window.location.href);n.searchParams.has("q")&&(n.searchParams.delete("q"),window.history.replaceState({},document.title,n.toString()),$("#ApprovalSlNo").val(""),$("#ApprovalVersion").val(""),$("#ApprovalStartDate").val(""),$("#ApprovalEndDate").val(""))}$.ajax({url:ROOT+"Master/PV_NewPMUMappings",type:"POST","async":!1,cache:!1,dataType:"HTML",data:{ProjectId:parseInt($("#ProjectId").val()),ProjectName:$("#ProjectId option:selected").text(),IsFromTemplate:n,HubId:parseInt($("#Hub option:selected").val()),HubName:$("#Hub option:selected").text(),Template_Id:parseInt($("#fromtemplate").val()),ApprovalSlNo:t,ApprovalVersion:i,ApprovalStartDate:r,ApprovalEndDate:u},success:function(n){var i,t;$("#pmumappingtablediv").html(n);$("#pmumapping thead tr").clone(!0).addClass("filters").appendTo("#pmumapping thead");i=$("#pmumapping tbody tr").length;initializeDataTable(i);documentDetails=JSON.parse($("#DocumentDetails").val());remarksDetails=JSON.parse($("#RemarksDetails").val());loadAutoCompleteDropdowns(autocompleteDrodownArray);$("#ApprovedLatestVersion").val()!==null&&$("#ApprovedLatestVersion").val()!==""&&typeof $("#ApprovedLatestVersion").val()!="undefined"?(t=$("#isWeekEndExclude").val().toLowerCase(),t=t=="true"?"Excluded":"Included",$("#btnApprove").hide(),$("#btnClone").hide(),$(".template-div").hide(),$(".weekend-switching-div").hide(),$("#ApprovedLatestVersion").val()==$("#currentSelectedVersion").val()&&$("#save-template").show(),$(".version-div").show(),$("#weekend-selected").text(t),$(".weekend-selected-span").show()):($(".version-div").hide(),$("#weekend-selected").text(""),$(".weekend-selected-span").hide(),$("#ApprovedLatestVersion").val()==$("#currentSelectedVersion").val()&&$("#save-template").show(),$("#btnApprove").show(),$("#btnClone").show(),$(".template-div").show(),$(".weekend-switching-div").show());$("#ApprovedLatestVersion").val()==$("#currentSelectedVersion").val()?$("#RevisedRequestData").val()==null||$("#RevisedRequestData").val()==undefined||$("#RevisedRequestData").val()==""?isSavable==1?$("#btnSubmit").show():$("#btnSubmit").hide():$("#btnSubmit").show():$("#btnSubmit").hide();smartSheetCalculation(0)},error:function(n,t,i){alert(i)}})}}function removeValidationStartEndDate(){$("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var f=$(t).attr("data-headerid"),i=parseInt($(t).find("[data-slno]").attr("data-slno")),u=$("#row_"+i).find("[data-startdate]").val(),r;u===null||u===""||typeof u=="undefined"?$("#row_"+i).find("[data-startdate]").siblings("span").removeClass("hide"):$("#row_"+i).find("[data-startdate]").siblings("span").addClass("hide");r=$("#row_"+i).find("[data-enddate]").val();r===null||r===""||typeof r=="undefined"?$("#row_"+i).find("[data-enddate]").siblings("span").removeClass("hide"):$("#row_"+i).find("[data-enddate]").siblings("span").addClass("hide");$("#pmumapping").dataTable().$('[data-relationid="'+f+'"]').each(function(n,t){var i=parseInt($(t).find("[data-slno]").attr("data-slno")),f=$("#row_"+i).find("[data-task]").attr("data-task"),r,u;f===null||f===""||typeof f=="undefined"?$("#row_"+i).find("[data-task]").siblings("span").removeClass("hide"):($("#row_"+i).find("[data-task]").siblings("span").addClass("hide"),r=$("#row_"+i).find("[data-startdate]").val(),r===null||r===""||typeof r=="undefined"?$("#row_"+i).find("[data-startdate]").siblings("span").removeClass("hide"):$("#row_"+i).find("[data-startdate]").siblings("span").addClass("hide"),u=$("#row_"+i).find("[data-enddate]").val(),u===null||u===""||typeof u=="undefined"?$("#row_"+i).find("[data-enddate]").siblings("span").removeClass("hide"):$("#row_"+i).find("[data-enddate]").siblings("span").addClass("hide"))})})}function submitData(n,t){var i=new FormData,e=[],u,s,f,o,r;$("#pmumapping").dataTable().$("tr").each(function(n,t){var l=$(t).find("[data-wbsheader]").attr("data-wbsheader"),p=$(t).attr("data-headerid"),a=$(t).find("[data-task]").attr("data-task"),h=$(t).find("[data-dependency]").val(),f=$(t).find("[data-duration]").val(),o=$(t).find("[data-startdate]").val(),s=$(t).find("[data-enddate]").val(),k=$(t).find("[data-percentage]").val()!==null&&$(t).find("[data-percentage]").val()!==""&&typeof $(t).find("[data-percentage]").val()!="undefined"?parseFloat($(t).find("[data-percentage]").val()):0,c=$(t).find("[data-resources]").val(),d=$(t).find("[data-remarks]").val(),u=$("#ProjectId").val(),r=$(t).find("[data-slno]").attr("data-slno"),g=$(t).find("[data-files]")[0].files,v=$(t).attr("data-relationid"),nt=$(t).attr("data-milestonestatus"),y=[],w=[],b;if(c!==null&&c!==""&&typeof c!="undefined"&&$.each(c.split(","),function(n,t){var i=t.split("-"),f,e;i.length>1&&(f=autocompleteDrodownArray.Resources.findIndex(function(n){return n.UserName===i[1].replace(" ","")}),f>=0&&(e={ProjectId:parseInt(u),RowNum:parseInt(r),ResourceName:i[1].replace(" ","")},w.push(e)))}),p!==null&&p!==""&&typeof p!="undefined"&&l!==null&&l!==""&&typeof l!="undefined"&&f!==null&&f!==""&&typeof f!="undefined"&&o!==null&&o!==""&&typeof o!="undefined"&&s!==null&&s!==""&&typeof s!="undefined"){$.each(g,function(n,t){var f,o,e;t.size>0&&(f=moment().valueOf(),i.append(u+"_"+r+"_"+(n+1)+"_"+f,t),o=t.name.split(".").pop(),e={ProjectId:parseInt(u),RowNum:parseInt(r),DocumentName:$.trim(u+"_"+r+"_"+(n+1)+"_"+f+t.name).replace(" "," ")},y.push(e))});var tt=deletedDocumentsArray.filter(function(n){return n.SlNo===parseInt(r)}),it=DeletedRemarksArray.filter(function(n){return n.SlNo===parseInt(r)}),rt={WBSHeader:parseInt(l),Task:0,RelationId:0,Dependency:h,Duration:parseInt(f),StartDate:moment(o,"DD/MM/YYYY").format("YYYY-MM-DD"),EndDate:moment(s,"DD/MM/YYYY").format("YYYY-MM-DD"),Percentage:parseFloat(k),Resources:c,Remarks:d,ProjectId:parseInt(u),RowNum:parseInt(r),DocumentArray:y,DependencyArray:[],DeletedDocumentsArray:tt,DeletedRemarksArray:it,ResourcesArray:w,MileStoneStatus:nt,VersionRemarks:$("#VersionRemarks").val()};e.push(rt)}if(v!==null&&v!==""&&typeof v!="undefined"&&a!==null&&a!==""&&typeof a!="undefined"&&f!==null&&f!==""&&typeof f!="undefined"&&o!==null&&o!==""&&typeof o!="undefined"&&s!==null&&s!==""&&typeof s!="undefined"){b=[];$.each(g,function(n,t){var f,o,e;t.size>0&&(f=moment().valueOf(),i.append(u+"_"+r+"_"+(n+1)+"_"+f,t),o=t.name.split(".").pop(),e={ProjectId:parseInt(u),RowNum:parseInt(r),DocumentName:$.trim(u+"_"+r+"_"+(n+1)+"_"+f+t.name).replace(" "," ")},y.push(e))});h!==null&&h!==""&&typeof h!="undefined"&&$.each(h.split(","),function(n,t){var i=t.indexOf("F")>-1?t.indexOf("F"):t.indexOf("S"),f=t.substr(0,i),e=t.substr(i,2),o=t.indexOf("+")>-1?t.indexOf("+"):t.indexOf("-"),s=t.substr(o,t.length);b.push({RowNum:parseInt(r),ProjectId:parseInt(u),Depedency:parseInt(f),DependencyType:e,LeadOrLag:parseInt(s)})});var tt=deletedDocumentsArray.filter(function(n){return n.SlNo===parseInt(r)}),it=DeletedRemarksArray.filter(function(n){return n.SlNo===parseInt(r)}),rt={WBSHeader:0,Task:parseInt(a),RelationId:parseInt(v),Dependency:h,Duration:parseInt(f),StartDate:moment(o,"DD/MM/YYYY").format("YYYY-MM-DD"),EndDate:moment(s,"DD/MM/YYYY").format("YYYY-MM-DD"),Percentage:parseFloat(k),Resources:c,Remarks:d,ProjectId:parseInt(u),RowNum:parseInt(r),DocumentArray:y,DependencyArray:b,DeletedDocumentsArray:tt,DeletedRemarksArray:it,ResourcesArray:w,MileStoneStatus:nt,VersionRemarks:$("#VersionRemarks").val()};e.push(rt)}});u=Array.from(new Set(ChangedSLNo.split(",")));u=u.filter(Boolean);s=u.join(",");i.append("PMUMappings",JSON.stringify(e));i.append("PMUVersion",n);i.append("IsLatest",t);i.append("IsWeekendExcluded",$("#weekend-switching option:selected").val());i.append("HubId",parseInt($("#Hub option:selected").val()));i.append("ProjectId",$("#ProjectId").val());f=[];o=[];requestedData=[];r=0;$("#RevisedRequestData").val()!=null&&$("#RevisedRequestData").val()!=undefined&&$("#RevisedRequestData").val()!=""&&(f=JSON.parse($("#RevisedRequestData").val()),o=f.Item1,requestedData=f.Item2,r=requestedData.filter(n=>n.SlNo===o[0].SlNo).map(n=>n.ExtendId),r=r[0]);i.append("ExtendedId",r);i.append("ChangedSlInfo",s);$.ajax({url:ROOT+"Master/SavePMUMappings",type:"POST",data:i,contentType:!1,processData:!1,success:function(n){if(n.includes("success")){let n=new URL(window.location.href);n.searchParams.has("q")&&(n.searchParams.delete("q"),window.history.replaceState({},document.title,n.toString()));window.location.reload()}else alert(n);$("#NewVersion").val("");$("#VersionRemarks").val("")},error:function(n,t,i){alert(i)}})}function addBusinessDays(n,t){const u=0,f=6;let r=t;const i=n.clone();var e=JSON.parse($("#isWeekEndExclude").val().toLowerCase());if(e){while(r>0)i.add(1,"days"),i.day()!==u&&i.day()!==f&&r--;while(r<0)i.add(-1,"days"),i.day()!==u&&i.day()!==f&&r++}else{while(r>0)i.add(1,"days"),r--;while(r<0)i.add(-1,"days"),r++}return i}function getBusinessDays(n,t){var i=n.clone(),r=0,u=JSON.parse($("#isWeekEndExclude").val().toLowerCase());if(u)while(i.isBefore(t))i.day()!==0&&i.day()!==6&&r++,i.add(1,"days");else while(i.isBefore(t))r++,i.add(1,"days");return r}function confirmWithVersion(n,t,i){if($("#NewVersion").val(""),$("#VersionRemarks").val(""),$("#Version").val()=="Baseline"?($("#versionpopupmesssage").empty().html('A new version "<b> Version 1 <\/b>" will be created on clicking <b>save<\/b>'),$("#versionpopupOK").empty().text("Save")):$("#versionpopupmesssage").empty().html(n),$("#versionpopup").modal("show"),t){$("#versionpopupOK").unbind("click");$("#versionpopupOK").on("click",t)}if(i){$("#Version").val()=="Baseline"?$("#versionpopupCancel").hide():$("#versionpopupCancel").unbind("click");$("#versionpopupCancel").on("click",i)}}function confirmWithDependentAlert(n,t,i){if($("#dependentAlertTable").empty().html(n),$("#dependentMilestonesAlert").modal("show"),t){$("#dependentMilestonesAlertYes").unbind("click");$("#dependentMilestonesAlertYes").on("click",t)}if(i){$("#dependentMilestonesAlertNo").unbind("click");$("#dependentMilestonesAlertNo").on("click",i)}}function showDependency(n){var i=$(n).closest("tr"),t=$(n).siblings("input").val(),u=$(i).find("[data-slno]").attr("data-slno"),f=$(i).find("[data-task]").val(),r;$("#SelectedRow").text(u);$("#SelectedTask").text(f);$("#dependency").modal("show");$("#dependencyTable tbody").html("");t!==null&&t!==""&&typeof t!="undefined"&&$.each(t.split(","),function(n,t){var i=t.indexOf("F")>-1?t.indexOf("F"):t.indexOf("S"),r=t.substr(0,i),u=t.substr(i,2),f=t.indexOf("+")>-1?t.indexOf("+"):t.indexOf("-"),e=t.substr(f,t.length),o=$("#row_"+r).find("[data-task]").val(),s='<tr><td><input type="text" class="form-control text-center" value="'+r+'" data-predecessor="" /><\/td><td data-predecessortask="">'+o+'<\/td><td><select class="form-control" data-predecessortype=""><option value="">Select<\/option>'+(u==="FS"?'<option value="FS" selected>Finish to Start (FS)<\/option>':'<option value="FS">Finish to Start (FS)<\/option>')+(u==="SS"?'<option value="SS" selected>Start to Start (SS)<\/option>':'<option value="SS">Start to Start (SS)<\/option>')+'<\/select><\/td><td><input type="text" class="form-control text-center" data-predecessorleadorlag="" value="'+e+'" /><\/td><td class="text-center"><div class="action_width"><button class="trash_icon ml-2" type="button" onclick="deletePredecessorRow(this)"><i class="fas fa-trash"><\/i><\/button><\/div><\/td><\/tr>';$("#dependencyTable tbody").append(s)});r='<tr><td><input type="text" class="form-control text-right" value="" data-predecessor="" /><\/td><td data-predecessortask=""><\/td><td><select class="form-control" data-predecessortype=""><option value="">Select<\/option><option value="FS">Finish to Start (FS)<\/option><option value="SS">Start to Start (SS)<\/option><\/select><\/td><td><input type="text" class="form-control text-right" data-predecessorleadorlag="" value="" /><\/td><td class="text-center"><div class="action_width"><button class="trash_icon ml-2" type="button" onclick="deletePredecessorRow(this)"><i class="fas fa-trash"><\/i><\/button><\/div><\/td><\/tr>';$("#dependencyTable tbody").append(r)}function deletePredecessorRow(n){var t=$(n).closest("tr");$(t).remove()}function showDocuments(n,t=1){var u,f;$("#documents").modal("show");var e=$("#row_"+n).find("[data-task]").val()!==""?2:1,i="",r="";e==1?(i="WBS Header: ",r=$("#row_"+n).find("[data-wbsheader]").val()):(i="Task: ",r=$("#row_"+n).find("[data-task]").val());$(".documents-label").text(i);$("#documentsSelectedRow").text(r);$("#documentsTable tbody").html("");u=documentDetails.filter(function(t){return parseInt(t.SlNo)===parseInt(n)});f=u.filter(function(n){return!deletedDocumentsArray.some(function(t){return n.DocumentName===t.DocumentName})});t!=0?$.each(f,function(t,i){$("#documentsTable tbody").append('<tr><td data-documentname="'+i.DocumentName+'">'+i.DocumentName+"<\/td><td>"+i.SubmittedBy+"<\/td><td>"+i.SubmittedOn+'<\/td><td class="text-center"><a href="'+ROOT+"PMUMappingsUploads/"+i.ProjectId+"/"+i.SlNo+"/"+i.DocumentName+'" download><i class="fa fa-download" title="Download"><\/i><\/a><button class="trash_icon ml-2" type="button" onclick="deleteDocuments(this,'+n+')"><i class="fas fa-trash"  title="Delete" ><\/i><\/button><\/td><\/tr>')}):t==0&&$.each(u,function(n,t){$("#documentsTable tbody").append('<tr><td data-documentname="'+t.DocumentName+'">'+t.DocumentName+"<\/td><td>"+t.SubmittedBy+"<\/td><td>"+t.SubmittedOn+'<\/td><td class="text-center"><a href="'+ROOT+"PMUMappingsUploads/"+t.ProjectId+"/"+t.SlNo+"/"+t.DocumentName+'" download><i class="fa fa-download" title="Download"><\/i><\/a><\/td><\/tr>')})}function deleteDocuments(n,t){confirm("Are you sure, do you want to delete?",function(){var r=$(n).closest("tr"),u=$(r).find("[data-documentname]").attr("data-documentname"),e=documentDetails.filter(function(n){return n.SlNo===t&&n.DocumentName===u}),i,f;$.each(e,function(n,t){deletedDocumentsArray.push(t)});$(r).remove();i=documentDetails.filter(n=>n.SlNo===t&&n.DocumentName!==u);i=i.filter(n=>!deletedDocumentsArray.some(t=>t.SlNo===n.SlNo&&t.DocumentName===n.DocumentName));i.length==0&&(f=$("#row_"+t).find(".show-file-icon"),$(".fa-history").each(function(){f.css("display","none")}))})}function showRemarks(n){var r;$("#remarks").modal("show");var u=$("#row_"+n).find("[data-task]").val()!==""?2:1,t="",i="";u==1?(t="WBS Header: ",i=$("#row_"+n).find("[data-wbsheader]").val()):(t="Task: ",i=$("#row_"+n).find("[data-task]").val());$(".remarks-label").text(t);$("#remarksSelectedRow").text(i);$("#remarksTable tbody").html("");r=remarksDetails.filter(function(t){return parseInt(t.SlNo)===parseInt(n)});$.each(r,function(n,t){$("#remarksTable tbody").append('<tr><td class="remark_td">'+t.RemarkDesc+"<\/td><td>"+t.SubmittedBy+"<\/td><td>"+t.SubmittedOn+"<\/td><\/tr>")})}function GetNotesData(){$("#notes_msg").text("");$("#notes_msg").removeClass("text-red");$("#notes_msg").removeClass("text-success");var n=!0,t=parseInt($("#Hub").val()),i=parseInt($("#ProjectId").val());if(t===0&&i===0)return alert("Please Select Project and HUB"),n=!1,!1;i==0?(alert("Please select Project"),n=!1):t==0?(alert("Please select Hub"),n=!1):n&&($("#RemarksModal1").modal("show"),CreateNotesModal(t,i),$("#Hub_text").text($("#Hub option:selected").text()),$("#project_text").text($("#ProjectId :selected").text()))}function CreateNotesModal(n,t){$.ajax({url:ROOT+"Master/GetNotes",type:"GET",data:{HubId:n,ProjectId:t},success:function(n){notesData=n;$.jgrid.gridUnload("#viewlist");createModalGrid()},error:function(){alert(" An Error occured!!")}})}function createModalGrid(){$("#viewlist").jqGrid({url:"",datatype:"local",data:notesData,mtype:"GET",colModel:remarkscolmodels,loadonce:!0,viewrecords:!0,pager:"#pager_expected1",rowNum:200,scroll:1,gridComplete:function(){var t=$("#viewlist tbody tr"),r=$("#viewlist tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#viewlist").closest(".ui-jqgrid-bdiv").css({"max-height":"48vh"});$("#viewlist").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"10vh"});var n=$("#viewlist").closest(".ui-jqgrid-bdiv").find("tbody").height();n>280?($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","5px")):($("#viewlist").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#viewlist").closest(".-virtual-scroll").find(".ui-jqgrid-hbox").css("padding-right","0px"))}function getWbsHeaderGrid(){$(".Err-exists-wbsheader").hide();$(".Err-empty-wbsheader").hide();$("#new-wbsheader").val("");$.jgrid.gridUnload("#wbsheader-grid");wbsheadergridColModels=[{name:"WBSHeaderId",label:"Action",resizable:!0,ignoreCase:!0,align:"center",width:40,key:!0,search:!1,formatter:function(n,t,i){if(i.IsApproved==!1)return'<div><\/button > <button class="trash_icon" type="button" onclick="deleteWbsheaderTask('+n+',1,this)"><i class="fas fa-trash" title="Delete"><\/i><\/button><\/div>';return""}},{name:"WBSHeaderDesc",label:"WBS Header",resizable:!0,ignoreCase:!0,width:220},];$("#wbsheader-grid").jqGrid({url:"",datatype:"local",data:autocompleteDrodownArray.hasOwnProperty("WBSHeader")?autocompleteDrodownArray.WBSHeader:[],mtype:"GET",colModel:wbsheadergridColModels,loadonce:!0,viewrecords:!0,pager:"#wbsheadergrid-pager",rowNum:20,scroll:1,gridComplete:function(){var t=$("#wbsheader-grid tbody tr"),r=$("#wbsheader-grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#wbsheader-grid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$("#wbsheader-grid").closest(".jqg-first-row-header").hide();$("#wbsheader-grid").closest(".ui-jqgrid-bdiv").css({"max-height":"22vh"});$("#wbsheader-grid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});var n=$("#wbsheader-grid").closest(".ui-jqgrid-bdiv").find("tbody").height();n>130?($("#wbsheader-grid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#wbsheader-grid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#wbsheader-grid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#wbsheader-grid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"))}function getTaskGrid(){$(".Err-empty-task").hide();$(".Err-exists-task").hide();$("#new-task").val("");$.jgrid.gridUnload("#task-grid");taskgridColModels=[{name:"TaskId",label:"Action",resizable:!0,ignoreCase:!0,align:"center",width:40,key:!0,search:!1,formatter:function(n,t,i){if(i.IsApproved==!1)return'<div><\/button > <button class="trash_icon" type="button" onclick="deleteWbsheaderTask('+n+',2,this)"><i class="fas fa-trash" title="Delete"><\/i><\/button><\/div>';return""}},{name:"TaskDesc",label:"Task",resizable:!0,ignoreCase:!0,width:220},];$("#task-grid").jqGrid({url:"",datatype:"local",data:autocompleteDrodownArray.hasOwnProperty("Task")?autocompleteDrodownArray.Task:[],mtype:"GET",colModel:taskgridColModels,loadonce:!0,viewrecords:!0,pager:"#taskgrid-pager",rowNum:20,scroll:1,gridComplete:function(){var t=$("#task-grid tbody tr"),r=$("#task-grid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#task-grid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$("#task-grid").closest(".jqg-first-row-header").hide();$("#task-grid").closest(".ui-jqgrid-bdiv").css({"max-height":"22vh"});$("#task-grid").closest(".ui-jqgrid-bdiv").children("div").css({"min-height":"0vh"});var n=$("#task-grid").closest(".ui-jqgrid-bdiv").find("tbody").height();n>130?($("#task-grid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#task-grid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","6px")):($("#task-grid").closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$("#task-grid").closest(".-virtual-scroll").find(".ui-jqgrid-hdiv").css("padding-right","0px"))}function saveNewWbsHeaderTask(n){var t="",i="";n==1?(t=$("#new-wbsheader").val().trim(),t=t.replace(/\s+/g," "),i="WBSHeader"):n==2&&(t=$("#new-task").val().trim(),t=t.replace(/\s+/g," "),i="Task");$.ajax({url:ROOT+"Master/SaveNewWBSHeaderTask",type:"POST",dataType:"JSON",data:{newData:t,type:i},success:function(n){var u=n.Item1,r=n.Item2;u.toLowerCase().includes("successfully")&&(i.toLowerCase()=="task"?(autocompleteDrodownArray.Task.unshift({TaskId:r,TaskDesc:t,IsApproved:0}),$.jgrid.gridUnload("#task-grid"),getTaskGrid(),$("#new-task").val(""),$(".alt-saved-task").show().delay(3e3).fadeOut()):i.toLowerCase()=="wbsheader"?(autocompleteDrodownArray.WBSHeader.unshift({WBSHeaderId:r,WBSHeaderDesc:t,IsApproved:0}),$.jgrid.gridUnload("#wbsheader-grid"),getWbsHeaderGrid(),$("#new-wbsheader").val(""),$(".alt-saved-wbsheader").show().delay(3e3).fadeOut()):alert("Error Occured: "+result))},error:function(n){alert("<bold>Error Occured<\/bold> : "+n)}})}function deleteWbsheaderTask(n,t,i){$("#ConfirmDelete").modal("show");$("#deleteok").off("click").on("click",function(){var u=$(i).closest("tr.jqgrow"),r=parseInt(u.attr("id"));t==1?t="WBSHeader":t==2&&(t="Task");$.ajax({url:ROOT+"Master/DeleteWBSHeaderTask",type:"POST",dataType:"JSON",data:{deleteId:n,type:t},success:function(n){var i=n.result;i.toLowerCase().includes("successfully")&&(t.toLowerCase()=="task"?(autocompleteDrodownArray.Task=autocompleteDrodownArray.Task.filter(n=>n.TaskId!=r),$.jgrid.gridUnload("#task-grid"),getTaskGrid(),$(".alt-delete-task").show().delay(3e3).fadeOut()):t.toLowerCase()=="wbsheader"?(autocompleteDrodownArray.WBSHeader=autocompleteDrodownArray.WBSHeader.filter(n=>n.WBSHeaderId!=r),$.jgrid.gridUnload("#wbsheader-grid"),getWbsHeaderGrid(),$(".alt-delete-wbsheader").show().delay(3e3).fadeOut()):alert("Error Occured: "+i))},error:function(n){alert("<bold>Error Occured<\/bold> : "+n)}})})}function getVersionData(){$.ajax({url:ROOT+"Master/PV_NewPMUMappings",type:"POST","async":!1,cache:!1,dataType:"HTML",data:{ProjectId:parseInt($("#ProjectId").val()),ProjectName:$("#ProjectId option:selected").text(),CurrentSelectedVersion:$("#Version option:selected").text()==null?"":$("#Version option:selected").text(),HubId:parseInt($("#Hub option:selected").val()),HubName:$("#Hub option:selected").text()},success:function(n){var r,t;$("#pmumappingtablediv").html(n);$("#pmumapping thead tr").clone(!0).addClass("filters").appendTo("#pmumapping thead");r=$("#pmumapping tbody tr").length;initializeDataTable(r);documentDetails=JSON.parse($("#DocumentDetails").val());remarksDetails=JSON.parse($("#RemarksDetails").val());loadAutoCompleteDropdowns(autocompleteDrodownArray);t=$("#isWeekEndExclude").val().toLowerCase();t=t=="true"?"Excluded":"Included";$("#btnClone").hide();$("#btnApprove").hide();$("#notes_span").hide();$(".template-div").hide();$(".weekend-switching-div").hide();$(".version-div").show();$("#weekend-selected").text(t);$(".weekend-selected-span").show();$("#ApprovedLatestVersion").val()==$("#currentSelectedVersion").val()?($("#save-template").show(),$("#RevisedRequestData").val()==null||$("#RevisedRequestData").val()==undefined||$("#RevisedRequestData").val()==""?isSavable==1?$("#btnSubmit").show():$("#btnSubmit").hide():$("#btnSubmit").show()):($("#btnSubmit").hide(),$("#save-template").hide());smartSheetCalculation(0);let i=new URL(window.location.href);i.searchParams.has("q")&&(i.searchParams.delete("q"),window.history.replaceState({},document.title,i.toString()),$("#ApprovalSlNo").val(""),$("#ApprovalVersion").val(""),$("#ApprovalStartDate").val(""),$("#ApprovalEndDate").val(""))},error:function(n,t,i){alert(i)}})}function findLargestTemplateId(){return autocompleteDrodownArray.Template.map(n=>n.TemplateId).reduce((n,t)=>Math.max(n,t),0)}function saveTemplateData(n){var t=new FormData,i=[];$("#pmumapping").dataTable().$("tr").each(function(n,t){var r=$(t).find("[data-wbsheader]").attr("data-wbsheader"),o=$(t).attr("data-headerid"),u=$(t).find("[data-task]").attr("data-task"),s=$(t).find("[data-dependency]").val(),h=$(t).find("[data-duration]").val(),c=$("#ProjectId").val(),l=$(t).find("[data-slno]").attr("data-slno"),f=$(t).attr("data-relationid"),e;o!==null&&o!==""&&typeof o!="undefined"&&r!==null&&r!==""&&typeof r!="undefined"&&(e={WBSHeader:parseInt(r),Task:0,RelationId:0,Dependency:s,Duration:parseInt(h),ProjectId:parseInt(c),RowNum:parseInt(l)},i.push(e));f!==null&&f!==""&&typeof f!="undefined"&&u!==null&&u!==""&&typeof u!="undefined"&&(e={WBSHeader:0,Task:parseInt(u),RelationId:parseInt(f),Dependency:s,Duration:parseInt(h),ProjectId:parseInt(c),RowNum:parseInt(l)},i.push(e))});t.append("PMUMappings",JSON.stringify(i));t.append("TemplateName",n);$.ajax({url:ROOT+"Master/SaveNewTemplate",type:"POST",data:t,contentType:!1,processData:!1,success:function(t){t.toLowerCase().includes("successfully")?($("#new-template-name").val(""),$(".err-exists-template").hide(),$(".err-need-template").hide(),$("#save-as-template-popup").modal("hide"),autocompleteDrodownArray.Template.unshift({TemplateId:findLargestTemplateId()+1,TemplateName:n}),smartSheetCalculation(0),alert(t)):alert(t)},error:function(n,t,i){alert(i)}})}function CreateJqGrid(n){$.jgrid.gridUnload("#jqgrid");$("#jqgrid").jqGrid({url:"",datatype:"local",data:n,mtype:"Get",colModel:[{name:"RowNum",label:"Sl.No",width:60,resizable:!0,ignoreCase:!0,search:!1},{name:"WBSHeader",label:"WBS Header",resizable:!0,ignoreCase:!0},{name:"Task",label:"Task",resizable:!0,ignoreCase:!0},{name:"Dependency",label:"Dependency",resizable:!0,ignoreCase:!0},{name:"Duration",label:"Duration",resizable:!0,ignoreCase:!0},{name:"StartDate",label:"Start Date",resizable:!0,ignoreCase:!0},{name:"EndDate",label:"End Date",resizable:!0,ignoreCase:!0},{name:"Percentage",label:"Percentage",resizable:!0,ignoreCase:!0},{name:"Resources",label:"Resources",resizable:!0,ignoreCase:!0},{name:"Files",label:"Files",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){var r=excel_documentarray.filter(function(n){return parseInt(n.SlNo)===parseInt(i.RowNum)}).length;return r>0?"Yes":""}},{name:"Remarks",label:"Remarks",resizable:!0,ignoreCase:!0,formatter:function(n,t,i){var r=excelremarksarray.filter(function(n){return parseInt(n.SlNo)===parseInt(i.RowNum)}).length;return r>0?"Yes":""}},],loadonce:!0,viewrecords:!0,rowNum:20,pager:"#pager",subGrid:!0,gridComplete:function(){var t=$("#jqgrid tbody tr"),r=$("#jqgrid tbody tr td"),n;if(t.length>1)for(n=$(t[1]).children("td"),i=0;i<n.length;i++)$(n[i]).css("width",$(r[i]).css("width"))}});$("#jqgrid").jqGrid("filterToolbar",{autosearch:!0,stringResult:!1,searchOnEnter:!1,defaultSearch:"cn"});$(".ui-jqgrid-bdiv").css({"max-height":"300px"});$(".ui-jqgrid-bdiv").children("div").css({height:"auto"});var t=$(".ui-jqgrid-bdiv").find("tbody").height();t>278?($(".ui-jqgrid").find(".ui-jqgrid-bdiv").css("overflow","auto"),$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","17px")):$(".m-table__responsive").find(".ui-jqgrid-htable").css("padding-right","0px")}function GetPMUMappingsExcelData(n,t){$.ajax({url:ROOT+"Master/GetNewPMUMappingsExcelData",type:"GET",dataType:"JSON","async":!1,data:{ProjectId:n,HubId:t},success:function(n){CreateJqGrid(n)}})}function GetCloneData(){var t=parseInt($("#Hub").val()),i=parseInt($("#ProjectId").val()),n;if($("#MappedHubId").val("").trigger("change"),$("#MappedProjectId").val("").trigger("change"),n=!0,i==0&&t==0)alert("Please select Project and Hub"),n=!1;else{if(i==0)return alert("Please select Project"),n=!1,!1;if(t==0)return alert("Please select Hub"),n=!1,!1;n&&($("#addModal").modal("show"),$("#To_Project").text($("#ProjectId :selected").text()),$("#To_Hub").text($("#Hub option:selected").text()))}}function loadClonedProjectHubData(n,t){DeletedRemarksArray=remarksDetails;deletedDocumentsArray=documentDetails;$.ajax({url:ROOT+"Master/PV_CloneNewPMUMappings",type:"POST","async":!1,cache:!1,dataType:"HTML",data:{ProjectId:n,HubId:t,CurrentSelectedVersion:"",ApprovedLatestVersion:$("#ApprovedLatestVersion").val()},success:function(n){var t,i;$("#pmumappingtablediv").html(n);$("#pmumapping thead tr").clone(!0).addClass("filters").appendTo("#pmumapping thead");t=$("#pmumapping tbody tr").length;initializeDataTable(t);documentDetails=JSON.parse($("#DocumentDetails").val());remarksDetails=JSON.parse($("#RemarksDetails").val());loadAutoCompleteDropdowns(autocompleteDrodownArray);i=$("#isWeekEndExclude").val();$("#weekend-switching").val(i).trigger("change")},error:function(n,t,i){alert(i)}})}function exceldatadownload(){var n=[];excel_documentarray=[];excelremarksarray=[];excelremarksarray=JSON.parse($("#RemarksDetails").val());excel_documentarray=JSON.parse($("#DocumentDetails").val());$("#pmumapping").dataTable().$("tr").each(function(t,i){var l=$(i).find("[data-wbsheader]").val(),w=$(i).attr("data-headerid"),a=$(i).find("[data-task]").val(),s=$(i).find("[data-dependency]").val(),u=$(i).find("[data-duration]").val(),f=$(i).find("[data-startdate]").val(),e=$(i).find("[data-enddate]").val(),g=$(i).find("[data-percentage]").val()!==null&&$(i).find("[data-percentage]").val()!==""&&typeof $(i).find("[data-percentage]").val()!="undefined"?parseFloat($(i).find("[data-percentage]").val()):0,h=$(i).find("[data-resources]").val(),b=$(i).find("[data-remarks]").val(),o=$("#ProjectId").val(),r=$(i).find("[data-slno]").attr("data-slno"),nt=$(i).find("[data-files]")[0].files,v=$(i).attr("data-relationid"),tt=$(i).attr("data-milestonestatus"),c=[],k=[],d,y,p;h!==null&&h!==""&&typeof h!="undefined"&&$.each(h.split(","),function(n,t){var i=t.split("-"),u,f;i.length>1&&(u=autocompleteDrodownArray.Resources.findIndex(function(n){return n.UserName===i[1].replace(" ","")}),u>=0&&(f={ProjectId:parseInt(o),RowNum:parseInt(r),ResourceName:i[1].replace(" ","")},k.push(f)))});w!==null&&w!==""&&typeof w!="undefined"&&l!==null&&l!==""&&typeof l!="undefined"&&u!==null&&u!==""&&typeof u!="undefined"&&f!==null&&f!==""&&typeof f!="undefined"&&e!==null&&e!==""&&typeof e!="undefined"&&($.each(nt,function(n,t){if(t.size>0){var i=moment().valueOf(),f=t.name.split(".").pop(),u={ProjectId:parseInt(o),RowNum:parseInt(r),DocumentName:$.trim(o+"_"+r+"_"+(n+1)+"_"+i+t.name).replace(" "," ")};c.push(u)}}),y=deletedDocumentsArray.filter(function(n){return n.SlNo===parseInt(r)}),p={WBSHeader:l,Task:"",RelationId:0,Dependency:s,Duration:parseInt(u),StartDate:moment(f,"DD/MM/YYYY").format("DD/MM/YYYY"),EndDate:moment(e,"DD/MM/YYYY").format("DD/MM/YYYY"),Percentage:parseFloat(g),Resources:h,Remarks:b,ProjectId:parseInt(o),RowNum:parseInt(r),DocumentArray:c,DependencyArray:[],DeletedDocumentsArray:y,ResourcesArray:k,MileStoneStatus:tt,VersionRemarks:$("#VersionRemarks").val()},n.push(p));v!==null&&v!==""&&typeof v!="undefined"&&a!==null&&a!==""&&typeof a!="undefined"&&u!==null&&u!==""&&typeof u!="undefined"&&f!==null&&f!==""&&typeof f!="undefined"&&e!==null&&e!==""&&typeof e!="undefined"&&(d=[],$.each(nt,function(n,t){if(t.size>0){var i=moment().valueOf(),f=t.name.split(".").pop(),u={ProjectId:parseInt(o),RowNum:parseInt(r),DocumentName:$.trim(o+"_"+r+"_"+(n+1)+"_"+i+t.name).replace(" "," ")};c.push(u)}}),s!==null&&s!==""&&typeof s!="undefined"&&$.each(s.split(","),function(n,t){var i=t.indexOf("F")>-1?t.indexOf("F"):t.indexOf("S"),u=t.substr(0,i),f=t.substr(i,2),e=t.indexOf("+")>-1?t.indexOf("+"):t.indexOf("-"),s=t.substr(e,t.length);d.push({RowNum:parseInt(r),ProjectId:parseInt(o),Depedency:parseInt(u),DependencyType:f,LeadOrLag:parseInt(s)})}),y=deletedDocumentsArray.filter(function(n){return n.SlNo===parseInt(r)}),p={WBSHeader:"",Task:a,RelationId:parseInt(v),Dependency:s,Duration:parseInt(u),StartDate:moment(f,"DD/MM/YYYY").format("DD/MM/YYYY"),EndDate:moment(e,"DD/MM/YYYY").format("DD/MM/YYYY"),Percentage:parseFloat(g),Resources:h,Remarks:b,ProjectId:parseInt(o),RowNum:parseInt(r),DocumentArray:c,DependencyArray:d,DeletedDocumentsArray:y,ResourcesArray:k,MileStoneStatus:tt,VersionRemarks:$("#VersionRemarks").val()},n.push(p));excel_documentarray.push(c);excelremarksarray.push(b)});CreateJqGrid(n)}function GetHubList(n){$.ajax({dataType:"json",url:ROOT+"Home/GetHubBasedOnProjectId",method:"get",data:{projectId:n},success:function(n){var i="",r=$("#Hub").val(),t;if(n.length>0){for($("#Hub").html(""),i+='<option  value="0">Select Hub<\/option>',t=0;t<n.length;t++)i+=n[t].HubApproved==="1"?'<option  data-bgcolor="#358375 !important;" class="approvedHub" value="'+n[t].HubId+'">'+n[t].HubName+"<\/option>":n[t].HubApproved==="0"&&n[t].HubSaved==="1"?'<option  data-bgcolor="#db8c44 !important;" class="savedHub" value="'+n[t].HubId+'">'+n[t].HubName+"<\/option>":'<option value="'+n[t].HubId+'">'+n[t].HubName+"<\/option>";$("#Hub").html(i);$("#Hub").val(r);$("#Hub").select2({templateResult:function(n){if(!n.id)return n.text;var t=$(n.element),i=t.data("bgcolor")||"block",r=t.text();return $('<span style="color: '+i+';  font-weight: bold;">'+r+"<\/span>")}})}}})}var selectedWBSHeadrId=0,isExport=!1,selectedTaskId=0,selectedResourcesId=0,documentDetails=[],remarksDetails=[],deletedDocumentsArray=[],autocompleteDrodownArray=[],wbsheaderArray=[],taskArray=[],isSavable=1,DeletedRemarksArray=[],from,to,flagloaded=0,remarkscolmodels,notesData,projectId,hubId,excel_documentarray,excelremarksarray,ChangedSLNo,changedSLNoForSave;$(document).ready(function(){var n=0;$("#btnRemarks").hide();$("#addModal").modal("hide");$("#notes_span").hide();setInterval(()=>{isSavable==1&&($("#Version").val()==""||$("#Version").val()==null)&&submitAutoData("",!1),$("#loader").hide(),$("#loader").css("visibility","hidden")},3e5);$("body").on("input",".noSpacesField",function(){this.value=this.value.replace(/^\s+/g,"")});$("#new-wbsheader").autocomplete({source:function(n,t){var i=[];$.each(autocompleteDrodownArray.WBSHeader,function(t,r){r.WBSHeaderDesc.toLowerCase().includes(n.term.trim().toLowerCase())&&i.push(r.WBSHeaderDesc)});t(i)},minLength:2});$("#new-task").autocomplete({source:function(n,t){var i=[];$.each(autocompleteDrodownArray.Task,function(t,r){r.TaskDesc.toLowerCase().includes(n.term.trim().toLowerCase())&&i.push(r.TaskDesc)});t(i)},minLength:2});$.ajax({url:ROOT+"Master/DropdownList",type:"POST","async":!1,dataType:"JSON",success:function(n){autocompleteDrodownArray=n}});$("#selectedProjectId").val()===null||$("#selectedProjectId").val()===""||typeof $("#selectedProjectId").val()=="undefined"||$("#selectedProjectId").val()==="0"?($(".projectName_error").text("Please select the Project"),$(".template-div").hide(),$(".version-div").hide(),$("#notes_span").show(),$(".weekend-switching-div").hide(),$(".weekend-selected-span").hide(),$("#save-template").hide(),$("#btnSubmit").hide(),$("#btnApprove").hide(),$("#btnClone").hide(),n=0):($("#ProjectId").val($("#selectedProjectId").val()),$(".projectName_error").text(""),GetHubList($("#selectedProjectId").val()),n=1);$("#selectedHubId").val()===null||$("#selectedHubId").val()===""||typeof $("#selectedHubId").val()=="undefined"||$("#selectedHubId").val()==="0"?($(".hubName_error").text("Please select HUB"),$(".template-div").hide(),$(".version-div").hide(),$("#notes_span").show(),$(".weekend-switching-div").hide(),$(".weekend-selected-span").hide(),$("#save-template").hide(),$("#btnSubmit").hide(),$("#btnApprove").hide(),$("#btnClone").hide(),n=0):($("#Hub").val($("#selectedHubId").val()).change(),$(".hubName_error").text(""),n=1);n==1&&flagloaded==0&&ajaxtocallgetdata()});$("body").on("change","#ProjectId",function(){$("#ProjectId").val()!==null&&$("#ProjectId").val()!==""&&typeof $("#ProjectId").val()!="undefined"&&$("#ProjectId").val()!=="0"?($(".projectName_error").text(""),$("#Hub").val()===null||$("#Hub").val()===""||typeof $("#Hub").val()=="undefined"||$("#Hub").val()==="0"?$(".hubName_error").text("Please select HUB"):ajaxtocallgetdata()):($(".projectName_error").text("Please select the Project"),($("#Hub").val()===null||$("#Hub").val()===""||typeof $("#Hub").val()=="undefined"||$("#Hub").val()==="0")&&$(".hubName_error").text("Please select HUB"),$("#pmumappingtablediv").html(""),$(".template-div").hide(),$(".version-div").hide(),$("#notes_span").show(),$(".weekend-switching-div").hide(),$(".weekend-selected-span").hide(),$("#save-template").hide(),$("#btnSubmit").hide(),$("#btnApprove").hide(),$("#btnClone").hide(),$("#OverAllProjectPercentage").text(""),$("#OverAllStartDate").text(""),$("#OverAllEndDate").text(""));GetHubList($("#ProjectId").children(":selected").attr("value"))});$("body").on("change","#Hub",function(){$("#notes_span").show();$("#Hub").val()!==null&&$("#Hub").val()!==""&&typeof $("#Hub").val()!="undefined"&&$("#Hub").val()!=="0"?($(".hubName_error").text(""),$("#ProjectId").val()===null||$("#ProjectId").val()===""||typeof $("#ProjectId").val()=="undefined"||$("#ProjectId").val()==="0"?$(".projectName_error").text("Please select the Project"):(ajaxtocallgetdata(),flagloaded=1)):($(".hubName_error").text("Please select HUB"),($("#ProjectId").val()===null||$("#ProjectId").val()===""||typeof $("#ProjectId").val()=="undefined"||$("#ProjectId").val()==="0")&&$(".projectName_error").text("Please select the Project"),$("#pmumappingtablediv").html(""),$(".template-div").hide(),$(".version-div").hide(),$("#notes_span").show(),$(".weekend-switching-div").hide(),$(".weekend-selected-span").hide(),$("#save-template").hide(),$("#btnSubmit").hide(),$("#btnApprove").hide(),$("#btnClone").hide(),$("#OverAllProjectPercentage").text(""),$("#OverAllStartDate").text(""),$("#OverAllEndDate").text(""))});$("body").on("keyup","[data-percentage]",function(){var u=$(this).closest("tr").find("td[data-slno]").attr("data-slno"),t=0,i,n,r;$("#pmumapping").dataTable().$("[data-headerid]").length>0&&($("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var r=parseInt($(t).attr("data-headerid"));if(r<u)i=t;else return!1}),t=$(i).attr("data-headerid"),$(this).closest("tr").attr("data-relationid",t));this.value=this.value.replace(/[^0-9\.]/g,"");(this.value===null||this.value===""||typeof this.value=="undefined")&&(this.value="");$.isNumeric(this.value)&&(Number(this.value)>100&&(alert("Percentage cannot be greater than 100"),this.value=100),$(this).siblings("span").children("span").width(this.value+"%"),n=$(this).closest("tr"),$(n).attr("data-isupdate",1),r=$(n).attr("data-relationid"),smartSheetCalculation(r))});$("body").on("change","[data-duration]",function(){var s=$(this).closest("tr").find("td[data-slno]").attr("data-slno"),u=0,f,r,e,t,o;$("#pmumapping").dataTable().$("[data-headerid]").length>0&&($("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var i=parseInt($(t).attr("data-headerid"));if(i<s)f=t;else return!1}),u=$(f).attr("data-headerid"),$(this).closest("tr").attr("data-relationid",u));var n=$(this).closest("tr"),h=$(this).closest("tr").attr("data-relationid"),i=$(n).find("[data-task]").val();i===null||i===""||typeof i=="undefined"?($(n).find("[data-task]").siblings("span").removeClass("hide"),$(n).find("[data-duration]").val("")):$(n).find("[data-task]").siblings("span").addClass("hide");this.value=this.value.replace(/[^0-9\.]/g,"");$(this).val()!==null&&$(this).val()!==""&&typeof $(this).val()!="undefined"&&$(this).siblings("span").addClass("hide");$.isNumeric(this.value)&&(r=$(this).val()!==null&&$(this).val()!==""&&typeof $(this).val()!="undefined"?Number($(this).val()):0,e=r===0?0:r-1,$(this).closest("tr").attr("data-isupdate",1),t=$(n).find("td [data-startdate]").val(),t!==null&&t!==""&&typeof t!="undefined"&&(o=moment(addBusinessDays(moment(t,"DD/MM/YYYY"),e)).format("DD/MM/YYYY"),$(n).find("td [data-enddate]").val(o),smartSheetCalculation(h,1)))});$("body").on("change","[data-startdate]",function(){var n=$(this).closest("tr"),a=$(this).closest("tr").find("td[data-slno]").attr("data-slno"),t=$(this).val(),h=0,c,r,u,i,f,e,o,l,s;if($("#pmumapping").dataTable().$("[data-headerid]").length>0&&($("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var i=parseInt($(t).attr("data-headerid"));if(i<a)c=t;else return!1}),h=$(c).attr("data-headerid"),$(this).closest("tr").attr("data-relationid",h)),r=$(n).find("[data-task]").val(),r===null||r===""||typeof r=="undefined"?($(n).find("[data-task]").siblings("span").removeClass("hide"),$(n).find("[data-startdate]").val(""),t=""):$(n).find("[data-startdate]").siblings("span").addClass("hide"),u=$(n).find("[data-dependency]").val(),i=[],$(n).find("[data-startdate]").attr("data-previousvalue")!==null&&$(n).find("[data-startdate]").attr("data-previousvalue")!==""&&typeof $(n).find("[data-startdate]").attr("data-previousvalue")!="undefined")for(i.push(parseInt($(n).find("[data-slno]").attr("data-slno"))),f=0;f<i.length;)$("#pmumapping").dataTable().$("[data-relationid]").each(function(n,t){var r=$(t).find("[data-dependency]").val(),e;if(r!==null&&r!==""&&typeof r!="undefined"){var o=r.split(","),u=!1,s=i[f];$.each(o,function(n,t){var i=t.indexOf("F")>-1?t.indexOf("F"):t.indexOf("S"),r=t.substr(0,i);parseInt(s)===parseInt(r)&&(u=!0)});u&&(e=i.findIndex(function(n){return Number(n)===parseInt($(t).find("[data-slno]").attr("data-slno"))}),e==-1&&i.push(parseInt($(t).find("[data-slno]").attr("data-slno"))))}}),f+=1;u===null||u===""||typeof u=="undefined"?(e=$(n).find("td [data-duration]").val()!==null&&$(n).find("td [data-duration]").val()!==""&&typeof $(n).find("td [data-duration]").val()!="undefined"?Number($(n).find("td [data-duration]").val()):0,o=e===0?0:e-1,o===0?$(n).find("[data-duration]").val(1):$(n).find("[data-duration]").val(e),t!==null&&t!==""&&typeof t!="undefined"&&($(n).find("[data-startdate]").siblings("span").addClass("hide"),l=moment(addBusinessDays(moment(t,"DD/MM/YYYY"),o)).format("DD/MM/YYYY"),$(n).find("[data-enddate]").val(l),$(n).find("[data-startdate]").attr("data-previousvalue",t),$(n).find("[data-enddate]").siblings("span").addClass("hide"))):confirm('Manually changing "Start Date" will result in the removal of all predecessor relationships on this row. Do you wish to continue?',function(){var r,u,f;$(n).find("[data-dependency]").val("");$(n).find("[data-startdate]").val(t);r=$(n).find("td [data-duration]").val()!==null&&$(n).find("td [data-duration]").val()!==""&&typeof $(n).find("td [data-duration]").val()!="undefined"?Number($(n).find("td [data-duration]").val()):0;u=r===0?0:r-1;u===0?$(n).find("[data-duration]").val(1):$(n).find("[data-duration]").val(r);t!==null&&t!==""&&typeof t!="undefined"&&($(n).find("[data-startdate]").siblings("span").addClass("hide"),f=moment(addBusinessDays(moment(t,"DD/MM/YYYY"),u)).format("DD/MM/YYYY"),$(n).find("[data-enddate]").val(f),$(n).find("[data-startdate]").attr("data-previousvalue",t),$(n).find("[data-enddate]").siblings("span").addClass("hide"),smartSheetCalculation(s,i))});s=$(n).attr("data-relationid");smartSheetCalculation(s,1,i);removeValidationStartEndDate()});$("body").on("change","[data-enddate]",function(){var n=$(this).closest("tr"),b=$(this).closest("tr").find("td[data-slno]").attr("data-slno"),y=0,p,t,f,e,s,c,v,h;$("#pmumapping").dataTable().$("[data-headerid]").length>0&&($("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){var i=parseInt($(t).attr("data-headerid"));if(i<b)p=t;else return!1}),y=$(p).attr("data-headerid"),$(this).closest("tr").attr("data-relationid",y));var l=parseInt($(n).find("[data-relationid]").attr("data-relationid")),i=$(this).val(),a=$(n).find("[data-task]").val();if(a===null||a===""||typeof a=="undefined")return $(n).find("[data-task]").siblings("span").removeClass("hide"),!1;if($(n).find("[data-task]").siblings("span").addClass("hide"),t=$(n).find("[data-startdate]").val(),t===null||t===""||typeof t=="undefined")return $(n).find("[data-startdate]").siblings("span").removeClass("hide"),!1;if($(n).find("[data-startdate]").siblings("span").addClass("hide"),f=$(n).find("[data-enddate]").val(),f===null||f===""||typeof f=="undefined")return $(n).find("[data-enddate]").siblings("span").removeClass("hide"),!1;if($(n).find("[data-enddate]").siblings("span").addClass("hide"),moment(t,"DD/MM/YYYY")>moment(f,"DD/MM/YYYY"))alert("End Date should be greater than Start Date"),e=$(n).find("[data-previousvalue]").attr("data-previousvalue"),s=e!==""&&e!==null&&typeof e!="undefined"?e:t,$(n).find("[data-enddate]").val(s),$(n).find("[data-enddate]").attr("data-previousvalue",s),h=getBusinessDays(moment(t,"DD/MM/YYYY"),moment(s,"DD/MM/YYYY")),$(n).find("[data-duration]").val(h+1);else{var r=[],u=[],w=[],o={SlNo:parseInt($(n).find("[data-slno]").attr("data-slno")),Task:$(n).find("[data-task]").val(),StartDate:$(n).find("[data-startdate]").val(),EndDate:$(n).find("[data-enddate]").attr("data-previousvalue"),RevisedStartDate:$(n).find("[data-startdate]").val(),RevisedEndDate:i,Dependency:$(n).find("[data-dependency]").val(),Duration:$(n).find("[data-duration]").val()};for(u.push(o),r.push(parseInt($(n).find("[data-slno]").attr("data-slno"))),c=0;c<r.length;)$("#pmumapping").dataTable().$("[data-relationid]").each(function(n,t){var f=$(t).find("[data-dependency]").val(),a,i,s;if(f!==null&&f!==""&&typeof f!="undefined"){var h=f.split(","),l=!1,e=r[c];if($.each(h,function(n,t){var i=t.indexOf("F")>-1?t.indexOf("F"):t.indexOf("S"),r=t.substr(0,i);parseInt(e)===parseInt(r)&&(l=!0)}),l&&w.includes(parseInt($(t).find("[data-slno]").attr("data-slno")))==!1){if(a=r.findIndex(function(n){return Number(n)===parseInt($(t).find("[data-slno]").attr("data-slno"))}),a==-1&&r.push(parseInt($(t).find("[data-slno]").attr("data-slno"))),i=[],$.each(h,function(n,f){var w=f.indexOf("F")>-1?f.indexOf("F"):f.indexOf("S"),c=f.substr(0,w),l=f.indexOf("+")>-1?f.indexOf("+"):f.indexOf("-"),y=Number(f.substr(l,f.length))<0?Number(f.substr(l,f.length)):Number(f.substr(l,f.length))===0?0:Number(f.substr(l,f.length)),h,o,s,a;if(Number(c===Number(e)))h=u.filter(function(n){Number(n.SlNo)===Number(e)}),h.length>0&&(o=h[0].RevisedEndDate,o!==null&&o!==""&&o!=="undefined"&&(o=h[0].Duration!==null&&h[0].Duration!==""&&typeof h[0].Duration!="undefined"&&parseInt(h[0].Duration)===0?moment(addBusinessDays(moment(o,"DD/MM/YYYY"),0)).format("DD/MM/YYYY"):moment(addBusinessDays(moment(o,"DD/MM/YYYY"),1)).format("DD/MM/YYYY")),s=f.indexOf("F")>-1?o:$(v).find("td [data-startdate]").val(),s!==null&&s!==""&&typeof s!="undefined"&&(a=addBusinessDays(moment(s,"DD/MM/YYYY"),y),i.push(a)));else{var v=$("#pmumapping").dataTable().$("#row_"+c),b=r.includes(parseInt(c)),o=$(v).find("td [data-enddate]").val(),p=$(v).find("td [data-startdate]").val();b&&(o=u.filter(n=>n.SlNo===parseInt(c)).map(n=>n.RevisedEndDate),p=u.filter(n=>n.SlNo===parseInt(c)).map(n=>n.RevisedStartDate));o!==null&&o!==""&&o!=="undefined"&&(o=$(t).find("[data-duration]").val()!==null&&$(t).find("[data-duration]").val()!==""&&typeof $(t).find("[data-duration]").val()!="undefined"&&parseInt($(t).find("[data-duration]").val())===0?moment(addBusinessDays(moment(o,"DD/MM/YYYY"),0)).format("DD/MM/YYYY"):moment(addBusinessDays(moment(o,"DD/MM/YYYY"),1)).format("DD/MM/YYYY"));s=f.indexOf("F")>-1?o:p;s!==null&&s!==""&&typeof s!="undefined"&&(a=addBusinessDays(moment(s,"DD/MM/YYYY"),y),i.push(a))}}),i.length>0){o={SlNo:parseInt($(t).find("[data-slno]").attr("data-slno")),Task:$(t).find("[data-task]").val(),StartDate:$(t).find("[data-startdate]").val(),EndDate:$(t).find("[data-enddate]").attr("data-previousvalue"),RevisedStartDate:"",RevisedEndDate:"",Dependency:$(t).find("[data-dependency]").val(),Duration:$(t).find("[data-duration]").val()};s=moment.max(i);o.RevisedStartDate=s.format("DD/MM/YYYY");var v=$(t).find("[data-duration]").val()!==null&&$(t).find("[data-duration]").val()!==""&&typeof $(t).find("[data-duration]").val()!="undefined"?Number($(t).find("[data-duration]").val()):0,y=v===0?0:v-1,p=addBusinessDays(s,y);o.RevisedEndDate=p.format("DD/MM/YYYY");u.push(o)}w.push(parseInt($(t).find("[data-slno]").attr("data-slno")))}}}),c+=1;$("#dependentAlertTable tbody").html("");u.length>1?(v="",$.each(u,function(n,t){v+="<tr><td>"+t.SlNo+"<\/td><td>"+t.Task+"<\/td><td>"+t.Dependency+'<\/td><td class="text-right">'+t.Duration+"<\/td><td>"+t.StartDate+"<\/td><td>"+t.EndDate+"<\/td><td>"+t.RevisedStartDate+"<\/td><td>"+t.RevisedEndDate+"<\/td><\/tr>"}),confirmWithDependentAlert(v,function(){$(n).find("[data-enddate]").val(i);$(n).find("[data-enddate]").attr("data-previousvalue",i);var u=getBusinessDays(moment(t,"DD/MM/YYYY"),moment(i,"DD/MM/YYYY"));$(n).find("[data-duration]").val(u+1);smartSheetCalculation(l,1,r)},function(){$(n).find("[data-enddate]").val($(n).find("[data-enddate]").attr("data-previousvalue"));$(n).find("[data-enddate]").attr("data-previousvalue",$(n).find("[data-enddate]").attr("data-previousvalue"));var i=getBusinessDays(moment(t,"DD/MM/YYYY"),moment($(n).find("[data-enddate]").attr("data-previousvalue"),"DD/MM/YYYY"));$(n).find("[data-duration]").val(i+1);smartSheetCalculation(l)})):($(n).find("[data-enddate]").val(i),$(n).find("[data-enddate]").attr("data-previousvalue",i),h=getBusinessDays(moment(t,"DD/MM/YYYY"),moment(i,"DD/MM/YYYY")),$(n).find("[data-duration]").val(h+1))}smartSheetCalculation(l,1);removeValidationStartEndDate()});$("body").on("change","[data-dependency]",function(){var n=$(this).closest("tr").find("td[data-slno]").attr("data-slno"),r=0,u,f,t,e;$("#pmumapping").dataTable().$("[data-headerid]").length>0&&($("#pmumapping").dataTable().$("[data-headerid]").each(function(t,i){var r=parseInt($(i).attr("data-headerid"));r<n&&(u=i)}),r=$(u).attr("data-headerid"),$(this).closest("tr").attr("data-relationid",r));var s=$(this).closest("tr"),o=$(this).closest("tr").attr("data-relationid"),i=[];$("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){$(t).attr("data-headerid")!==null&&$(t).attr("data-headerid")!==""&&typeof $(t).attr("data-headerid")!="undefined"&&i.push(Number($(t).attr("data-headerid")))});$(this).val()!==null&&$(this).val()!==""&&typeof $(this).val()!="undefined"&&(f=$(this).val().toUpperCase().split(","),t=[],$.each(f,function(r,u){var s=$("#pmumapping").dataTable().$("tr").length,h,o,f;if($.isNumeric(u)){if(Number(u)===0)return alert("Dependency Value cannot be zero"),!1;if(Number(u)===Number(n))return alert("Circular Dependency is not possible"),!1;if(jQuery.inArray(Number(u),i)!=-1)return alert("WBS Header ID cannot be considered as dependency, Please enter the valid task ID for dependency."),!1;if(Number(u)>s)return alert("Dependency Row No cannot exceed the total no of rows"),!1;if($("#row_"+u).find("[data-task]").val()===null||$("#row_"+u).find("[data-task]").val()===""||typeof $("#row_"+u).find("[data-task]").val()=="undefined")return alert("row: "+u+" doesn't have any task"),!1;ChangedSLNo=n+",";t.push(u+"FS+0")}else if(h=/^\d*(?:FS|SS)[+-]\d+$/,u!==null&&u!==""&&typeof u!="undefined")if(o=u.slice(-2),f=o==="FS"||o==="SS"?u+"+0":u,h.test(f)){var c=f.indexOf("F")>-1?f.indexOf("F"):f.indexOf("S"),e=f.substr(0,c),s=$("#pmumapping").dataTable().$("tr").length;if(Number(e)===0)return alert("Dependency Value cannot be zero"),!1;if(Number(e)===Number(n))return alert("Circular Dependency is not possible"),!1;if(jQuery.inArray(Number(u),i)!=-1)return alert("WBS Header ID cannot be considered as dependency, Please enter the valid task ID for dependency."),!1;if(Number(e)>s)return alert("Dependency Row No cannot exceed the total no of rows"),!1;if($("#row_"+e).find("[data-task]").val()===null||$("#row_"+e).find("[data-task]").val()===""||typeof $("#row_"+e).find("[data-task]").val()=="undefined")return alert("row: "+u+" doesn't have any task"),!1;ChangedSLNo+=n+",";t.push(f)}else return alert(f+" does not match the pattern"),!1}),t.length===0?$(this).val(""):(e=$.unique(t),$(this).val(e.join(","))),smartSheetCalculation(o,1))});$("body").on("click","#btnSubmit",function(){var n=!0,t=!0,i;$("#ProjectId").val()!==null&&$("#ProjectId").val()!==""&&typeof $("#ProjectId").val()!="undefined"&&$("#ProjectId").val()!=="0"?($(".projectName_error").text(""),$("#Hub").val()===null||$("#Hub").val()===""||typeof $("#Hub").val()=="undefined"||$("#Hub").val()==="0"?$(".hubName_error").text("Please select HUB"):($(".hubName_error").text(""),i=$("#pmumapping").dataTable().$("[data-headerid]").length,i===0&&(alert("Please add atleast one WBS Header"),n=!1),$("#pmumapping").dataTable().$("[data-headerid]").each(function(i,r){var h=$(r).attr("data-headerid"),u=parseInt($(r).find("[data-slno]").attr("data-slno")),s=$("#row_"+u).find("[data-wbsheader]").attr("data-wbsheader"),f,e,o,c;if(s===null||s===""||typeof s=="undefined"?($("#row_"+u).find("[data-header]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-header]").siblings("span").addClass("hide"),f=$("#row_"+u).find("[data-duration]").val(),f===null||f===""||typeof f=="undefined"?($("#row_"+u).find("[data-duration]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-duration]").siblings("span").addClass("hide"),e=$("#row_"+u).find("[data-startdate]").val(),e===null||e===""||typeof e=="undefined"?($("#row_"+u).find("[data-startdate]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-startdate]").siblings("span").addClass("hide"),o=$("#row_"+u).find("[data-enddate]").val(),o===null||o===""||typeof o=="undefined"?($("#row_"+u).find("[data-enddate]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-enddate]").siblings("span").addClass("hide"),c=$("#pmumapping").dataTable().$('[data-relationid="'+h+'"]').length,c===0)return alert("Please add atleast one Task under WBS Header"),t=!1,!1;$("#pmumapping").dataTable().$('[data-relationid="'+h+'"]').each(function(i,r){var u=parseInt($(r).find("[data-slno]").attr("data-slno")),h=$("#row_"+u).find("[data-task]").attr("data-task"),f,e,o,s;h===null||h===""||typeof h=="undefined"?($("#row_"+u).find("[data-task]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-task]").siblings("span").addClass("hide");f=$("#row_"+u).find("[data-duration]").val();f===null||f===""||typeof f=="undefined"?($("#row_"+u).find("[data-duration]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-duration]").siblings("span").addClass("hide");e=$("#row_"+u).find("[data-startdate]").val();e===null||e===""||typeof e=="undefined"?($("#row_"+u).find("[data-startdate]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-startdate]").siblings("span").addClass("hide");o=$("#row_"+u).find("[data-enddate]").val();o===null||o===""||typeof o=="undefined"?($("#row_"+u).find("[data-enddate]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-enddate]").siblings("span").addClass("hide");$("#ApprovedLatestVersion").val()!==null&&$("#ApprovedLatestVersion").val()!==""&&typeof $("#ApprovedLatestVersion").val()!="undefined"&&(s=$("#row_"+u).find("[data-resources]").val(),s===null||s===""||typeof s=="undefined"?($("#row_"+u).find("[data-resources]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-resources]").siblings("span").addClass("hide"))})}),n&&t&&($("#ApprovedLatestVersion").val()===null||$("#ApprovedLatestVersion").val()===""||typeof $("#ApprovedLatestVersion").val()=="undefined"?submitData("",!1):ChangedSLNo==""&&changedSLNoForSave==""&&($("#RevisedRequestData").val()==null||$("#RevisedRequestData").val()==undefined||$("#RevisedRequestData").val()=="")?alert("There is no changes to save"):confirmWithVersion("Do you want to save it as a new version?",function(){var t=!0,n;if($("#VersionRemarks").val()===""||$("#VersionRemarks").val()===null||typeof $("#VersionRemarks").val()=="undefined"||$("#VersionRemarks").val()===""||$("#VersionRemarks").val()===null||typeof $("#VersionRemarks").val()=="undefined")return t=!1,$("#VersionRemarks").siblings("span").removeClass("hide"),!1;if($("#VersionRemarks").siblings("span").addClass("hide"),t=!0,t){if(n="",$("#NewVersion").siblings("span").addClass("hide"),$("#VersionRemarks").siblings("span").addClass("hide"),$("#Version").val()=="Baseline")n="Version 1";else{var r=$("#Version").val(),i=r.split(" "),u=parseInt(i[1])+1;n=i[0]+" "+u}submitData(n,!0)}},function(){submitData($("#ApprovedLatestVersion").val(),!1)})))):($(".projectName_error").text("Please select the Project"),($("#Hub").val()===null||$("#Hub").val()===""||typeof $("#Hub").val()=="undefined"||$("#Hub").val()==="0")&&$(".hubName_error").text("Please select HUB"))});$("body").on("click","#btnApprove",function(){var n=!0,t=!0,i;$("#ProjectId").val()!==null&&$("#ProjectId").val()!==""&&typeof $("#ProjectId").val()!="undefined"&&$("#ProjectId").val()!=="0"?($(".projectName_error").text(""),$("#Hub").val()===null||$("#Hub").val()===""||typeof $("#Hub").val()=="undefined"||$("#Hub").val()==="0"?$(".hubName_error").text("Please select HUB"):($(".hubName_error").text(""),i=$("#pmumapping").dataTable().$("[data-headerid]").length,i===0&&(alert("Please add atleast one WBS Header"),n=!1),$("#pmumapping").dataTable().$("[data-headerid]").each(function(i,r){var h=$(r).attr("data-headerid"),u=parseInt($(r).find("[data-slno]").attr("data-slno")),s=$("#row_"+u).find("[data-wbsheader]").attr("data-wbsheader"),f,e,o,c;if(s===null||s===""||typeof s=="undefined"?($("#row_"+u).find("[data-header]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-header]").siblings("span").addClass("hide"),f=$("#row_"+u).find("[data-duration]").val(),f===null||f===""||typeof f=="undefined"?($("#row_"+u).find("[data-duration]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-duration]").siblings("span").addClass("hide"),e=$("#row_"+u).find("[data-startdate]").val(),e===null||e===""||typeof e=="undefined"?($("#row_"+u).find("[data-startdate]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-startdate]").siblings("span").addClass("hide"),o=$("#row_"+u).find("[data-enddate]").val(),o===null||o===""||typeof o=="undefined"?($("#row_"+u).find("[data-enddate]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-enddate]").siblings("span").addClass("hide"),c=$("#pmumapping").dataTable().$('[data-relationid="'+h+'"]').length,c===0)return alert("Please add atleast one Task under WBS Header"),t=!1,!1;$("#pmumapping").dataTable().$('[data-relationid="'+h+'"]').each(function(i,r){var u=parseInt($(r).find("[data-slno]").attr("data-slno")),h=$("#row_"+u).find("[data-task]").attr("data-task"),f,e,o,s;h===null||h===""||typeof h=="undefined"?($("#row_"+u).find("[data-task]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-task]").siblings("span").addClass("hide");f=$("#row_"+u).find("[data-duration]").val();f===null||f===""||typeof f=="undefined"?($("#row_"+u).find("[data-duration]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-duration]").siblings("span").addClass("hide");e=$("#row_"+u).find("[data-startdate]").val();e===null||e===""||typeof e=="undefined"?($("#row_"+u).find("[data-startdate]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-startdate]").siblings("span").addClass("hide");o=$("#row_"+u).find("[data-enddate]").val();o===null||o===""||typeof o=="undefined"?($("#row_"+u).find("[data-enddate]").siblings("span").removeClass("hide"),t=!1):$("#row_"+u).find("[data-enddate]").siblings("span").addClass("hide");s=$("#row_"+u).find("[data-resources]").val();s===null||s===""||typeof s=="undefined"?($("#row_"+u).find("[data-resources]").siblings("span").removeClass("hide"),n=!1):$("#row_"+u).find("[data-resources]").siblings("span").addClass("hide")})}),n&&t&&confirm("Are you sure, Do you want to Approve?",function(){submitData("Baseline",!0)}))):($(".projectName_error").text("Please select the Project"),($("#Hub").val()===null||$("#Hub").val()===""||typeof $("#Hub").val()=="undefined"||$("#Hub").val()==="0")&&$(".hubName_error").text("Please select HUB"))});$("body").on("change","[data-predecessor]",function(){var u;if(this.value=this.value.replace(/[^0-9\.]/g,""),$(this).val()!==null&&$(this).val()!==""&&typeof $(this).val()!="undefined"){var n=$(this).val(),o=parseInt($("#row_"+n).find("[data-slno]").attr("data-slno")),f=parseInt($("#SelectedRow").text()),e=$("#pmumapping").dataTable().$("tr").length,s=$("#row_"+n).attr("data-headerid"),t=$("#row_"+n).find("[data-task]").val(),i=$(this).closest("tr"),r=[];if($("#pmumapping").dataTable().$("[data-headerid]").each(function(n,t){$(t).attr("data-headerid")!==null&&$(t).attr("data-headerid")!==""&&typeof $(t).attr("data-headerid")!="undefined"&&r.push(Number($(t).attr("data-headerid")))}),Number(n)==0)return $(this).val(""),alert("Dependency Value cannot be zero"),!1;if(Number(n)===f)return $(this).val(""),alert("Circular Dependency is not possible"),!1;if(jQuery.inArray(Number(n),r)!=-1)return $(this).val(""),alert("WBS Header ID cannot be considered as dependency, Please enter the valid task ID for dependency."),!1;if(parseInt(n)>e)return $(this).val(""),alert("Invalid Row Number"),!1;if(t===null||t===""||typeof t=="undefined")return $(this).val(""),alert("Please enter the task to add the dependency"),!1;$(i).find("[data-predecessortask]").text(t);$(i).find("[data-predecessortype]").val("FS");u='<tr><td><input type="text" class="form-control text-right" value="" data-predecessor="" /><\/td><td data-predecessortask=""><\/td><td><select class="form-control" data-predecessortype=""><option value="">Select<\/option><option value="FS">Finish to Start (FS)<\/option><option value="SS">Start to Start (SS)<\/option><\/select><\/td><td><input type="text" class="form-control text-right" data-predecessorleadorlag="" value="" /><\/td><td class="text-center"><div class="action_width"><button class="trash_icon ml-2" type="button" onclick="deletePredecessorRow(this)"><i class="fas fa-trash"><\/i><\/button><\/div><\/td><\/tr>';$("#dependencyTable tbody").append(u)}});$("body").on("click","#dependencypopupOk",function(){var t=$("#SelectedRow").text(),o=parseInt($("#row_"+t).attr("data-relationid")),s=$("#row_"+t),i=[],f=[],n,r,u,e;$("#dependencyTable tbody tr").each(function(n,t){var u=$(t).find("[data-predecessor]").val(),s,h;if(u!==null&&u!==""&&typeof u!="undefined"){var o=$(t).find("[data-predecessortype]").val(),r=$(t).find("[data-predecessorleadorlag]").val()!==null&&$(t).find("[data-predecessorleadorlag]").val()!==""&&typeof $(t).find("[data-predecessorleadorlag]").val()!="undefined"?parseInt($(t).find("[data-predecessorleadorlag]").val()):0,c=r===0?0:r>0?r-1:r+1,e=o==="FS"?$("#pmumapping").dataTable().$("#row_"+u).find("td [data-enddate]").val():$("#pmumapping").dataTable().$("#row_"+u).find("td [data-startdate]").val();e!==null&&e!==""&&typeof e!="undefined"&&(s=addBusinessDays(moment(e,"DD/MM/YYYY"),c),i.push(s));h=u+o+(r>=0?"+"+r:r);f.push(h)}});n=$("#pmumapping").dataTable().$("#row_"+t);i.length>0&&(r=moment.max(i),$(n).find("td [data-startdate]").val(r.format("DD/MM/YYYY")),u=$(n).find("td [data-duration]").val()!==null&&$(n).find("td [data-duration]").val()!==""&&typeof $(n).find("td [data-duration]").val()!="undefined"?Number($(n).find("td [data-duration]").val())-1:0,e=addBusinessDays(r,u),u===0&&$(n).find("td [data-duration]").val(1),$(n).find("td [data-enddate]").val(e.format("DD/MM/YYYY")));$(n).find("td [data-dependency]").val(f.join(","));smartSheetCalculation(o)});remarkscolmodels=[{name:"Notes",label:"Notes",width:60,resizable:!0,ignoreCase:!0,sortable:!1},{name:"UpdatedBy",label:"Updated By",width:40,resizable:!0,ignoreCase:!0,sortable:!1},{name:"UpdatedOn",label:"Updated On",width:40,resizable:!0,ignoreCase:!0,sortable:!1,sorttype:"date",formatter:"date",formatoptions:{newformat:"d/m/Y"}}];notesData=[];$("#ProjectId").val($("#selectedProjectId").val());projectId=parseInt($("#ProjectId").val());hubId=parseInt($("#Hub option:selected").val());$("#btnAdd").on("click",function(){$("#notes_msg").text("");$("#notes_msg").removeClass("text-red");$("#notes_msg").removeClass("text-success");var t=!0,n=$("#Notes").val(),i=parseInt($("#Hub option:selected").val()),r=parseInt($("#ProjectId").val());if(n==""||n==null||typeof n=="undefined")return $("#btnRemarks").show(),t=!1,!1;t&&$.ajax({url:ROOT+"Master/SaveNotes",type:"POST",data:{HubId:i,ProjectId:r,Notes:n},success:function(n){n.includes("Successfully")?($("#notes_msg").text(n),$("#notes_msg").addClass("text-success"),$("#notes_msg").removeClass("text-red"),$("#Notes").val(""),CreateNotesModal(i,r)):($("#notes_msg").text(n),$("#notes_msg").addClass("text-red"),$("#notes_msg").removeClass("text-success"))},error:function(){}})});$("#Notes").on("keyup",function(){$("#btnRemarks").hide()});$("body").on("click","#wbsheader",function(){getWbsHeaderGrid();$("#wbsheader-modal").modal("show")});$("body").on("click","#task",function(){getTaskGrid();$("#task-modal").modal("show")});$("body").on("click","#add-new-wbsheader,#add-new-task",function(){var e=$(this).attr("id"),n=1,t,r,i,f,u;if(e.toLowerCase().includes("wbsheader")){if(t=$("#new-wbsheader").val().trim(),t=t.replace(/\s+/g," "),t==""?($(".Err-exists-wbsheader").hide(),$(".Err-empty-wbsheader").show(),n=0):($(".Err-empty-wbsheader").hide(),n=1),n==1){for(r=0;r<autocompleteDrodownArray.WBSHeader.length;r++)if(u=autocompleteDrodownArray.WBSHeader[r].WBSHeaderDesc,u.toLowerCase()==t.toLowerCase()){n=0;$(".Err-exists-wbsheader").show();break}n==1&&$(".Err-exists-wbsheader").hide()}n==1&&saveNewWbsHeaderTask(1)}else if(e.toLowerCase().includes("task")){if(i=$("#new-task").val().trim(),i=i.replace(/\s+/g," "),i==""?($(".Err-exists-task").hide(),$(".Err-empty-task").show(),n=0):($(".Err-empty-task").hide(),n=1),n==1){for(f=0;f<autocompleteDrodownArray.Task.length;f++)if(u=autocompleteDrodownArray.Task[f].TaskDesc,u.toLowerCase()==i.toLowerCase()){n=0;$(".Err-exists-task").show();break}n==1&&$(".Err-exists-task").hide()}n==1&&saveNewWbsHeaderTask(2)}});$("body").on("change","#Version",function(){var n=$("#ApprovedLatestVersion").val(),t=$(this).val();t===n?$("#notes_span").show():$("#notes_span").hide();$.ajax({url:ROOT+"Master/CheckForApproval",type:"POST",dataType:"JSON","async":!1,data:{projectId:parseInt($("#ProjectId").val()),HubId:parseInt($("#Hub option:selected").val())},success:function(n){n.length>0?getVersionData():getVersionData()}})});$("body").on("change","#weekend-switching",function(){$("#isWeekEndExclude").val($(this).val());loadAutoCompleteDropdowns(autocompleteDrodownArray);smartSheetCalculation(0)});$("body").on("click","#save-template",function(){var n=$("#pmumapping").dataTable().$("[data-headerid]").length;if(n===0)alert("Please add atleast one row to save as template");else{$("#new-template-name").val("");$(".err-exists-template").hide();$(".err-need-template").hide();$("#save-as-template-popup").modal("show");$("body").off("click","#save-as-template").on("click","#save-as-template",function(){var i=$("#new-template-name").val().trim(),n=1,t,r;if(i=="")$(".err-exists-template").hide(),$(".err-need-template").show(),n=0;else{for($(".err-need-template").hide(),n=1,t=0;t<autocompleteDrodownArray.Template.length;t++)if(r=autocompleteDrodownArray.Template[t].TemplateName,r.toLowerCase()==i.toLowerCase()){n=0;$(".err-exists-template").show();break}n==1&&($(".err-exists-template").hide(),saveTemplateData(i))}})}});$("body").on("change","#fromtemplate",function(){$(this).val()!==null&&$(this).val()!==""&&typeof $(this).val()!="undefined"&&$(this).val()!=="0"&&getData(!0)});$("body").on("click",".confirm-cancel",function(){var n=$("#fromtemplate");n.val("0").change()});excel_documentarray=[];excelremarksarray=[];$("#ExcelDownload").on("click",function(){var r;CreateJqGrid("");var t=parseInt($("#ProjectId").val()),i=parseInt($("#Hub option:selected").val()),u=$("#ProjectId option:selected").text(),f=$("#Hub option:selected").text(),n=!0;t==0&&i==0?(alert("Please select Project and Hub"),n=!1):t==0?(alert("Please select Project "),n=!1):i==0?(alert("Please select Hub"),n=!1):(exceldatadownload(),r=$("#jqgrid").jqGrid("getGridParam","data"),r.length===0&&(alert("No data in Grid"),n=!1));n&&(isExport=!0,$("#jqgrid").jqGrid("exportToExcel",{includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,exportcol:!1,fileName:u+"_"+f+".xlsx",maxlength:1e3}),isExport=!1)});$("#MappedProjectId").on("change",function(){var n=$("#MappedProjectId").val();parseInt(n===0)||n==""?($("#MappedHubId").empty(),$("#MappedHubId").select2()):$.ajax({url:ROOT+"Master/GetNewPMUMappingsHubData",type:"GET",dataType:"JSON","async":!1,data:{ProjectId:n},success:function(n){n.length>0&&($("#MappedHubId").empty(),$("#MappedHubId").append('<option value="">-- Select the HUB--<\/option>'),$.each(n,function(n,t){$("#MappedHubId").append("<option value="+t.Value+">"+t.Text+"<\/option>")}),$("#MappedHubId").select2())},error:function(n){console.log(n)}})});$("#btnClonseSubmit").on("click",function(){var r,u;$("#notes_span").show();var n=$("#MappedProjectId").val(),t=$("#MappedHubId").val(),i=!0;(n==0||n==""||n==null||typeof n=="undefined")&&($(".FromProjectId_error").text("Please Select Project"),i=!1);(t==0||t==""||t==null||typeof t=="undefined")&&($(".FromHubId_error").text("Please Select Hub"),i=!1);i&&(r=$("#pmumapping").dataTable().$("[data-headerid]").length,u=$("#pmumapping").dataTable().$("[data-relationid]").length,u>0||r>0?confirm("Are you sure do you want to override the existing data?",function(){loadClonedProjectHubData(n,t);$("#addModal").modal("hide");$("#MappedHubId").val("").trigger("change");$("#MappedProjectId").val("").trigger("change")}):(loadClonedProjectHubData(n,t),$("#addModal").modal("hide"),$("#MappedHubId").val("").trigger("change"),$("#MappedProjectId").val("").trigger("change")))});$("#MappedProjectId").on("change",function(){$(".FromProjectId_error").text(" ")});$("#MappedHubId").on("change",function(){$(".FromHubId_error").text(" ")});ChangedSLNo="";$("body").on("change","[data-duration] , [data-startdate] ,[data-enddate] , [data-resources], [data-remarks]",function(){var n=$(this).closest("tr").find("td[data-slno]").attr("data-slno");ChangedSLNo+=n+","});$("body").on("keyup","[data-percentage]",function(){var n=$(this).closest("tr").find("td[data-slno]").attr("data-slno");ChangedSLNo+=n+","});changedSLNoForSave="";$("body").on("change","[data-files],[data-remarks]",function(){var n=$(this).closest("tr").find("td[data-slno]").attr("data-slno");changedSLNoForSave+=n+","});